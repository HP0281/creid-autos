(self.webpackChunkcrediautos=self.webpackChunkcrediautos||[]).push([[228],{8051:(Xn,be,Bt)=>{"use strict";Bt.r(be),Bt.d(be,{factory:()=>ke,getGlobalVars:()=>Mn,registerAnalytics:()=>xn,resetGlobalVars:()=>kn,settings:()=>Qe});var D=function(){return(D=Object.assign||function(it){for(var at,wt=1,dt=arguments.length;wt<dt;wt++)for(var gt in at=arguments[wt])Object.prototype.hasOwnProperty.call(at,gt)&&(it[gt]=at[gt]);return it}).apply(this,arguments)};function de(q,it,at,wt){return new(at||(at=Promise))(function(gt,Mt){function Ht(ue){try{Ft(wt.next(ue))}catch(je){Mt(je)}}function ae(ue){try{Ft(wt.throw(ue))}catch(je){Mt(je)}}function Ft(ue){ue.done?gt(ue.value):function(gt){return gt instanceof at?gt:new at(function(Mt){Mt(gt)})}(ue.value).then(Ht,ae)}Ft((wt=wt.apply(q,it||[])).next())})}function J(q,it){var wt,dt,gt,Mt,at={label:0,sent:function(){if(1&gt[0])throw gt[1];return gt[1]},trys:[],ops:[]};return Mt={next:Ht(0),throw:Ht(1),return:Ht(2)},"function"==typeof Symbol&&(Mt[Symbol.iterator]=function(){return this}),Mt;function Ht(Ft){return function(ue){return function(Ft){if(wt)throw new TypeError("Generator is already executing.");for(;at;)try{if(wt=1,dt&&(gt=2&Ft[0]?dt.return:Ft[0]?dt.throw||((gt=dt.return)&&gt.call(dt),0):dt.next)&&!(gt=gt.call(dt,Ft[1])).done)return gt;switch(dt=0,gt&&(Ft=[2&Ft[0],gt.value]),Ft[0]){case 0:case 1:gt=Ft;break;case 4:return at.label++,{value:Ft[1],done:!1};case 5:at.label++,dt=Ft[1],Ft=[0];continue;case 7:Ft=at.ops.pop(),at.trys.pop();continue;default:if(!(gt=(gt=at.trys).length>0&&gt[gt.length-1])&&(6===Ft[0]||2===Ft[0])){at=0;continue}if(3===Ft[0]&&(!gt||Ft[1]>gt[0]&&Ft[1]<gt[3])){at.label=Ft[1];break}if(6===Ft[0]&&at.label<gt[1]){at.label=gt[1],gt=Ft;break}if(gt&&at.label<gt[2]){at.label=gt[2],at.ops.push(Ft);break}gt[2]&&at.ops.pop(),at.trys.pop();continue}Ft=it.call(q,at)}catch(ue){Ft=[6,ue],dt=0}finally{wt=gt=0}if(5&Ft[0])throw Ft[1];return{value:Ft[0]?Ft[1]:void 0,done:!0}}([Ft,ue])}}}var m=Bt(6279),b=(Bt(7918),Bt(300)),A=Bt(1704),x=Bt(1100),tt="https://www.googletagmanager.com/gtag/js",yt=(()=>{return(q=yt||(yt={})).EVENT="event",q.SET="set",q.CONFIG="config",yt;var q})(),pe=(()=>{return(q=pe||(pe={})).ADD_SHIPPING_INFO="add_shipping_info",q.ADD_PAYMENT_INFO="add_payment_info",q.ADD_TO_CART="add_to_cart",q.ADD_TO_WISHLIST="add_to_wishlist",q.BEGIN_CHECKOUT="begin_checkout",q.CHECKOUT_PROGRESS="checkout_progress",q.EXCEPTION="exception",q.GENERATE_LEAD="generate_lead",q.LOGIN="login",q.PAGE_VIEW="page_view",q.PURCHASE="purchase",q.REFUND="refund",q.REMOVE_FROM_CART="remove_from_cart",q.SCREEN_VIEW="screen_view",q.SEARCH="search",q.SELECT_CONTENT="select_content",q.SELECT_ITEM="select_item",q.SELECT_PROMOTION="select_promotion",q.SET_CHECKOUT_OPTION="set_checkout_option",q.SHARE="share",q.SIGN_UP="sign_up",q.TIMING_COMPLETE="timing_complete",q.VIEW_CART="view_cart",q.VIEW_ITEM="view_item",q.VIEW_ITEM_LIST="view_item_list",q.VIEW_PROMOTION="view_promotion",q.VIEW_SEARCH_RESULTS="view_search_results",pe;var q})(),jt=new b.Logger("@firebase/analytics");function Rt(q,it,at,wt,dt,gt){return de(this,void 0,void 0,function(){var Mt,Ht,ae,Ft;return J(this,function(ue){switch(ue.label){case 0:Mt=wt[dt],ue.label=1;case 1:return ue.trys.push([1,7,,8]),Mt?[4,it[Mt]]:[3,3];case 2:return ue.sent(),[3,6];case 3:return[4,Promise.all(at)];case 4:return Ht=ue.sent(),(ae=Ht.find(function(je){return je.measurementId===dt}))?[4,it[ae.appId]]:[3,6];case 5:ue.sent(),ue.label=6;case 6:return[3,8];case 7:return Ft=ue.sent(),jt.error(Ft),[3,8];case 8:return q(yt.CONFIG,dt,gt),[2]}})})}function Oe(q,it,at,wt,dt){return de(this,void 0,void 0,function(){var gt,Mt,Ht,ae,Ft,ue,Fe;return J(this,function(bn){switch(bn.label){case 0:return bn.trys.push([0,4,,5]),gt=[],dt&&dt.send_to?(Mt=dt.send_to,Array.isArray(Mt)||(Mt=[Mt]),[4,Promise.all(at)]):[3,2];case 1:for(Ht=bn.sent(),ae=function(G){var j=Ht.find(function(et){return et.measurementId===G}),K=j&&it[j.appId];if(!K)return gt=[],"break";gt.push(K)},Ft=0,ue=Mt;Ft<ue.length&&"break"!==ae(ue[Ft]);Ft++);bn.label=2;case 2:return 0===gt.length&&(gt=Object.values(it)),[4,Promise.all(gt)];case 3:return bn.sent(),q(yt.EVENT,wt,dt||{}),[3,5];case 4:return Fe=bn.sent(),jt.error(Fe),[3,5];case 5:return[2]}})})}var _e,vn=((_e={})["already-exists"]="A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",_e["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",_e["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate: {$reason}",_e["invalid-analytics-context"]="Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",_e["indexeddb-unavailable"]="IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",_e["fetch-throttle"]="The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",_e["config-fetch-failed"]="Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",_e["no-api-key"]='The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',_e["no-app-id"]='The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',_e),le=new A.ErrorFactory("analytics","Analytics",vn),hn=new(function(){function q(it,at){void 0===it&&(it={}),void 0===at&&(at=1e3),this.throttleMetadata=it,this.intervalMillis=at}return q.prototype.getThrottleMetadata=function(it){return this.throttleMetadata[it]},q.prototype.setThrottleMetadata=function(it,at){this.throttleMetadata[it]=at},q.prototype.deleteThrottleMetadata=function(it){delete this.throttleMetadata[it]},q}());function cn(q){return new Headers({Accept:"application/json","x-goog-api-key":q})}function _n(q){var it;return de(this,void 0,void 0,function(){var at,dt,gt,Mt,Ht,ae;return J(this,function(ue){switch(ue.label){case 0:return at=q.appId,dt={method:"GET",headers:cn(q.apiKey)},gt="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",at),[4,fetch(gt,dt)];case 1:if(200===(Mt=ue.sent()).status||304===Mt.status)return[3,6];Ht="",ue.label=2;case 2:return ue.trys.push([2,4,,5]),[4,Mt.json()];case 3:return ae=ue.sent(),(null===(it=ae.error)||void 0===it?void 0:it.message)&&(Ht=ae.error.message),[3,5];case 4:return ue.sent(),[3,5];case 5:throw le.create("config-fetch-failed",{httpStatus:Mt.status,responseMessage:Ht});case 6:return[2,Mt.json()]}})})}function Ce(q,it,at,wt){var dt=it.throttleEndTimeMillis,gt=it.backoffCount;return void 0===wt&&(wt=hn),de(this,void 0,void 0,function(){var Mt,Ht,ae,Ft,ue,je,De;return J(this,function(Fe){switch(Fe.label){case 0:Mt=q.appId,Ht=q.measurementId,Fe.label=1;case 1:return Fe.trys.push([1,3,,4]),[4,we(at,dt)];case 2:return Fe.sent(),[3,4];case 3:if(ae=Fe.sent(),Ht)return jt.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+Ht+' provided in the "measurementId" field in the local Firebase config. ['+ae.message+"]"),[2,{appId:Mt,measurementId:Ht}];throw ae;case 4:return Fe.trys.push([4,6,,7]),[4,_n(q)];case 5:return Ft=Fe.sent(),wt.deleteThrottleMetadata(Mt),[2,Ft];case 6:if(!function(q){if(!(q instanceof A.FirebaseError))return!1;var it=Number(q.httpStatus);return 429===it||500===it||503===it||504===it}(ue=Fe.sent())){if(wt.deleteThrottleMetadata(Mt),Ht)return jt.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+Ht+' provided in the "measurementId" field in the local Firebase config. ['+ue.message+"]"),[2,{appId:Mt,measurementId:Ht}];throw ue}return je=503===Number(ue.httpStatus)?(0,A.calculateBackoffMillis)(gt,wt.intervalMillis,30):(0,A.calculateBackoffMillis)(gt,wt.intervalMillis),De={throttleEndTimeMillis:Date.now()+je,backoffCount:gt+1},wt.setThrottleMetadata(Mt,De),jt.debug("Calling attemptFetch again in "+je+" millis"),[2,Ce(q,De,at,wt)];case 7:return[2]}})})}function we(q,it){return new Promise(function(at,wt){var dt=Math.max(it-Date.now(),0),gt=setTimeout(at,dt);q.addEventListener(function(){clearTimeout(gt),wt(le.create("fetch-throttle",{throttleEndTimeMillis:it}))})})}var An=function(){function q(){this.listeners=[]}return q.prototype.addEventListener=function(it){this.listeners.push(it)},q.prototype.abort=function(){this.listeners.forEach(function(it){return it()})},q}();var Ee,ln,sn={},Ke=[],Ge={},Pe="dataLayer",Se="gtag",wn=!1;function kn(q,it,at){void 0===q&&(q=!1),void 0===it&&(it={}),void 0===at&&(at=[]),wn=q,sn=it,Ke=at,Pe="dataLayer",Se="gtag"}function Mn(){return{initializationPromisesMap:sn,dynamicConfigPromisesList:Ke}}function Qe(q){if(wn)throw le.create("already-initialized");q.dataLayerName&&(Pe=q.dataLayerName),q.gtagName&&(Se=q.gtagName)}function ke(q,it){!function(){var q=[];if((0,A.isBrowserExtension)()&&q.push("This is a browser extension environment."),(0,A.areCookiesEnabled)()||q.push("Cookies are not available."),q.length>0){var it=q.map(function(wt,dt){return"("+(dt+1)+") "+wt}).join(" "),at=le.create("invalid-analytics-context",{errorInfo:it});jt.warn(at.message)}}();var at=q.options.appId;if(!at)throw le.create("no-app-id");if(!q.options.apiKey){if(!q.options.measurementId)throw le.create("no-api-key");jt.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+q.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=sn[at])throw le.create("already-exists",{id:at});if(!wn){(function(){for(var q=window.document.getElementsByTagName("script"),it=0,at=Object.values(q);it<at.length;it++){var wt=at[it];if(wt.src&&wt.src.includes(tt))return wt}return null})()||function(q){var it=document.createElement("script");it.src=tt+"?l="+q,it.async=!0,document.head.appendChild(it)}(Pe),function(q){var it=[];Array.isArray(window[q])?it=window[q]:window[q]=it}(Pe);var wt=function(q,it,at,wt,dt){var gt=function(){for(var Mt=[],Ht=0;Ht<arguments.length;Ht++)Mt[Ht]=arguments[Ht];window[wt].push(arguments)};return window[dt]&&"function"==typeof window[dt]&&(gt=window[dt]),window[dt]=function(q,it,at,wt){return function(gt,Mt,Ht){return de(this,void 0,void 0,function(){var ae;return J(this,function(Ft){switch(Ft.label){case 0:return Ft.trys.push([0,6,,7]),gt!==yt.EVENT?[3,2]:[4,Oe(q,it,at,Mt,Ht)];case 1:return Ft.sent(),[3,5];case 2:return gt!==yt.CONFIG?[3,4]:[4,Rt(q,it,at,wt,Mt,Ht)];case 3:return Ft.sent(),[3,5];case 4:q(yt.SET,Mt),Ft.label=5;case 5:return[3,7];case 6:return ae=Ft.sent(),jt.error(ae),[3,7];case 7:return[2]}})})}}(gt,q,it,at),{gtagCore:gt,wrappedGtag:window[dt]}}(sn,Ke,Ge,Pe,Se);ln=wt.wrappedGtag,Ee=wt.gtagCore,wn=!0}return sn[at]=function(q,it,at,wt,dt){return de(this,void 0,void 0,function(){var gt,Mt,Ht,ae,Ft,ue,je;return J(this,function(De){switch(De.label){case 0:return(gt=function(q,it,at){return void 0===it&&(it=hn),de(this,void 0,void 0,function(){var wt,dt,gt,Mt,Ht,ae,Ft=this;return J(this,function(ue){if(gt=(wt=q.options).apiKey,Mt=wt.measurementId,!(dt=wt.appId))throw le.create("no-app-id");if(!gt){if(Mt)return[2,{measurementId:Mt,appId:dt}];throw le.create("no-api-key")}return Ht=it.getThrottleMetadata(dt)||{backoffCount:0,throttleEndTimeMillis:Date.now()},ae=new An,setTimeout(function(){return de(Ft,void 0,void 0,function(){return J(this,function(je){return ae.abort(),[2]})})},6e4),[2,Ce({appId:dt,apiKey:gt,measurementId:Mt},Ht,ae,it)]})})}(q)).then(function(Fe){at[Fe.measurementId]=Fe.appId,q.options.measurementId&&Fe.measurementId!==q.options.measurementId&&jt.warn("The measurement ID in the local Firebase config ("+q.options.measurementId+") does not match the measurement ID fetched from the server ("+Fe.measurementId+"). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(function(Fe){return jt.error(Fe)}),it.push(gt),Mt=function(){return de(this,void 0,void 0,function(){var q;return J(this,function(it){switch(it.label){case 0:return(0,A.isIndexedDBAvailable)()?[3,1]:(jt.warn(le.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),[2,!1]);case 1:return it.trys.push([1,3,,4]),[4,(0,A.validateIndexedDBOpenable)()];case 2:return it.sent(),[3,4];case 3:return q=it.sent(),jt.warn(le.create("indexeddb-unavailable",{errorInfo:q}).message),[2,!1];case 4:return[2,!0]}})})}().then(function(Fe){if(Fe)return wt.getId()}),[4,Promise.all([gt,Mt])];case 1:return Ht=De.sent(),ae=Ht[0],Ft=Ht[1],dt("js",new Date),(je={}).origin="firebase",je.update=!0,ue=je,null!=Ft&&(ue.firebase_id=Ft),dt(yt.CONFIG,ae.measurementId,ue),[2,ae.measurementId]}})})}(q,Ke,Ge,it,Ee),{app:q,logEvent:function(Ht,ae,Ft){(function(q,it,at,wt,dt){return de(this,void 0,void 0,function(){var gt,Mt;return J(this,function(Ht){switch(Ht.label){case 0:return dt&&dt.global?(q(yt.EVENT,at,wt),[2]):[3,1];case 1:return[4,it];case 2:gt=Ht.sent(),Mt=D(D({},wt),{send_to:gt}),q(yt.EVENT,at,Mt),Ht.label=3;case 3:return[2]}})})})(ln,sn[at],Ht,ae,Ft).catch(function(ue){return jt.error(ue)})},setCurrentScreen:function(Ht,ae){(function(q,it,at,wt){return de(this,void 0,void 0,function(){var dt;return J(this,function(gt){switch(gt.label){case 0:return wt&&wt.global?(q(yt.SET,{screen_name:at}),[2,Promise.resolve()]):[3,1];case 1:return[4,it];case 2:dt=gt.sent(),q(yt.CONFIG,dt,{update:!0,screen_name:at}),gt.label=3;case 3:return[2]}})})})(ln,sn[at],Ht,ae).catch(function(Ft){return jt.error(Ft)})},setUserId:function(Ht,ae){(function(q,it,at,wt){return de(this,void 0,void 0,function(){var dt;return J(this,function(gt){switch(gt.label){case 0:return wt&&wt.global?(q(yt.SET,{user_id:at}),[2,Promise.resolve()]):[3,1];case 1:return[4,it];case 2:dt=gt.sent(),q(yt.CONFIG,dt,{update:!0,user_id:at}),gt.label=3;case 3:return[2]}})})})(ln,sn[at],Ht,ae).catch(function(Ft){return jt.error(Ft)})},setUserProperties:function(Ht,ae){(function(q,it,at,wt){return de(this,void 0,void 0,function(){var dt,gt,Mt,Ht,ae;return J(this,function(Ft){switch(Ft.label){case 0:if(!wt||!wt.global)return[3,1];for(dt={},gt=0,Mt=Object.keys(at);gt<Mt.length;gt++)dt["user_properties."+(Ht=Mt[gt])]=at[Ht];return q(yt.SET,dt),[2,Promise.resolve()];case 1:return[4,it];case 2:ae=Ft.sent(),q(yt.CONFIG,ae,{update:!0,user_properties:at}),Ft.label=3;case 3:return[2]}})})})(ln,sn[at],Ht,ae).catch(function(Ft){return jt.error(Ft)})},setAnalyticsCollectionEnabled:function(Ht){(function(q,it){return de(this,void 0,void 0,function(){var at;return J(this,function(wt){switch(wt.label){case 0:return[4,q];case 1:return at=wt.sent(),window["ga-disable-"+at]=!it,[2]}})})})(sn[at],Ht).catch(function(ae){return jt.error(ae)})},INTERNAL:{delete:function(){return delete sn[at],Promise.resolve()}}}}var Fn="analytics";function xn(q){q.INTERNAL.registerComponent(new x.Component(Fn,function(at){return ke(at.getProvider("app").getImmediate(),at.getProvider("installations").getImmediate())},"PUBLIC").setServiceProps({settings:Qe,EventName:pe,isSupported:Hn})),q.INTERNAL.registerComponent(new x.Component("analytics-internal",function(at){try{return{logEvent:at.getProvider(Fn).getImmediate().logEvent}}catch(dt){throw le.create("interop-component-reg-failed",{reason:dt})}},"PRIVATE")),q.registerVersion("@firebase/analytics","0.6.0")}function Hn(){return de(this,void 0,void 0,function(){return J(this,function(at){switch(at.label){case 0:if((0,A.isBrowserExtension)())return[2,!1];if(!(0,A.areCookiesEnabled)())return[2,!1];if(!(0,A.isIndexedDBAvailable)())return[2,!1];at.label=1;case 1:return at.trys.push([1,3,,4]),[4,(0,A.validateIndexedDBOpenable)()];case 2:return[2,at.sent()];case 3:return at.sent(),[2,!1];case 4:return[2]}})})}xn(m.default)},4614:(Xn,be,Bt)=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});var B=Bt(6279),Dt=Bt(209),D=Bt(1704),Te=Bt(300),St=Bt(1100);function Ne(a){return a&&"object"==typeof a&&"default"in a?a:{default:a}}var a,Yt=Ne(B),de=function(){function a(r){this.domStorage_=r,this.prefix_="firebase:"}return a.prototype.set=function(r,o){null==o?this.domStorage_.removeItem(this.prefixedName_(r)):this.domStorage_.setItem(this.prefixedName_(r),D.stringify(o))},a.prototype.get=function(r){var o=this.domStorage_.getItem(this.prefixedName_(r));return null==o?null:D.jsonEval(o)},a.prototype.remove=function(r){this.domStorage_.removeItem(this.prefixedName_(r))},a.prototype.prefixedName_=function(r){return this.prefix_+r},a.prototype.toString=function(){return this.domStorage_.toString()},a}(),J=function(){function a(){this.cache_={},this.isInMemoryStorage=!0}return a.prototype.set=function(r,o){null==o?delete this.cache_[r]:this.cache_[r]=o},a.prototype.get=function(r){return D.contains(this.cache_,r)?this.cache_[r]:null},a.prototype.remove=function(r){delete this.cache_[r]},a}(),ut=function(a){try{if("undefined"!=typeof window&&void 0!==window[a]){var r=window[a];return r.setItem("firebase:sentinel","cache"),r.removeItem("firebase:sentinel"),new de(r)}}catch(o){}return new J},Lt=ut("localStorage"),ee=ut("sessionStorage"),Tt=new Te.Logger("@firebase/database"),ge=(a=1,function(){return a++}),Xe=function(a){var r=D.stringToByteArray(a),o=new D.Sha1;o.update(r);var c=o.digest();return D.base64.encodeByteArray(c)},ve=function(){for(var a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];for(var o="",c=0;c<a.length;c++){var h=a[c];Array.isArray(h)||h&&"object"==typeof h&&"number"==typeof h.length?o+=ve.apply(null,h):o+="object"==typeof h?D.stringify(h):h,o+=" "}return o},ct=null,Ct=!0,mt=function(a,r){D.assert(!r||!0===a||!1===a,"Can't turn on custom loggers persistently."),!0===a?(Tt.logLevel=Te.LogLevel.VERBOSE,ct=Tt.log.bind(Tt),r&&ee.set("logging_enabled",!0)):"function"==typeof a?ct=a:(ct=null,ee.remove("logging_enabled"))},Kt=function(){for(var a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];if(!0===Ct&&(Ct=!1,null===ct&&!0===ee.get("logging_enabled")&&mt(!0)),ct){var o=ve.apply(null,a);ct(o)}},ne=function(a){return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];Kt.apply(void 0,Dt.__spread([a],r))}},qt=function(){for(var a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];var o="FIREBASE INTERNAL ERROR: "+ve.apply(void 0,Dt.__spread(a));Tt.error(o)},xt=function(){for(var a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];var o="FIREBASE FATAL ERROR: "+ve.apply(void 0,Dt.__spread(a));throw Tt.error(o),new Error(o)},At=function(){for(var a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];var o="FIREBASE WARNING: "+ve.apply(void 0,Dt.__spread(a));Tt.warn(o)},S=function(a){return"number"==typeof a&&(a!=a||a===Number.POSITIVE_INFINITY||a===Number.NEGATIVE_INFINITY)},A="[MIN_NAME]",x="[MAX_NAME]",T=function(a,r){if(a===r)return 0;if(a===A||r===x)return-1;if(r===A||a===x)return 1;var o=re(a),c=re(r);return null!==o?null!==c?o-c==0?a.length-r.length:o-c:-1:null!==c?1:a<r?-1:1},z=function(a,r){return a===r?0:a<r?-1:1},Y=function(a,r){if(r&&a in r)return r[a];throw new Error("Missing required key ("+a+") in object: "+D.stringify(r))},Xt=function(a){if("object"!=typeof a||null===a)return D.stringify(a);var r=[];for(var o in a)r.push(o);r.sort();for(var c="{",h=0;h<r.length;h++)0!==h&&(c+=","),c+=D.stringify(r[h]),c+=":",c+=Xt(a[r[h]]);return c+"}"},tt=function(a,r){var o=a.length;if(o<=r)return[a];for(var c=[],h=0;h<o;h+=r)c.push(a.substring(h,h+r>o?o:h+r));return c};function yt(a,r){for(var o in a)a.hasOwnProperty(o)&&r(o,a[o])}var at,gt,Ft,je,De,Q,pe=function(a){D.assert(!S(a),"Invalid JSON number");var h,p,I,R,F,c=1023;0===a?(p=0,I=0,h=1/a==-1/0?1:0):(h=a<0,(a=Math.abs(a))>=Math.pow(2,1-c)?(p=(R=Math.min(Math.floor(Math.log(a)/Math.LN2),c))+c,I=Math.round(a*Math.pow(2,52-R)-Math.pow(2,52))):(p=0,I=Math.round(a/Math.pow(2,-1074))));var k=[];for(F=52;F;F-=1)k.push(I%2?1:0),I=Math.floor(I/2);for(F=11;F;F-=1)k.push(p%2?1:0),p=Math.floor(p/2);k.push(h?1:0),k.reverse();var ot=k.join(""),pt="";for(F=0;F<64;F+=8){var _t=parseInt(ot.substr(F,8),2).toString(16);1===_t.length&&(_t="0"+_t),pt+=_t}return pt.toLowerCase()},Nt=new RegExp("^-?(0*)\\d{1,10}$"),re=function(a){if(Nt.test(a)){var r=Number(a);if(r>=-2147483648&&r<=2147483647)return r}return null},jt=function(a){try{a()}catch(r){setTimeout(function(){throw At("Exception was thrown by user callback.",r.stack||""),r},Math.floor(0))}},ye=function(a,r){var o=setTimeout(a,r);return"object"==typeof o&&o.unref&&o.unref(),o},Rt=function(){function a(r,o){if(void 0===o){this.pieces_=r.split("/");for(var c=0,h=0;h<this.pieces_.length;h++)this.pieces_[h].length>0&&(this.pieces_[c]=this.pieces_[h],c++);this.pieces_.length=c,this.pieceNum_=0}else this.pieces_=r,this.pieceNum_=o}return Object.defineProperty(a,"Empty",{get:function(){return new a("")},enumerable:!1,configurable:!0}),a.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},a.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},a.prototype.popFront=function(){var r=this.pieceNum_;return r<this.pieces_.length&&r++,new a(this.pieces_,r)},a.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},a.prototype.toString=function(){for(var r="",o=this.pieceNum_;o<this.pieces_.length;o++)""!==this.pieces_[o]&&(r+="/"+this.pieces_[o]);return r||"/"},a.prototype.toUrlEncodedString=function(){for(var r="",o=this.pieceNum_;o<this.pieces_.length;o++)""!==this.pieces_[o]&&(r+="/"+encodeURIComponent(String(this.pieces_[o])));return r||"/"},a.prototype.slice=function(r){return void 0===r&&(r=0),this.pieces_.slice(this.pieceNum_+r)},a.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var r=[],o=this.pieceNum_;o<this.pieces_.length-1;o++)r.push(this.pieces_[o]);return new a(r,0)},a.prototype.child=function(r){for(var o=[],c=this.pieceNum_;c<this.pieces_.length;c++)o.push(this.pieces_[c]);if(r instanceof a)for(c=r.pieceNum_;c<r.pieces_.length;c++)o.push(r.pieces_[c]);else{var h=r.split("/");for(c=0;c<h.length;c++)h[c].length>0&&o.push(h[c])}return new a(o,0)},a.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},a.relativePath=function(r,o){var c=r.getFront(),h=o.getFront();if(null===c)return o;if(c===h)return a.relativePath(r.popFront(),o.popFront());throw new Error("INTERNAL ERROR: innerPath ("+o+") is not within outerPath ("+r+")")},a.comparePaths=function(r,o){for(var c=r.slice(),h=o.slice(),p=0;p<c.length&&p<h.length;p++){var I=T(c[p],h[p]);if(0!==I)return I}return c.length===h.length?0:c.length<h.length?-1:1},a.prototype.equals=function(r){if(this.getLength()!==r.getLength())return!1;for(var o=this.pieceNum_,c=r.pieceNum_;o<=this.pieces_.length;o++,c++)if(this.pieces_[o]!==r.pieces_[c])return!1;return!0},a.prototype.contains=function(r){var o=this.pieceNum_,c=r.pieceNum_;if(this.getLength()>r.getLength())return!1;for(;o<this.pieces_.length;){if(this.pieces_[o]!==r.pieces_[c])return!1;++o,++c}return!0},a}(),Oe=function(){function a(r,o){this.errorPrefix_=o,this.parts_=r.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var c=0;c<this.parts_.length;c++)this.byteLength_+=D.stringLength(this.parts_[c]);this.checkValid_()}return Object.defineProperty(a,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(a,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),a.prototype.push=function(r){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(r),this.byteLength_+=D.stringLength(r),this.checkValid_()},a.prototype.pop=function(){var r=this.parts_.pop();this.byteLength_-=D.stringLength(r),this.parts_.length>0&&(this.byteLength_-=1)},a.prototype.checkValid_=function(){if(this.byteLength_>a.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+a.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>a.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+a.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},a.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},a}(),le="firebaseio.com",Sn="websocket",hn="long_polling",cn=function(){function a(r,o,c,h,p,I,R){void 0===p&&(p=!1),void 0===I&&(I=""),void 0===R&&(R=!1),this.secure=o,this.namespace=c,this.webSocketOnly=h,this.nodeAdmin=p,this.persistenceKey=I,this.includeNamespaceInQueryParams=R,this.host=r.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=Lt.get("host:"+r)||this.host}return a.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},a.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},a.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},a.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},a.prototype.updateHost=function(r){r!==this.internalHost&&(this.internalHost=r,this.isCacheableHost()&&Lt.set("host:"+this.host,this.internalHost))},a.prototype.connectionURL=function(r,o){var c;if(D.assert("string"==typeof r,"typeof type must == string"),D.assert("object"==typeof o,"typeof params must == object"),r===Sn)c=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(r!==hn)throw new Error("Unknown connection type: "+r);c=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(o.ns=this.namespace);var h=[];return yt(o,function(p,I){h.push(p+"="+I)}),c+h.join("&")},a.prototype.toString=function(){var r=this.toURLString();return this.persistenceKey&&(r+="<"+this.persistenceKey+">"),r},a.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},a}(),Ce=function(a,r){var o=we(a),c=o.namespace;return"firebase.com"===o.domain&&xt(o.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!c||"undefined"===c)&&"localhost"!==o.domain&&xt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),o.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&At("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new cn(o.host,o.secure,c,r,"ws"===o.scheme||"wss"===o.scheme,"",c!==o.subdomain),path:new Rt(o.pathString)}},we=function(a){var r="",o="",c="",h="",p="",I=!0,R="https",F=443;if("string"==typeof a){var k=a.indexOf("//");k>=0&&(R=a.substring(0,k-1),a=a.substring(k+2));var ot=a.indexOf("/");-1===ot&&(ot=a.length);var pt=a.indexOf("?");-1===pt&&(pt=a.length),r=a.substring(0,Math.min(ot,pt)),ot<pt&&(h=function(a){for(var r="",o=a.split("/"),c=0;c<o.length;c++)if(o[c].length>0){var h=o[c];try{h=decodeURIComponent(h.replace(/\+/g," "))}catch(p){}r+="/"+h}return r}(a.substring(ot,pt)));var _t=function(a){var r,o,c={};"?"===a.charAt(0)&&(a=a.substring(1));try{for(var h=Dt.__values(a.split("&")),p=h.next();!p.done;p=h.next()){var I=p.value;if(0!==I.length){var R=I.split("=");2===R.length?c[decodeURIComponent(R[0])]=decodeURIComponent(R[1]):At("Invalid query segment '"+I+"' in query '"+a+"'")}}}catch(F){r={error:F}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}return c}(a.substring(Math.min(a.length,pt)));(k=r.indexOf(":"))>=0?(I="https"===R||"wss"===R,F=parseInt(r.substring(k+1),10)):k=r.length;var Ut=r.slice(0,k);if("localhost"===Ut.toLowerCase())o="localhost";else if(Ut.split(".").length<=2)o=Ut;else{var $t=r.indexOf(".");c=r.substring(0,$t).toLowerCase(),o=r.substring($t+1),p=c}"ns"in _t&&(p=_t.ns)}return{host:r,port:F,domain:o,subdomain:c,secure:I,scheme:R,pathString:h,namespace:p}},Cn=/[\[\].#$\/\u0000-\u001F\u007F]/,An=/[\[\].#$\u0000-\u001F\u007F]/,fe=10485760,$e=function(a){return"string"==typeof a&&0!==a.length&&!Cn.test(a)},sn=function(a){return"string"==typeof a&&0!==a.length&&!An.test(a)},Ge=function(a){return null===a||"string"==typeof a||"number"==typeof a&&!S(a)||a&&"object"==typeof a&&D.contains(a,".sv")},Pe=function(a,r,o,c,h){h&&void 0===o||Se(D.errorPrefix(a,r,h),o,c)},Se=function(a,r,o){var c=o instanceof Rt?new Oe(o,a):o;if(void 0===r)throw new Error(a+"contains undefined "+c.toErrorString());if("function"==typeof r)throw new Error(a+"contains a function "+c.toErrorString()+" with contents = "+r.toString());if(S(r))throw new Error(a+"contains "+r.toString()+" "+c.toErrorString());if("string"==typeof r&&r.length>fe/3&&D.stringLength(r)>fe)throw new Error(a+"contains a string greater than "+fe+" utf8 bytes "+c.toErrorString()+" ('"+r.substring(0,50)+"...')");if(r&&"object"==typeof r){var h=!1,p=!1;if(yt(r,function(I,R){if(".value"===I)h=!0;else if(".priority"!==I&&".sv"!==I&&(p=!0,!$e(I)))throw new Error(a+" contains an invalid key ("+I+") "+c.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');c.push(I),Se(a,R,c),c.pop()}),h&&p)throw new Error(a+' contains ".value" child '+c.toErrorString()+" in addition to actual children.")}},ln=function(a,r,o,c,h){if(!h||void 0!==o){var p=D.errorPrefix(a,r,h);if(!o||"object"!=typeof o||Array.isArray(o))throw new Error(p+" must be an object containing the children to replace.");var I=[];yt(o,function(R,F){var k=new Rt(R);if(Se(p,F,c.child(k)),".priority"===k.getBack()&&!Ge(F))throw new Error(p+"contains an invalid value for '"+k.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");I.push(k)}),function(a,r){var o,c;for(o=0;o<r.length;o++)for(var h=(c=r[o]).slice(),p=0;p<h.length;p++)if((".priority"!==h[p]||p!==h.length-1)&&!$e(h[p]))throw new Error(a+"contains an invalid key ("+h[p]+") in path "+c.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.sort(Rt.comparePaths);var I=null;for(o=0;o<r.length;o++){if(c=r[o],null!==I&&I.contains(c))throw new Error(a+"contains a path "+I.toString()+" that is ancestor of another path "+c.toString());I=c}}(p,I)}},wn=function(a,r,o,c){if(!c||void 0!==o){if(S(o))throw new Error(D.errorPrefix(a,r,c)+"is "+o.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ge(o))throw new Error(D.errorPrefix(a,r,c)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},kn=function(a,r,o,c){if(!c||void 0!==o)switch(o){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(D.errorPrefix(a,r,c)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Mn=function(a,r,o,c){if(!(c&&void 0===o||$e(o)))throw new Error(D.errorPrefix(a,r,c)+'was an invalid key = "'+o+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Qe=function(a,r,o,c){if(!(c&&void 0===o||sn(o)))throw new Error(D.errorPrefix(a,r,c)+'was an invalid path = "'+o+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Dn=function(a,r,o,c){o&&(o=o.replace(/^\/*\.info(\/|$)/,"/")),Qe(a,r,o,c)},ke=function(a,r){if(".info"===r.getFront())throw new Error(a+" failed = Can't modify data under /.info/")},Je=function(a,r,o){var c=o.path.toString();if("string"!=typeof o.repoInfo.host||0===o.repoInfo.host.length||!$e(o.repoInfo.namespace)&&"localhost"!==o.repoInfo.host.split(":")[0]||0!==c.length&&!function(a){return a&&(a=a.replace(/^\/*\.info(\/|$)/,"/")),sn(a)}(c))throw new Error(D.errorPrefix(a,r,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},Wn=function(a,r,o,c){if((!c||void 0!==o)&&"boolean"!=typeof o)throw new Error(D.errorPrefix(a,r,c)+"must be a boolean.")},Fn=function(){function a(r,o){this.repo_=r,this.path_=o}return a.prototype.cancel=function(r){D.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),D.validateCallback("OnDisconnect.cancel",1,r,!0);var o=new D.Deferred;return this.repo_.onDisconnectCancel(this.path_,o.wrapCallback(r)),o.promise},a.prototype.remove=function(r){D.validateArgCount("OnDisconnect.remove",0,1,arguments.length),ke("OnDisconnect.remove",this.path_),D.validateCallback("OnDisconnect.remove",1,r,!0);var o=new D.Deferred;return this.repo_.onDisconnectSet(this.path_,null,o.wrapCallback(r)),o.promise},a.prototype.set=function(r,o){D.validateArgCount("OnDisconnect.set",1,2,arguments.length),ke("OnDisconnect.set",this.path_),Pe("OnDisconnect.set",1,r,this.path_,!1),D.validateCallback("OnDisconnect.set",2,o,!0);var c=new D.Deferred;return this.repo_.onDisconnectSet(this.path_,r,c.wrapCallback(o)),c.promise},a.prototype.setWithPriority=function(r,o,c){D.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),ke("OnDisconnect.setWithPriority",this.path_),Pe("OnDisconnect.setWithPriority",1,r,this.path_,!1),wn("OnDisconnect.setWithPriority",2,o,!1),D.validateCallback("OnDisconnect.setWithPriority",3,c,!0);var h=new D.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,r,o,h.wrapCallback(c)),h.promise},a.prototype.update=function(r,o){if(D.validateArgCount("OnDisconnect.update",1,2,arguments.length),ke("OnDisconnect.update",this.path_),Array.isArray(r)){for(var c={},h=0;h<r.length;++h)c[""+h]=r[h];r=c,At("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ln("OnDisconnect.update",1,r,this.path_,!1),D.validateCallback("OnDisconnect.update",2,o,!0);var p=new D.Deferred;return this.repo_.onDisconnectUpdate(this.path_,r,p.wrapCallback(o)),p.promise},a}(),xn=function(){function a(r,o){this.committed=r,this.snapshot=o}return a.prototype.toJSON=function(){return D.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},a}(),Hn=function(){var a="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",r=0,o=[];return function(c){var h=c===r;r=c;var p,I=new Array(8);for(p=7;p>=0;p--)I[p]=a.charAt(c%64),c=Math.floor(c/64);D.assert(0===c,"Cannot push at time == 0");var R=I.join("");if(h){for(p=11;p>=0&&63===o[p];p--)o[p]=0;o[p]++}else for(p=0;p<12;p++)o[p]=Math.floor(64*Math.random());for(p=0;p<12;p++)R+=a.charAt(o[p]);return D.assert(20===R.length,"nextPushId: Length should be 20."),R}}(),q=function(){function a(r,o){this.name=r,this.node=o}return a.Wrap=function(r,o){return new a(r,o)},a}(),it=function(){function a(){}return a.prototype.getCompare=function(){return this.compare.bind(this)},a.prototype.indexedValueChanged=function(r,o){var c=new q(A,r),h=new q(A,o);return 0!==this.compare(c,h)},a.prototype.minPost=function(){return q.MIN},a}(),wt=function(a){function r(){return null!==a&&a.apply(this,arguments)||this}return Dt.__extends(r,a),Object.defineProperty(r,"__EMPTY_NODE",{get:function(){return at},set:function(o){at=o},enumerable:!1,configurable:!0}),r.prototype.compare=function(o,c){return T(o.name,c.name)},r.prototype.isDefinedOn=function(o){throw D.assertionError("KeyIndex.isDefinedOn not expected to be called.")},r.prototype.indexedValueChanged=function(o,c){return!1},r.prototype.minPost=function(){return q.MIN},r.prototype.maxPost=function(){return new q(x,at)},r.prototype.makePost=function(o,c){return D.assert("string"==typeof o,"KeyIndex indexValue must always be a string."),new q(o,at)},r.prototype.toString=function(){return".key"},r}(it),dt=new wt,Ht=function(a){return"number"==typeof a?"number:"+pe(a):"string:"+a},ae=function(a){if(a.isLeafNode()){var r=a.val();D.assert("string"==typeof r||"number"==typeof r||"object"==typeof r&&D.contains(r,".sv"),"Priority must be a string or number.")}else D.assert(a===gt||a.isEmpty(),"priority of unexpected type.");D.assert(a===gt||a.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},ue=function(){function a(r,o){void 0===o&&(o=a.__childrenNodeConstructor.EMPTY_NODE),this.value_=r,this.priorityNode_=o,this.lazyHash_=null,D.assert(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),ae(this.priorityNode_)}return Object.defineProperty(a,"__childrenNodeConstructor",{get:function(){return Ft},set:function(r){Ft=r},enumerable:!1,configurable:!0}),a.prototype.isLeafNode=function(){return!0},a.prototype.getPriority=function(){return this.priorityNode_},a.prototype.updatePriority=function(r){return new a(this.value_,r)},a.prototype.getImmediateChild=function(r){return".priority"===r?this.priorityNode_:a.__childrenNodeConstructor.EMPTY_NODE},a.prototype.getChild=function(r){return r.isEmpty()?this:".priority"===r.getFront()?this.priorityNode_:a.__childrenNodeConstructor.EMPTY_NODE},a.prototype.hasChild=function(){return!1},a.prototype.getPredecessorChildName=function(r,o){return null},a.prototype.updateImmediateChild=function(r,o){return".priority"===r?this.updatePriority(o):o.isEmpty()&&".priority"!==r?this:a.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(r,o).updatePriority(this.priorityNode_)},a.prototype.updateChild=function(r,o){var c=r.getFront();return null===c?o:o.isEmpty()&&".priority"!==c?this:(D.assert(".priority"!==c||1===r.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(c,a.__childrenNodeConstructor.EMPTY_NODE.updateChild(r.popFront(),o)))},a.prototype.isEmpty=function(){return!1},a.prototype.numChildren=function(){return 0},a.prototype.forEachChild=function(r,o){return!1},a.prototype.val=function(r){return r&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},a.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.priorityNode_.isEmpty()||(r+="priority:"+Ht(this.priorityNode_.val())+":");var o=typeof this.value_;r+=o+":",r+="number"===o?pe(this.value_):this.value_,this.lazyHash_=Xe(r)}return this.lazyHash_},a.prototype.getValue=function(){return this.value_},a.prototype.compareTo=function(r){return r===a.__childrenNodeConstructor.EMPTY_NODE?1:r instanceof a.__childrenNodeConstructor?-1:(D.assert(r.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(r))},a.prototype.compareToLeafNode_=function(r){var o=typeof r.value_,c=typeof this.value_,h=a.VALUE_TYPE_ORDER.indexOf(o),p=a.VALUE_TYPE_ORDER.indexOf(c);return D.assert(h>=0,"Unknown leaf type: "+o),D.assert(p>=0,"Unknown leaf type: "+c),h===p?"object"===c?0:this.value_<r.value_?-1:this.value_===r.value_?0:1:p-h},a.prototype.withIndex=function(){return this},a.prototype.isIndexed=function(){return!0},a.prototype.equals=function(r){return r===this||!!r.isLeafNode()&&(this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_))},a.VALUE_TYPE_ORDER=["object","boolean","number","string"],a}(),j=new(function(a){function r(){return null!==a&&a.apply(this,arguments)||this}return Dt.__extends(r,a),r.prototype.compare=function(o,c){var h=o.node.getPriority(),p=c.node.getPriority(),I=h.compareTo(p);return 0===I?T(o.name,c.name):I},r.prototype.isDefinedOn=function(o){return!o.getPriority().isEmpty()},r.prototype.indexedValueChanged=function(o,c){return!o.getPriority().equals(c.getPriority())},r.prototype.minPost=function(){return q.MIN},r.prototype.maxPost=function(){return new q(x,new ue("[PRIORITY-POST]",De))},r.prototype.makePost=function(o,c){var h=je(o);return new q(c,new ue("[PRIORITY-POST]",h))},r.prototype.toString=function(){return".priority"},r}(it)),K=function(){function a(r,o,c,h,p){void 0===p&&(p=null),this.isReverse_=h,this.resultGenerator_=p,this.nodeStack_=[];for(var I=1;!r.isEmpty();)if(r=r,I=o?c(r.key,o):1,h&&(I*=-1),I<0)r=this.isReverse_?r.left:r.right;else{if(0===I){this.nodeStack_.push(r);break}this.nodeStack_.push(r),r=this.isReverse_?r.right:r.left}}return a.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var o,r=this.nodeStack_.pop();if(o=this.resultGenerator_?this.resultGenerator_(r.key,r.value):{key:r.key,value:r.value},this.isReverse_)for(r=r.left;!r.isEmpty();)this.nodeStack_.push(r),r=r.right;else for(r=r.right;!r.isEmpty();)this.nodeStack_.push(r),r=r.left;return o},a.prototype.hasNext=function(){return this.nodeStack_.length>0},a.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var r=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(r.key,r.value):{key:r.key,value:r.value}},a}(),et=function(){function a(r,o,c,h,p){this.key=r,this.value=o,this.color=null!=c?c:a.RED,this.left=null!=h?h:y.EMPTY_NODE,this.right=null!=p?p:y.EMPTY_NODE}return a.prototype.copy=function(r,o,c,h,p){return new a(null!=r?r:this.key,null!=o?o:this.value,null!=c?c:this.color,null!=h?h:this.left,null!=p?p:this.right)},a.prototype.count=function(){return this.left.count()+1+this.right.count()},a.prototype.isEmpty=function(){return!1},a.prototype.inorderTraversal=function(r){return this.left.inorderTraversal(r)||!!r(this.key,this.value)||this.right.inorderTraversal(r)},a.prototype.reverseTraversal=function(r){return this.right.reverseTraversal(r)||r(this.key,this.value)||this.left.reverseTraversal(r)},a.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},a.prototype.minKey=function(){return this.min_().key},a.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},a.prototype.insert=function(r,o,c){var h=this,p=c(r,h.key);return(h=p<0?h.copy(null,null,null,h.left.insert(r,o,c),null):0===p?h.copy(null,o,null,null,null):h.copy(null,null,null,null,h.right.insert(r,o,c))).fixUp_()},a.prototype.removeMin_=function(){if(this.left.isEmpty())return y.EMPTY_NODE;var r=this;return!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),(r=r.copy(null,null,null,r.left.removeMin_(),null)).fixUp_()},a.prototype.remove=function(r,o){var c,h;if(o(r,(c=this).key)<0)!c.left.isEmpty()&&!c.left.isRed_()&&!c.left.left.isRed_()&&(c=c.moveRedLeft_()),c=c.copy(null,null,null,c.left.remove(r,o),null);else{if(c.left.isRed_()&&(c=c.rotateRight_()),!c.right.isEmpty()&&!c.right.isRed_()&&!c.right.left.isRed_()&&(c=c.moveRedRight_()),0===o(r,c.key)){if(c.right.isEmpty())return y.EMPTY_NODE;h=c.right.min_(),c=c.copy(h.key,h.value,null,null,c.right.removeMin_())}c=c.copy(null,null,null,null,c.right.remove(r,o))}return c.fixUp_()},a.prototype.isRed_=function(){return this.color},a.prototype.fixUp_=function(){var r=this;return r.right.isRed_()&&!r.left.isRed_()&&(r=r.rotateLeft_()),r.left.isRed_()&&r.left.left.isRed_()&&(r=r.rotateRight_()),r.left.isRed_()&&r.right.isRed_()&&(r=r.colorFlip_()),r},a.prototype.moveRedLeft_=function(){var r=this.colorFlip_();return r.right.left.isRed_()&&(r=(r=(r=r.copy(null,null,null,null,r.right.rotateRight_())).rotateLeft_()).colorFlip_()),r},a.prototype.moveRedRight_=function(){var r=this.colorFlip_();return r.left.left.isRed_()&&(r=(r=r.rotateRight_()).colorFlip_()),r},a.prototype.rotateLeft_=function(){var r=this.copy(null,null,a.RED,null,this.right.left);return this.right.copy(null,null,this.color,r,null)},a.prototype.rotateRight_=function(){var r=this.copy(null,null,a.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,r)},a.prototype.colorFlip_=function(){var r=this.left.copy(null,null,!this.left.color,null,null),o=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,r,o)},a.prototype.checkMaxDepth_=function(){var r=this.check_();return Math.pow(2,r)<=this.count()+1},a.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var r=this.left.check_();if(r!==this.right.check_())throw new Error("Black depths differ");return r+(this.isRed_()?0:1)},a.RED=!0,a.BLACK=!1,a}(),P=function(){function a(){}return a.prototype.copy=function(r,o,c,h,p){return this},a.prototype.insert=function(r,o,c){return new et(r,o,null)},a.prototype.remove=function(r,o){return this},a.prototype.count=function(){return 0},a.prototype.isEmpty=function(){return!0},a.prototype.inorderTraversal=function(r){return!1},a.prototype.reverseTraversal=function(r){return!1},a.prototype.minKey=function(){return null},a.prototype.maxKey=function(){return null},a.prototype.check_=function(){return 0},a.prototype.isRed_=function(){return!1},a}(),y=function(){function a(r,o){void 0===o&&(o=a.EMPTY_NODE),this.comparator_=r,this.root_=o}return a.prototype.insert=function(r,o){return new a(this.comparator_,this.root_.insert(r,o,this.comparator_).copy(null,null,et.BLACK,null,null))},a.prototype.remove=function(r){return new a(this.comparator_,this.root_.remove(r,this.comparator_).copy(null,null,et.BLACK,null,null))},a.prototype.get=function(r){for(var o,c=this.root_;!c.isEmpty();){if(0===(o=this.comparator_(r,c.key)))return c.value;o<0?c=c.left:o>0&&(c=c.right)}return null},a.prototype.getPredecessorKey=function(r){for(var o,c=this.root_,h=null;!c.isEmpty();){if(0===(o=this.comparator_(r,c.key))){if(c.left.isEmpty())return h?h.key:null;for(c=c.left;!c.right.isEmpty();)c=c.right;return c.key}o<0?c=c.left:o>0&&(h=c,c=c.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},a.prototype.isEmpty=function(){return this.root_.isEmpty()},a.prototype.count=function(){return this.root_.count()},a.prototype.minKey=function(){return this.root_.minKey()},a.prototype.maxKey=function(){return this.root_.maxKey()},a.prototype.inorderTraversal=function(r){return this.root_.inorderTraversal(r)},a.prototype.reverseTraversal=function(r){return this.root_.reverseTraversal(r)},a.prototype.getIterator=function(r){return new K(this.root_,null,this.comparator_,!1,r)},a.prototype.getIteratorFrom=function(r,o){return new K(this.root_,r,this.comparator_,!1,o)},a.prototype.getReverseIteratorFrom=function(r,o){return new K(this.root_,r,this.comparator_,!0,o)},a.prototype.getReverseIterator=function(r){return new K(this.root_,null,this.comparator_,!0,r)},a.EMPTY_NODE=new P,a}(),C=Math.log(2),M=function(){function a(r){this.count=parseInt(Math.log(r+1)/C,10),this.current_=this.count-1;var h=parseInt(Array(this.count+1).join("1"),2);this.bits_=r+1&h}return a.prototype.nextBitIsOne=function(){var r=!(this.bits_&1<<this.current_);return this.current_--,r},a}(),W=function(a,r,o,c){a.sort(r);var h=function(F,k){var pt,_t,ot=k-F;if(0===ot)return null;if(1===ot)return pt=a[F],_t=o?o(pt):pt,new et(_t,pt.node,et.BLACK,null,null);var Ut=parseInt(ot/2,10)+F,$t=h(F,Ut),Zt=h(Ut+1,k);return pt=a[Ut],_t=o?o(pt):pt,new et(_t,pt.node,et.BLACK,$t,Zt)},R=function(F){for(var k=null,ot=null,pt=a.length,_t=function(ze,lr){var yr=pt-ze,vi=pt;pt-=ze;var zr=h(yr+1,vi),Fi=a[yr],Ui=o?o(Fi):Fi;Ut(new et(Ui,Fi.node,lr,null,zr))},Ut=function(ze){k?(k.left=ze,k=ze):(ot=ze,k=ze)},$t=0;$t<F.count;++$t){var Zt=F.nextBitIsOne(),He=Math.pow(2,F.count-($t+1));Zt?_t(He,et.BLACK):(_t(He,et.BLACK),_t(He,et.RED))}return ot}(new M(a.length));return new y(c||r,R)},rt={},Pt=function(){function a(r,o){this.indexes_=r,this.indexSet_=o}return Object.defineProperty(a,"Default",{get:function(){return D.assert(rt&&j,"ChildrenNode.ts has not been loaded"),Q=Q||new a({".priority":rt},{".priority":j})},enumerable:!1,configurable:!0}),a.prototype.get=function(r){var o=D.safeGet(this.indexes_,r);if(!o)throw new Error("No index defined for "+r);return o instanceof y?o:null},a.prototype.hasIndex=function(r){return D.contains(this.indexSet_,r.toString())},a.prototype.addIndex=function(r,o){D.assert(r!==dt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var c=[],h=!1,p=o.getIterator(q.Wrap),I=p.getNext();I;)h=h||r.isDefinedOn(I.node),c.push(I),I=p.getNext();var R;R=h?W(c,r.getCompare()):rt;var F=r.toString(),k=Dt.__assign({},this.indexSet_);k[F]=r;var ot=Dt.__assign({},this.indexes_);return ot[F]=R,new a(ot,k)},a.prototype.addToIndexes=function(r,o){var c=this;return new a(D.map(this.indexes_,function(p,I){var R=D.safeGet(c.indexSet_,I);if(D.assert(R,"Missing index implementation for "+I),p===rt){if(R.isDefinedOn(r.node)){for(var F=[],k=o.getIterator(q.Wrap),ot=k.getNext();ot;)ot.name!==r.name&&F.push(ot),ot=k.getNext();return F.push(r),W(F,R.getCompare())}return rt}var pt=o.get(r.name),_t=p;return pt&&(_t=_t.remove(new q(r.name,pt))),_t.insert(r,r.node)}),this.indexSet_)},a.prototype.removeFromIndexes=function(r,o){return new a(D.map(this.indexes_,function(h){if(h===rt)return h;var p=o.get(r.name);return p?h.remove(new q(r.name,p)):h}),this.indexSet_)},a}();function Vt(a,r){return T(a.name,r.name)}function he(a,r){return T(a,r)}var ie,zt=function(){function a(r,o,c){this.children_=r,this.priorityNode_=o,this.indexMap_=c,this.lazyHash_=null,this.priorityNode_&&ae(this.priorityNode_),this.children_.isEmpty()&&D.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(a,"EMPTY_NODE",{get:function(){return ie||(ie=new a(new y(he),null,Pt.Default))},enumerable:!1,configurable:!0}),a.prototype.isLeafNode=function(){return!1},a.prototype.getPriority=function(){return this.priorityNode_||ie},a.prototype.updatePriority=function(r){return this.children_.isEmpty()?this:new a(this.children_,r,this.indexMap_)},a.prototype.getImmediateChild=function(r){if(".priority"===r)return this.getPriority();var o=this.children_.get(r);return null===o?ie:o},a.prototype.getChild=function(r){var o=r.getFront();return null===o?this:this.getImmediateChild(o).getChild(r.popFront())},a.prototype.hasChild=function(r){return null!==this.children_.get(r)},a.prototype.updateImmediateChild=function(r,o){if(D.assert(o,"We should always be passing snapshot nodes"),".priority"===r)return this.updatePriority(o);var c=new q(r,o),h=void 0,p=void 0;o.isEmpty()?(h=this.children_.remove(r),p=this.indexMap_.removeFromIndexes(c,this.children_)):(h=this.children_.insert(r,o),p=this.indexMap_.addToIndexes(c,this.children_));var I=h.isEmpty()?ie:this.priorityNode_;return new a(h,I,p)},a.prototype.updateChild=function(r,o){var c=r.getFront();if(null===c)return o;D.assert(".priority"!==r.getFront()||1===r.getLength(),".priority must be the last token in a path");var h=this.getImmediateChild(c).updateChild(r.popFront(),o);return this.updateImmediateChild(c,h)},a.prototype.isEmpty=function(){return this.children_.isEmpty()},a.prototype.numChildren=function(){return this.children_.count()},a.prototype.val=function(r){if(this.isEmpty())return null;var o={},c=0,h=0,p=!0;if(this.forEachChild(j,function(F,k){o[F]=k.val(r),c++,p&&a.INTEGER_REGEXP_.test(F)?h=Math.max(h,Number(F)):p=!1}),!r&&p&&h<2*c){var I=[];for(var R in o)I[R]=o[R];return I}return r&&!this.getPriority().isEmpty()&&(o[".priority"]=this.getPriority().val()),o},a.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.getPriority().isEmpty()||(r+="priority:"+Ht(this.getPriority().val())+":"),this.forEachChild(j,function(o,c){var h=c.hash();""!==h&&(r+=":"+o+":"+h)}),this.lazyHash_=""===r?"":Xe(r)}return this.lazyHash_},a.prototype.getPredecessorChildName=function(r,o,c){var h=this.resolveIndex_(c);if(h){var p=h.getPredecessorKey(new q(r,o));return p?p.name:null}return this.children_.getPredecessorKey(r)},a.prototype.getFirstChildName=function(r){var o=this.resolveIndex_(r);if(o){var c=o.minKey();return c&&c.name}return this.children_.minKey()},a.prototype.getFirstChild=function(r){var o=this.getFirstChildName(r);return o?new q(o,this.children_.get(o)):null},a.prototype.getLastChildName=function(r){var o=this.resolveIndex_(r);if(o){var c=o.maxKey();return c&&c.name}return this.children_.maxKey()},a.prototype.getLastChild=function(r){var o=this.getLastChildName(r);return o?new q(o,this.children_.get(o)):null},a.prototype.forEachChild=function(r,o){var c=this.resolveIndex_(r);return c?c.inorderTraversal(function(h){return o(h.name,h.node)}):this.children_.inorderTraversal(o)},a.prototype.getIterator=function(r){return this.getIteratorFrom(r.minPost(),r)},a.prototype.getIteratorFrom=function(r,o){var c=this.resolveIndex_(o);if(c)return c.getIteratorFrom(r,function(I){return I});for(var h=this.children_.getIteratorFrom(r.name,q.Wrap),p=h.peek();null!=p&&o.compare(p,r)<0;)h.getNext(),p=h.peek();return h},a.prototype.getReverseIterator=function(r){return this.getReverseIteratorFrom(r.maxPost(),r)},a.prototype.getReverseIteratorFrom=function(r,o){var c=this.resolveIndex_(o);if(c)return c.getReverseIteratorFrom(r,function(I){return I});for(var h=this.children_.getReverseIteratorFrom(r.name,q.Wrap),p=h.peek();null!=p&&o.compare(p,r)>0;)h.getNext(),p=h.peek();return h},a.prototype.compareTo=function(r){return this.isEmpty()?r.isEmpty()?0:-1:r.isLeafNode()||r.isEmpty()?1:r===Ae?-1:0},a.prototype.withIndex=function(r){if(r===dt||this.indexMap_.hasIndex(r))return this;var o=this.indexMap_.addIndex(r,this.children_);return new a(this.children_,this.priorityNode_,o)},a.prototype.isIndexed=function(r){return r===dt||this.indexMap_.hasIndex(r)},a.prototype.equals=function(r){if(r===this)return!0;if(r.isLeafNode())return!1;var o=r;if(this.getPriority().equals(o.getPriority())){if(this.children_.count()===o.children_.count()){for(var c=this.getIterator(j),h=o.getIterator(j),p=c.getNext(),I=h.getNext();p&&I;){if(p.name!==I.name||!p.node.equals(I.node))return!1;p=c.getNext(),I=h.getNext()}return null===p&&null===I}return!1}return!1},a.prototype.resolveIndex_=function(r){return r===dt?null:this.indexMap_.get(r.toString())},a.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,a}(),Ae=new(function(a){function r(){return a.call(this,new y(he),zt.EMPTY_NODE,Pt.Default)||this}return Dt.__extends(r,a),r.prototype.compareTo=function(o){return o===this?0:1},r.prototype.equals=function(o){return o===this},r.prototype.getPriority=function(){return this},r.prototype.getImmediateChild=function(o){return zt.EMPTY_NODE},r.prototype.isEmpty=function(){return!1},r}(zt));function Re(a,r){if(void 0===r&&(r=null),null===a)return zt.EMPTY_NODE;if("object"==typeof a&&".priority"in a&&(r=a[".priority"]),D.assert(null===r||"string"==typeof r||"number"==typeof r||"object"==typeof r&&".sv"in r,"Invalid priority type found: "+typeof r),"object"==typeof a&&".value"in a&&null!==a[".value"]&&(a=a[".value"]),"object"!=typeof a||".sv"in a)return new ue(a,Re(r));if(a instanceof Array){var F=zt.EMPTY_NODE;return yt(a,function(k,ot){if(D.contains(a,k)&&"."!==k.substring(0,1)){var pt=Re(ot);(pt.isLeafNode()||!pt.isEmpty())&&(F=F.updateImmediateChild(k,pt))}}),F.updatePriority(Re(r))}var c=[],h=!1;if(yt(a,function(k,ot){if("."!==k.substring(0,1)){var pt=Re(ot);pt.isEmpty()||(h=h||!pt.getPriority().isEmpty(),c.push(new q(k,pt)))}}),0===c.length)return zt.EMPTY_NODE;var I=W(c,Vt,function(k){return k.name},he);if(h){var R=W(c,j.getCompare());return new zt(I,Re(r),new Pt({".priority":R},{".priority":j}))}return new zt(I,Re(r),Pt.Default)}Object.defineProperties(q,{MIN:{value:new q(A,zt.EMPTY_NODE)},MAX:{value:new q(x,Ae)}}),wt.__EMPTY_NODE=zt.EMPTY_NODE,ue.__childrenNodeConstructor=zt,function(a){gt=a}(Ae),function(a){De=a}(Ae),function(a){je=a}(Re);var Sr,mr=new(function(a){function r(){return null!==a&&a.apply(this,arguments)||this}return Dt.__extends(r,a),r.prototype.compare=function(o,c){var h=o.node.compareTo(c.node);return 0===h?T(o.name,c.name):h},r.prototype.isDefinedOn=function(o){return!0},r.prototype.indexedValueChanged=function(o,c){return!o.equals(c)},r.prototype.minPost=function(){return q.MIN},r.prototype.maxPost=function(){return q.MAX},r.prototype.makePost=function(o,c){var h=Re(o);return new q(c,h)},r.prototype.toString=function(){return".value"},r}(it)),Tr=function(a){function r(o){var c=a.call(this)||this;return c.indexPath_=o,D.assert(!o.isEmpty()&&".priority"!==o.getFront(),"Can't create PathIndex with empty path or .priority key"),c}return Dt.__extends(r,a),r.prototype.extractChild=function(o){return o.getChild(this.indexPath_)},r.prototype.isDefinedOn=function(o){return!o.getChild(this.indexPath_).isEmpty()},r.prototype.compare=function(o,c){var h=this.extractChild(o.node),p=this.extractChild(c.node),I=h.compareTo(p);return 0===I?T(o.name,c.name):I},r.prototype.makePost=function(o,c){var h=Re(o),p=zt.EMPTY_NODE.updateChild(this.indexPath_,h);return new q(c,p)},r.prototype.maxPost=function(){var o=zt.EMPTY_NODE.updateChild(this.indexPath_,Ae);return new q(x,o)},r.prototype.toString=function(){return this.indexPath_.slice().join("/")},r}(it),hr=function(){function a(r,o,c){this.node_=r,this.ref_=o,this.index_=c}return a.prototype.val=function(){return D.validateArgCount("DataSnapshot.val",0,0,arguments.length),this.node_.val()},a.prototype.exportVal=function(){return D.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},a.prototype.toJSON=function(){return D.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},a.prototype.exists=function(){return D.validateArgCount("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},a.prototype.child=function(r){D.validateArgCount("DataSnapshot.child",0,1,arguments.length),r=String(r),Qe("DataSnapshot.child",1,r,!1);var o=new Rt(r),c=this.ref_.child(o);return new a(this.node_.getChild(o),c,j)},a.prototype.hasChild=function(r){D.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),Qe("DataSnapshot.hasChild",1,r,!1);var o=new Rt(r);return!this.node_.getChild(o).isEmpty()},a.prototype.getPriority=function(){return D.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},a.prototype.forEach=function(r){var o=this;if(D.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),D.validateCallback("DataSnapshot.forEach",1,r,!1),this.node_.isLeafNode())return!1;var c=this.node_;return!!c.forEachChild(this.index_,function(h,p){return r(new a(p,o.ref_.child(h),j))})},a.prototype.hasChildren=function(){return D.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(a.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),a.prototype.numChildren=function(){return D.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},a.prototype.getRef=function(){return D.validateArgCount("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(a.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),a}(),mi=function(){function a(r,o,c,h){this.eventType=r,this.eventRegistration=o,this.snapshot=c,this.prevName=h}return a.prototype.getPath=function(){var r=this.snapshot.getRef();return"value"===this.eventType?r.path:r.getParent().path},a.prototype.getEventType=function(){return this.eventType},a.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},a.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+D.stringify(this.snapshot.exportVal())},a}(),ii=function(){function a(r,o,c){this.eventRegistration=r,this.error=o,this.path=c}return a.prototype.getPath=function(){return this.path},a.prototype.getEventType=function(){return"cancel"},a.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},a.prototype.toString=function(){return this.path.toString()+":cancel"},a}(),_i=function(){function a(r,o,c){this.callback_=r,this.cancelCallback_=o,this.context_=c}return a.prototype.respondsTo=function(r){return"value"===r},a.prototype.createEvent=function(r,o){var c=o.getQueryParams().getIndex();return new mi("value",this,new hr(r.snapshotNode,o.getRef(),c))},a.prototype.getEventRunner=function(r){var o=this.context_;if("cancel"===r.getEventType()){D.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var c=this.cancelCallback_;return function(){c.call(o,r.error)}}var h=this.callback_;return function(){h.call(o,r.snapshot)}},a.prototype.createCancelEvent=function(r,o){return this.cancelCallback_?new ii(this,r,o):null},a.prototype.matches=function(r){return r instanceof a&&(!r.callback_||!this.callback_||r.callback_===this.callback_&&r.context_===this.context_)},a.prototype.hasAnyCallback=function(){return null!==this.callback_},a}(),pr=function(){function a(r,o,c){this.callbacks_=r,this.cancelCallback_=o,this.context_=c}return a.prototype.respondsTo=function(r){var o="children_added"===r?"child_added":r;return D.contains(this.callbacks_,o="children_removed"===o?"child_removed":o)},a.prototype.createCancelEvent=function(r,o){return this.cancelCallback_?new ii(this,r,o):null},a.prototype.createEvent=function(r,o){D.assert(null!=r.childName,"Child events should have a childName.");var c=o.getRef().child(r.childName),h=o.getQueryParams().getIndex();return new mi(r.type,this,new hr(r.snapshotNode,c,h),r.prevName)},a.prototype.getEventRunner=function(r){var o=this.context_;if("cancel"===r.getEventType()){D.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var c=this.cancelCallback_;return function(){c.call(o,r.error)}}var h=this.callbacks_[r.eventType];return function(){h.call(o,r.snapshot,r.prevName)}},a.prototype.matches=function(r){var o=this;if(r instanceof a){if(!this.callbacks_||!r.callbacks_)return!0;if(this.context_===r.context_){var c=Object.keys(r.callbacks_),h=Object.keys(this.callbacks_),p=c.length;if(p===h.length){if(1===p){var R=c[0],F=h[0];return!(F!==R||r.callbacks_[R]&&this.callbacks_[F]&&r.callbacks_[R]!==this.callbacks_[F])}return h.every(function(k){return r.callbacks_[k]===o.callbacks_[k]})}}}return!1},a.prototype.hasAnyCallback=function(){return null!==this.callbacks_},a}(),Pr=function(){function a(r,o,c,h){this.repo=r,this.path=o,this.queryParams_=c,this.orderByCalled_=h}return Object.defineProperty(a,"__referenceConstructor",{get:function(){return D.assert(Sr,"Reference.ts has not been loaded"),Sr},set:function(r){Sr=r},enumerable:!1,configurable:!0}),a.validateQueryEndpoints_=function(r){var o=null,c=null;if(r.hasStart()&&(o=r.getIndexStartValue()),r.hasEnd()&&(c=r.getIndexEndValue()),r.getIndex()===dt){var h="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",p="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(r.hasStart()){if(r.getIndexStartName()!==A)throw new Error(h);if("string"!=typeof o)throw new Error(p)}if(r.hasEnd()){if(r.getIndexEndName()!==x)throw new Error(h);if("string"!=typeof c)throw new Error(p)}}else if(r.getIndex()===j){if(null!=o&&!Ge(o)||null!=c&&!Ge(c))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(D.assert(r.getIndex()instanceof Tr||r.getIndex()===mr,"unknown index type."),null!=o&&"object"==typeof o||null!=c&&"object"==typeof c)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},a.validateLimit_=function(r){if(r.hasStart()&&r.hasEnd()&&r.hasLimit()&&!r.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},a.prototype.validateNoPreviousOrderByCall_=function(r){if(!0===this.orderByCalled_)throw new Error(r+": You can't combine multiple orderBy calls.")},a.prototype.getQueryParams=function(){return this.queryParams_},a.prototype.getRef=function(){return D.validateArgCount("Query.ref",0,0,arguments.length),new a.__referenceConstructor(this.repo,this.path)},a.prototype.on=function(r,o,c,h){D.validateArgCount("Query.on",2,4,arguments.length),kn("Query.on",1,r,!1),D.validateCallback("Query.on",2,o,!1);var p=a.getCancelAndContextArgs_("Query.on",c,h);if("value"===r)this.onValueEvent(o,p.cancel,p.context);else{var I={};I[r]=o,this.onChildEvent(I,p.cancel,p.context)}return o},a.prototype.onValueEvent=function(r,o,c){var h=new _i(r,o||null,c||null);this.repo.addEventCallbackForQuery(this,h)},a.prototype.onChildEvent=function(r,o,c){var h=new pr(r,o,c);this.repo.addEventCallbackForQuery(this,h)},a.prototype.off=function(r,o,c){D.validateArgCount("Query.off",0,3,arguments.length),kn("Query.off",1,r,!0),D.validateCallback("Query.off",2,o,!0),D.validateContextObject("Query.off",3,c,!0);var h=null,p=null;if("value"===r){var I=o||null;h=new _i(I,null,c||null)}else r&&(o&&((p={})[r]=o),h=new pr(p,null,c||null));this.repo.removeEventCallbackForQuery(this,h)},a.prototype.once=function(r,o,c,h){var p=this;D.validateArgCount("Query.once",1,4,arguments.length),kn("Query.once",1,r,!1),D.validateCallback("Query.once",2,o,!0);var I=a.getCancelAndContextArgs_("Query.once",c,h),R=!0,F=new D.Deferred;F.promise.catch(function(){});var k=function(ot){R&&(R=!1,p.off(r,k),o&&o.bind(I.context)(ot),F.resolve(ot))};return this.on(r,k,function(ot){p.off(r,k),I.cancel&&I.cancel.bind(I.context)(ot),F.reject(ot)}),F.promise},a.prototype.limitToFirst=function(r){if(D.validateArgCount("Query.limitToFirst",1,1,arguments.length),"number"!=typeof r||Math.floor(r)!==r||r<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new a(this.repo,this.path,this.queryParams_.limitToFirst(r),this.orderByCalled_)},a.prototype.limitToLast=function(r){if(D.validateArgCount("Query.limitToLast",1,1,arguments.length),"number"!=typeof r||Math.floor(r)!==r||r<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new a(this.repo,this.path,this.queryParams_.limitToLast(r),this.orderByCalled_)},a.prototype.orderByChild=function(r){if(D.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===r)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===r)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===r)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');Qe("Query.orderByChild",1,r,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var o=new Rt(r);if(o.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var c=new Tr(o),h=this.queryParams_.orderBy(c);return a.validateQueryEndpoints_(h),new a(this.repo,this.path,h,!0)},a.prototype.orderByKey=function(){D.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var r=this.queryParams_.orderBy(dt);return a.validateQueryEndpoints_(r),new a(this.repo,this.path,r,!0)},a.prototype.orderByPriority=function(){D.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var r=this.queryParams_.orderBy(j);return a.validateQueryEndpoints_(r),new a(this.repo,this.path,r,!0)},a.prototype.orderByValue=function(){D.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var r=this.queryParams_.orderBy(mr);return a.validateQueryEndpoints_(r),new a(this.repo,this.path,r,!0)},a.prototype.startAt=function(r,o){void 0===r&&(r=null),D.validateArgCount("Query.startAt",0,2,arguments.length),Pe("Query.startAt",1,r,this.path,!0),Mn("Query.startAt",2,o,!0);var c=this.queryParams_.startAt(r,o);if(a.validateLimit_(c),a.validateQueryEndpoints_(c),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===r&&(r=null,o=null),new a(this.repo,this.path,c,this.orderByCalled_)},a.prototype.endAt=function(r,o){void 0===r&&(r=null),D.validateArgCount("Query.endAt",0,2,arguments.length),Pe("Query.endAt",1,r,this.path,!0),Mn("Query.endAt",2,o,!0);var c=this.queryParams_.endAt(r,o);if(a.validateLimit_(c),a.validateQueryEndpoints_(c),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new a(this.repo,this.path,c,this.orderByCalled_)},a.prototype.equalTo=function(r,o){if(D.validateArgCount("Query.equalTo",1,2,arguments.length),Pe("Query.equalTo",1,r,this.path,!1),Mn("Query.equalTo",2,o,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(r,o).endAt(r,o)},a.prototype.toString=function(){return D.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},a.prototype.toJSON=function(){return D.validateArgCount("Query.toJSON",0,1,arguments.length),this.toString()},a.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},a.prototype.queryIdentifier=function(){var r=this.queryObject(),o=Xt(r);return"{}"===o?"default":o},a.prototype.isEqual=function(r){if(D.validateArgCount("Query.isEqual",1,1,arguments.length),!(r instanceof a)){var o="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(o)}var c=this.repo===r.repo,h=this.path.equals(r.path),p=this.queryIdentifier()===r.queryIdentifier();return c&&h&&p},a.getCancelAndContextArgs_=function(r,o,c){var h={cancel:null,context:null};if(o&&c)h.cancel=o,D.validateCallback(r,3,h.cancel,!0),h.context=c,D.validateContextObject(r,4,h.context,!0);else if(o)if("object"==typeof o&&null!==o)h.context=o;else{if("function"!=typeof o)throw new Error(D.errorPrefix(r,3,!0)+" must either be a cancel callback or a context object.");h.cancel=o}return h},Object.defineProperty(a.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),a}(),Qr=function(){function a(r){this.node_=r}return a.prototype.getImmediateChild=function(r){return new a(this.node_.getImmediateChild(r))},a.prototype.node=function(){return this.node_},a}(),oi=function(){function a(r,o){this.syncTree_=r,this.path_=o}return a.prototype.getImmediateChild=function(r){var o=this.path_.child(r);return new a(this.syncTree_,o)},a.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},a}(),tr=function(a,r,o){return a&&"object"==typeof a?(D.assert(".sv"in a,"Unexpected leaf node or priority contents"),"string"==typeof a[".sv"]?si(a[".sv"],r,o):"object"==typeof a[".sv"]?En(a[".sv"],r):void D.assert(!1,"Unexpected server value: "+JSON.stringify(a,null,2))):a},si=function(a,r,o){switch(a){case"timestamp":return o.timestamp;default:D.assert(!1,"Unexpected server value: "+a)}},En=function(a,r,o){a.hasOwnProperty("increment")||D.assert(!1,"Unexpected server value: "+JSON.stringify(a,null,2));var c=a.increment;"number"!=typeof c&&D.assert(!1,"Unexpected increment value: "+c);var h=r.node();if(D.assert(null!=h,"Expected ChildrenNode.EMPTY_NODE for nulls"),!h.isLeafNode())return c;var I=h.getValue();return"number"!=typeof I?c:I+c},qn=function(a,r,o,c){return sr(r,new oi(o,a),c)},$n=function(a,r,o){return sr(a,new Qr(r),o)};function sr(a,r,o){var p,c=a.getPriority().val(),h=tr(c,r.getImmediateChild(".priority"),o);if(a.isLeafNode()){var I=a,R=tr(I.getValue(),r,o);return R!==I.getValue()||h!==I.getPriority().val()?new ue(R,Re(h)):a}var F=a;return p=F,h!==F.getPriority().val()&&(p=p.updatePriority(new ue(h))),F.forEachChild(j,function(k,ot){var pt=sr(ot,r.getImmediateChild(k),o);pt!==ot&&(p=p.updateImmediateChild(k,pt))}),p}var ur,li,ai=function(){function a(){this.value=null,this.children=new Map}return a.prototype.find=function(r){if(null!=this.value)return this.value.getChild(r);if(!r.isEmpty()&&this.children.size>0){var o=r.getFront();return r=r.popFront(),this.children.has(o)?this.children.get(o).find(r):null}return null},a.prototype.remember=function(r,o){if(r.isEmpty())this.value=o,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(r,o);else{var c=r.getFront();this.children.has(c)||this.children.set(c,new a);var h=this.children.get(c);r=r.popFront(),h.remember(r,o)}},a.prototype.forget=function(r){if(r.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var o=this.value;this.value=null;var c=this;return o.forEachChild(j,function(I,R){c.remember(new Rt(I),R)}),this.forget(r)}if(this.children.size>0){var h=r.getFront();return r=r.popFront(),this.children.has(h)&&this.children.get(h).forget(r)&&this.children.delete(h),0===this.children.size}return!0},a.prototype.forEachTree=function(r,o){null!==this.value?o(r,this.value):this.forEachChild(function(c,h){var p=new Rt(r.toString()+"/"+c);h.forEachTree(p,o)})},a.prototype.forEachChild=function(r){this.children.forEach(function(o,c){r(c,o)})},a}(),In=(()=>(function(a){a[a.OVERWRITE=0]="OVERWRITE",a[a.MERGE=1]="MERGE",a[a.ACK_USER_WRITE=2]="ACK_USER_WRITE",a[a.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(In||(In={})),In))(),ar=function(){function a(r,o,c,h){this.fromUser=r,this.fromServer=o,this.queryId=c,this.tagged=h,D.assert(!h||o,"Tagged queries must be from server.")}return a.User=new a(!0,!1,null,!1),a.Server=new a(!1,!0,null,!1),a.forServerTaggedQuery=function(r){return new a(!1,!0,r,!0)},a}(),jr=function(){function a(r,o,c){this.path=r,this.affectedTree=o,this.revert=c,this.type=In.ACK_USER_WRITE,this.source=ar.User}return a.prototype.operationForChild=function(r){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return D.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var o=this.affectedTree.subtree(new Rt(r));return new a(Rt.Empty,o,this.revert)}return D.assert(this.path.getFront()===r,"operationForChild called for unrelated child."),new a(this.path.popFront(),this.affectedTree,this.revert)},a}(),Tn=function(){function a(r,o){void 0===o&&(ur||(ur=new y(z)),o=ur),this.value=r,this.children=o}return a.fromObject=function(r){var o=a.Empty;return yt(r,function(c,h){o=o.set(new Rt(c),h)}),o},a.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},a.prototype.findRootMostMatchingPathAndValue=function(r,o){if(null!=this.value&&o(this.value))return{path:Rt.Empty,value:this.value};if(r.isEmpty())return null;var c=r.getFront(),h=this.children.get(c);if(null!==h){var p=h.findRootMostMatchingPathAndValue(r.popFront(),o);return null!=p?{path:new Rt(c).child(p.path),value:p.value}:null}return null},a.prototype.findRootMostValueAndPath=function(r){return this.findRootMostMatchingPathAndValue(r,function(){return!0})},a.prototype.subtree=function(r){if(r.isEmpty())return this;var o=r.getFront(),c=this.children.get(o);return null!==c?c.subtree(r.popFront()):a.Empty},a.prototype.set=function(r,o){if(r.isEmpty())return new a(o,this.children);var c=r.getFront(),p=(this.children.get(c)||a.Empty).set(r.popFront(),o),I=this.children.insert(c,p);return new a(this.value,I)},a.prototype.remove=function(r){if(r.isEmpty())return this.children.isEmpty()?a.Empty:new a(null,this.children);var o=r.getFront(),c=this.children.get(o);if(c){var h=c.remove(r.popFront()),p=void 0;return p=h.isEmpty()?this.children.remove(o):this.children.insert(o,h),null===this.value&&p.isEmpty()?a.Empty:new a(this.value,p)}return this},a.prototype.get=function(r){if(r.isEmpty())return this.value;var o=r.getFront(),c=this.children.get(o);return c?c.get(r.popFront()):null},a.prototype.setTree=function(r,o){if(r.isEmpty())return o;var I,c=r.getFront(),p=(this.children.get(c)||a.Empty).setTree(r.popFront(),o);return I=p.isEmpty()?this.children.remove(c):this.children.insert(c,p),new a(this.value,I)},a.prototype.fold=function(r){return this.fold_(Rt.Empty,r)},a.prototype.fold_=function(r,o){var c={};return this.children.inorderTraversal(function(h,p){c[h]=p.fold_(r.child(h),o)}),o(r,this.value,c)},a.prototype.findOnPath=function(r,o){return this.findOnPath_(r,Rt.Empty,o)},a.prototype.findOnPath_=function(r,o,c){var h=!!this.value&&c(o,this.value);if(h)return h;if(r.isEmpty())return null;var p=r.getFront(),I=this.children.get(p);return I?I.findOnPath_(r.popFront(),o.child(p),c):null},a.prototype.foreachOnPath=function(r,o){return this.foreachOnPath_(r,Rt.Empty,o)},a.prototype.foreachOnPath_=function(r,o,c){if(r.isEmpty())return this;this.value&&c(o,this.value);var h=r.getFront(),p=this.children.get(h);return p?p.foreachOnPath_(r.popFront(),o.child(h),c):a.Empty},a.prototype.foreach=function(r){this.foreach_(Rt.Empty,r)},a.prototype.foreach_=function(r,o){this.children.inorderTraversal(function(c,h){h.foreach_(r.child(c),o)}),this.value&&o(r,this.value)},a.prototype.foreachChild=function(r){this.children.inorderTraversal(function(o,c){c.value&&r(o,c.value)})},a.Empty=new a(null),a}(),ui=function(){function a(r,o){this.source=r,this.path=o,this.type=In.LISTEN_COMPLETE}return a.prototype.operationForChild=function(r){return this.path.isEmpty()?new a(this.source,Rt.Empty):new a(this.source,this.path.popFront())},a}(),_r=function(){function a(r,o,c){this.source=r,this.path=o,this.snap=c,this.type=In.OVERWRITE}return a.prototype.operationForChild=function(r){return this.path.isEmpty()?new a(this.source,Rt.Empty,this.snap.getImmediateChild(r)):new a(this.source,this.path.popFront(),this.snap)},a}(),wr=function(){function a(r,o,c){this.source=r,this.path=o,this.children=c,this.type=In.MERGE}return a.prototype.operationForChild=function(r){if(this.path.isEmpty()){var o=this.children.subtree(new Rt(r));return o.isEmpty()?null:o.value?new _r(this.source,Rt.Empty,o.value):new a(this.source,Rt.Empty,o)}return D.assert(this.path.getFront()===r,"Can't get a merge for a child not on the path of the operation"),new a(this.source,this.path.popFront(),this.children)},a.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},a}(),er=function(){function a(r,o,c){this.node_=r,this.fullyInitialized_=o,this.filtered_=c}return a.prototype.isFullyInitialized=function(){return this.fullyInitialized_},a.prototype.isFiltered=function(){return this.filtered_},a.prototype.isCompleteForPath=function(r){if(r.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var o=r.getFront();return this.isCompleteForChild(o)},a.prototype.isCompleteForChild=function(r){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(r)},a.prototype.getNode=function(){return this.node_},a}(),br=function(){function a(r,o){this.eventCache_=r,this.serverCache_=o}return a.prototype.updateEventSnap=function(r,o,c){return new a(new er(r,o,c),this.serverCache_)},a.prototype.updateServerSnap=function(r,o,c){return new a(this.eventCache_,new er(r,o,c))},a.prototype.getEventCache=function(){return this.eventCache_},a.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},a.prototype.getServerCache=function(){return this.serverCache_},a.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},a.Empty=new a(new er(zt.EMPTY_NODE,!1,!1),new er(zt.EMPTY_NODE,!1,!1)),a}(),Le=function(){function a(r,o,c,h,p){this.type=r,this.snapshotNode=o,this.childName=c,this.oldSnap=h,this.prevName=p}return a.valueChange=function(r){return new a(a.VALUE,r)},a.childAddedChange=function(r,o){return new a(a.CHILD_ADDED,o,r)},a.childRemovedChange=function(r,o){return new a(a.CHILD_REMOVED,o,r)},a.childChangedChange=function(r,o,c){return new a(a.CHILD_CHANGED,o,r,c)},a.childMovedChange=function(r,o){return new a(a.CHILD_MOVED,o,r)},a.CHILD_ADDED="child_added",a.CHILD_REMOVED="child_removed",a.CHILD_CHANGED="child_changed",a.CHILD_MOVED="child_moved",a.VALUE="value",a}(),Vr=function(){function a(r){this.index_=r}return a.prototype.updateChild=function(r,o,c,h,p,I){D.assert(r.isIndexed(this.index_),"A node must be indexed if only a child is updated");var R=r.getImmediateChild(o);return R.getChild(h).equals(c.getChild(h))&&R.isEmpty()===c.isEmpty()||(null!=I&&(c.isEmpty()?r.hasChild(o)?I.trackChildChange(Le.childRemovedChange(o,R)):D.assert(r.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):R.isEmpty()?I.trackChildChange(Le.childAddedChange(o,c)):I.trackChildChange(Le.childChangedChange(o,c,R))),r.isLeafNode()&&c.isEmpty())?r:r.updateImmediateChild(o,c).withIndex(this.index_)},a.prototype.updateFullNode=function(r,o,c){return null!=c&&(r.isLeafNode()||r.forEachChild(j,function(h,p){o.hasChild(h)||c.trackChildChange(Le.childRemovedChange(h,p))}),o.isLeafNode()||o.forEachChild(j,function(h,p){if(r.hasChild(h)){var I=r.getImmediateChild(h);I.equals(p)||c.trackChildChange(Le.childChangedChange(h,p,I))}else c.trackChildChange(Le.childAddedChange(h,p))})),o.withIndex(this.index_)},a.prototype.updatePriority=function(r,o){return r.isEmpty()?zt.EMPTY_NODE:r.updatePriority(o)},a.prototype.filtersNodes=function(){return!1},a.prototype.getIndexedFilter=function(){return this},a.prototype.getIndex=function(){return this.index_},a}(),nr=function(){function a(){this.changeMap=new Map}return a.prototype.trackChildChange=function(r){var o=r.type,c=r.childName;D.assert(o===Le.CHILD_ADDED||o===Le.CHILD_CHANGED||o===Le.CHILD_REMOVED,"Only child changes supported for tracking"),D.assert(".priority"!==c,"Only non-priority child changes can be tracked.");var h=this.changeMap.get(c);if(h){var p=h.type;if(o===Le.CHILD_ADDED&&p===Le.CHILD_REMOVED)this.changeMap.set(c,Le.childChangedChange(c,r.snapshotNode,h.snapshotNode));else if(o===Le.CHILD_REMOVED&&p===Le.CHILD_ADDED)this.changeMap.delete(c);else if(o===Le.CHILD_REMOVED&&p===Le.CHILD_CHANGED)this.changeMap.set(c,Le.childRemovedChange(c,h.oldSnap));else if(o===Le.CHILD_CHANGED&&p===Le.CHILD_ADDED)this.changeMap.set(c,Le.childAddedChange(c,r.snapshotNode));else{if(o!==Le.CHILD_CHANGED||p!==Le.CHILD_CHANGED)throw D.assertionError("Illegal combination of changes: "+r+" occurred after "+h);this.changeMap.set(c,Le.childChangedChange(c,r.snapshotNode,h.oldSnap))}}else this.changeMap.set(c,r)},a.prototype.getChanges=function(){return Array.from(this.changeMap.values())},a}(),Xr=new(function(){function a(){}return a.prototype.getCompleteChild=function(r){return null},a.prototype.getChildAfterChild=function(r,o,c){return null},a}()),Br=function(){function a(r,o,c){void 0===c&&(c=null),this.writes_=r,this.viewCache_=o,this.optCompleteServerCache_=c}return a.prototype.getCompleteChild=function(r){var o=this.viewCache_.getEventCache();if(o.isCompleteForChild(r))return o.getNode().getImmediateChild(r);var c=null!=this.optCompleteServerCache_?new er(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(r,c)},a.prototype.getChildAfterChild=function(r,o,c){var h=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),p=this.writes_.calcIndexedSlice(h,o,1,c,r);return 0===p.length?null:p[0]},a}(),$r=function(r,o){this.viewCache=r,this.changes=o},wi=function(){function a(r){this.filter_=r}return a.prototype.assertIndexed=function(r){D.assert(r.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),D.assert(r.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},a.prototype.applyOperation=function(r,o,c,h){var I,R,p=new nr;if(o.type===In.OVERWRITE){var F=o;F.source.fromUser?I=this.applyUserOverwrite_(r,F.path,F.snap,c,h,p):(D.assert(F.source.fromServer,"Unknown source."),R=F.source.tagged||r.getServerCache().isFiltered()&&!F.path.isEmpty(),I=this.applyServerOverwrite_(r,F.path,F.snap,c,h,R,p))}else if(o.type===In.MERGE){var k=o;k.source.fromUser?I=this.applyUserMerge_(r,k.path,k.children,c,h,p):(D.assert(k.source.fromServer,"Unknown source."),R=k.source.tagged||r.getServerCache().isFiltered(),I=this.applyServerMerge_(r,k.path,k.children,c,h,R,p))}else if(o.type===In.ACK_USER_WRITE){var ot=o;I=ot.revert?this.revertUserWrite_(r,ot.path,c,h,p):this.ackUserWrite_(r,ot.path,ot.affectedTree,c,h,p)}else{if(o.type!==In.LISTEN_COMPLETE)throw D.assertionError("Unknown operation type: "+o.type);I=this.listenComplete_(r,o.path,c,p)}var pt=p.getChanges();return a.maybeAddValueEvent_(r,I,pt),new $r(I,pt)},a.maybeAddValueEvent_=function(r,o,c){var h=o.getEventCache();if(h.isFullyInitialized()){var p=h.getNode().isLeafNode()||h.getNode().isEmpty(),I=r.getCompleteEventSnap();(c.length>0||!r.getEventCache().isFullyInitialized()||p&&!h.getNode().equals(I)||!h.getNode().getPriority().equals(I.getPriority()))&&c.push(Le.valueChange(o.getCompleteEventSnap()))}},a.prototype.generateEventCacheAfterServerEvent_=function(r,o,c,h,p){var I=r.getEventCache();if(null!=c.shadowingWrite(o))return r;var R=void 0,F=void 0;if(o.isEmpty())if(D.assert(r.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),r.getServerCache().isFiltered()){var k=r.getCompleteServerSnap(),pt=c.calcCompleteEventChildren(k instanceof zt?k:zt.EMPTY_NODE);R=this.filter_.updateFullNode(r.getEventCache().getNode(),pt,p)}else{var _t=c.calcCompleteEventCache(r.getCompleteServerSnap());R=this.filter_.updateFullNode(r.getEventCache().getNode(),_t,p)}else{var Ut=o.getFront();if(".priority"===Ut){D.assert(1===o.getLength(),"Can't have a priority with additional path components");var $t=I.getNode();F=r.getServerCache().getNode();var Zt=c.calcEventCacheAfterServerOverwrite(o,$t,F);R=null!=Zt?this.filter_.updatePriority($t,Zt):I.getNode()}else{var He=o.popFront(),ze=void 0;if(I.isCompleteForChild(Ut)){F=r.getServerCache().getNode();var lr=c.calcEventCacheAfterServerOverwrite(o,I.getNode(),F);ze=null!=lr?I.getNode().getImmediateChild(Ut).updateChild(He,lr):I.getNode().getImmediateChild(Ut)}else ze=c.calcCompleteChild(Ut,r.getServerCache());R=null!=ze?this.filter_.updateChild(I.getNode(),Ut,ze,He,h,p):I.getNode()}}return r.updateEventSnap(R,I.isFullyInitialized()||o.isEmpty(),this.filter_.filtersNodes())},a.prototype.applyServerOverwrite_=function(r,o,c,h,p,I,R){var k,F=r.getServerCache(),ot=I?this.filter_:this.filter_.getIndexedFilter();if(o.isEmpty())k=ot.updateFullNode(F.getNode(),c,null);else if(ot.filtersNodes()&&!F.isFiltered()){var pt=F.getNode().updateChild(o,c);k=ot.updateFullNode(F.getNode(),pt,null)}else{var _t=o.getFront();if(!F.isCompleteForPath(o)&&o.getLength()>1)return r;var Ut=o.popFront(),Zt=F.getNode().getImmediateChild(_t).updateChild(Ut,c);k=".priority"===_t?ot.updatePriority(F.getNode(),Zt):ot.updateChild(F.getNode(),_t,Zt,Ut,Xr,null)}var He=r.updateServerSnap(k,F.isFullyInitialized()||o.isEmpty(),ot.filtersNodes()),ze=new Br(h,He,p);return this.generateEventCacheAfterServerEvent_(He,o,h,ze,R)},a.prototype.applyUserOverwrite_=function(r,o,c,h,p,I){var F,k,R=r.getEventCache(),ot=new Br(h,r,p);if(o.isEmpty())k=this.filter_.updateFullNode(r.getEventCache().getNode(),c,I),F=r.updateEventSnap(k,!0,this.filter_.filtersNodes());else{var pt=o.getFront();if(".priority"===pt)k=this.filter_.updatePriority(r.getEventCache().getNode(),c),F=r.updateEventSnap(k,R.isFullyInitialized(),R.isFiltered());else{var _t=o.popFront(),Ut=R.getNode().getImmediateChild(pt),$t=void 0;if(_t.isEmpty())$t=c;else{var Zt=ot.getCompleteChild(pt);$t=null!=Zt?".priority"===_t.getBack()&&Zt.getChild(_t.parent()).isEmpty()?Zt:Zt.updateChild(_t,c):zt.EMPTY_NODE}if(Ut.equals($t))F=r;else{var He=this.filter_.updateChild(R.getNode(),pt,$t,_t,ot,I);F=r.updateEventSnap(He,R.isFullyInitialized(),this.filter_.filtersNodes())}}}return F},a.cacheHasChild_=function(r,o){return r.getEventCache().isCompleteForChild(o)},a.prototype.applyUserMerge_=function(r,o,c,h,p,I){var R=this,F=r;return c.foreach(function(k,ot){var pt=o.child(k);a.cacheHasChild_(r,pt.getFront())&&(F=R.applyUserOverwrite_(F,pt,ot,h,p,I))}),c.foreach(function(k,ot){var pt=o.child(k);a.cacheHasChild_(r,pt.getFront())||(F=R.applyUserOverwrite_(F,pt,ot,h,p,I))}),F},a.prototype.applyMerge_=function(r,o){return o.foreach(function(c,h){r=r.updateChild(c,h)}),r},a.prototype.applyServerMerge_=function(r,o,c,h,p,I,R){var F=this;if(r.getServerCache().getNode().isEmpty()&&!r.getServerCache().isFullyInitialized())return r;var ot,k=r;ot=o.isEmpty()?c:Tn.Empty.setTree(o,c);var pt=r.getServerCache().getNode();return ot.children.inorderTraversal(function(_t,Ut){if(pt.hasChild(_t)){var $t=r.getServerCache().getNode().getImmediateChild(_t),Zt=F.applyMerge_($t,Ut);k=F.applyServerOverwrite_(k,new Rt(_t),Zt,h,p,I,R)}}),ot.children.inorderTraversal(function(_t,Ut){var $t=!r.getServerCache().isCompleteForChild(_t)&&null==Ut.value;if(!pt.hasChild(_t)&&!$t){var Zt=r.getServerCache().getNode().getImmediateChild(_t),He=F.applyMerge_(Zt,Ut);k=F.applyServerOverwrite_(k,new Rt(_t),He,h,p,I,R)}}),k},a.prototype.ackUserWrite_=function(r,o,c,h,p,I){if(null!=h.shadowingWrite(o))return r;var R=r.getServerCache().isFiltered(),F=r.getServerCache();if(null!=c.value){if(o.isEmpty()&&F.isFullyInitialized()||F.isCompleteForPath(o))return this.applyServerOverwrite_(r,o,F.getNode().getChild(o),h,p,R,I);if(o.isEmpty()){var k=Tn.Empty;return F.getNode().forEachChild(dt,function(pt,_t){k=k.set(new Rt(pt),_t)}),this.applyServerMerge_(r,o,k,h,p,R,I)}return r}var ot=Tn.Empty;return c.foreach(function(pt,_t){var Ut=o.child(pt);F.isCompleteForPath(Ut)&&(ot=ot.set(pt,F.getNode().getChild(Ut)))}),this.applyServerMerge_(r,o,ot,h,p,R,I)},a.prototype.listenComplete_=function(r,o,c,h){var p=r.getServerCache(),I=r.updateServerSnap(p.getNode(),p.isFullyInitialized()||o.isEmpty(),p.isFiltered());return this.generateEventCacheAfterServerEvent_(I,o,c,Xr,h)},a.prototype.revertUserWrite_=function(r,o,c,h,p){var I;if(null!=c.shadowingWrite(o))return r;var R=new Br(c,r,h),F=r.getEventCache().getNode(),k=void 0;if(o.isEmpty()||".priority"===o.getFront()){var ot=void 0;if(r.getServerCache().isFullyInitialized())ot=c.calcCompleteEventCache(r.getCompleteServerSnap());else{var pt=r.getServerCache().getNode();D.assert(pt instanceof zt,"serverChildren would be complete if leaf node"),ot=c.calcCompleteEventChildren(pt)}k=this.filter_.updateFullNode(F,ot=ot,p)}else{var _t=o.getFront(),Ut=c.calcCompleteChild(_t,r.getServerCache());null==Ut&&r.getServerCache().isCompleteForChild(_t)&&(Ut=F.getImmediateChild(_t)),(k=null!=Ut?this.filter_.updateChild(F,_t,Ut,o.popFront(),R,p):r.getEventCache().getNode().hasChild(_t)?this.filter_.updateChild(F,_t,zt.EMPTY_NODE,o.popFront(),R,p):F).isEmpty()&&r.getServerCache().isFullyInitialized()&&(I=c.calcCompleteEventCache(r.getCompleteServerSnap())).isLeafNode()&&(k=this.filter_.updateFullNode(k,I,p))}return I=r.getServerCache().isFullyInitialized()||null!=c.shadowingWrite(Rt.Empty),r.updateEventSnap(k,I,this.filter_.filtersNodes())},a}(),an=function(){function a(r){this.query_=r,this.index_=this.query_.getQueryParams().getIndex()}return a.prototype.generateEventsForChanges=function(r,o,c){var h=this,p=[],I=[];return r.forEach(function(R){R.type===Le.CHILD_CHANGED&&h.index_.indexedValueChanged(R.oldSnap,R.snapshotNode)&&I.push(Le.childMovedChange(R.childName,R.snapshotNode))}),this.generateEventsForType_(p,Le.CHILD_REMOVED,r,c,o),this.generateEventsForType_(p,Le.CHILD_ADDED,r,c,o),this.generateEventsForType_(p,Le.CHILD_MOVED,I,c,o),this.generateEventsForType_(p,Le.CHILD_CHANGED,r,c,o),this.generateEventsForType_(p,Le.VALUE,r,c,o),p},a.prototype.generateEventsForType_=function(r,o,c,h,p){var I=this,R=c.filter(function(F){return F.type===o});R.sort(this.compareChanges_.bind(this)),R.forEach(function(F){var k=I.materializeSingleChange_(F,p);h.forEach(function(ot){ot.respondsTo(F.type)&&r.push(ot.createEvent(k,I.query_))})})},a.prototype.materializeSingleChange_=function(r,o){return"value"===r.type||"child_removed"===r.type||(r.prevName=o.getPredecessorChildName(r.childName,r.snapshotNode,this.index_)),r},a.prototype.compareChanges_=function(r,o){if(null==r.childName||null==o.childName)throw D.assertionError("Should only compare child_ events.");var c=new q(r.childName,r.snapshotNode),h=new q(o.childName,o.snapshotNode);return this.index_.compare(c,h)},a}(),ci=function(){function a(r,o){this.query_=r,this.eventRegistrations_=[];var c=this.query_.getQueryParams(),h=new Vr(c.getIndex()),p=c.getNodeFilter();this.processor_=new wi(p);var I=o.getServerCache(),R=o.getEventCache(),F=h.updateFullNode(zt.EMPTY_NODE,I.getNode(),null),k=p.updateFullNode(zt.EMPTY_NODE,R.getNode(),null),ot=new er(F,I.isFullyInitialized(),h.filtersNodes()),pt=new er(k,R.isFullyInitialized(),p.filtersNodes());this.viewCache_=new br(pt,ot),this.eventGenerator_=new an(this.query_)}return a.prototype.getQuery=function(){return this.query_},a.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},a.prototype.getCompleteServerCache=function(r){var o=this.viewCache_.getCompleteServerSnap();return o&&(this.query_.getQueryParams().loadsAllData()||!r.isEmpty()&&!o.getImmediateChild(r.getFront()).isEmpty())?o.getChild(r):null},a.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},a.prototype.addEventRegistration=function(r){this.eventRegistrations_.push(r)},a.prototype.removeEventRegistration=function(r,o){var c=[];if(o){D.assert(null==r,"A cancel should cancel all event registrations.");var h=this.query_.path;this.eventRegistrations_.forEach(function(F){var k=F.createCancelEvent(o=o,h);k&&c.push(k)})}if(r){for(var p=[],I=0;I<this.eventRegistrations_.length;++I){var R=this.eventRegistrations_[I];if(R.matches(r)){if(r.hasAnyCallback()){p=p.concat(this.eventRegistrations_.slice(I+1));break}}else p.push(R)}this.eventRegistrations_=p}else this.eventRegistrations_=[];return c},a.prototype.applyOperation=function(r,o,c){r.type===In.MERGE&&null!==r.source.queryId&&(D.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),D.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var h=this.viewCache_,p=this.processor_.applyOperation(h,r,o,c);return this.processor_.assertIndexed(p.viewCache),D.assert(p.viewCache.getServerCache().isFullyInitialized()||!h.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=p.viewCache,this.generateEventsForChanges_(p.changes,p.viewCache.getEventCache().getNode(),null)},a.prototype.getInitialEvents=function(r){var o=this.viewCache_.getEventCache(),c=[];return o.getNode().isLeafNode()||o.getNode().forEachChild(j,function(p,I){c.push(Le.childAddedChange(p,I))}),o.isFullyInitialized()&&c.push(Le.valueChange(o.getNode())),this.generateEventsForChanges_(c,o.getNode(),r)},a.prototype.generateEventsForChanges_=function(r,o,c){return this.eventGenerator_.generateEventsForChanges(r,o,c?[c]:this.eventRegistrations_)},a}(),bi=function(){function a(){this.views=new Map}return Object.defineProperty(a,"__referenceConstructor",{get:function(){return D.assert(li,"Reference.ts has not been loaded"),li},set:function(r){D.assert(!li,"__referenceConstructor has already been defined"),li=r},enumerable:!1,configurable:!0}),a.prototype.isEmpty=function(){return 0===this.views.size},a.prototype.applyOperation=function(r,o,c){var h,p,I=r.source.queryId;if(null!==I){var R=this.views.get(I);return D.assert(null!=R,"SyncTree gave us an op for an invalid query."),R.applyOperation(r,o,c)}var F=[];try{for(var k=Dt.__values(this.views.values()),ot=k.next();!ot.done;ot=k.next())F=F.concat((R=ot.value).applyOperation(r,o,c))}catch(pt){h={error:pt}}finally{try{ot&&!ot.done&&(p=k.return)&&p.call(k)}finally{if(h)throw h.error}}return F},a.prototype.addEventRegistration=function(r,o,c,h,p){var I=r.queryIdentifier(),R=this.views.get(I);if(!R){var F=c.calcCompleteEventCache(p?h:null),k=!1;F?k=!0:h instanceof zt?(F=c.calcCompleteEventChildren(h),k=!1):(F=zt.EMPTY_NODE,k=!1);var ot=new br(new er(F,k,!1),new er(h,p,!1));R=new ci(r,ot),this.views.set(I,R)}return R.addEventRegistration(o),R.getInitialEvents(o)},a.prototype.removeEventRegistration=function(r,o,c){var h,p,I=r.queryIdentifier(),R=[],F=[],k=this.hasCompleteView();if("default"===I)try{for(var ot=Dt.__values(this.views.entries()),pt=ot.next();!pt.done;pt=ot.next()){var $t,_t=Dt.__read(pt.value,2),Ut=_t[0];F=F.concat(($t=_t[1]).removeEventRegistration(o,c)),$t.isEmpty()&&(this.views.delete(Ut),$t.getQuery().getQueryParams().loadsAllData()||R.push($t.getQuery()))}}catch(Zt){h={error:Zt}}finally{try{pt&&!pt.done&&(p=ot.return)&&p.call(ot)}finally{if(h)throw h.error}}else($t=this.views.get(I))&&(F=F.concat($t.removeEventRegistration(o,c)),$t.isEmpty()&&(this.views.delete(I),$t.getQuery().getQueryParams().loadsAllData()||R.push($t.getQuery())));return k&&!this.hasCompleteView()&&R.push(new a.__referenceConstructor(r.repo,r.path)),{removed:R,events:F}},a.prototype.getQueryViews=function(){var r,o,c=[];try{for(var h=Dt.__values(this.views.values()),p=h.next();!p.done;p=h.next()){var I=p.value;I.getQuery().getQueryParams().loadsAllData()||c.push(I)}}catch(R){r={error:R}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}return c},a.prototype.getCompleteServerCache=function(r){var o,c,h=null;try{for(var p=Dt.__values(this.views.values()),I=p.next();!I.done;I=p.next())h=h||I.value.getCompleteServerCache(r)}catch(F){o={error:F}}finally{try{I&&!I.done&&(c=p.return)&&c.call(p)}finally{if(o)throw o.error}}return h},a.prototype.viewForQuery=function(r){if(r.getQueryParams().loadsAllData())return this.getCompleteView();var c=r.queryIdentifier();return this.views.get(c)},a.prototype.viewExistsForQuery=function(r){return null!=this.viewForQuery(r)},a.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},a.prototype.getCompleteView=function(){var r,o;try{for(var c=Dt.__values(this.views.values()),h=c.next();!h.done;h=c.next()){var p=h.value;if(p.getQuery().getQueryParams().loadsAllData())return p}}catch(I){r={error:I}}finally{try{h&&!h.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}return null},a}(),rr=function(){function a(r){this.writeTree_=r}return a.prototype.addWrite=function(r,o){if(r.isEmpty())return new a(new Tn(o));var c=this.writeTree_.findRootMostValueAndPath(r);if(null!=c){var h=c.path,p=c.value,I=Rt.relativePath(h,r);return p=p.updateChild(I,o),new a(this.writeTree_.set(h,p))}var R=new Tn(o);return new a(this.writeTree_.setTree(r,R))},a.prototype.addWrites=function(r,o){var c=this;return yt(o,function(h,p){c=c.addWrite(r.child(h),p)}),c},a.prototype.removeWrite=function(r){return r.isEmpty()?a.Empty:new a(this.writeTree_.setTree(r,Tn.Empty))},a.prototype.hasCompleteWrite=function(r){return null!=this.getCompleteNode(r)},a.prototype.getCompleteNode=function(r){var o=this.writeTree_.findRootMostValueAndPath(r);return null!=o?this.writeTree_.get(o.path).getChild(Rt.relativePath(o.path,r)):null},a.prototype.getCompleteChildren=function(){var r=[],o=this.writeTree_.value;return null!=o?o.isLeafNode()||o.forEachChild(j,function(c,h){r.push(new q(c,h))}):this.writeTree_.children.inorderTraversal(function(c,h){null!=h.value&&r.push(new q(c,h.value))}),r},a.prototype.childCompoundWrite=function(r){if(r.isEmpty())return this;var o=this.getCompleteNode(r);return new a(null!=o?new Tn(o):this.writeTree_.subtree(r))},a.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},a.prototype.apply=function(r){return _(Rt.Empty,this.writeTree_,r)},a.Empty=new a(new Tn(null)),a}();function _(a,r,o){if(null!=r.value)return o.updateChild(a,r.value);var c=null;return r.children.inorderTraversal(function(h,p){".priority"===h?(D.assert(null!==p.value,"Priority writes must always be leaf nodes"),c=p.value):o=_(a.child(h),p,o)}),!o.getChild(a).isEmpty()&&null!==c&&(o=o.updateChild(a.child(".priority"),c)),o}var g=function(){function a(){this.visibleWrites_=rr.Empty,this.allWrites_=[],this.lastWriteId_=-1}return a.prototype.childWrites=function(r){return new N(r,this)},a.prototype.addOverwrite=function(r,o,c,h){D.assert(c>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===h&&(h=!0),this.allWrites_.push({path:r,snap:o,writeId:c,visible:h}),h&&(this.visibleWrites_=this.visibleWrites_.addWrite(r,o)),this.lastWriteId_=c},a.prototype.addMerge=function(r,o,c){D.assert(c>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:r,children:o,writeId:c,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(r,o),this.lastWriteId_=c},a.prototype.getWrite=function(r){for(var o=0;o<this.allWrites_.length;o++){var c=this.allWrites_[o];if(c.writeId===r)return c}return null},a.prototype.removeWrite=function(r){var o=this,c=this.allWrites_.findIndex(function(ot){return ot.writeId===r});D.assert(c>=0,"removeWrite called with nonexistent writeId.");var h=this.allWrites_[c];this.allWrites_.splice(c,1);for(var p=h.visible,I=!1,R=this.allWrites_.length-1;p&&R>=0;){var F=this.allWrites_[R];F.visible&&(R>=c&&this.recordContainsPath_(F,h.path)?p=!1:h.path.contains(F.path)&&(I=!0)),R--}return!!p&&(I?(this.resetTree_(),!0):(h.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(h.path):yt(h.children,function(ot){o.visibleWrites_=o.visibleWrites_.removeWrite(h.path.child(ot))}),!0))},a.prototype.getCompleteWriteData=function(r){return this.visibleWrites_.getCompleteNode(r)},a.prototype.calcCompleteEventCache=function(r,o,c,h){if(c||h){var F=this.visibleWrites_.childCompoundWrite(r);return!h&&F.isEmpty()?o:h||null!=o||F.hasCompleteWrite(Rt.Empty)?a.layerTree_(this.allWrites_,function(_t){return(_t.visible||h)&&(!c||!~c.indexOf(_t.writeId))&&(_t.path.contains(r)||r.contains(_t.path))},r).apply(o||zt.EMPTY_NODE):null}var p=this.visibleWrites_.getCompleteNode(r);if(null!=p)return p;var I=this.visibleWrites_.childCompoundWrite(r);return I.isEmpty()?o:null!=o||I.hasCompleteWrite(Rt.Empty)?I.apply(o||zt.EMPTY_NODE):null},a.prototype.calcCompleteEventChildren=function(r,o){var c=zt.EMPTY_NODE,h=this.visibleWrites_.getCompleteNode(r);if(h)return h.isLeafNode()||h.forEachChild(j,function(R,F){c=c.updateImmediateChild(R,F)}),c;if(o){var p=this.visibleWrites_.childCompoundWrite(r);return o.forEachChild(j,function(R,F){var k=p.childCompoundWrite(new Rt(R)).apply(F);c=c.updateImmediateChild(R,k)}),p.getCompleteChildren().forEach(function(R){c=c.updateImmediateChild(R.name,R.node)}),c}return this.visibleWrites_.childCompoundWrite(r).getCompleteChildren().forEach(function(R){c=c.updateImmediateChild(R.name,R.node)}),c},a.prototype.calcEventCacheAfterServerOverwrite=function(r,o,c,h){D.assert(c||h,"Either existingEventSnap or existingServerSnap must exist");var p=r.child(o);if(this.visibleWrites_.hasCompleteWrite(p))return null;var I=this.visibleWrites_.childCompoundWrite(p);return I.isEmpty()?h.getChild(o):I.apply(h.getChild(o))},a.prototype.calcCompleteChild=function(r,o,c){var h=r.child(o),p=this.visibleWrites_.getCompleteNode(h);return null!=p?p:c.isCompleteForChild(o)?this.visibleWrites_.childCompoundWrite(h).apply(c.getNode().getImmediateChild(o)):null},a.prototype.shadowingWrite=function(r){return this.visibleWrites_.getCompleteNode(r)},a.prototype.calcIndexedSlice=function(r,o,c,h,p,I){var R,F=this.visibleWrites_.childCompoundWrite(r),k=F.getCompleteNode(Rt.Empty);if(null!=k)R=k;else{if(null==o)return[];R=F.apply(o)}if((R=R.withIndex(I)).isEmpty()||R.isLeafNode())return[];for(var ot=[],pt=I.getCompare(),_t=p?R.getReverseIteratorFrom(c,I):R.getIteratorFrom(c,I),Ut=_t.getNext();Ut&&ot.length<h;)0!==pt(Ut,c)&&ot.push(Ut),Ut=_t.getNext();return ot},a.prototype.recordContainsPath_=function(r,o){if(r.snap)return r.path.contains(o);for(var c in r.children)if(r.children.hasOwnProperty(c)&&r.path.child(c).contains(o))return!0;return!1},a.prototype.resetTree_=function(){this.visibleWrites_=a.layerTree_(this.allWrites_,a.DefaultFilter_,Rt.Empty),this.lastWriteId_=this.allWrites_.length>0?this.allWrites_[this.allWrites_.length-1].writeId:-1},a.DefaultFilter_=function(r){return r.visible},a.layerTree_=function(r,o,c){for(var h=rr.Empty,p=0;p<r.length;++p){var I=r[p];if(o(I)){var R=I.path,F=void 0;if(I.snap)c.contains(R)?(F=Rt.relativePath(c,R),h=h.addWrite(F,I.snap)):R.contains(c)&&(F=Rt.relativePath(R,c),h=h.addWrite(Rt.Empty,I.snap.getChild(F)));else{if(!I.children)throw D.assertionError("WriteRecord should have .snap or .children");if(c.contains(R))F=Rt.relativePath(c,R),h=h.addWrites(F,I.children);else if(R.contains(c))if((F=Rt.relativePath(R,c)).isEmpty())h=h.addWrites(Rt.Empty,I.children);else{var k=D.safeGet(I.children,F.getFront());if(k){var ot=k.getChild(F.popFront());h=h.addWrite(Rt.Empty,ot)}}}}}return h},a}(),N=function(){function a(r,o){this.treePath_=r,this.writeTree_=o}return a.prototype.calcCompleteEventCache=function(r,o,c){return this.writeTree_.calcCompleteEventCache(this.treePath_,r,o,c)},a.prototype.calcCompleteEventChildren=function(r){return this.writeTree_.calcCompleteEventChildren(this.treePath_,r)},a.prototype.calcEventCacheAfterServerOverwrite=function(r,o,c){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,r,o,c)},a.prototype.shadowingWrite=function(r){return this.writeTree_.shadowingWrite(this.treePath_.child(r))},a.prototype.calcIndexedSlice=function(r,o,c,h,p){return this.writeTree_.calcIndexedSlice(this.treePath_,r,o,c,h,p)},a.prototype.calcCompleteChild=function(r,o){return this.writeTree_.calcCompleteChild(this.treePath_,r,o)},a.prototype.child=function(r){return new a(this.treePath_.child(r),this.writeTree_)},a}(),V=function(){function a(r){this.listenProvider_=r,this.syncPointTree_=Tn.Empty,this.pendingWriteTree_=new g,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return a.prototype.applyUserOverwrite=function(r,o,c,h){return this.pendingWriteTree_.addOverwrite(r,o,c,h),h?this.applyOperationToSyncPoints_(new _r(ar.User,r,o)):[]},a.prototype.applyUserMerge=function(r,o,c){this.pendingWriteTree_.addMerge(r,o,c);var h=Tn.fromObject(o);return this.applyOperationToSyncPoints_(new wr(ar.User,r,h))},a.prototype.ackUserWrite=function(r,o){void 0===o&&(o=!1);var c=this.pendingWriteTree_.getWrite(r);if(this.pendingWriteTree_.removeWrite(r)){var p=Tn.Empty;return null!=c.snap?p=p.set(Rt.Empty,!0):yt(c.children,function(I,R){p=p.set(new Rt(I),R)}),this.applyOperationToSyncPoints_(new jr(c.path,p,o))}return[]},a.prototype.applyServerOverwrite=function(r,o){return this.applyOperationToSyncPoints_(new _r(ar.Server,r,o))},a.prototype.applyServerMerge=function(r,o){var c=Tn.fromObject(o);return this.applyOperationToSyncPoints_(new wr(ar.Server,r,c))},a.prototype.applyListenComplete=function(r){return this.applyOperationToSyncPoints_(new ui(ar.Server,r))},a.prototype.applyTaggedQueryOverwrite=function(r,o,c){var h=this.queryKeyForTag_(c);if(null!=h){var p=a.parseQueryKey_(h),I=p.path,R=p.queryId,F=Rt.relativePath(I,r),k=new _r(ar.forServerTaggedQuery(R),F,o);return this.applyTaggedOperation_(I,k)}return[]},a.prototype.applyTaggedQueryMerge=function(r,o,c){var h=this.queryKeyForTag_(c);if(h){var p=a.parseQueryKey_(h),I=p.path,R=p.queryId,F=Rt.relativePath(I,r),k=Tn.fromObject(o),ot=new wr(ar.forServerTaggedQuery(R),F,k);return this.applyTaggedOperation_(I,ot)}return[]},a.prototype.applyTaggedListenComplete=function(r,o){var c=this.queryKeyForTag_(o);if(c){var h=a.parseQueryKey_(c),p=h.path,I=h.queryId,R=Rt.relativePath(p,r),F=new ui(ar.forServerTaggedQuery(I),R);return this.applyTaggedOperation_(p,F)}return[]},a.prototype.addEventRegistration=function(r,o){var c=r.path,h=null,p=!1;this.syncPointTree_.foreachOnPath(c,function(Zt,He){var ze=Rt.relativePath(Zt,c);h=h||He.getCompleteServerCache(ze),p=p||He.hasCompleteView()});var R,I=this.syncPointTree_.get(c);I?(p=p||I.hasCompleteView(),h=h||I.getCompleteServerCache(Rt.Empty)):(I=new bi,this.syncPointTree_=this.syncPointTree_.set(c,I)),null!=h?R=!0:(R=!1,h=zt.EMPTY_NODE,this.syncPointTree_.subtree(c).foreachChild(function(Zt,He){var ze=He.getCompleteServerCache(Rt.Empty);ze&&(h=h.updateImmediateChild(Zt,ze))}));var k=I.viewExistsForQuery(r);if(!k&&!r.getQueryParams().loadsAllData()){var ot=a.makeQueryKey_(r);D.assert(!this.queryToTagMap.has(ot),"View does not exist, but we have a tag");var pt=a.getNextQueryTag_();this.queryToTagMap.set(ot,pt),this.tagToQueryMap.set(pt,ot)}var _t=this.pendingWriteTree_.childWrites(c),Ut=I.addEventRegistration(r,o,_t,h,R);if(!k&&!p){var $t=I.viewForQuery(r);Ut=Ut.concat(this.setupListener_(r,$t))}return Ut},a.prototype.removeEventRegistration=function(r,o,c){var h=this,p=r.path,I=this.syncPointTree_.get(p),R=[];if(I&&("default"===r.queryIdentifier()||I.viewExistsForQuery(r))){var F=I.removeEventRegistration(r,o,c);I.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(p));var k=F.removed;R=F.events;var ot=-1!==k.findIndex(function(yr){return yr.getQueryParams().loadsAllData()}),pt=this.syncPointTree_.findOnPath(p,function(yr,vi){return vi.hasCompleteView()});if(ot&&!pt){var _t=this.syncPointTree_.subtree(p);if(!_t.isEmpty())for(var Ut=this.collectDistinctViewsForSubTree_(_t),$t=0;$t<Ut.length;++$t){var Zt=Ut[$t],He=Zt.getQuery(),ze=this.createListenerForView_(Zt);this.listenProvider_.startListening(a.queryForListening_(He),this.tagForQuery_(He),ze.hashFn,ze.onComplete)}}!pt&&k.length>0&&!c&&(ot?this.listenProvider_.stopListening(a.queryForListening_(r),null):k.forEach(function(yr){var vi=h.queryToTagMap.get(a.makeQueryKey_(yr));h.listenProvider_.stopListening(a.queryForListening_(yr),vi)})),this.removeTags_(k)}return R},a.prototype.calcCompleteEventCache=function(r,o){var h=this.pendingWriteTree_,p=this.syncPointTree_.findOnPath(r,function(I,R){var F=Rt.relativePath(I,r),k=R.getCompleteServerCache(F);if(k)return k});return h.calcCompleteEventCache(r,p,o,!0)},a.prototype.collectDistinctViewsForSubTree_=function(r){return r.fold(function(o,c,h){if(c&&c.hasCompleteView())return[c.getCompleteView()];var I=[];return c&&(I=c.getQueryViews()),yt(h,function(R,F){I=I.concat(F)}),I})},a.prototype.removeTags_=function(r){for(var o=0;o<r.length;++o){var c=r[o];if(!c.getQueryParams().loadsAllData()){var h=a.makeQueryKey_(c),p=this.queryToTagMap.get(h);this.queryToTagMap.delete(h),this.tagToQueryMap.delete(p)}}},a.queryForListening_=function(r){return r.getQueryParams().loadsAllData()&&!r.getQueryParams().isDefault()?r.getRef():r},a.prototype.setupListener_=function(r,o){var c=r.path,h=this.tagForQuery_(r),p=this.createListenerForView_(o),I=this.listenProvider_.startListening(a.queryForListening_(r),h,p.hashFn,p.onComplete),R=this.syncPointTree_.subtree(c);if(h)D.assert(!R.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var F=R.fold(function(pt,_t,Ut){if(!pt.isEmpty()&&_t&&_t.hasCompleteView())return[_t.getCompleteView().getQuery()];var $t=[];return _t&&($t=$t.concat(_t.getQueryViews().map(function(Zt){return Zt.getQuery()}))),yt(Ut,function(Zt,He){$t=$t.concat(He)}),$t}),k=0;k<F.length;++k){var ot=F[k];this.listenProvider_.stopListening(a.queryForListening_(ot),this.tagForQuery_(ot))}return I},a.prototype.createListenerForView_=function(r){var o=this,c=r.getQuery(),h=this.tagForQuery_(c);return{hashFn:function(){return(r.getServerCache()||zt.EMPTY_NODE).hash()},onComplete:function(p){if("ok"===p)return h?o.applyTaggedListenComplete(c.path,h):o.applyListenComplete(c.path);var I=function(a,r){var o="Unknown Error";"too_big"===a?o="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===a?o="Client doesn't have permission to access the desired data.":"unavailable"===a&&(o="The service is unavailable");var c=new Error(a+" at "+r.path.toString()+": "+o);return c.code=a.toUpperCase(),c}(p,c);return o.removeEventRegistration(c,null,I)}}},a.makeQueryKey_=function(r){return r.path.toString()+"$"+r.queryIdentifier()},a.parseQueryKey_=function(r){var o=r.indexOf("$");return D.assert(-1!==o&&o<r.length-1,"Bad queryKey."),{queryId:r.substr(o+1),path:new Rt(r.substr(0,o))}},a.prototype.queryKeyForTag_=function(r){return this.tagToQueryMap.get(r)},a.prototype.tagForQuery_=function(r){var o=a.makeQueryKey_(r);return this.queryToTagMap.get(o)},a.getNextQueryTag_=function(){return a.nextQueryTag_++},a.prototype.applyTaggedOperation_=function(r,o){var c=this.syncPointTree_.get(r);D.assert(c,"Missing sync point for query tag that we're tracking");var h=this.pendingWriteTree_.childWrites(r);return c.applyOperation(o,h,null)},a.prototype.applyOperationToSyncPoints_=function(r){return this.applyOperationHelper_(r,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Rt.Empty))},a.prototype.applyOperationHelper_=function(r,o,c,h){if(r.path.isEmpty())return this.applyOperationDescendantsHelper_(r,o,c,h);var p=o.get(Rt.Empty);null==c&&null!=p&&(c=p.getCompleteServerCache(Rt.Empty));var I=[],R=r.path.getFront(),F=r.operationForChild(R),k=o.children.get(R);if(k&&F){var ot=c?c.getImmediateChild(R):null,pt=h.child(R);I=I.concat(this.applyOperationHelper_(F,k,ot,pt))}return p&&(I=I.concat(p.applyOperation(r,h,c))),I},a.prototype.applyOperationDescendantsHelper_=function(r,o,c,h){var p=this,I=o.get(Rt.Empty);null==c&&null!=I&&(c=I.getCompleteServerCache(Rt.Empty));var R=[];return o.children.inorderTraversal(function(F,k){var ot=c?c.getImmediateChild(F):null,pt=h.child(F),_t=r.operationForChild(F);_t&&(R=R.concat(p.applyOperationDescendantsHelper_(_t,k,ot,pt)))}),I&&(R=R.concat(I.applyOperation(r,h,c))),R},a.nextQueryTag_=1,a}(),H=function(){function a(){this.rootNode_=zt.EMPTY_NODE}return a.prototype.getNode=function(r){return this.rootNode_.getChild(r)},a.prototype.updateSnapshot=function(r,o){this.rootNode_=this.rootNode_.updateChild(r,o)},a}(),nt=function(){function a(){this.counters_={}}return a.prototype.incrementCounter=function(r,o){void 0===o&&(o=1),D.contains(this.counters_,r)||(this.counters_[r]=0),this.counters_[r]+=o},a.prototype.get=function(){return D.deepCopy(this.counters_)},a}(),bt=function(){function a(){}return a.getCollection=function(r){var o=r.toString();return this.collections_[o]||(this.collections_[o]=new nt),this.collections_[o]},a.getOrCreateReporter=function(r,o){var c=r.toString();return this.reporters_[c]||(this.reporters_[c]=o()),this.reporters_[c]},a.collections_={},a.reporters_={},a}(),kt=function(){function a(r){this.collection_=r,this.last_=null}return a.prototype.get=function(){var r=this.collection_.get(),o=Dt.__assign({},r);return this.last_&&yt(this.last_,function(c,h){o[c]=o[c]-h}),this.last_=r,o},a}(),xe=function(){function a(r,o){this.server_=o,this.statsToReport_={},this.statsListener_=new kt(r);var c=1e4+2e4*Math.random();ye(this.reportStats_.bind(this),Math.floor(c))}return a.prototype.includeStat=function(r){this.statsToReport_[r]=!0},a.prototype.reportStats_=function(){var r=this,o=this.statsListener_.get(),c={},h=!1;yt(o,function(p,I){I>0&&D.contains(r.statsToReport_,p)&&(c[p]=I,h=!0)}),h&&this.server_.reportStats(c),ye(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},a}(),me=function(){function a(){this.eventLists_=[],this.recursionDepth_=0}return a.prototype.queueEvents=function(r){for(var o=null,c=0;c<r.length;c++){var h=r[c],p=h.getPath();null!==o&&!p.equals(o.getPath())&&(this.eventLists_.push(o),o=null),null===o&&(o=new yn(p)),o.add(h)}o&&this.eventLists_.push(o)},a.prototype.raiseEventsAtPath=function(r,o){this.queueEvents(o),this.raiseQueuedEventsMatchingPredicate_(function(c){return c.equals(r)})},a.prototype.raiseEventsForChangedPath=function(r,o){this.queueEvents(o),this.raiseQueuedEventsMatchingPredicate_(function(c){return c.contains(r)||r.contains(c)})},a.prototype.raiseQueuedEventsMatchingPredicate_=function(r){this.recursionDepth_++;for(var o=!0,c=0;c<this.eventLists_.length;c++){var h=this.eventLists_[c];h&&(r(h.getPath())?(this.eventLists_[c].raise(),this.eventLists_[c]=null):o=!1)}o&&(this.eventLists_=[]),this.recursionDepth_--},a}(),yn=function(){function a(r){this.path_=r,this.events_=[]}return a.prototype.add=function(r){this.events_.push(r)},a.prototype.raise=function(){for(var r=0;r<this.events_.length;r++){var o=this.events_[r];if(null!==o){this.events_[r]=null;var c=o.getEventRunner();ct&&Kt("event: "+o.toString()),jt(c)}}},a.prototype.getPath=function(){return this.path_},a}(),Ve=function(){function a(r){this.allowedEvents_=r,this.listeners_={},D.assert(Array.isArray(r)&&r.length>0,"Requires a non-empty array")}return a.prototype.trigger=function(r){for(var o=[],c=1;c<arguments.length;c++)o[c-1]=arguments[c];if(Array.isArray(this.listeners_[r]))for(var h=Dt.__spread(this.listeners_[r]),p=0;p<h.length;p++)h[p].callback.apply(h[p].context,o)},a.prototype.on=function(r,o,c){this.validateEventType_(r),this.listeners_[r]=this.listeners_[r]||[],this.listeners_[r].push({callback:o,context:c});var h=this.getInitialEvent(r);h&&o.apply(c,h)},a.prototype.off=function(r,o,c){this.validateEventType_(r);for(var h=this.listeners_[r]||[],p=0;p<h.length;p++)if(h[p].callback===o&&(!c||c===h[p].context))return void h.splice(p,1)},a.prototype.validateEventType_=function(r){D.assert(this.allowedEvents_.find(function(o){return o===r}),"Unknown event: "+r)},a}(),gn=function(a){function r(){var c,h,o=a.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(h="visibilitychange",c="hidden"):void 0!==document.mozHidden?(h="mozvisibilitychange",c="mozHidden"):void 0!==document.msHidden?(h="msvisibilitychange",c="msHidden"):void 0!==document.webkitHidden&&(h="webkitvisibilitychange",c="webkitHidden")),o.visible_=!0,h&&document.addEventListener(h,function(){var p=!document[c];p!==o.visible_&&(o.visible_=p,o.trigger("visible",p))},!1),o}return Dt.__extends(r,a),r.getInstance=function(){return new r},r.prototype.getInitialEvent=function(o){return D.assert("visible"===o,"Unknown event type: "+o),[this.visible_]},r}(Ve),rn=function(a){function r(){var o=a.call(this,["online"])||this;return o.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!D.isMobileCordova()&&(window.addEventListener("online",function(){o.online_||(o.online_=!0,o.trigger("online",!0))},!1),window.addEventListener("offline",function(){o.online_&&(o.online_=!1,o.trigger("online",!1))},!1)),o}return Dt.__extends(r,a),r.getInstance=function(){return new r},r.prototype.getInitialEvent=function(o){return D.assert("online"===o,"Unknown event type: "+o),[this.online_]},r.prototype.currentlyOnline=function(){return this.online_},r}(Ve),Kn=function(){function a(r){this.onMessage_=r,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return a.prototype.closeAfter=function(r,o){this.closeAfterResponse=r,this.onClose=o,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},a.prototype.handleResponse=function(r,o){var c=this;this.pendingResponses[r]=o;for(var h=function(){var R=p.pendingResponses[p.currentResponseNum];delete p.pendingResponses[p.currentResponseNum];for(var F=function(ot){R[ot]&&jt(function(){c.onMessage_(R[ot])})},k=0;k<R.length;++k)F(k);if(p.currentResponseNum===p.closeAfterResponse)return p.onClose&&(p.onClose(),p.onClose=null),"break";p.currentResponseNum++},p=this;this.pendingResponses[this.currentResponseNum]&&"break"!==h(););},a}(),Wr=function(){function a(r,o,c,h,p){this.connId=r,this.repoInfo=o,this.applicationId=c,this.transportSessionId=h,this.lastSessionId=p,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ne(r),this.stats_=bt.getCollection(o),this.urlFn=function(I){return o.connectionURL(hn,I)}}return a.prototype.open=function(r,o){var c=this;this.curSegmentNum=0,this.onDisconnect_=o,this.myPacketOrderer=new Kn(r),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){c.log_("Timed out trying to connect."),c.onClosed_(),c.connectTimeoutTimer_=null},Math.floor(3e4)),function(a){if(D.isNodeSdk()||"complete"===document.readyState)a();else{var r=!1,o=function(){document.body?r||(r=!0,a()):setTimeout(o,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&o()}),window.attachEvent("onload",o))}}(function(){if(!c.isClosed_){c.scriptTagHolder=new Ei(function(){for(var I=[],R=0;R<arguments.length;R++)I[R]=arguments[R];var F=Dt.__read(I,5),k=F[0],ot=F[1],pt=F[2];if(c.incrementIncomingBytes_(I),c.scriptTagHolder)if(c.connectTimeoutTimer_&&(clearTimeout(c.connectTimeoutTimer_),c.connectTimeoutTimer_=null),c.everConnected_=!0,"start"===k)c.id=ot,c.password=pt;else{if("close"!==k)throw new Error("Unrecognized command received: "+k);ot?(c.scriptTagHolder.sendNewPolls=!1,c.myPacketOrderer.closeAfter(ot,function(){c.onClosed_()})):c.onClosed_()}},function(){for(var I=[],R=0;R<arguments.length;R++)I[R]=arguments[R];var F=Dt.__read(I,2),k=F[0],ot=F[1];c.incrementIncomingBytes_(I),c.myPacketOrderer.handleResponse(k,ot)},function(){c.onClosed_()},c.urlFn);var h={start:"t"};h.ser=Math.floor(1e8*Math.random()),c.scriptTagHolder.uniqueCallbackIdentifier&&(h.cb=c.scriptTagHolder.uniqueCallbackIdentifier),h.v="5",c.transportSessionId&&(h.s=c.transportSessionId),c.lastSessionId&&(h.ls=c.lastSessionId),c.applicationId&&(h.p=c.applicationId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(le)&&(h.r="f");var p=c.urlFn(h);c.log_("Connecting via long-poll to "+p),c.scriptTagHolder.addTag(p,function(){})}})},a.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},a.forceAllow=function(){a.forceAllow_=!0},a.forceDisallow=function(){a.forceDisallow_=!0},a.isAvailable=function(){return!(D.isNodeSdk()||!a.forceAllow_&&(a.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},a.prototype.markConnectionHealthy=function(){},a.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},a.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},a.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},a.prototype.send=function(r){var o=D.stringify(r);this.bytesSent+=o.length,this.stats_.incrementCounter("bytes_sent",o.length);for(var c=D.base64Encode(o),h=tt(c,1840),p=0;p<h.length;p++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,h.length,h[p]),this.curSegmentNum++},a.prototype.addDisconnectPingFrame=function(r,o){if(!D.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var c={dframe:"t"};c.id=r,c.pw=o,this.myDisconnFrame.src=this.urlFn(c),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},a.prototype.incrementIncomingBytes_=function(r){var o=D.stringify(r).length;this.bytesReceived+=o,this.stats_.incrementCounter("bytes_received",o)},a}(),Ei=function(){function a(r,o,c,h){if(this.onDisconnect=c,this.urlFn=h,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,D.isNodeSdk())this.commandCB=r,this.onMessageCB=o;else{this.uniqueCallbackIdentifier=ge(),window["pLPCommand"+this.uniqueCallbackIdentifier]=r,window["pRTLPCB"+this.uniqueCallbackIdentifier]=o,this.myIFrame=a.createIFrame_();var p="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(p='<script>document.domain="'+document.domain+'";<\/script>');var R="<html><body>"+p+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(R),this.myIFrame.doc.close()}catch(F){Kt("frame writing exception"),F.stack&&Kt(F.stack),Kt(F)}}}return a.createIFrame_=function(){var r=document.createElement("iframe");if(r.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(r);try{r.contentWindow.document||Kt("No IE domain setting required")}catch(h){var c=document.domain;r.src="javascript:void((function(){document.open();document.domain='"+c+"';document.close();})())"}return r.contentDocument?r.doc=r.contentDocument:r.contentWindow?r.doc=r.contentWindow.document:r.document&&(r.doc=r.document),r},a.prototype.close=function(){var r=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==r.myIFrame&&(document.body.removeChild(r.myIFrame),r.myIFrame=null)},Math.floor(0)));var o=this.onDisconnect;o&&(this.onDisconnect=null,o())},a.prototype.startLongPoll=function(r,o){for(this.myID=r,this.myPW=o,this.alive=!0;this.newRequest_(););},a.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var r={};r.id=this.myID,r.pw=this.myPW,r.ser=this.currentSerial;for(var o=this.urlFn(r),c="",h=0;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+c.length<=1870;){var I=this.pendingSegs.shift();c=c+"&seg"+h+"="+I.seg+"&ts"+h+"="+I.ts+"&d"+h+"="+I.d,h++}return this.addLongPollTag_(o+=c,this.currentSerial),!0}return!1},a.prototype.enqueueSegment=function(r,o,c){this.pendingSegs.push({seg:r,ts:o,d:c}),this.alive&&this.newRequest_()},a.prototype.addLongPollTag_=function(r,o){var c=this;this.outstandingRequests.add(o);var h=function(){c.outstandingRequests.delete(o),c.newRequest_()},p=setTimeout(h,Math.floor(25e3));this.addTag(r,function(){clearTimeout(p),h()})},a.prototype.addTag=function(r,o){var c=this;D.isNodeSdk()?this.doNodeLongPoll(r,o):setTimeout(function(){try{if(!c.sendNewPolls)return;var h=c.myIFrame.doc.createElement("script");h.type="text/javascript",h.async=!0,h.src=r,h.onload=h.onreadystatechange=function(){var p=h.readyState;(!p||"loaded"===p||"complete"===p)&&(h.onload=h.onreadystatechange=null,h.parentNode&&h.parentNode.removeChild(h),o())},h.onerror=function(){Kt("Long-poll script failed to load: "+r),c.sendNewPolls=!1,c.close()},c.myIFrame.doc.body.appendChild(h)}catch(p){}},Math.floor(1))},a}(),Zr="",Ar=null;"undefined"!=typeof MozWebSocket?Ar=MozWebSocket:"undefined"!=typeof WebSocket&&(Ar=WebSocket);var Un=function(){function a(r,o,c,h,p){this.connId=r,this.applicationId=c,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ne(this.connId),this.stats_=bt.getCollection(o),this.connURL=a.connectionURL_(o,h,p),this.nodeAdmin=o.nodeAdmin}return a.connectionURL_=function(r,o,c){var h={v:"5"};return!D.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(le)&&(h.r="f"),o&&(h.s=o),c&&(h.ls=c),r.connectionURL(Sn,h)},a.prototype.open=function(r,o){var c=this;this.onDisconnect=o,this.onMessage=r,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Lt.set("previous_websocket_failure",!0);try{if(D.isNodeSdk()){var p={headers:{"User-Agent":"Firebase/5/"+Zr+"/"+process.platform+"/"+(this.nodeAdmin?"AdminNode":"Node"),"X-Firebase-GMPID":this.applicationId||""}},I=process.env,R=0===this.connURL.indexOf("wss://")?I.HTTPS_PROXY||I.https_proxy:I.HTTP_PROXY||I.http_proxy;R&&(p.proxy={origin:R}),this.mySock=new Ar(this.connURL,[],p)}else this.mySock=new Ar(this.connURL,[],p={headers:{"X-Firebase-GMPID":this.applicationId||""}})}catch(k){this.log_("Error instantiating WebSocket.");var F=k.message||k.data;return F&&this.log_(F),void this.onClosed_()}this.mySock.onopen=function(){c.log_("Websocket connected."),c.everConnected_=!0},this.mySock.onclose=function(){c.log_("Websocket connection was disconnected."),c.mySock=null,c.onClosed_()},this.mySock.onmessage=function(k){c.handleIncomingFrame(k)},this.mySock.onerror=function(k){c.log_("WebSocket error.  Closing connection.");var ot=k.message||k.data;ot&&c.log_(ot),c.onClosed_()}},a.prototype.start=function(){},a.forceDisallow=function(){a.forceDisallow_=!0},a.isAvailable=function(){var r=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var c=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);c&&c.length>1&&parseFloat(c[1])<4.4&&(r=!0)}return!r&&null!==Ar&&!a.forceDisallow_},a.previouslyFailed=function(){return Lt.isInMemoryStorage||!0===Lt.get("previous_websocket_failure")},a.prototype.markConnectionHealthy=function(){Lt.remove("previous_websocket_failure")},a.prototype.appendFrame_=function(r){if(this.frames.push(r),this.frames.length===this.totalFrames){var o=this.frames.join("");this.frames=null;var c=D.jsonEval(o);this.onMessage(c)}},a.prototype.handleNewFrameCount_=function(r){this.totalFrames=r,this.frames=[]},a.prototype.extractFrameCount_=function(r){if(D.assert(null===this.frames,"We already have a frame buffer"),r.length<=6){var o=Number(r);if(!isNaN(o))return this.handleNewFrameCount_(o),null}return this.handleNewFrameCount_(1),r},a.prototype.handleIncomingFrame=function(r){if(null!==this.mySock){var o=r.data;if(this.bytesReceived+=o.length,this.stats_.incrementCounter("bytes_received",o.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(o);else{var c=this.extractFrameCount_(o);null!==c&&this.appendFrame_(c)}}},a.prototype.send=function(r){this.resetKeepAlive();var o=D.stringify(r);this.bytesSent+=o.length,this.stats_.incrementCounter("bytes_sent",o.length);var c=tt(o,16384);c.length>1&&this.sendString_(String(c.length));for(var h=0;h<c.length;h++)this.sendString_(c[h])},a.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},a.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},a.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},a.prototype.resetKeepAlive=function(){var r=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){r.mySock&&r.sendString_("0"),r.resetKeepAlive()},Math.floor(45e3))},a.prototype.sendString_=function(r){try{this.mySock.send(r)}catch(o){this.log_("Exception thrown from WebSocket.send():",o.message||o.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},a.responsesRequiredToBeHealthy=2,a.healthyTimeout=3e4,a}(),hi=function(){function a(r){this.initTransports_(r)}return Object.defineProperty(a,"ALL_TRANSPORTS",{get:function(){return[Wr,Un]},enumerable:!1,configurable:!0}),a.prototype.initTransports_=function(r){var o,c,h=Un&&Un.isAvailable(),p=h&&!Un.previouslyFailed();if(r.webSocketOnly&&(h||At("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),p=!0),p)this.transports_=[Un];else{var I=this.transports_=[];try{for(var R=Dt.__values(a.ALL_TRANSPORTS),F=R.next();!F.done;F=R.next()){var k=F.value;k&&k.isAvailable()&&I.push(k)}}catch(ot){o={error:ot}}finally{try{F&&!F.done&&(c=R.return)&&c.call(R)}finally{if(o)throw o.error}}}},a.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},a.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},a}(),Si=function(){function a(r,o,c,h,p,I,R,F){this.id=r,this.repoInfo_=o,this.applicationId_=c,this.onMessage_=h,this.onReady_=p,this.onDisconnect_=I,this.onKill_=R,this.lastSessionId=F,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ne("c:"+this.id+":"),this.transportManager_=new hi(o),this.log_("Connection created"),this.start_()}return a.prototype.start_=function(){var r=this,o=this.transportManager_.initialTransport();this.conn_=new o(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=o.responsesRequiredToBeHealthy||0;var c=this.connReceiver_(this.conn_),h=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){r.conn_&&r.conn_.open(c,h)},Math.floor(0));var p=o.healthyTimeout||0;p>0&&(this.healthyTimeout_=ye(function(){r.healthyTimeout_=null,r.isHealthy_||(r.conn_&&r.conn_.bytesReceived>102400?(r.log_("Connection exceeded healthy timeout but has received "+r.conn_.bytesReceived+" bytes.  Marking connection healthy."),r.isHealthy_=!0,r.conn_.markConnectionHealthy()):r.conn_&&r.conn_.bytesSent>10240?r.log_("Connection exceeded healthy timeout but has sent "+r.conn_.bytesSent+" bytes.  Leaving connection alive."):(r.log_("Closing unhealthy connection after timeout."),r.close()))},Math.floor(p)))},a.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},a.prototype.disconnReceiver_=function(r){var o=this;return function(c){r===o.conn_?o.onConnectionLost_(c):r===o.secondaryConn_?(o.log_("Secondary connection lost."),o.onSecondaryConnectionLost_()):o.log_("closing an old connection")}},a.prototype.connReceiver_=function(r){var o=this;return function(c){2!==o.state_&&(r===o.rx_?o.onPrimaryMessageReceived_(c):r===o.secondaryConn_?o.onSecondaryMessageReceived_(c):o.log_("message on old connection"))}},a.prototype.sendRequest=function(r){this.sendData_({t:"d",d:r})},a.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},a.prototype.onSecondaryControl_=function(r){if("t"in r){var o=r.t;"a"===o?this.upgradeIfSecondaryHealthy_():"r"===o?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===o&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},a.prototype.onSecondaryMessageReceived_=function(r){var o=Y("t",r),c=Y("d",r);if("c"===o)this.onSecondaryControl_(c);else{if("d"!==o)throw new Error("Unknown protocol layer: "+o);this.pendingDataMessages.push(c)}},a.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},a.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},a.prototype.onPrimaryMessageReceived_=function(r){var o=Y("t",r),c=Y("d",r);"c"===o?this.onControl_(c):"d"===o&&this.onDataMessage_(c)},a.prototype.onDataMessage_=function(r){this.onPrimaryResponse_(),this.onMessage_(r)},a.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},a.prototype.onControl_=function(r){var o=Y("t",r);if("d"in r){var c=r.d;if("h"===o)this.onHandshake_(c);else if("n"===o){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var h=0;h<this.pendingDataMessages.length;++h)this.onDataMessage_(this.pendingDataMessages[h]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===o?this.onConnectionShutdown_(c):"r"===o?this.onReset_(c):"e"===o?qt("Server Error: "+c):"o"===o?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):qt("Unknown control packet command: "+o)}},a.prototype.onHandshake_=function(r){var o=r.ts,c=r.v,h=r.h;this.sessionId=r.s,this.repoInfo_.updateHost(h),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,o),"5"!==c&&At("Protocol version mismatch detected"),this.tryStartUpgrade_())},a.prototype.tryStartUpgrade_=function(){var r=this.transportManager_.upgradeTransport();r&&this.startUpgrade_(r)},a.prototype.startUpgrade_=function(r){var o=this;this.secondaryConn_=new r(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=r.responsesRequiredToBeHealthy||0;var c=this.connReceiver_(this.secondaryConn_),h=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(c,h),ye(function(){o.secondaryConn_&&(o.log_("Timed out trying to upgrade."),o.secondaryConn_.close())},Math.floor(6e4))},a.prototype.onReset_=function(r){this.log_("Reset packet received.  New host: "+r),this.repoInfo_.updateHost(r),1===this.state_?this.close():(this.closeConnections_(),this.start_())},a.prototype.onConnectionEstablished_=function(r,o){var c=this;this.log_("Realtime connection established."),this.conn_=r,this.state_=1,this.onReady_&&(this.onReady_(o,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ye(function(){c.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},a.prototype.sendPingOnPrimaryIfNecessary_=function(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},a.prototype.onSecondaryConnectionLost_=function(){var r=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===r||this.rx_===r)&&this.close()},a.prototype.onConnectionLost_=function(r){this.conn_=null,r||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Lt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},a.prototype.onConnectionShutdown_=function(r){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(r),this.onKill_=null),this.onDisconnect_=null,this.close()},a.prototype.sendData_=function(r){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(r)},a.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},a.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},a}(),$i=function(){function a(){}return a.prototype.put=function(r,o,c,h){},a.prototype.merge=function(r,o,c,h){},a.prototype.refreshAuthToken=function(r){},a.prototype.onDisconnectPut=function(r,o,c){},a.prototype.onDisconnectMerge=function(r,o,c){},a.prototype.onDisconnectCancel=function(r,o){},a.prototype.reportStats=function(r){},a}(),Rr=1e3,on=function(a){function r(o,c,h,p,I,R,F){var k=a.call(this)||this;if(k.repoInfo_=o,k.applicationId_=c,k.onDataUpdate_=h,k.onConnectStatus_=p,k.onServerInfoUpdate_=I,k.authTokenProvider_=R,k.authOverride_=F,k.id=r.nextPersistentConnectionId_++,k.log_=ne("p:"+k.id+":"),k.interruptReasons_={},k.listens=new Map,k.outstandingPuts_=[],k.outstandingPutCount_=0,k.onDisconnectRequestQueue_=[],k.connected_=!1,k.reconnectDelay_=Rr,k.maxReconnectDelay_=3e5,k.securityDebugCallback_=null,k.lastSessionId=null,k.establishConnectionTimer_=null,k.visible_=!1,k.requestCBHash_={},k.requestNumber_=0,k.realtime_=null,k.authToken_=null,k.forceTokenRefresh_=!1,k.invalidAuthTokenCount_=0,k.firstConnection_=!0,k.lastConnectionAttemptTime_=null,k.lastConnectionEstablishedTime_=null,F&&!D.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return k.scheduleConnect_(0),gn.getInstance().on("visible",k.onVisible_,k),-1===o.host.indexOf("fblocal")&&rn.getInstance().on("online",k.onOnline_,k),k}return Dt.__extends(r,a),r.prototype.sendRequest=function(o,c,h){var p=++this.requestNumber_,I={r:p,a:o,b:c};this.log_(D.stringify(I)),D.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(I),h&&(this.requestCBHash_[p]=h)},r.prototype.listen=function(o,c,h,p){var I=o.queryIdentifier(),R=o.path.toString();this.log_("Listen called for "+R+" "+I),this.listens.has(R)||this.listens.set(R,new Map),D.assert(o.getQueryParams().isDefault()||!o.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),D.assert(!this.listens.get(R).has(I),"listen() called twice for same path/queryId.");var F={onComplete:p,hashFn:c,query:o,tag:h};this.listens.get(R).set(I,F),this.connected_&&this.sendListen_(F)},r.prototype.sendListen_=function(o){var c=this,h=o.query,p=h.path.toString(),I=h.queryIdentifier();this.log_("Listen on "+p+" for "+I);var R={p};o.tag&&(R.q=h.queryObject(),R.t=o.tag),R.h=o.hashFn(),this.sendRequest("q",R,function(k){var ot=k.d,pt=k.s;r.warnOnListenWarnings_(ot,h),(c.listens.get(p)&&c.listens.get(p).get(I))===o&&(c.log_("listen response",k),"ok"!==pt&&c.removeListen_(p,I),o.onComplete&&o.onComplete(pt,ot))})},r.warnOnListenWarnings_=function(o,c){if(o&&"object"==typeof o&&D.contains(o,"w")){var h=D.safeGet(o,"w");if(Array.isArray(h)&&~h.indexOf("no_index")){var p='".indexOn": "'+c.getQueryParams().getIndex().toString()+'"',I=c.path.toString();At("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+p+" at "+I+" to your security rules for better performance.")}}},r.prototype.refreshAuthToken=function(o){this.authToken_=o,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(o)},r.prototype.reduceReconnectDelayIfAdminCredential_=function(o){(o&&40===o.length||D.isAdmin(o))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},r.prototype.tryAuth=function(){var o=this;if(this.connected_&&this.authToken_){var c=this.authToken_,h=D.isValidFormat(c)?"auth":"gauth",p={cred:c};null===this.authOverride_?p.noauth=!0:"object"==typeof this.authOverride_&&(p.authvar=this.authOverride_),this.sendRequest(h,p,function(I){var R=I.s,F=I.d||"error";o.authToken_===c&&("ok"===R?o.invalidAuthTokenCount_=0:o.onAuthRevoked_(R,F))})}},r.prototype.unlisten=function(o,c){var h=o.path.toString(),p=o.queryIdentifier();this.log_("Unlisten called for "+h+" "+p),D.assert(o.getQueryParams().isDefault()||!o.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(h,p)&&this.connected_&&this.sendUnlisten_(h,p,o.queryObject(),c)},r.prototype.sendUnlisten_=function(o,c,h,p){this.log_("Unlisten on "+o+" for "+c);var I={p:o};p&&(I.q=h,I.t=p),this.sendRequest("n",I)},r.prototype.onDisconnectPut=function(o,c,h){this.connected_?this.sendOnDisconnect_("o",o,c,h):this.onDisconnectRequestQueue_.push({pathString:o,action:"o",data:c,onComplete:h})},r.prototype.onDisconnectMerge=function(o,c,h){this.connected_?this.sendOnDisconnect_("om",o,c,h):this.onDisconnectRequestQueue_.push({pathString:o,action:"om",data:c,onComplete:h})},r.prototype.onDisconnectCancel=function(o,c){this.connected_?this.sendOnDisconnect_("oc",o,null,c):this.onDisconnectRequestQueue_.push({pathString:o,action:"oc",data:null,onComplete:c})},r.prototype.sendOnDisconnect_=function(o,c,h,p){var I={p:c,d:h};this.log_("onDisconnect "+o,I),this.sendRequest(o,I,function(R){p&&setTimeout(function(){p(R.s,R.d)},Math.floor(0))})},r.prototype.put=function(o,c,h,p){this.putInternal("p",o,c,h,p)},r.prototype.merge=function(o,c,h,p){this.putInternal("m",o,c,h,p)},r.prototype.putInternal=function(o,c,h,p,I){var R={p:c,d:h};void 0!==I&&(R.h=I),this.outstandingPuts_.push({action:o,request:R,onComplete:p}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+c)},r.prototype.sendPut_=function(o){var c=this,h=this.outstandingPuts_[o].action,p=this.outstandingPuts_[o].request,I=this.outstandingPuts_[o].onComplete;this.outstandingPuts_[o].queued=this.connected_,this.sendRequest(h,p,function(R){c.log_(h+" response",R),delete c.outstandingPuts_[o],c.outstandingPutCount_--,0===c.outstandingPutCount_&&(c.outstandingPuts_=[]),I&&I(R.s,R.d)})},r.prototype.reportStats=function(o){var c=this;if(this.connected_){var h={c:o};this.log_("reportStats",h),this.sendRequest("s",h,function(p){"ok"!==p.s&&c.log_("reportStats","Error sending stats: "+p.d)})}},r.prototype.onDataMessage_=function(o){if("r"in o){this.log_("from server: "+D.stringify(o));var c=o.r,h=this.requestCBHash_[c];h&&(delete this.requestCBHash_[c],h(o.b))}else{if("error"in o)throw"A server-side error has occurred: "+o.error;"a"in o&&this.onDataPush_(o.a,o.b)}},r.prototype.onDataPush_=function(o,c){this.log_("handleServerMessage",o,c),"d"===o?this.onDataUpdate_(c.p,c.d,!1,c.t):"m"===o?this.onDataUpdate_(c.p,c.d,!0,c.t):"c"===o?this.onListenRevoked_(c.p,c.q):"ac"===o?this.onAuthRevoked_(c.s,c.d):"sd"===o?this.onSecurityDebugPacket_(c):qt("Unrecognized action received from server: "+D.stringify(o)+"\nAre you using the latest client?")},r.prototype.onReady_=function(o,c){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(o),this.lastSessionId=c,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},r.prototype.scheduleConnect_=function(o){var c=this;D.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){c.establishConnectionTimer_=null,c.establishConnection_()},Math.floor(o))},r.prototype.onVisible_=function(o){o&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Rr,this.realtime_||this.scheduleConnect_(0)),this.visible_=o},r.prototype.onOnline_=function(o){o?(this.log_("Browser went online."),this.reconnectDelay_=Rr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},r.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Rr),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var c=(new Date).getTime()-this.lastConnectionAttemptTime_,h=Math.max(0,this.reconnectDelay_-c);h=Math.random()*h,this.log_("Trying to reconnect in "+h+"ms"),this.scheduleConnect_(h),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},r.prototype.establishConnection_=function(){var o=this;if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var c=this.onDataMessage_.bind(this),h=this.onReady_.bind(this),p=this.onRealtimeDisconnect_.bind(this),I=this.id+":"+r.nextConnectionId_++,R=this,F=this.lastSessionId,k=!1,ot=null,pt=function(){ot?ot.close():(k=!0,p())};this.realtime_={close:pt,sendRequest:function($t){D.assert(ot,"sendRequest call when we're not connected not allowed."),ot.sendRequest($t)}};var Ut=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(Ut).then(function($t){k?Kt("getToken() completed but was canceled"):(Kt("getToken() completed. Creating connection."),R.authToken_=$t&&$t.accessToken,ot=new Si(I,R.repoInfo_,R.applicationId_,c,h,p,function(Zt){At(Zt+" ("+R.repoInfo_.toString()+")"),R.interrupt("server_kill")},F))}).then(null,function($t){R.log_("Failed to get token: "+$t),k||(o.repoInfo_.nodeAdmin&&At($t),pt())})}},r.prototype.interrupt=function(o){Kt("Interrupting connection for reason: "+o),this.interruptReasons_[o]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},r.prototype.resume=function(o){Kt("Resuming connection for reason: "+o),delete this.interruptReasons_[o],D.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=Rr,this.realtime_||this.scheduleConnect_(0))},r.prototype.handleTimestamp_=function(o){var c=o-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:c})},r.prototype.cancelSentTransactions_=function(){for(var o=0;o<this.outstandingPuts_.length;o++){var c=this.outstandingPuts_[o];c&&"h"in c.request&&c.queued&&(c.onComplete&&c.onComplete("disconnect"),delete this.outstandingPuts_[o],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},r.prototype.onListenRevoked_=function(o,c){var h;h=c?c.map(function(I){return Xt(I)}).join("$"):"default";var p=this.removeListen_(o,h);p&&p.onComplete&&p.onComplete("permission_denied")},r.prototype.removeListen_=function(o,c){var p,h=new Rt(o).toString();if(this.listens.has(h)){var I=this.listens.get(h);p=I.get(c),I.delete(c),0===I.size&&this.listens.delete(h)}else p=void 0;return p},r.prototype.onAuthRevoked_=function(o,c){Kt("Auth token revoked: "+o+"/"+c),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===o||"permission_denied"===o)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},r.prototype.onSecurityDebugPacket_=function(o){this.securityDebugCallback_?this.securityDebugCallback_(o):"msg"in o&&console.log("FIREBASE: "+o.msg.replace("\n","\nFIREBASE: "))},r.prototype.restoreState_=function(){var o,c,h,p;this.tryAuth();try{for(var I=Dt.__values(this.listens.values()),R=I.next();!R.done;R=I.next()){var F=R.value;try{for(var k=(h=void 0,Dt.__values(F.values())),ot=k.next();!ot.done;ot=k.next())this.sendListen_(ot.value)}catch($t){h={error:$t}}finally{try{ot&&!ot.done&&(p=k.return)&&p.call(k)}finally{if(h)throw h.error}}}}catch($t){o={error:$t}}finally{try{R&&!R.done&&(c=I.return)&&c.call(I)}finally{if(o)throw o.error}}for(var _t=0;_t<this.outstandingPuts_.length;_t++)this.outstandingPuts_[_t]&&this.sendPut_(_t);for(;this.onDisconnectRequestQueue_.length;){var Ut=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(Ut.action,Ut.pathString,Ut.data,Ut.onComplete)}},r.prototype.sendConnectStats_=function(){var o={},c="js";D.isNodeSdk()&&(c=this.repoInfo_.nodeAdmin?"admin_node":"node"),o["sdk."+c+"."+Zr.replace(/\./g,"-")]=1,D.isMobileCordova()?o["framework.cordova"]=1:D.isReactNative()&&(o["framework.reactnative"]=1),this.reportStats(o)},r.prototype.shouldReconnect_=function(){var o=rn.getInstance().currentlyOnline();return D.isEmpty(this.interruptReasons_)&&o},r.nextPersistentConnectionId_=0,r.nextConnectionId_=0,r}($i),Mi=function(a){function r(o,c,h){var p=a.call(this)||this;return p.repoInfo_=o,p.onDataUpdate_=c,p.authTokenProvider_=h,p.log_=ne("p:rest:"),p.listens_={},p}return Dt.__extends(r,a),r.prototype.reportStats=function(o){throw new Error("Method not implemented.")},r.getListenId_=function(o,c){return void 0!==c?"tag$"+c:(D.assert(o.getQueryParams().isDefault(),"should have a tag if it's not a default query."),o.path.toString())},r.prototype.listen=function(o,c,h,p){var I=this,R=o.path.toString();this.log_("Listen called for "+R+" "+o.queryIdentifier());var F=r.getListenId_(o,h),k={};this.listens_[F]=k;var ot=o.getQueryParams().toRestQueryStringParameters();this.restRequest_(R+".json",ot,function(pt,_t){var Ut=_t;404===pt&&(Ut=null,pt=null),null===pt&&I.onDataUpdate_(R,Ut,!1,h),D.safeGet(I.listens_,F)===k&&p(pt?401===pt?"permission_denied":"rest_error:"+pt:"ok",null)})},r.prototype.unlisten=function(o,c){var h=r.getListenId_(o,c);delete this.listens_[h]},r.prototype.refreshAuthToken=function(o){},r.prototype.restRequest_=function(o,c,h){var p=this;void 0===c&&(c={}),c.format="export",this.authTokenProvider_.getToken(!1).then(function(I){var R=I&&I.accessToken;R&&(c.auth=R);var F=(p.repoInfo_.secure?"https://":"http://")+p.repoInfo_.host+o+"?ns="+p.repoInfo_.namespace+D.querystring(c);p.log_("Sending REST request for "+F);var k=new XMLHttpRequest;k.onreadystatechange=function(){if(h&&4===k.readyState){p.log_("REST Response for "+F+" received. status:",k.status,"response:",k.responseText);var ot=null;if(k.status>=200&&k.status<300){try{ot=D.jsonEval(k.responseText)}catch(pt){At("Failed to parse JSON response for "+F+": "+k.responseText)}h(null,ot)}else 401!==k.status&&404!==k.status&&At("Got unsuccessful REST response for "+F+" Status: "+k.status),h(k.status);h=null}},k.open("GET",F,!0),k.send()})},r}($i),Wt="repo_interrupt",un=function(){function a(r,o,c,h){var p=this;if(this.repoInfo_=r,this.app=c,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new me,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new ai,this.persistentConnection_=null,this.stats_=bt.getCollection(r),o||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new Mi(this.repoInfo_,this.onDataUpdate_.bind(this),h),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var I=c.options.databaseAuthVariableOverride;if(null!=I){if("object"!=typeof I)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{D.stringify(I)}catch(R){throw new Error("Invalid authOverride provided: "+R)}}this.persistentConnection_=new on(this.repoInfo_,c.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),h,I),this.server_=this.persistentConnection_}h.addTokenChangeListener(function(R){p.server_.refreshAuthToken(R)}),this.statsReporter_=bt.getOrCreateReporter(r,function(){return new xe(p.stats_,p.server_)}),this.transactionsInit_(),this.infoData_=new H,this.infoSyncTree_=new V({startListening:function(R,F,k,ot){var pt=[],_t=p.infoData_.getNode(R.path);return _t.isEmpty()||(pt=p.infoSyncTree_.applyServerOverwrite(R.path,_t),setTimeout(function(){ot("ok")},0)),pt},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new V({startListening:function(R,F,k,ot){return p.server_.listen(R,k,F,function(pt,_t){var Ut=ot(pt,_t);p.eventQueue_.raiseEventsForChangedPath(R.path,Ut)}),[]},stopListening:function(R,F){p.server_.unlisten(R,F)}})}return a.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},a.prototype.name=function(){return this.repoInfo_.namespace},a.prototype.serverTime=function(){var o=this.infoData_.getNode(new Rt(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+o},a.prototype.generateServerValues=function(){return function(a){return(a=a||{}).timestamp=a.timestamp||(new Date).getTime(),a}({timestamp:this.serverTime()})},a.prototype.onDataUpdate_=function(r,o,c,h){this.dataUpdateCount++;var p=new Rt(r);o=this.interceptServerDataCallback_?this.interceptServerDataCallback_(r,o):o;var I=[];if(h)if(c){var R=D.map(o,function(_t){return Re(_t)});I=this.serverSyncTree_.applyTaggedQueryMerge(p,R,h)}else{var F=Re(o);I=this.serverSyncTree_.applyTaggedQueryOverwrite(p,F,h)}else if(c){var k=D.map(o,function(_t){return Re(_t)});I=this.serverSyncTree_.applyServerMerge(p,k)}else{var ot=Re(o);I=this.serverSyncTree_.applyServerOverwrite(p,ot)}var pt=p;I.length>0&&(pt=this.rerunTransactions_(p)),this.eventQueue_.raiseEventsForChangedPath(pt,I)},a.prototype.interceptServerData_=function(r){this.interceptServerDataCallback_=r},a.prototype.onConnectStatus_=function(r){this.updateInfo_("connected",r),!1===r&&this.runOnDisconnectEvents_()},a.prototype.onServerInfoUpdate_=function(r){var o=this;yt(r,function(c,h){o.updateInfo_(c,h)})},a.prototype.updateInfo_=function(r,o){var c=new Rt("/.info/"+r),h=Re(o);this.infoData_.updateSnapshot(c,h);var p=this.infoSyncTree_.applyServerOverwrite(c,h);this.eventQueue_.raiseEventsForChangedPath(c,p)},a.prototype.getNextWriteId_=function(){return this.nextWriteId_++},a.prototype.setWithPriority=function(r,o,c,h){var p=this;this.log_("set",{path:r.toString(),value:o,priority:c});var I=this.generateServerValues(),R=Re(o,c),F=this.serverSyncTree_.calcCompleteEventCache(r),k=$n(R,F,I),ot=this.getNextWriteId_(),pt=this.serverSyncTree_.applyUserOverwrite(r,k,ot,!0);this.eventQueue_.queueEvents(pt),this.server_.put(r.toString(),R.val(!0),function(Ut,$t){var Zt="ok"===Ut;Zt||At("set at "+r+" failed: "+Ut);var He=p.serverSyncTree_.ackUserWrite(ot,!Zt);p.eventQueue_.raiseEventsForChangedPath(r,He),p.callOnCompleteCallback(h,Ut,$t)});var _t=this.abortTransactions_(r);this.rerunTransactions_(_t),this.eventQueue_.raiseEventsForChangedPath(_t,[])},a.prototype.update=function(r,o,c){var h=this;this.log_("update",{path:r.toString(),value:o});var p=!0,I=this.generateServerValues(),R={};if(yt(o,function(ot,pt){p=!1,R[ot]=qn(r.child(ot),Re(pt),h.serverSyncTree_,I)}),p)Kt("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(c,"ok");else{var F=this.getNextWriteId_(),k=this.serverSyncTree_.applyUserMerge(r,R,F);this.eventQueue_.queueEvents(k),this.server_.merge(r.toString(),o,function(ot,pt){var _t="ok"===ot;_t||At("update at "+r+" failed: "+ot);var Ut=h.serverSyncTree_.ackUserWrite(F,!_t),$t=Ut.length>0?h.rerunTransactions_(r):r;h.eventQueue_.raiseEventsForChangedPath($t,Ut),h.callOnCompleteCallback(c,ot,pt)}),yt(o,function(ot){var pt=h.abortTransactions_(r.child(ot));h.rerunTransactions_(pt)}),this.eventQueue_.raiseEventsForChangedPath(r,[])}},a.prototype.runOnDisconnectEvents_=function(){var r=this;this.log_("onDisconnectEvents");var o=this.generateServerValues(),c=new ai;this.onDisconnect_.forEachTree(Rt.Empty,function(p,I){var R=qn(p,I,r.serverSyncTree_,o);c.remember(p,R)});var h=[];c.forEachTree(Rt.Empty,function(p,I){h=h.concat(r.serverSyncTree_.applyServerOverwrite(p,I));var R=r.abortTransactions_(p);r.rerunTransactions_(R)}),this.onDisconnect_=new ai,this.eventQueue_.raiseEventsForChangedPath(Rt.Empty,h)},a.prototype.onDisconnectCancel=function(r,o){var c=this;this.server_.onDisconnectCancel(r.toString(),function(h,p){"ok"===h&&c.onDisconnect_.forget(r),c.callOnCompleteCallback(o,h,p)})},a.prototype.onDisconnectSet=function(r,o,c){var h=this,p=Re(o);this.server_.onDisconnectPut(r.toString(),p.val(!0),function(I,R){"ok"===I&&h.onDisconnect_.remember(r,p),h.callOnCompleteCallback(c,I,R)})},a.prototype.onDisconnectSetWithPriority=function(r,o,c,h){var p=this,I=Re(o,c);this.server_.onDisconnectPut(r.toString(),I.val(!0),function(R,F){"ok"===R&&p.onDisconnect_.remember(r,I),p.callOnCompleteCallback(h,R,F)})},a.prototype.onDisconnectUpdate=function(r,o,c){var h=this;if(D.isEmpty(o))return Kt("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(c,"ok");this.server_.onDisconnectMerge(r.toString(),o,function(p,I){"ok"===p&&yt(o,function(R,F){var k=Re(F);h.onDisconnect_.remember(r.child(R),k)}),h.callOnCompleteCallback(c,p,I)})},a.prototype.addEventCallbackForQuery=function(r,o){var c;c=".info"===r.path.getFront()?this.infoSyncTree_.addEventRegistration(r,o):this.serverSyncTree_.addEventRegistration(r,o),this.eventQueue_.raiseEventsAtPath(r.path,c)},a.prototype.removeEventCallbackForQuery=function(r,o){var c;c=".info"===r.path.getFront()?this.infoSyncTree_.removeEventRegistration(r,o):this.serverSyncTree_.removeEventRegistration(r,o),this.eventQueue_.raiseEventsAtPath(r.path,c)},a.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Wt)},a.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Wt)},a.prototype.stats=function(r){if(void 0===r&&(r=!1),"undefined"!=typeof console){var o;r?(this.statsListener_||(this.statsListener_=new kt(this.stats_)),o=this.statsListener_.get()):o=this.stats_.get();var c=Object.keys(o).reduce(function(h,p){return Math.max(p.length,h)},0);yt(o,function(h,p){for(var I=h,R=h.length;R<c+2;R++)I+=" ";console.log(I+p)})}},a.prototype.statsIncrementCounter=function(r){this.stats_.incrementCounter(r),this.statsReporter_.includeStat(r)},a.prototype.log_=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var c="";this.persistentConnection_&&(c=this.persistentConnection_.id+":"),Kt.apply(void 0,Dt.__spread([c],r))},a.prototype.callOnCompleteCallback=function(r,o,c){r&&jt(function(){if("ok"===o)r(null);else{var h=(o||"error").toUpperCase(),p=h;c&&(p+=": "+c);var I=new Error(p);I.code=h,r(I)}})},Object.defineProperty(a.prototype,"database",{get:function(){return this.__database||(this.__database=new lt(this))},enumerable:!1,configurable:!0}),a}(),Zi=function(){function a(r){this.indexedFilter_=new Vr(r.getIndex()),this.index_=r.getIndex(),this.startPost_=a.getStartPost_(r),this.endPost_=a.getEndPost_(r)}return a.prototype.getStartPost=function(){return this.startPost_},a.prototype.getEndPost=function(){return this.endPost_},a.prototype.matches=function(r){return this.index_.compare(this.getStartPost(),r)<=0&&this.index_.compare(r,this.getEndPost())<=0},a.prototype.updateChild=function(r,o,c,h,p,I){return this.matches(new q(o,c))||(c=zt.EMPTY_NODE),this.indexedFilter_.updateChild(r,o,c,h,p,I)},a.prototype.updateFullNode=function(r,o,c){o.isLeafNode()&&(o=zt.EMPTY_NODE);var h=o.withIndex(this.index_);h=h.updatePriority(zt.EMPTY_NODE);var p=this;return o.forEachChild(j,function(I,R){p.matches(new q(I,R))||(h=h.updateImmediateChild(I,zt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(r,h,c)},a.prototype.updatePriority=function(r,o){return r},a.prototype.filtersNodes=function(){return!0},a.prototype.getIndexedFilter=function(){return this.indexedFilter_},a.prototype.getIndex=function(){return this.index_},a.getStartPost_=function(r){if(r.hasStart()){var o=r.getIndexStartName();return r.getIndex().makePost(r.getIndexStartValue(),o)}return r.getIndex().minPost()},a.getEndPost_=function(r){if(r.hasEnd()){var o=r.getIndexEndName();return r.getIndex().makePost(r.getIndexEndValue(),o)}return r.getIndex().maxPost()},a}(),pi=function(){function a(r){this.rangedFilter_=new Zi(r),this.index_=r.getIndex(),this.limit_=r.getLimit(),this.reverse_=!r.isViewFromLeft()}return a.prototype.updateChild=function(r,o,c,h,p,I){return this.rangedFilter_.matches(new q(o,c))||(c=zt.EMPTY_NODE),r.getImmediateChild(o).equals(c)?r:r.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(r,o,c,h,p,I):this.fullLimitUpdateChild_(r,o,c,p,I)},a.prototype.updateFullNode=function(r,o,c){var h;if(o.isLeafNode()||o.isEmpty())h=zt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<o.numChildren()&&o.isIndexed(this.index_)){h=zt.EMPTY_NODE.withIndex(this.index_);var p=void 0;p=this.reverse_?o.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var I=0;p.hasNext()&&I<this.limit_;){var R=p.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),R)<=0:this.index_.compare(R,this.rangedFilter_.getEndPost())<=0))break;h=h.updateImmediateChild(R.name,R.node),I++}}else{h=(h=o.withIndex(this.index_)).updatePriority(zt.EMPTY_NODE);var k=void 0,ot=void 0,pt=void 0;if(p=void 0,this.reverse_){p=h.getReverseIterator(this.index_),k=this.rangedFilter_.getEndPost(),ot=this.rangedFilter_.getStartPost();var _t=this.index_.getCompare();pt=function(He,ze){return _t(ze,He)}}else p=h.getIterator(this.index_),k=this.rangedFilter_.getStartPost(),ot=this.rangedFilter_.getEndPost(),pt=this.index_.getCompare();I=0;for(var Ut=!1;p.hasNext();)R=p.getNext(),!Ut&&pt(k,R)<=0&&(Ut=!0),Ut&&I<this.limit_&&pt(R,ot)<=0?I++:h=h.updateImmediateChild(R.name,zt.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(r,h,c)},a.prototype.updatePriority=function(r,o){return r},a.prototype.filtersNodes=function(){return!0},a.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},a.prototype.getIndex=function(){return this.index_},a.prototype.fullLimitUpdateChild_=function(r,o,c,h,p){var I;if(this.reverse_){var R=this.index_.getCompare();I=function(lr,yr){return R(yr,lr)}}else I=this.index_.getCompare();var F=r;D.assert(F.numChildren()===this.limit_,"");var k=new q(o,c),ot=this.reverse_?F.getFirstChild(this.index_):F.getLastChild(this.index_),pt=this.rangedFilter_.matches(k);if(F.hasChild(o)){for(var _t=F.getImmediateChild(o),Ut=h.getChildAfterChild(this.index_,ot,this.reverse_);null!=Ut&&(Ut.name===o||F.hasChild(Ut.name));)Ut=h.getChildAfterChild(this.index_,Ut,this.reverse_);var $t=null==Ut?1:I(Ut,k);if(pt&&!c.isEmpty()&&$t>=0)return null!=p&&p.trackChildChange(Le.childChangedChange(o,c,_t)),F.updateImmediateChild(o,c);null!=p&&p.trackChildChange(Le.childRemovedChange(o,_t));var He=F.updateImmediateChild(o,zt.EMPTY_NODE);return null!=Ut&&this.rangedFilter_.matches(Ut)?(null!=p&&p.trackChildChange(Le.childAddedChange(Ut.name,Ut.node)),He.updateImmediateChild(Ut.name,Ut.node)):He}return c.isEmpty()?r:pt&&I(ot,k)>=0?(null!=p&&(p.trackChildChange(Le.childRemovedChange(ot.name,ot.node)),p.trackChildChange(Le.childAddedChange(o,c))),F.updateImmediateChild(o,c).updateImmediateChild(ot.name,zt.EMPTY_NODE)):r},a}(),Hr=function(){function a(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=j}return a.prototype.hasStart=function(){return this.startSet_},a.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===a.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},a.prototype.getIndexStartValue=function(){return D.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},a.prototype.getIndexStartName=function(){return D.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:A},a.prototype.hasEnd=function(){return this.endSet_},a.prototype.getIndexEndValue=function(){return D.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},a.prototype.getIndexEndName=function(){return D.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:x},a.prototype.hasLimit=function(){return this.limitSet_},a.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},a.prototype.getLimit=function(){return D.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},a.prototype.getIndex=function(){return this.index_},a.prototype.copy_=function(){var r=new a;return r.limitSet_=this.limitSet_,r.limit_=this.limit_,r.startSet_=this.startSet_,r.indexStartValue_=this.indexStartValue_,r.startNameSet_=this.startNameSet_,r.indexStartName_=this.indexStartName_,r.endSet_=this.endSet_,r.indexEndValue_=this.indexEndValue_,r.endNameSet_=this.endNameSet_,r.indexEndName_=this.indexEndName_,r.index_=this.index_,r.viewFrom_=this.viewFrom_,r},a.prototype.limit=function(r){var o=this.copy_();return o.limitSet_=!0,o.limit_=r,o.viewFrom_="",o},a.prototype.limitToFirst=function(r){var o=this.copy_();return o.limitSet_=!0,o.limit_=r,o.viewFrom_=a.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,o},a.prototype.limitToLast=function(r){var o=this.copy_();return o.limitSet_=!0,o.limit_=r,o.viewFrom_=a.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,o},a.prototype.startAt=function(r,o){var c=this.copy_();return c.startSet_=!0,void 0===r&&(r=null),c.indexStartValue_=r,null!=o?(c.startNameSet_=!0,c.indexStartName_=o):(c.startNameSet_=!1,c.indexStartName_=""),c},a.prototype.endAt=function(r,o){var c=this.copy_();return c.endSet_=!0,void 0===r&&(r=null),c.indexEndValue_=r,void 0!==o?(c.endNameSet_=!0,c.indexEndName_=o):(c.endNameSet_=!1,c.indexEndName_=""),c},a.prototype.orderBy=function(r){var o=this.copy_();return o.index_=r,o},a.prototype.getQueryObject=function(){var r=a.WIRE_PROTOCOL_CONSTANTS_,o={};if(this.startSet_&&(o[r.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(o[r.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(o[r.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(o[r.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){o[r.LIMIT]=this.limit_;var c=this.viewFrom_;""===c&&(c=this.isViewFromLeft()?r.VIEW_FROM_LEFT:r.VIEW_FROM_RIGHT),o[r.VIEW_FROM]=c}return this.index_!==j&&(o[r.INDEX]=this.index_.toString()),o},a.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},a.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===j},a.prototype.getNodeFilter=function(){return this.loadsAllData()?new Vr(this.getIndex()):this.hasLimit()?new pi(this):new Zi(this)},a.prototype.toRestQueryStringParameters=function(){var c,r=a.REST_QUERY_CONSTANTS_,o={};return this.isDefault()||(this.index_===j?c=r.PRIORITY_INDEX:this.index_===mr?c=r.VALUE_INDEX:this.index_===dt?c=r.KEY_INDEX:(D.assert(this.index_ instanceof Tr,"Unrecognized index type!"),c=this.index_.toString()),o[r.ORDER_BY]=D.stringify(c),this.startSet_&&(o[r.START_AT]=D.stringify(this.indexStartValue_),this.startNameSet_&&(o[r.START_AT]+=","+D.stringify(this.indexStartName_))),this.endSet_&&(o[r.END_AT]=D.stringify(this.indexEndValue_),this.endNameSet_&&(o[r.END_AT]+=","+D.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?o[r.LIMIT_TO_FIRST]=this.limit_:o[r.LIMIT_TO_LAST]=this.limit_)),o},a.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},a.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},a.DEFAULT=new a,a}(),dr=function(a){function r(o,c){if(!(o instanceof un))throw new Error("new Reference() no longer supported - use app.database().");return a.call(this,o,c,Hr.DEFAULT,!1)||this}return Dt.__extends(r,a),r.prototype.getKey=function(){return D.validateArgCount("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},r.prototype.child=function(o){return D.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof o?o=String(o):o instanceof Rt||(null===this.path.getFront()?Dn("Reference.child",1,o,!1):Qe("Reference.child",1,o,!1)),new r(this.repo,this.path.child(o))},r.prototype.getParent=function(){D.validateArgCount("Reference.parent",0,0,arguments.length);var o=this.path.parent();return null===o?null:new r(this.repo,o)},r.prototype.getRoot=function(){D.validateArgCount("Reference.root",0,0,arguments.length);for(var o=this;null!==o.getParent();)o=o.getParent();return o},r.prototype.databaseProp=function(){return this.repo.database},r.prototype.set=function(o,c){D.validateArgCount("Reference.set",1,2,arguments.length),ke("Reference.set",this.path),Pe("Reference.set",1,o,this.path,!1),D.validateCallback("Reference.set",2,c,!0);var h=new D.Deferred;return this.repo.setWithPriority(this.path,o,null,h.wrapCallback(c)),h.promise},r.prototype.update=function(o,c){if(D.validateArgCount("Reference.update",1,2,arguments.length),ke("Reference.update",this.path),Array.isArray(o)){for(var h={},p=0;p<o.length;++p)h[""+p]=o[p];o=h,At("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ln("Reference.update",1,o,this.path,!1),D.validateCallback("Reference.update",2,c,!0);var I=new D.Deferred;return this.repo.update(this.path,o,I.wrapCallback(c)),I.promise},r.prototype.setWithPriority=function(o,c,h){if(D.validateArgCount("Reference.setWithPriority",2,3,arguments.length),ke("Reference.setWithPriority",this.path),Pe("Reference.setWithPriority",1,o,this.path,!1),wn("Reference.setWithPriority",2,c,!1),D.validateCallback("Reference.setWithPriority",3,h,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var p=new D.Deferred;return this.repo.setWithPriority(this.path,o,c,p.wrapCallback(h)),p.promise},r.prototype.remove=function(o){return D.validateArgCount("Reference.remove",0,1,arguments.length),ke("Reference.remove",this.path),D.validateCallback("Reference.remove",1,o,!0),this.set(null,o)},r.prototype.transaction=function(o,c,h){if(D.validateArgCount("Reference.transaction",1,3,arguments.length),ke("Reference.transaction",this.path),D.validateCallback("Reference.transaction",1,o,!1),D.validateCallback("Reference.transaction",2,c,!0),Wn("Reference.transaction",3,h,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===h&&(h=!0);var p=new D.Deferred;"function"==typeof c&&p.promise.catch(function(){});var I=function(R,F,k){R?p.reject(R):p.resolve(new xn(F,k)),"function"==typeof c&&c(R,F,k)};return this.repo.startTransaction(this.path,o,I,h),p.promise},r.prototype.setPriority=function(o,c){D.validateArgCount("Reference.setPriority",1,2,arguments.length),ke("Reference.setPriority",this.path),wn("Reference.setPriority",1,o,!1),D.validateCallback("Reference.setPriority",2,c,!0);var h=new D.Deferred;return this.repo.setWithPriority(this.path.child(".priority"),o,null,h.wrapCallback(c)),h.promise},r.prototype.push=function(o,c){D.validateArgCount("Reference.push",0,2,arguments.length),ke("Reference.push",this.path),Pe("Reference.push",1,o,this.path,!0),D.validateCallback("Reference.push",2,c,!0);var F,h=this.repo.serverTime(),p=Hn(h),I=this.child(p),R=this.child(p);return F=null!=o?I.set(o,c).then(function(){return R}):Promise.resolve(R),I.then=F.then.bind(F),I.catch=F.then.bind(F,void 0),"function"==typeof c&&F.catch(function(){}),I},r.prototype.onDisconnect=function(){return ke("Reference.onDisconnect",this.path),new Fn(this.repo,this.path)},Object.defineProperty(r.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),r}(Pr);Pr.__referenceConstructor=dr,bi.__referenceConstructor=dr;var to=function(){this.children={},this.childCount=0,this.value=null},ni=function(){function a(r,o,c){void 0===r&&(r=""),void 0===o&&(o=null),void 0===c&&(c=new to),this.name_=r,this.parent_=o,this.node_=c}return a.prototype.subTree=function(r){for(var o=r instanceof Rt?r:new Rt(r),c=this,h=o.getFront();null!==h;)c=new a(h,c,D.safeGet(c.node_.children,h)||new to),h=(o=o.popFront()).getFront();return c},a.prototype.getValue=function(){return this.node_.value},a.prototype.setValue=function(r){D.assert(void 0!==r,"Cannot set value to undefined"),this.node_.value=r,this.updateParents_()},a.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},a.prototype.hasChildren=function(){return this.node_.childCount>0},a.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},a.prototype.forEachChild=function(r){var o=this;yt(this.node_.children,function(c,h){r(new a(c,o,h))})},a.prototype.forEachDescendant=function(r,o,c){o&&!c&&r(this),this.forEachChild(function(h){h.forEachDescendant(r,!0,c)}),o&&c&&r(this)},a.prototype.forEachAncestor=function(r,o){for(var c=o?this:this.parent();null!==c;){if(r(c))return!0;c=c.parent()}return!1},a.prototype.forEachImmediateDescendantWithValue=function(r){this.forEachChild(function(o){null!==o.getValue()?r(o):o.forEachImmediateDescendantWithValue(r)})},a.prototype.path=function(){return new Rt(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},a.prototype.name=function(){return this.name_},a.prototype.parent=function(){return this.parent_},a.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},a.prototype.updateChild_=function(r,o){var c=o.isEmpty(),h=D.contains(this.node_.children,r);c&&h?(delete this.node_.children[r],this.node_.childCount--,this.updateParents_()):!c&&!h&&(this.node_.children[r]=o.node_,this.node_.childCount++,this.updateParents_())},a}(),Rn=(()=>(function(a){a[a.RUN=0]="RUN",a[a.SENT=1]="SENT",a[a.COMPLETED=2]="COMPLETED",a[a.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",a[a.NEEDS_ABORT=4]="NEEDS_ABORT"}(Rn||(Rn={})),Rn))();un.MAX_TRANSACTION_RETRIES_=25,un.prototype.transactionsInit_=function(){this.transactionQueueTree_=new ni},un.prototype.startTransaction=function(a,r,o,c){this.log_("transaction on "+a);var h=function(){},p=new dr(this,a);p.on("value",h);var R={path:a,update:r,onComplete:o,status:null,order:ge(),applyLocally:c,retryCount:0,unwatcher:function(){p.off("value",h)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},F=this.getLatestState_(a);R.currentInputSnapshot=F;var k=R.update(F.val());if(void 0===k){if(R.unwatcher(),R.currentOutputSnapshotRaw=null,R.currentOutputSnapshotResolved=null,R.onComplete){var ot=new hr(R.currentInputSnapshot,new dr(this,R.path),j);R.onComplete(null,!1,ot)}}else{Se("transaction failed: Data returned ",k,R.path),R.status=Rn.RUN;var pt=this.transactionQueueTree_.subTree(a),_t=pt.getValue()||[];_t.push(R),pt.setValue(_t);var Ut=void 0;"object"==typeof k&&null!==k&&D.contains(k,".priority")?(Ut=D.safeGet(k,".priority"),D.assert(Ge(Ut),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):Ut=(this.serverSyncTree_.calcCompleteEventCache(a)||zt.EMPTY_NODE).getPriority().val(),Ut=Ut;var Zt=this.generateServerValues(),He=Re(k,Ut),ze=$n(He,F,Zt);R.currentOutputSnapshotRaw=He,R.currentOutputSnapshotResolved=ze,R.currentWriteId=this.getNextWriteId_();var lr=this.serverSyncTree_.applyUserOverwrite(a,ze,R.currentWriteId,R.applyLocally);this.eventQueue_.raiseEventsForChangedPath(a,lr),this.sendReadyTransactions_()}},un.prototype.getLatestState_=function(a,r){return this.serverSyncTree_.calcCompleteEventCache(a,r)||zt.EMPTY_NODE},un.prototype.sendReadyTransactions_=function(a){var r=this;if(void 0===a&&(a=this.transactionQueueTree_),a||this.pruneCompletedTransactionsBelowNode_(a),null!==a.getValue()){var o=this.buildTransactionQueue_(a);D.assert(o.length>0,"Sending zero length transaction queue"),o.every(function(h){return h.status===Rn.RUN})&&this.sendTransactionQueue_(a.path(),o)}else a.hasChildren()&&a.forEachChild(function(h){r.sendReadyTransactions_(h)})},un.prototype.sendTransactionQueue_=function(a,r){for(var o=this,c=r.map(function(_t){return _t.currentWriteId}),h=this.getLatestState_(a,c),p=h,I=h.hash(),R=0;R<r.length;R++){var F=r[R];D.assert(F.status===Rn.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),F.status=Rn.SENT,F.retryCount++;var k=Rt.relativePath(a,F.path);p=p.updateChild(k,F.currentOutputSnapshotRaw)}var ot=p.val(!0),pt=a;this.server_.put(pt.toString(),ot,function(_t){o.log_("transaction put response",{path:pt.toString(),status:_t});var Ut=[];if("ok"===_t){for(var $t=[],Zt=0;Zt<r.length;Zt++){if(r[Zt].status=Rn.COMPLETED,Ut=Ut.concat(o.serverSyncTree_.ackUserWrite(r[Zt].currentWriteId)),r[Zt].onComplete){var He=r[Zt].currentOutputSnapshotResolved,ze=new dr(o,r[Zt].path),lr=new hr(He,ze,j);$t.push(r[Zt].onComplete.bind(null,null,!0,lr))}r[Zt].unwatcher()}for(o.pruneCompletedTransactionsBelowNode_(o.transactionQueueTree_.subTree(a)),o.sendReadyTransactions_(),o.eventQueue_.raiseEventsForChangedPath(a,Ut),Zt=0;Zt<$t.length;Zt++)jt($t[Zt])}else{if("datastale"===_t)for(Zt=0;Zt<r.length;Zt++)r[Zt].status=r[Zt].status===Rn.SENT_NEEDS_ABORT?Rn.NEEDS_ABORT:Rn.RUN;else for(At("transaction at "+pt.toString()+" failed: "+_t),Zt=0;Zt<r.length;Zt++)r[Zt].status=Rn.NEEDS_ABORT,r[Zt].abortReason=_t;o.rerunTransactions_(a)}},I)},un.prototype.rerunTransactions_=function(a){var r=this.getAncestorTransactionNode_(a),o=r.path(),c=this.buildTransactionQueue_(r);return this.rerunTransactionQueue_(c,o),o},un.prototype.rerunTransactionQueue_=function(a,r){if(0!==a.length){for(var o=[],c=[],p=a.filter(function(zr){return zr.status===Rn.RUN}).map(function(zr){return zr.currentWriteId}),I=0;I<a.length;I++){var R=a[I],F=Rt.relativePath(r,R.path),k=!1,ot=void 0;if(D.assert(null!==F,"rerunTransactionsUnderNode_: relativePath should not be null."),R.status===Rn.NEEDS_ABORT)k=!0,ot=R.abortReason,c=c.concat(this.serverSyncTree_.ackUserWrite(R.currentWriteId,!0));else if(R.status===Rn.RUN)if(R.retryCount>=un.MAX_TRANSACTION_RETRIES_)k=!0,ot="maxretry",c=c.concat(this.serverSyncTree_.ackUserWrite(R.currentWriteId,!0));else{var pt=this.getLatestState_(R.path,p);R.currentInputSnapshot=pt;var _t=a[I].update(pt.val());if(void 0!==_t){Se("transaction failed: Data returned ",_t,R.path);var Ut=Re(_t);"object"==typeof _t&&null!=_t&&D.contains(_t,".priority")||(Ut=Ut.updatePriority(pt.getPriority()));var Zt=R.currentWriteId,He=this.generateServerValues(),ze=$n(Ut,pt,He);R.currentOutputSnapshotRaw=Ut,R.currentOutputSnapshotResolved=ze,R.currentWriteId=this.getNextWriteId_(),p.splice(p.indexOf(Zt),1),c=(c=c.concat(this.serverSyncTree_.applyUserOverwrite(R.path,ze,R.currentWriteId,R.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(Zt,!0))}else k=!0,ot="nodata",c=c.concat(this.serverSyncTree_.ackUserWrite(R.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(r,c),c=[],k&&(a[I].status=Rn.COMPLETED,setTimeout(a[I].unwatcher,Math.floor(0)),a[I].onComplete))if("nodata"===ot){var lr=new dr(this,a[I].path),vi=new hr(a[I].currentInputSnapshot,lr,j);o.push(a[I].onComplete.bind(null,null,!1,vi))}else o.push(a[I].onComplete.bind(null,new Error(ot),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),I=0;I<o.length;I++)jt(o[I]);this.sendReadyTransactions_()}},un.prototype.getAncestorTransactionNode_=function(a){var r,o=this.transactionQueueTree_;for(r=a.getFront();null!==r&&null===o.getValue();)o=o.subTree(r),r=(a=a.popFront()).getFront();return o},un.prototype.buildTransactionQueue_=function(a){var r=[];return this.aggregateTransactionQueuesForNode_(a,r),r.sort(function(o,c){return o.order-c.order}),r},un.prototype.aggregateTransactionQueuesForNode_=function(a,r){var o=this,c=a.getValue();if(null!==c)for(var h=0;h<c.length;h++)r.push(c[h]);a.forEachChild(function(p){o.aggregateTransactionQueuesForNode_(p,r)})},un.prototype.pruneCompletedTransactionsBelowNode_=function(a){var r=this,o=a.getValue();if(o){for(var c=0,h=0;h<o.length;h++)o[h].status!==Rn.COMPLETED&&(o[c]=o[h],c++);o.length=c,a.setValue(o.length>0?o:null)}a.forEachChild(function(p){r.pruneCompletedTransactionsBelowNode_(p)})},un.prototype.abortTransactions_=function(a){var r=this,o=this.getAncestorTransactionNode_(a).path(),c=this.transactionQueueTree_.subTree(a);return c.forEachAncestor(function(h){r.abortTransactionsOnNode_(h)}),this.abortTransactionsOnNode_(c),c.forEachDescendant(function(h){r.abortTransactionsOnNode_(h)}),o},un.prototype.abortTransactionsOnNode_=function(a){var r=a.getValue();if(null!==r){for(var o=[],c=[],h=-1,p=0;p<r.length;p++)r[p].status!==Rn.SENT_NEEDS_ABORT&&(r[p].status===Rn.SENT?(D.assert(h===p-1,"All SENT items should be at beginning of queue."),h=p,r[p].status=Rn.SENT_NEEDS_ABORT,r[p].abortReason="set"):(D.assert(r[p].status===Rn.RUN,"Unexpected transaction status in abort"),r[p].unwatcher(),c=c.concat(this.serverSyncTree_.ackUserWrite(r[p].currentWriteId,!0)),r[p].onComplete&&o.push(r[p].onComplete.bind(null,new Error("set"),!1,null))));for(-1===h?a.setValue(null):r.length=h+1,this.eventQueue_.raiseEventsForChangedPath(a.path(),c),p=0;p<o.length;p++)jt(o[p])}};var L,u=function(){function a(r,o){var c=this;this.app_=r,this.authProvider_=o,this.auth_=null,this.auth_=o.getImmediate({optional:!0}),this.auth_||o.get().then(function(h){return c.auth_=h})}return a.prototype.getToken=function(r){return this.auth_?this.auth_.getToken(r).catch(function(o){return o&&"auth/token-not-initialized"===o.code?(Kt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(o)}):Promise.resolve(null)},a.prototype.addTokenChangeListener=function(r){this.auth_?this.auth_.addAuthTokenListener(r):(setTimeout(function(){return r(null)},0),this.authProvider_.get().then(function(o){return o.addAuthTokenListener(r)}))},a.prototype.removeTokenChangeListener=function(r){this.authProvider_.get().then(function(o){return o.removeAuthTokenListener(r)})},a.prototype.notifyForInvalidToken=function(){var r='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';At(r+="credential"in this.app_.options?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.')},a}(),v=function(){function a(){}return a.prototype.getToken=function(r){return Promise.resolve({accessToken:a.EMULATOR_AUTH_TOKEN})},a.prototype.addTokenChangeListener=function(r){r(a.EMULATOR_AUTH_TOKEN)},a.prototype.removeTokenChangeListener=function(r){},a.prototype.notifyForInvalidToken=function(){},a.EMULATOR_AUTH_TOKEN="owner",a}(),Z=function(){function a(){this.repos_={},this.useRestClient_=!1}return a.getInstance=function(){return L||(L=new a),L},a.prototype.interrupt=function(){var r,o,c,h;try{for(var p=Dt.__values(Object.keys(this.repos_)),I=p.next();!I.done;I=p.next()){var R=I.value;try{for(var F=(c=void 0,Dt.__values(Object.keys(this.repos_[R]))),k=F.next();!k.done;k=F.next())this.repos_[R][k.value].interrupt()}catch(pt){c={error:pt}}finally{try{k&&!k.done&&(h=F.return)&&h.call(F)}finally{if(c)throw c.error}}}}catch(pt){r={error:pt}}finally{try{I&&!I.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}},a.prototype.resume=function(){var r,o,c,h;try{for(var p=Dt.__values(Object.keys(this.repos_)),I=p.next();!I.done;I=p.next()){var R=I.value;try{for(var F=(c=void 0,Dt.__values(Object.keys(this.repos_[R]))),k=F.next();!k.done;k=F.next())this.repos_[R][k.value].resume()}catch(pt){c={error:pt}}finally{try{k&&!k.done&&(h=F.return)&&h.call(F)}finally{if(c)throw c.error}}}}catch(pt){r={error:pt}}finally{try{I&&!I.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}},a.prototype.databaseFromApp=function(r,o,c,h){var p=c||r.options.databaseURL;void 0===p&&(r.options.projectId||xt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Kt("Using default host for project ",r.options.projectId),p=r.options.projectId+"-default-rtdb.firebaseio.com");var F,I=Ce(p,h),R=I.repoInfo,k=void 0;"undefined"!=typeof process&&(k=process.env.FIREBASE_DATABASE_EMULATOR_HOST),k?(F=!0,R=(I=Ce(p="http://"+k+"?ns="+R.namespace,h)).repoInfo):F=!I.repoInfo.secure;var ot=h&&F?new v:new u(r,o);return Je("Invalid Firebase Database URL",1,I),I.path.isEmpty()||xt("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(R,r,ot).database},a.prototype.deleteRepo=function(r){var o=D.safeGet(this.repos_,r.app.name);(!o||D.safeGet(o,r.repoInfo_.toURLString())!==r)&&xt("Database "+r.app.name+"("+r.repoInfo_+") has already been deleted."),r.interrupt(),delete o[r.repoInfo_.toURLString()]},a.prototype.createRepo=function(r,o,c){var h=D.safeGet(this.repos_,o.name);h||(this.repos_[o.name]=h={});var p=D.safeGet(h,r.toURLString());return p&&xt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),p=new un(r,this.useRestClient_,o,c),h[r.toURLString()]=p,p},a.prototype.forceRestClient=function(r){this.useRestClient_=r},a}(),lt=function(){function a(r){this.repo_=r,r instanceof un||xt("Don't call new Database() directly - please use firebase.database()."),this.root_=new dr(r,Rt.Empty),this.INTERNAL=new Jt(this)}return Object.defineProperty(a.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),a.prototype.ref=function(r){return this.checkDeleted_("ref"),D.validateArgCount("database.ref",0,1,arguments.length),r instanceof dr?this.refFromURL(r.toString()):void 0!==r?this.root_.child(r):this.root_},a.prototype.refFromURL=function(r){var o="database.refFromURL";this.checkDeleted_(o),D.validateArgCount(o,1,1,arguments.length);var c=Ce(r,this.repo_.repoInfo_.nodeAdmin);Je(o,1,c);var h=c.repoInfo;return h.host!==this.repo_.repoInfo_.host&&xt(o+": Host name does not match the current database: (found "+h.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(c.path.toString())},a.prototype.checkDeleted_=function(r){null===this.repo_&&xt("Cannot call "+r+" on a deleted database.")},a.prototype.goOffline=function(){D.validateArgCount("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},a.prototype.goOnline=function(){D.validateArgCount("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},a.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(r){return{".sv":{increment:r}}}},a}(),Jt=function(){function a(r){this.database=r}return a.prototype.delete=function(){return Dt.__awaiter(this,void 0,void 0,function(){return Dt.__generator(this,function(r){return this.database.checkDeleted_("delete"),Z.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},a}(),ir=Object.freeze({__proto__:null,forceLongPolling:function(){Un.forceDisallow(),Wr.forceAllow()},forceWebSockets:function(){Wr.forceDisallow()},isWebSocketsAvailable:function(){return Un.isAvailable()},setSecurityDebugCallback:function(a,r){a.repo.persistentConnection_.securityDebugCallback_=r},stats:function(a,r){a.repo.stats(r)},statsIncrementCounter:function(a,r){a.repo.statsIncrementCounter(r)},dataUpdateCount:function(a){return a.repo.dataUpdateCount},interceptServerData:function(a,r){return a.repo.interceptServerData_(r)}}),eo=on;on.prototype.simpleListen=function(a,r){this.sendRequest("q",{p:a},r)},on.prototype.echo=function(a,r){this.sendRequest("echo",{d:a},r)};var os=Object.freeze({__proto__:null,DataConnection:eo,RealTimeConnection:Si,hijackHash:function(a){var r=on.prototype.put;return on.prototype.put=function(o,c,h,p){void 0!==p&&(p=a()),r.call(this,o,c,h,p)},function(){on.prototype.put=r}},ConnectionTarget:cn,queryIdentifier:function(a){return a.queryIdentifier()},forceRestClient:function(a){Z.getInstance().forceRestClient(a)}}),vo=lt.ServerValue;function yo(a){!function(a){Zr=a}(a.SDK_VERSION);var r=a.INTERNAL.registerComponent(new St.Component("database",function(o,c){var h=o.getProvider("app").getImmediate(),p=o.getProvider("auth-internal");return Z.getInstance().databaseFromApp(h,p,c)},"PUBLIC").setServiceProps({Reference:dr,Query:Pr,Database:lt,DataSnapshot:hr,enableLogging:mt,INTERNAL:ir,ServerValue:vo,TEST_ACCESS:os}).setMultipleInstances(!0));a.registerVersion("@firebase/database","0.6.13"),D.isNodeSdk()&&(Xn.exports=r)}yo(Yt.default),be.DataSnapshot=hr,be.Database=lt,be.OnDisconnect=Fn,be.Query=Pr,be.Reference=dr,be.ServerValue=vo,be.enableLogging=mt,be.registerDatabase=yo},5910:(Xn,be,Bt)=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});var n,B=Bt(5704),Dt=Bt(6279),D=Bt(300),Te=Bt(1704),St=Bt(2870),Ne=Bt(1100),de=(n=Dt)&&"object"==typeof n&&"default"in n?n:{default:n},J={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ut=function(n){function t(e,i){var s=this;return(s=n.call(this,i)||this).code=e,s.message=i,s.name="FirebaseError",s.toString=function(){return s.name+": [code="+s.code+"]: "+s.message},s}return B.__extends(t,n),t}(Error),Lt=new D.Logger("@firebase/firestore");function ee(){return Lt.logLevel}function Tt(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];if(Lt.logLevel<=D.LogLevel.DEBUG){var i=t.map(ve);Lt.debug.apply(Lt,B.__spreadArrays(["Firestore (7.24.0): "+n],i))}}function ge(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];if(Lt.logLevel<=D.LogLevel.ERROR){var i=t.map(ve);Lt.error.apply(Lt,B.__spreadArrays(["Firestore (7.24.0): "+n],i))}}function Xe(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];if(Lt.logLevel<=D.LogLevel.WARN){var i=t.map(ve);Lt.warn.apply(Lt,B.__spreadArrays(["Firestore (7.24.0): "+n],i))}}function ve(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(e){return n}}function ct(n){void 0===n&&(n="Unexpected state");var t="FIRESTORE (7.24.0) INTERNAL ASSERTION FAILED: "+n;throw ge(t),new Error(t)}function Ct(n,t){n||ct()}function mt(n,t){return n}function Kt(n){var t=0;for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function ne(n,t){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function qt(n){for(var t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var xt=function(){function n(t,e,i){void 0===e?e=0:e>t.length&&ct(),void 0===i?i=t.length-e:i>t.length-e&&ct(),this.segments=t,this.offset=e,this.t=i}return Object.defineProperty(n.prototype,"length",{get:function(){return this.t},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return 0===n.i(this,t)},n.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(function(i){e.push(i)}):e.push(t),this.o(e)},n.prototype.limit=function(){return this.offset+this.length},n.prototype.u=function(t){return this.o(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},n.prototype.h=function(){return this.o(this.segments,this.offset,this.length-1)},n.prototype.l=function(){return this.segments[this.offset]},n.prototype._=function(){return this.get(this.length-1)},n.prototype.get=function(t){return this.segments[this.offset+t]},n.prototype.m=function(){return 0===this.length},n.prototype.T=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},n.prototype.I=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},n.prototype.forEach=function(t){for(var e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])},n.prototype.A=function(){return this.segments.slice(this.offset,this.limit())},n.i=function(t,e){for(var i=Math.min(t.length,e.length),s=0;s<i;s++){var l=t.get(s),f=e.get(s);if(l<f)return-1;if(l>f)return 1}return t.length<e.length?-1:t.length>e.length?1:0},n}(),At=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return B.__extends(t,n),t.prototype.o=function(e,i,s){return new t(e,i,s)},t.prototype.R=function(){return this.A().join("/")},t.prototype.toString=function(){return this.R()},t.g=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];for(var s=[],l=0,f=e;l<f.length;l++){var d=f[l];if(d.indexOf("//")>=0)throw new ut(J.INVALID_ARGUMENT,"Invalid segment ("+d+"). Paths must not contain // in them.");s.push.apply(s,d.split("/").filter(function(w){return w.length>0}))}return new t(s)},t.P=function(){return new t([])},t}(xt),m=/^[_a-zA-Z][_a-zA-Z0-9]*$/,S=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return B.__extends(t,n),t.prototype.o=function(e,i,s){return new t(e,i,s)},t.V=function(e){return m.test(e)},t.prototype.R=function(){return this.A().map(function(e){return e=e.replace("\\","\\\\").replace("`","\\`"),t.V(e)||(e="`"+e+"`"),e}).join(".")},t.prototype.toString=function(){return this.R()},t.prototype.p=function(){return 1===this.length&&"__name__"===this.get(0)},t.v=function(){return new t(["__name__"])},t.S=function(e){for(var i=[],s="",l=0,f=function(){if(0===s.length)throw new ut(J.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");i.push(s),s=""},d=!1;l<e.length;){var w=e[l];if("\\"===w){if(l+1===e.length)throw new ut(J.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var O=e[l+1];if("\\"!==O&&"."!==O&&"`"!==O)throw new ut(J.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=O,l+=2}else"`"===w?(d=!d,l++):"."!==w||d?(s+=w,l++):(f(),l++)}if(f(),d)throw new ut(J.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new t(i)},t.P=function(){return new t([])},t}(xt),b=function(){function n(t){this.path=t}return n.D=function(t){return new n(At.g(t))},n.C=function(t){return new n(At.g(t).u(5))},n.prototype.N=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},n.prototype.isEqual=function(t){return null!==t&&0===At.i(this.path,t.path)},n.prototype.toString=function(){return this.path.toString()},n.i=function(t,e){return At.i(t.path,e.path)},n.F=function(t){return t.length%2==0},n.$=function(t){return new n(new At(t.slice()))},n}();function A(n,t){if(0!==t.length)throw new ut(J.INVALID_ARGUMENT,"Function "+n+"() does not support arguments, but was called with "+Oe(t.length,"argument")+".")}function x(n,t,e){if(t.length!==e)throw new ut(J.INVALID_ARGUMENT,"Function "+n+"() requires "+Oe(e,"argument")+", but was called with "+Oe(t.length,"argument")+".")}function T(n,t,e){if(t.length<e)throw new ut(J.INVALID_ARGUMENT,"Function "+n+"() requires at least "+Oe(e,"argument")+", but was called with "+Oe(t.length,"argument")+".")}function z(n,t,e,i){if(t.length<e||t.length>i)throw new ut(J.INVALID_ARGUMENT,"Function "+n+"() requires between "+e+" and "+i+" arguments, but was called with "+Oe(t.length,"argument")+".")}function Y(n,t,e,i){ft(n,t,Rt(e)+" argument",i)}function Xt(n,t,e,i){void 0!==i&&Y(n,t,e,i)}function tt(n,t,e,i){ft(n,t,e+" option",i)}function yt(n,t,e,i){void 0!==i&&tt(n,t,e,i)}function pe(n,t,e,i,s){void 0!==i&&function(l,f,d,w,O){for(var U=[],X=0,$=O;X<$.length;X++){var st=$[X];if(st===w)return;U.push(Nt(st))}var vt=Nt(w);throw new ut(J.INVALID_ARGUMENT,"Invalid value "+vt+" provided to function "+l+'() for option "'+d+'". Acceptable values: '+U.join(", "))}(n,0,e,i,s)}function Ot(n,t,e,i){if(!t.some(function(s){return s===i}))throw new ut(J.INVALID_ARGUMENT,"Invalid value "+Nt(i)+" provided to function "+n+"() for its "+Rt(e)+" argument. Acceptable values: "+t.join(", "));return i}function ft(n,t,e,i){if(!("object"===t?ht(i):"non-empty string"===t?"string"==typeof i&&""!==i:typeof i===t)){var s=Nt(i);throw new ut(J.INVALID_ARGUMENT,"Function "+n+"() requires its "+e+" to be of type "+t+", but it was: "+s)}}function ht(n){return"object"==typeof n&&null!==n&&(Object.getPrototypeOf(n)===Object.prototype||null===Object.getPrototypeOf(n))}function Nt(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=n.substring(0,20)+"..."),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";var t=function(e){if(e.constructor){var i=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(i&&i.length>1)return i[1]}return null}(n);return t?"a custom "+t+" object":"an object"}return"function"==typeof n?"a function":ct()}function re(n,t,e){if(void 0===e)throw new ut(J.INVALID_ARGUMENT,"Function "+n+"() requires a valid "+Rt(t)+" argument, but it was undefined.")}function jt(n,t,e){ne(t,function(i,s){if(e.indexOf(i)<0)throw new ut(J.INVALID_ARGUMENT,"Unknown option '"+i+"' passed to function "+n+"(). Available options: "+e.join(", "))})}function se(n,t,e,i){var s=Nt(i);return new ut(J.INVALID_ARGUMENT,"Function "+n+"() requires its "+Rt(e)+" argument to be a "+t+", but it was: "+s)}function ye(n,t,e){if(e<=0)throw new ut(J.INVALID_ARGUMENT,"Function "+n+"() requires its "+Rt(t)+" argument to be a positive number, but it was: "+e+".")}function Rt(n){switch(n){case 1:return"first";case 2:return"second";case 3:return"third";default:return n+"th"}}function Oe(n,t){return n+" "+t+(1===n?"":"s")}function nn(n){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(var i=0;i<n;i++)e[i]=Math.floor(256*Math.random());return e}var Be=function(){function n(){}return n.k=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,i="";i.length<20;)for(var s=nn(40),l=0;l<s.length;++l)i.length<20&&s[l]<e&&(i+=t.charAt(s[l]%t.length));return i},n}();function te(n,t){return n<t?-1:n>t?1:0}function _e(n,t,e){return n.length===t.length&&n.every(function(i,s){return e(i,t[s])})}function vn(n){return n+"\0"}var le=function(){function n(t){this.M=t}return n.fromBase64String=function(t){return new n(atob(t))},n.fromUint8Array=function(t){return new n(function(e){for(var i="",s=0;s<e.length;++s)i+=String.fromCharCode(e[s]);return i}(t))},n.prototype.toBase64=function(){return btoa(this.M)},n.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}(this.M)},n.prototype.O=function(){return 2*this.M.length},n.prototype.L=function(t){return te(this.M,t.M)},n.prototype.isEqual=function(t){return this.M===t.M},n}();le.B=new le("");var en=function(){function n(t){this.q=t}return n.fromBase64String=function(t){try{return new n(le.fromBase64String(t))}catch(e){throw new ut(J.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+e)}},n.fromUint8Array=function(t){return new n(le.fromUint8Array(t))},n.prototype.toBase64=function(){return this.q.toBase64()},n.prototype.toUint8Array=function(){return this.q.toUint8Array()},n.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},n.prototype.isEqual=function(t){return this.q.isEqual(t.q)},n}();function fn(){if("undefined"==typeof Uint8Array)throw new ut(J.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Sn(){if("undefined"==typeof atob)throw new ut(J.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var hn=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return B.__extends(t,n),t.fromBase64String=function(e){x("Blob.fromBase64String",arguments,1),Y("Blob.fromBase64String","string",1,e),Sn();try{return new t(le.fromBase64String(e))}catch(i){throw new ut(J.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+i)}},t.fromUint8Array=function(e){if(x("Blob.fromUint8Array",arguments,1),fn(),!(e instanceof Uint8Array))throw se("Blob.fromUint8Array","Uint8Array",1,e);return new t(le.fromUint8Array(e))},t.prototype.toBase64=function(){return x("Blob.toBase64",arguments,0),Sn(),n.prototype.toBase64.call(this)},t.prototype.toUint8Array=function(){return x("Blob.toUint8Array",arguments,0),fn(),n.prototype.toUint8Array.call(this)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(en),cn=function(n,t,e,i,s,l){this.U=n,this.persistenceKey=t,this.host=e,this.ssl=i,this.forceLongPolling=s,this.W=l},_n=function(){function n(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(n.prototype,"j",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database},n.prototype.L=function(t){return te(this.projectId,t.projectId)||te(this.database,t.database)},n}(),qe=function(){function n(t,e){this.K=t,this.G=e,this.H={}}return n.prototype.get=function(t){var e=this.K(t),i=this.H[e];if(void 0!==i)for(var s=0,l=i;s<l.length;s++){var f=l[s],w=f[1];if(this.G(f[0],t))return w}},n.prototype.has=function(t){return void 0!==this.get(t)},n.prototype.set=function(t,e){var i=this.K(t),s=this.H[i];if(void 0!==s){for(var l=0;l<s.length;l++)if(this.G(s[l][0],t))return void(s[l]=[t,e]);s.push([t,e])}else this.H[i]=[[t,e]]},n.prototype.delete=function(t){var e=this.K(t),i=this.H[e];if(void 0===i)return!1;for(var s=0;s<i.length;s++)if(this.G(i[s][0],t))return 1===i.length?delete this.H[e]:i.splice(s,1),!0;return!1},n.prototype.forEach=function(t){ne(this.H,function(e,i){for(var s=0,l=i;s<l.length;s++){var f=l[s];t(f[0],f[1])}})},n.prototype.m=function(){return qt(this.H)},n}(),Ce=function(){function n(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ut(J.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ut(J.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ut(J.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ut(J.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return n.now=function(){return n.fromMillis(Date.now())},n.fromDate=function(t){return n.fromMillis(t.getTime())},n.fromMillis=function(t){var e=Math.floor(t/1e3);return new n(e,1e6*(t-1e3*e))},n.prototype.toDate=function(){return new Date(this.toMillis())},n.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},n.prototype.Y=function(t){return this.seconds===t.seconds?te(this.nanoseconds,t.nanoseconds):te(this.seconds,t.seconds)},n.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},n.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},n.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},n.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},n}(),we=function(){function n(t){this.timestamp=t}return n.J=function(t){return new n(t)},n.min=function(){return new n(new Ce(0,0))},n.prototype.L=function(t){return this.timestamp.Y(t.timestamp)},n.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},n.prototype.X=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},n.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},n.prototype.Z=function(){return this.timestamp},n}();function Cn(n){return null==n}function An(n){return 0===n&&1/n==-1/0}function fe(n){return"number"==typeof n&&Number.isInteger(n)&&!An(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var $e=function(n,t,e,i,s,l,f){void 0===t&&(t=null),void 0===e&&(e=[]),void 0===i&&(i=[]),void 0===s&&(s=null),void 0===l&&(l=null),void 0===f&&(f=null),this.path=n,this.collectionGroup=t,this.orderBy=e,this.filters=i,this.limit=s,this.startAt=l,this.endAt=f,this.tt=null};function sn(n,t,e,i,s,l,f){return void 0===t&&(t=null),void 0===e&&(e=[]),void 0===i&&(i=[]),void 0===s&&(s=null),void 0===l&&(l=null),void 0===f&&(f=null),new $e(n,t,e,i,s,l,f)}function Ke(n){var t=mt(n);if(null===t.tt){var e=t.path.R();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(function(i){return(s=i).field.R()+s.op.toString()+he(s.value);var s}).join(","),e+="|ob:",e+=t.orderBy.map(function(i){return(s=i).field.R()+s.dir;var s}).join(","),Cn(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=Nr(t.startAt)),t.endAt&&(e+="|ub:",e+=Nr(t.endAt)),t.tt=e}return t.tt}function Ge(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<n.orderBy.length;e++)if(!ki(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(var i=0;i<n.filters.length;i++)if((s=n.filters[i]).op!==(l=t.filters[i]).op||!s.field.isEqual(l.field)||!Q(s.value,l.value))return!1;var s,l;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Ji(n.startAt,t.startAt)&&Ji(n.endAt,t.endAt)}function Pe(n){return b.F(n.path)&&null===n.collectionGroup&&0===n.filters.length}var Se,Ee,ln=function(){function n(t,e,i,s,l,f,d){void 0===l&&(l=we.min()),void 0===f&&(f=we.min()),void 0===d&&(d=le.B),this.target=t,this.targetId=e,this.et=i,this.sequenceNumber=s,this.nt=l,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=d}return n.prototype.st=function(t){return new n(this.target,this.targetId,this.et,t,this.nt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},n.prototype.it=function(t,e){return new n(this.target,this.targetId,this.et,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},n.prototype.rt=function(t){return new n(this.target,this.targetId,this.et,this.sequenceNumber,this.nt,t,this.resumeToken)},n}(),wn=function(n){this.count=n};function kn(n){switch(n){case J.OK:return ct();case J.CANCELLED:case J.UNKNOWN:case J.DEADLINE_EXCEEDED:case J.RESOURCE_EXHAUSTED:case J.INTERNAL:case J.UNAVAILABLE:case J.UNAUTHENTICATED:return!1;case J.INVALID_ARGUMENT:case J.NOT_FOUND:case J.ALREADY_EXISTS:case J.PERMISSION_DENIED:case J.FAILED_PRECONDITION:case J.ABORTED:case J.OUT_OF_RANGE:case J.UNIMPLEMENTED:case J.DATA_LOSS:return!0;default:return ct()}}function Mn(n){if(void 0===n)return ge("GRPC error has no .code"),J.UNKNOWN;switch(n){case Se.OK:return J.OK;case Se.CANCELLED:return J.CANCELLED;case Se.UNKNOWN:return J.UNKNOWN;case Se.DEADLINE_EXCEEDED:return J.DEADLINE_EXCEEDED;case Se.RESOURCE_EXHAUSTED:return J.RESOURCE_EXHAUSTED;case Se.INTERNAL:return J.INTERNAL;case Se.UNAVAILABLE:return J.UNAVAILABLE;case Se.UNAUTHENTICATED:return J.UNAUTHENTICATED;case Se.INVALID_ARGUMENT:return J.INVALID_ARGUMENT;case Se.NOT_FOUND:return J.NOT_FOUND;case Se.ALREADY_EXISTS:return J.ALREADY_EXISTS;case Se.PERMISSION_DENIED:return J.PERMISSION_DENIED;case Se.FAILED_PRECONDITION:return J.FAILED_PRECONDITION;case Se.ABORTED:return J.ABORTED;case Se.OUT_OF_RANGE:return J.OUT_OF_RANGE;case Se.UNIMPLEMENTED:return J.UNIMPLEMENTED;case Se.DATA_LOSS:return J.DATA_LOSS;default:return ct()}}(Ee=Se||(Se={}))[Ee.OK=0]="OK",Ee[Ee.CANCELLED=1]="CANCELLED",Ee[Ee.UNKNOWN=2]="UNKNOWN",Ee[Ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ee[Ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ee[Ee.NOT_FOUND=5]="NOT_FOUND",Ee[Ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ee[Ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ee[Ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ee[Ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ee[Ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ee[Ee.ABORTED=10]="ABORTED",Ee[Ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ee[Ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ee[Ee.INTERNAL=13]="INTERNAL",Ee[Ee.UNAVAILABLE=14]="UNAVAILABLE",Ee[Ee.DATA_LOSS=15]="DATA_LOSS";var Qe=function(){function n(t,e){this.i=t,this.root=e||ke.EMPTY}return n.prototype.ot=function(t,e){return new n(this.i,this.root.ot(t,e,this.i).copy(null,null,ke.at,null,null))},n.prototype.remove=function(t){return new n(this.i,this.root.remove(t,this.i).copy(null,null,ke.at,null,null))},n.prototype.get=function(t){for(var e=this.root;!e.m();){var i=this.i(t,e.key);if(0===i)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null},n.prototype.indexOf=function(t){for(var e=0,i=this.root;!i.m();){var s=this.i(t,i.key);if(0===s)return e+i.left.size;s<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1},n.prototype.m=function(){return this.root.m()},Object.defineProperty(n.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),n.prototype.ct=function(){return this.root.ct()},n.prototype.ut=function(){return this.root.ut()},n.prototype.ht=function(t){return this.root.ht(t)},n.prototype.forEach=function(t){this.ht(function(e,i){return t(e,i),!1})},n.prototype.toString=function(){var t=[];return this.ht(function(e,i){return t.push(e+":"+i),!1}),"{"+t.join(", ")+"}"},n.prototype.lt=function(t){return this.root.lt(t)},n.prototype._t=function(){return new Dn(this.root,null,this.i,!1)},n.prototype.ft=function(t){return new Dn(this.root,t,this.i,!1)},n.prototype.dt=function(){return new Dn(this.root,null,this.i,!0)},n.prototype.wt=function(t){return new Dn(this.root,t,this.i,!0)},n}(),Dn=function(){function n(t,e,i,s){this.Tt=s,this.Et=[];for(var l=1;!t.m();)if(l=e?i(t.key,e):1,s&&(l*=-1),l<0)t=this.Tt?t.left:t.right;else{if(0===l){this.Et.push(t);break}this.Et.push(t),t=this.Tt?t.right:t.left}}return n.prototype.It=function(){var t=this.Et.pop(),e={key:t.key,value:t.value};if(this.Tt)for(t=t.left;!t.m();)this.Et.push(t),t=t.right;else for(t=t.right;!t.m();)this.Et.push(t),t=t.left;return e},n.prototype.At=function(){return this.Et.length>0},n.prototype.Rt=function(){if(0===this.Et.length)return null;var t=this.Et[this.Et.length-1];return{key:t.key,value:t.value}},n}(),ke=function(){function n(t,e,i,s,l){this.key=t,this.value=e,this.color=null!=i?i:n.RED,this.left=null!=s?s:n.EMPTY,this.right=null!=l?l:n.EMPTY,this.size=this.left.size+1+this.right.size}return n.prototype.copy=function(t,e,i,s,l){return new n(null!=t?t:this.key,null!=e?e:this.value,null!=i?i:this.color,null!=s?s:this.left,null!=l?l:this.right)},n.prototype.m=function(){return!1},n.prototype.ht=function(t){return this.left.ht(t)||t(this.key,this.value)||this.right.ht(t)},n.prototype.lt=function(t){return this.right.lt(t)||t(this.key,this.value)||this.left.lt(t)},n.prototype.min=function(){return this.left.m()?this:this.left.min()},n.prototype.ct=function(){return this.min().key},n.prototype.ut=function(){return this.right.m()?this.key:this.right.ut()},n.prototype.ot=function(t,e,i){var s=this,l=i(t,s.key);return(s=l<0?s.copy(null,null,null,s.left.ot(t,e,i),null):0===l?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.ot(t,e,i))).gt()},n.prototype.Pt=function(){if(this.left.m())return n.EMPTY;var t=this;return t.left.yt()||t.left.left.yt()||(t=t.Vt()),(t=t.copy(null,null,null,t.left.Pt(),null)).gt()},n.prototype.remove=function(t,e){var i,s=this;if(e(t,s.key)<0)s.left.m()||s.left.yt()||s.left.left.yt()||(s=s.Vt()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.yt()&&(s=s.bt()),s.right.m()||s.right.yt()||s.right.left.yt()||(s=s.vt()),0===e(t,s.key)){if(s.right.m())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.Pt())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.gt()},n.prototype.yt=function(){return this.color},n.prototype.gt=function(){var t=this;return t.right.yt()&&!t.left.yt()&&(t=t.St()),t.left.yt()&&t.left.left.yt()&&(t=t.bt()),t.left.yt()&&t.right.yt()&&(t=t.Dt()),t},n.prototype.Vt=function(){var t=this.Dt();return t.right.left.yt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.bt())).St()).Dt()),t},n.prototype.vt=function(){var t=this.Dt();return t.left.left.yt()&&(t=(t=t.bt()).Dt()),t},n.prototype.St=function(){var t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},n.prototype.bt=function(){var t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},n.prototype.Dt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},n.prototype.Ct=function(){var t=this.Nt();return Math.pow(2,t)<=this.size+1},n.prototype.Nt=function(){if(this.yt()&&this.left.yt()||this.right.yt())throw ct();var t=this.left.Nt();if(t!==this.right.Nt())throw ct();return t+(this.yt()?0:1)},n}();ke.EMPTY=null,ke.RED=!0,ke.at=!1,ke.EMPTY=new(function(){function n(){this.size=0}return Object.defineProperty(n.prototype,"key",{get:function(){throw ct()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){throw ct()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"color",{get:function(){throw ct()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){throw ct()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){throw ct()},enumerable:!1,configurable:!0}),n.prototype.copy=function(t,e,i,s,l){return this},n.prototype.ot=function(t,e,i){return new ke(t,e)},n.prototype.remove=function(t,e){return this},n.prototype.m=function(){return!0},n.prototype.ht=function(t){return!1},n.prototype.lt=function(t){return!1},n.prototype.ct=function(){return null},n.prototype.ut=function(){return null},n.prototype.yt=function(){return!1},n.prototype.Ct=function(){return!0},n.prototype.Nt=function(){return 0},n}());var Je=function(){function n(t){this.i=t,this.data=new Qe(this.i)}return n.prototype.has=function(t){return null!==this.data.get(t)},n.prototype.first=function(){return this.data.ct()},n.prototype.last=function(){return this.data.ut()},Object.defineProperty(n.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),n.prototype.indexOf=function(t){return this.data.indexOf(t)},n.prototype.forEach=function(t){this.data.ht(function(e,i){return t(e),!1})},n.prototype.Ft=function(t,e){for(var i=this.data.ft(t[0]);i.At();){var s=i.It();if(this.i(s.key,t[1])>=0)return;e(s.key)}},n.prototype.xt=function(t,e){var i;for(i=void 0!==e?this.data.ft(e):this.data._t();i.At();)if(!t(i.It().key))return},n.prototype.$t=function(t){var e=this.data.ft(t);return e.At()?e.It().key:null},n.prototype._t=function(){return new Wn(this.data._t())},n.prototype.ft=function(t){return new Wn(this.data.ft(t))},n.prototype.add=function(t){return this.copy(this.data.remove(t).ot(t,!0))},n.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},n.prototype.m=function(){return this.data.m()},n.prototype.kt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(i){e=e.add(i)}),e},n.prototype.isEqual=function(t){if(!(t instanceof n)||this.size!==t.size)return!1;for(var e=this.data._t(),i=t.data._t();e.At();){var s=e.It().key,l=i.It().key;if(0!==this.i(s,l))return!1}return!0},n.prototype.A=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},n.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},n.prototype.copy=function(t){var e=new n(this.i);return e.data=t,e},n}(),Wn=function(){function n(t){this.Mt=t}return n.prototype.It=function(){return this.Mt.It().key},n.prototype.At=function(){return this.Mt.At()},n}(),Fn=new Qe(b.i);function xn(){return Fn}function Hn(){return xn()}var q=new Qe(b.i);function it(){return q}var at=new Qe(b.i),wt=new Je(b.i);function dt(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];for(var e=wt,i=0,s=n;i<s.length;i++){var l=s[i];e=e.add(l)}return e}var gt=new Je(te);function Mt(){return gt}var Ht=function(){function n(t){this.i=t?function(e,i){return t(e,i)||b.i(e.key,i.key)}:function(e,i){return b.i(e.key,i.key)},this.Ot=it(),this.Lt=new Qe(this.i)}return n.Bt=function(t){return new n(t.i)},n.prototype.has=function(t){return null!=this.Ot.get(t)},n.prototype.get=function(t){return this.Ot.get(t)},n.prototype.first=function(){return this.Lt.ct()},n.prototype.last=function(){return this.Lt.ut()},n.prototype.m=function(){return this.Lt.m()},n.prototype.indexOf=function(t){var e=this.Ot.get(t);return e?this.Lt.indexOf(e):-1},Object.defineProperty(n.prototype,"size",{get:function(){return this.Lt.size},enumerable:!1,configurable:!0}),n.prototype.forEach=function(t){this.Lt.ht(function(e,i){return t(e),!1})},n.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ot.ot(t.key,t),e.Lt.ot(t,null))},n.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ot.remove(t),this.Lt.remove(e)):this},n.prototype.isEqual=function(t){if(!(t instanceof n)||this.size!==t.size)return!1;for(var e=this.Lt._t(),i=t.Lt._t();e.At();){var s=e.It().key,l=i.It().key;if(!s.isEqual(l))return!1}return!0},n.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},n.prototype.copy=function(t,e){var i=new n;return i.i=this.i,i.Ot=t,i.Lt=e,i},n}(),ae=function(){function n(){this.qt=new Qe(b.i)}return n.prototype.track=function(t){var e=t.doc.key,i=this.qt.get(e);i?0!==t.type&&3===i.type?this.qt=this.qt.ot(e,t):3===t.type&&1!==i.type?this.qt=this.qt.ot(e,{type:i.type,doc:t.doc}):2===t.type&&2===i.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):2===t.type&&0===i.type?this.qt=this.qt.ot(e,{type:0,doc:t.doc}):1===t.type&&0===i.type?this.qt=this.qt.remove(e):1===t.type&&2===i.type?this.qt=this.qt.ot(e,{type:1,doc:i.doc}):0===t.type&&1===i.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):ct():this.qt=this.qt.ot(e,t)},n.prototype.Ut=function(){var t=[];return this.qt.ht(function(e,i){t.push(i)}),t},n}(),Ft=function(){function n(t,e,i,s,l,f,d,w){this.query=t,this.docs=e,this.Qt=i,this.docChanges=s,this.Wt=l,this.fromCache=f,this.jt=d,this.Kt=w}return n.Gt=function(t,e,i,s){var l=[];return e.forEach(function(f){l.push({type:0,doc:f})}),new n(t,e,Ht.Bt(e),l,i,s,!0,!1)},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return!this.Wt.m()},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.jt===t.jt&&this.Wt.isEqual(t.Wt)&&Lr(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Qt.isEqual(t.Qt)))return!1;var e=this.docChanges,i=t.docChanges;if(e.length!==i.length)return!1;for(var s=0;s<e.length;s++)if(e[s].type!==i[s].type||!e[s].doc.isEqual(i[s].doc))return!1;return!0},n}(),ue=function(){function n(t,e,i,s,l){this.nt=t,this.zt=e,this.Ht=i,this.Yt=s,this.Jt=l}return n.Xt=function(t,e){var i=new Map;return i.set(t,je.Zt(t,e)),new n(we.min(),i,Mt(),xn(),dt())},n}(),je=function(){function n(t,e,i,s,l){this.resumeToken=t,this.te=e,this.ee=i,this.ne=s,this.se=l}return n.Zt=function(t,e){return new n(le.B,e,dt(),dt(),dt())},n}(),De=function(n,t,e,i){this.ie=n,this.removedTargetIds=t,this.key=e,this.re=i},Fe=function(n,t){this.targetId=n,this.oe=t},bn=function(n,t,e,i){void 0===e&&(e=le.B),void 0===i&&(i=null),this.state=n,this.targetIds=t,this.resumeToken=e,this.cause=i},G=function(){function n(){this.ae=0,this.ce=et(),this.ue=le.B,this.he=!1,this.le=!0}return Object.defineProperty(n.prototype,"te",{get:function(){return this.he},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"resumeToken",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_e",{get:function(){return 0!==this.ae},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fe",{get:function(){return this.le},enumerable:!1,configurable:!0}),n.prototype.de=function(t){t.O()>0&&(this.le=!0,this.ue=t)},n.prototype.we=function(){var t=dt(),e=dt(),i=dt();return this.ce.forEach(function(s,l){switch(l){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:i=i.add(s);break;default:ct()}}),new je(this.ue,this.he,t,e,i)},n.prototype.me=function(){this.le=!1,this.ce=et()},n.prototype.Te=function(t,e){this.le=!0,this.ce=this.ce.ot(t,e)},n.prototype.Ee=function(t){this.le=!0,this.ce=this.ce.remove(t)},n.prototype.Ie=function(){this.ae+=1},n.prototype.Ae=function(){this.ae-=1},n.prototype.Re=function(){this.le=!0,this.he=!0},n}(),j=function(){function n(t){this.ge=t,this.Pe=new Map,this.ye=xn(),this.Ve=K(),this.pe=new Je(te)}return n.prototype.be=function(t){for(var e=0,i=t.ie;e<i.length;e++){var s=i[e];t.re instanceof Ze?this.ve(s,t.re):t.re instanceof Ln&&this.Se(s,t.key,t.re)}for(var l=0,f=t.removedTargetIds;l<f.length;l++)this.Se(f[l],t.key,t.re)},n.prototype.De=function(t){var e=this;this.Ce(t,function(i){var s=e.Ne(i);switch(t.state){case 0:e.Fe(i)&&s.de(t.resumeToken);break;case 1:s.Ae(),s._e||s.me(),s.de(t.resumeToken);break;case 2:s.Ae(),s._e||e.removeTarget(i);break;case 3:e.Fe(i)&&(s.Re(),s.de(t.resumeToken));break;case 4:e.Fe(i)&&(e.xe(i),s.de(t.resumeToken));break;default:ct()}})},n.prototype.Ce=function(t,e){var i=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Pe.forEach(function(s,l){i.Fe(l)&&e(l)})},n.prototype.$e=function(t){var e=t.targetId,i=t.oe.count,s=this.ke(e);if(s){var l=s.target;if(Pe(l))if(0===i){var f=new b(l.path);this.Se(e,f,new Ln(f,we.min()))}else Ct(1===i);else this.Me(e)!==i&&(this.xe(e),this.pe=this.pe.add(e))}},n.prototype.Oe=function(t){var e=this,i=new Map;this.Pe.forEach(function(f,d){var w=e.ke(d);if(w){if(f.te&&Pe(w.target)){var O=new b(w.target.path);null!==e.ye.get(O)||e.Le(d,O)||e.Se(d,O,new Ln(O,t))}f.fe&&(i.set(d,f.we()),f.me())}});var s=dt();this.Ve.forEach(function(f,d){var w=!0;d.xt(function(O){var U=e.ke(O);return!U||2===U.et||(w=!1,!1)}),w&&(s=s.add(f))});var l=new ue(t,i,this.pe,this.ye,s);return this.ye=xn(),this.Ve=K(),this.pe=new Je(te),l},n.prototype.ve=function(t,e){if(this.Fe(t)){var i=this.Le(t,e.key)?2:0;this.Ne(t).Te(e.key,i),this.ye=this.ye.ot(e.key,e),this.Ve=this.Ve.ot(e.key,this.Be(e.key).add(t))}},n.prototype.Se=function(t,e,i){if(this.Fe(t)){var s=this.Ne(t);this.Le(t,e)?s.Te(e,1):s.Ee(e),this.Ve=this.Ve.ot(e,this.Be(e).delete(t)),i&&(this.ye=this.ye.ot(e,i))}},n.prototype.removeTarget=function(t){this.Pe.delete(t)},n.prototype.Me=function(t){var e=this.Ne(t).we();return this.ge.qe(t).size+e.ee.size-e.se.size},n.prototype.Ie=function(t){this.Ne(t).Ie()},n.prototype.Ne=function(t){var e=this.Pe.get(t);return e||(e=new G,this.Pe.set(t,e)),e},n.prototype.Be=function(t){var e=this.Ve.get(t);return e||(e=new Je(te),this.Ve=this.Ve.ot(t,e)),e},n.prototype.Fe=function(t){var e=null!==this.ke(t);return e||Tt("WatchChangeAggregator","Detected inactive target",t),e},n.prototype.ke=function(t){var e=this.Pe.get(t);return e&&e._e?null:this.ge.Ue(t)},n.prototype.xe=function(t){var e=this;this.Pe.set(t,new G),this.ge.qe(t).forEach(function(i){e.Se(t,i,null)})},n.prototype.Le=function(t,e){return this.ge.qe(t).has(e)},n}();function K(){return new Qe(b.i)}function et(){return new Qe(b.i)}function P(n){var t,e;return"server_timestamp"===(null===(e=((null===(t=null==n?void 0:n.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===e?void 0:e.stringValue)}function y(n){var t=n.mapValue.fields.__previous_value__;return P(t)?y(t):t}function C(n){var t=zt(n.mapValue.fields.__local_write_time__.timestampValue);return new Ce(t.seconds,t.nanos)}var M=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function W(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?P(n)?4:10:ct()}function Q(n,t){var s,e=W(n);if(e!==W(t))return!1;switch(e){case 0:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return C(n).isEqual(C(t));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;var l=zt(i.timestampValue),f=zt(s.timestampValue);return l.seconds===f.seconds&&l.nanos===f.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return s=t,Ae(n.bytesValue).isEqual(Ae(s.bytesValue));case 7:return n.referenceValue===t.referenceValue;case 8:return function(i,s){return Ye(i.geoPointValue.latitude)===Ye(s.geoPointValue.latitude)&&Ye(i.geoPointValue.longitude)===Ye(s.geoPointValue.longitude)}(n,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ye(i.integerValue)===Ye(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){var l=Ye(i.doubleValue),f=Ye(s.doubleValue);return l===f?An(l)===An(f):isNaN(l)&&isNaN(f)}return!1}(n,t);case 9:return _e(n.arrayValue.values||[],t.arrayValue.values||[],Q);case 10:return function(i,s){var l=i.mapValue.fields||{},f=s.mapValue.fields||{};if(Kt(l)!==Kt(f))return!1;for(var d in l)if(l.hasOwnProperty(d)&&(void 0===f[d]||!Q(l[d],f[d])))return!1;return!0}(n,t);default:return ct()}}function rt(n,t){return void 0!==(n.values||[]).find(function(e){return Q(e,t)})}function Pt(n,t){var s,l,f,d,e=W(n),i=W(t);if(e!==i)return te(e,i);switch(e){case 0:return 0;case 1:return te(n.booleanValue,t.booleanValue);case 2:return l=t,(f=Ye((s=n).integerValue||s.doubleValue))<(d=Ye(l.integerValue||l.doubleValue))?-1:f>d?1:f===d?0:isNaN(f)?isNaN(d)?0:-1:1;case 3:return Vt(n.timestampValue,t.timestampValue);case 4:return Vt(C(n),C(t));case 5:return te(n.stringValue,t.stringValue);case 6:return function(s,l){var f=Ae(s),d=Ae(l);return f.L(d)}(n.bytesValue,t.bytesValue);case 7:return function(s,l){for(var f=s.split("/"),d=l.split("/"),w=0;w<f.length&&w<d.length;w++){var O=te(f[w],d[w]);if(0!==O)return O}return te(f.length,d.length)}(n.referenceValue,t.referenceValue);case 8:return function(s,l){var f=te(Ye(s.latitude),Ye(l.latitude));return 0!==f?f:te(Ye(s.longitude),Ye(l.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(s,l){for(var f=s.values||[],d=l.values||[],w=0;w<f.length&&w<d.length;++w){var O=Pt(f[w],d[w]);if(O)return O}return te(f.length,d.length)}(n.arrayValue,t.arrayValue);case 10:return function(s,l){var f=s.fields||{},d=Object.keys(f),w=l.fields||{},O=Object.keys(w);d.sort(),O.sort();for(var U=0;U<d.length&&U<O.length;++U){var X=te(d[U],O[U]);if(0!==X)return X;var $=Pt(f[d[U]],w[O[U]]);if(0!==$)return $}return te(d.length,O.length)}(n.mapValue,t.mapValue);default:throw ct()}}function Vt(n,t){if("string"==typeof n&&"string"==typeof t&&n.length===t.length)return te(n,t);var e=zt(n),i=zt(t),s=te(e.seconds,i.seconds);return 0!==s?s:te(e.nanos,i.nanos)}function he(n){return ie(n)}function ie(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?"time("+(s=zt(n.timestampValue)).seconds+","+s.nanos+")":"stringValue"in n?n.stringValue:"bytesValue"in n?Ae(n.bytesValue).toBase64():"referenceValue"in n?b.C(n.referenceValue).toString():"geoPointValue"in n?"geo("+(t=n.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in n?function(i){for(var s="[",l=!0,f=0,d=i.values||[];f<d.length;f++)l?l=!1:s+=",",s+=ie(d[f]);return s+"]"}(n.arrayValue):"mapValue"in n?function(i){for(var s="{",l=!0,f=0,d=Object.keys(i.fields||{}).sort();f<d.length;f++){var w=d[f];l?l=!1:s+=",",s+=w+":"+ie(i.fields[w])}return s+"}"}(n.mapValue):ct();var s,t}function zt(n){if(Ct(!!n),"string"==typeof n){var t=0,e=M.exec(n);if(Ct(!!e),e[1]){var i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}var s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:Ye(n.seconds),nanos:Ye(n.nanos)}}function Ye(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Ae(n){return"string"==typeof n?le.fromBase64String(n):le.fromUint8Array(n)}function Bn(n,t){return{referenceValue:"projects/"+n.projectId+"/databases/"+n.database+"/documents/"+t.path.R()}}function Re(n){return!!n&&"integerValue"in n}function Ur(n){return!!n&&"arrayValue"in n}function mr(n){return!!n&&"nullValue"in n}function Tr(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function hr(n){return!!n&&"mapValue"in n}var mi={asc:"ASCENDING",desc:"DESCENDING"},ii={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_i=function(n,t){this.U=n,this.Qe=t};function pr(n){return{integerValue:""+n}}function Sr(n,t){if(n.Qe){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:An(t)?"-0":t}}function Pr(n,t){return fe(t)?pr(t):Sr(n,t)}function Qr(n,t){return n.Qe?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function oi(n,t){return n.Qe?t.toBase64():t.toUint8Array()}function Yr(n,t){return Qr(n,t.Z())}function tr(n){return Ct(!!n),we.J((e=zt(n),new Ce(e.seconds,e.nanos)));var e}function si(n,t){return(e=n,new At(["projects",e.projectId,"databases",e.database])).child("documents").child(t).R();var e}function En(n){var t=At.g(n);return Ct(wi(t)),t}function qn(n,t){return si(n.U,t.path)}function $n(n,t){var e=En(t);return Ct(e.get(1)===n.U.projectId),Ct(!e.get(3)&&!n.U.database||e.get(3)===n.U.database),new b(ar(e))}function sr(n,t){return si(n.U,t)}function ai(n){var t=En(n);return 4===t.length?At.P():ar(t)}function In(n){return new At(["projects",n.U.projectId,"databases",n.U.database]).R()}function ar(n){return Ct(n.length>4&&"documents"===n.get(4)),n.u(5)}function jr(n,t,e){return{name:qn(n,t),fields:e.proto.mapValue.fields}}function ur(n,t){var e,s;if(t instanceof pn)e={update:jr(n,t.key,t.value)};else if(t instanceof Yn)e={delete:qn(n,t.key)};else if(t instanceof dn)e={update:jr(n,t.key,t.data),updateMask:$r(t.We)};else if(t instanceof Gn)e={transform:{document:qn(n,t.key),fieldTransforms:t.fieldTransforms.map(function(i){return function(s,l){var f=l.transform;if(f instanceof rr)return{fieldPath:l.field.R(),setToServerValue:"REQUEST_TIME"};if(f instanceof _)return{fieldPath:l.field.R(),appendMissingElements:{values:f.elements}};if(f instanceof N)return{fieldPath:l.field.R(),removeAllFromArray:{values:f.elements}};if(f instanceof H)return{fieldPath:l.field.R(),increment:f.je};throw ct()}(0,i)})}};else{if(!(t instanceof Jr))return ct();e={verify:qn(n,t.key)}}return t.Ge.Ke||(e.currentDocument=void 0!==(s=t.Ge).updateTime?{updateTime:Yr(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:ct()),e}function cr(n,t){var U,e=t.currentDocument?void 0!==(U=t.currentDocument).updateTime?Qt.updateTime(tr(U.updateTime)):void 0!==U.exists?Qt.exists(U.exists):Qt.ze():Qt.ze();if(t.update){var i=$n(n,t.update.name),s=new qr({mapValue:{fields:t.update.fields}});if(t.updateMask){var l=function(U){return new kt((U.fieldPaths||[]).map(function($){return S.S($)}))}(t.updateMask);return new dn(i,s,l,e)}return new pn(i,s,e)}if(t.delete){var f=$n(n,t.delete);return new Yn(f,e)}if(t.transform){var d=$n(n,t.transform.document),w=t.transform.fieldTransforms.map(function(U){return function(X,$){var st=null;"setToServerValue"in $?(Ct("REQUEST_TIME"===$.setToServerValue),st=new rr):"appendMissingElements"in $?st=new _($.appendMissingElements.values||[]):"removeAllFromArray"in $?st=new N($.removeAllFromArray.values||[]):"increment"in $?st=new H(X,$.increment):ct();var ce=S.S($.fieldPath);return new It(ce,st)}(n,U)});return Ct(!0===e.exists),new Gn(d,w)}if(t.verify){var O=$n(n,t.verify);return new Jr(O,e)}return ct()}function Tn(n,t){return{documents:[sr(n,t.path)]}}function ui(n,t){var e={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(e.parent=sr(n,i),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=sr(n,i.h()),e.structuredQuery.from=[{collectionId:i._()}]);var s=function(d){if(0!==d.length){var w=d.map(function(O){return function(U){if("=="===U.op){if(Tr(U.value))return{unaryFilter:{field:nr(U.field),op:"IS_NAN"}};if(mr(U.value))return{unaryFilter:{field:nr(U.field),op:"IS_NULL"}}}else if("!="===U.op){if(Tr(U.value))return{unaryFilter:{field:nr(U.field),op:"IS_NOT_NAN"}};if(mr(U.value))return{unaryFilter:{field:nr(U.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:nr(U.field),op:Vr(U.op),value:U.value}}}(O)});return 1===w.length?w[0]:{compositeFilter:{op:"AND",filters:w}}}}(t.filters);s&&(e.structuredQuery.where=s);var l=function(d){if(0!==d.length)return d.map(function(w){return{field:nr((O=w).field),direction:Le(O.dir)};var O})}(t.orderBy);l&&(e.structuredQuery.orderBy=l);var w,f=(w=t.limit,n.Qe||Cn(w)?w:{value:w});return null!==f&&(e.structuredQuery.limit=f),t.startAt&&(e.structuredQuery.startAt=er(t.startAt)),t.endAt&&(e.structuredQuery.endAt=er(t.endAt)),e}function _r(n){var t=ai(n.parent),e=n.structuredQuery,i=e.from?e.from.length:0,s=null;if(i>0){Ct(1===i);var l=e.from[0];l.allDescendants?s=l.collectionId:t=t.child(l.collectionId)}var f=[];e.where&&(f=wr(e.where));var d=[];e.orderBy&&(d=e.orderBy.map(function(X){return new ei(zn(($=X).field),function(st){switch(st){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}($.direction));var $}));var X,$,w=null;e.limit&&(w=Cn($="object"==typeof(X=e.limit)?X.value:X)?null:$);var O=null;e.startAt&&(O=br(e.startAt));var U=null;return e.endAt&&(U=br(e.endAt)),Un(lo(t,s,d,f,w,"F",O,U))}function wr(n){return n?void 0!==n.unaryFilter?[Br(n)]:void 0!==n.fieldFilter?[Xr(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(function(t){return wr(t)}).reduce(function(t,e){return t.concat(e)}):ct():[]}function er(n){return{before:n.before,values:n.position}}function br(n){return new Rr(n.values||[],!!n.before)}function Le(n){return mi[n]}function Vr(n){return ii[n]}function nr(n){return{fieldPath:n.R()}}function zn(n){return S.S(n.fieldPath)}function Xr(n){return Jn.create(zn(n.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return ct()}}(n.fieldFilter.op),n.fieldFilter.value)}function Br(n){switch(n.unaryFilter.op){case"IS_NAN":var t=zn(n.unaryFilter.field);return Jn.create(t,"==",{doubleValue:NaN});case"IS_NULL":var e=zn(n.unaryFilter.field);return Jn.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var i=zn(n.unaryFilter.field);return Jn.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var s=zn(n.unaryFilter.field);return Jn.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return ct()}}function $r(n){var t=[];return n.fields.forEach(function(e){return t.push(e.R())}),{fieldPaths:t}}function wi(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}var an=function(){this.He=void 0};function ci(n,t,e){return n instanceof rr?(l={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:(i=e).seconds,nanos:i.nanoseconds}}}},(s=t)&&(l.fields.__previous_value__=s),{mapValue:l}):n instanceof _?g(n,t):n instanceof N?V(n,t):function(i,s){var l=bi(i,s),f=nt(l)+nt(i.je);return Re(l)&&Re(i.je)?pr(f):Sr(i.serializer,f)}(n,t);var i,s,l}function li(n,t,e){return n instanceof _?g(n,t):n instanceof N?V(n,t):e}function bi(n,t){return n instanceof H?Re(e=t)||(i=e)&&"doubleValue"in i?t:{integerValue:0}:null;var i,e}var rr=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return B.__extends(t,n),t}(an),_=function(n){function t(e){var i=this;return(i=n.call(this)||this).elements=e,i}return B.__extends(t,n),t}(an);function g(n,t){for(var e=bt(t),i=function(f){e.some(function(d){return Q(d,f)})||e.push(f)},s=0,l=n.elements;s<l.length;s++)i(l[s]);return{arrayValue:{values:e}}}var N=function(n){function t(e){var i=this;return(i=n.call(this)||this).elements=e,i}return B.__extends(t,n),t}(an);function V(n,t){for(var e=bt(t),i=function(f){e=e.filter(function(d){return!Q(d,f)})},s=0,l=n.elements;s<l.length;s++)i(l[s]);return{arrayValue:{values:e}}}var H=function(n){function t(e,i){var s=this;return(s=n.call(this)||this).serializer=e,s.je=i,s}return B.__extends(t,n),t}(an);function nt(n){return Ye(n.integerValue||n.doubleValue)}function bt(n){return Ur(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var kt=function(){function n(t){this.fields=t,t.sort(S.i)}return n.prototype.Ye=function(t){for(var e=0,i=this.fields;e<i.length;e++)if(i[e].T(t))return!0;return!1},n.prototype.isEqual=function(t){return _e(this.fields,t.fields,function(e,i){return e.isEqual(i)})},n}(),It=function(n,t){this.field=n,this.transform=t},Gt=function(n,t){this.version=n,this.transformResults=t},Qt=function(){function n(t,e){this.updateTime=t,this.exists=e}return n.ze=function(){return new n},n.exists=function(t){return new n(void 0,t)},n.updateTime=function(t){return new n(t)},Object.defineProperty(n.prototype,"Ke",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},n}();function xe(n,t){return void 0!==n.updateTime?t instanceof Ze&&t.version.isEqual(n.updateTime):void 0===n.exists||n.exists===t instanceof Ze}var me=function(){};function yn(n,t,e){return n instanceof pn?new Ze((i=n).key,e.version,i.value,{hasCommittedMutations:!0}):n instanceof dn?function(i,s,l){if(!xe(i.Ge,s))return new Oi(i.key,l.version);var f=Qn(i,s);return new Ze(i.key,l.version,f,{hasCommittedMutations:!0})}(n,t,e):n instanceof Gn?function(i,s,l){if(Ct(null!=l.transformResults),!xe(i.Ge,s))return new Oi(i.key,l.version);var f=Dr(0,s),d=function(U,X,$){var st=[];Ct(U.length===$.length);for(var vt=0;vt<$.length;vt++){var Et=U[vt],ce=Et.transform,oe=null;X instanceof Ze&&(oe=X.field(Et.field)),st.push(li(ce,oe,$[vt]))}return st}(i.fieldTransforms,s,l.transformResults),w=l.version,O=Er(i,f.data(),d);return new Ze(i.key,w,O,{hasCommittedMutations:!0})}(n,t,e):function(i,s,l){return new Ln(i.key,l.version,{hasCommittedMutations:!0})}(n,0,e);var i}function Ve(n,t,e,i){return n instanceof pn?function(s,l){if(!xe(s.Ge,l))return l;var f=Kn(l);return new Ze(s.key,f,s.value,{Je:!0})}(n,t):n instanceof dn?function(s,l){if(!xe(s.Ge,l))return l;var f=Kn(l),d=Qn(s,l);return new Ze(s.key,f,d,{Je:!0})}(n,t):n instanceof Gn?function(s,l,f,d){if(!xe(s.Ge,l))return l;var w=Dr(0,l),O=function(X,$,st,vt){for(var Et=[],ce=0,oe=X;ce<oe.length;ce++){var Ie=oe[ce],Me=Ie.transform,tn=null;st instanceof Ze&&(tn=st.field(Ie.field)),null===tn&&vt instanceof Ze&&(tn=vt.field(Ie.field)),Et.push(ci(Me,tn,$))}return Et}(s.fieldTransforms,f,l,d),U=Er(s,w.data(),O);return new Ze(s.key,w.version,U,{Je:!0})}(n,t,i,e):xe((s=n).Ge,l=t)?new Ln(s.key,we.min()):l;var s,l}function gn(n,t){return n instanceof Gn?function(e,i){for(var s=null,l=0,f=e.fieldTransforms;l<f.length;l++){var d=f[l],w=i instanceof Ze?i.field(d.field):void 0,O=bi(d.transform,w||null);null!=O&&(s=null==s?(new Gr).set(d.field,O):s.set(d.field,O))}return s?s.Xe():null}(n,t):null}function rn(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.Ge.isEqual(t.Ge)&&(0===n.type?n.value.isEqual(t.value):1===n.type?n.data.isEqual(t.data)&&n.We.isEqual(t.We):2!==n.type||_e(n.fieldTransforms,n.fieldTransforms,function(e,i){return(s=e).field.isEqual((l=i).field)&&(d=l.transform,(f=s.transform)instanceof _&&d instanceof _||f instanceof N&&d instanceof N?_e(f.elements,d.elements,Q):f instanceof H&&d instanceof H?Q(f.je,d.je):f instanceof rr&&d instanceof rr);var s,l,f,d}))}function Kn(n){return n instanceof Ze?n.version:we.min()}var pn=function(n){function t(e,i,s){var l=this;return(l=n.call(this)||this).key=e,l.value=i,l.Ge=s,l.type=0,l}return B.__extends(t,n),t}(me),dn=function(n){function t(e,i,s,l){var f=this;return(f=n.call(this)||this).key=e,f.data=i,f.We=s,f.Ge=l,f.type=1,f}return B.__extends(t,n),t}(me);function Qn(n,t){return e=n,i=t instanceof Ze?t.data():qr.empty(),s=new Gr(i),e.We.fields.forEach(function(l){if(!l.m()){var f=e.data.field(l);null!==f?s.set(l,f):s.delete(l)}}),s.Xe();var e,i,s}var Gn=function(n){function t(e,i){var s=this;return(s=n.call(this)||this).key=e,s.fieldTransforms=i,s.type=2,s.Ge=Qt.exists(!0),s}return B.__extends(t,n),t}(me);function Dr(n,t){return t}function Er(n,t,e){for(var i=new Gr(t),s=0;s<n.fieldTransforms.length;s++)i.set(n.fieldTransforms[s].field,e[s]);return i.Xe()}var Yn=function(n){function t(e,i){var s=this;return(s=n.call(this)||this).key=e,s.Ge=i,s.type=3,s}return B.__extends(t,n),t}(me),Jr=function(n){function t(e,i){var s=this;return(s=n.call(this)||this).key=e,s.Ge=i,s.type=4,s}return B.__extends(t,n),t}(me),qr=function(){function n(t){this.proto=t}return n.empty=function(){return new n({mapValue:{}})},n.prototype.field=function(t){if(t.m())return this.proto;for(var e=this.proto,i=0;i<t.length-1;++i)if(!e.mapValue.fields||!hr(e=e.mapValue.fields[t.get(i)]))return null;return(e=(e.mapValue.fields||{})[t._()])||null},n.prototype.isEqual=function(t){return Q(this.proto,t.proto)},n}(),Gr=function(){function n(t){void 0===t&&(t=qr.empty()),this.Ze=t,this.tn=new Map}return n.prototype.set=function(t,e){return this.en(t,e),this},n.prototype.delete=function(t){return this.en(t,null),this},n.prototype.en=function(t,e){for(var i=this.tn,s=0;s<t.length-1;++s){var l=t.get(s),f=i.get(l);f instanceof Map?i=f:f&&10===W(f)?(f=new Map(Object.entries(f.mapValue.fields||{})),i.set(l,f),i=f):(f=new Map,i.set(l,f),i=f)}i.set(t._(),e)},n.prototype.Xe=function(){var t=this.nn(S.P(),this.tn);return null!=t?new qr(t):this.Ze},n.prototype.nn=function(t,e){var i=this,s=!1,l=this.Ze.field(t),f=hr(l)?Object.assign({},l.mapValue.fields):{};return e.forEach(function(d,w){if(d instanceof Map){var O=i.nn(t.child(w),d);null!=O&&(f[w]=O,s=!0)}else null!==d?(f[w]=d,s=!0):f.hasOwnProperty(w)&&(delete f[w],s=!0)}),s?{mapValue:{fields:f}}:null},n}();function co(n){var t=[];return ne(n.fields||{},function(e,i){var s=new S([e]);if(hr(i)){var l=co(i.mapValue).fields;if(0===l.length)t.push(s);else for(var f=0,d=l;f<d.length;f++)t.push(s.child(d[f]))}else t.push(s)}),new kt(t)}var Nn=function(n,t){this.key=n,this.version=t},Ze=function(n){function t(e,i,s,l){var f=this;return(f=n.call(this,e,i)||this).sn=s,f.Je=!!l.Je,f.hasCommittedMutations=!!l.hasCommittedMutations,f}return B.__extends(t,n),t.prototype.field=function(e){return this.sn.field(e)},t.prototype.data=function(){return this.sn},t.prototype.rn=function(){return this.sn.proto},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.Je===e.Je&&this.hasCommittedMutations===e.hasCommittedMutations&&this.sn.isEqual(e.sn)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.sn.toString()+", {hasLocalMutations: "+this.Je+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.Je||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t}(Nn),Ln=function(n){function t(e,i,s){var l=this;return(l=n.call(this,e,i)||this).hasCommittedMutations=!(!s||!s.hasCommittedMutations),l}return B.__extends(t,n),t.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.hasCommittedMutations===this.hasCommittedMutations&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)},t}(Nn),Oi=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return B.__extends(t,n),t.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)},t}(Nn),xr=function(n,t,e,i,s,l,f,d){void 0===t&&(t=null),void 0===e&&(e=[]),void 0===i&&(i=[]),void 0===s&&(s=null),void 0===l&&(l="F"),void 0===f&&(f=null),void 0===d&&(d=null),this.path=n,this.collectionGroup=t,this.on=e,this.filters=i,this.limit=s,this.an=l,this.startAt=f,this.endAt=d,this.cn=null,this.un=null};function lo(n,t,e,i,s,l,f,d){return new xr(n,t,e,i,s,l,f,d)}function Wr(n){return new xr(n)}function Ei(n){return!Cn(n.limit)&&"F"===n.an}function Zr(n){return!Cn(n.limit)&&"L"===n.an}function fi(n){return n.on.length>0?n.on[0].field:null}function Pi(n){for(var t=0,e=n.filters;t<e.length;t++){var i=e[t];if(i.hn())return i.field}return null}function Cr(n){return null!==n.collectionGroup}function Ar(n){var t=mt(n);if(null===t.cn){t.cn=[];var e=Pi(t),i=fi(t);if(null!==e&&null===i)e.p()||t.cn.push(new ei(e)),t.cn.push(new ei(S.v(),"asc"));else{for(var s=!1,l=0,f=t.on;l<f.length;l++){var d=f[l];t.cn.push(d),d.field.p()&&(s=!0)}if(!s){var w=t.on.length>0?t.on[t.on.length-1].dir:"asc";t.cn.push(new ei(S.v(),w))}}}return t.cn}function Un(n){var t=mt(n);if(!t.un)if("F"===t.an)t.un=sn(t.path,t.collectionGroup,Ar(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var e=[],i=0,s=Ar(t);i<s.length;i++){var l=s[i];e.push(new ei(l.field,"desc"===l.dir?"asc":"desc"))}var d=t.endAt?new Rr(t.endAt.position,!t.endAt.before):null,w=t.startAt?new Rr(t.startAt.position,!t.startAt.before):null;t.un=sn(t.path,t.collectionGroup,e,t.filters,t.limit,d,w)}return t.un}function hi(n,t,e){return new xr(n.path,n.collectionGroup,n.on.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Ki(n,t){return new xr(n.path,n.collectionGroup,n.on.slice(),n.filters.slice(),n.limit,n.an,t,n.endAt)}function Di(n,t){return new xr(n.path,n.collectionGroup,n.on.slice(),n.filters.slice(),n.limit,n.an,n.startAt,t)}function Lr(n,t){return Ge(Un(n),Un(t))&&n.an===t.an}function Qi(n){return Ke(Un(n))+"|lt:"+n.an}function ti(n){return"Query(target="+(e=(t=Un(n)).path.R(),null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(i){return(s=i).field.R()+" "+s.op+" "+he(s.value);var s}).join(", ")+"]"),Cn(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(i){return(s=i).field.R()+" ("+s.dir+")";var s}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Nr(t.startAt)),t.endAt&&(e+=", endAt: "+Nr(t.endAt)),"Target("+e+"); limitType=")+n.an+")";var t,e}function kr(n,t){return s=(i=t).key.path,(null!==(e=n).collectionGroup?i.key.N(e.collectionGroup)&&e.path.T(s):b.F(e.path)?e.path.isEqual(s):e.path.I(s))&&function(e,i){for(var s=0,l=e.on;s<l.length;s++){var f=l[s];if(!f.field.p()&&null===i.field(f.field))return!1}return!0}(n,t)&&function(e,i){for(var s=0,l=e.filters;s<l.length;s++)if(!l[s].matches(i))return!1;return!0}(n,t)&&function(e,i){return!(e.startAt&&!Li(e.startAt,Ar(e),i)||e.endAt&&Li(e.endAt,Ar(e),i))}(n,t);var e,i,s}function fo(n){return function(t,e){for(var i=!1,s=0,l=Ar(n);s<l.length;s++){var f=l[s],d=po(f,t,e);if(0!==d)return d;i=i||f.field.p()}return 0}}var Jn=function(n){function t(e,i,s){var l=this;return(l=n.call(this)||this).field=e,l.op=i,l.value=s,l}return B.__extends(t,n),t.create=function(e,i,s){if(e.p())return"in"===i||"not-in"===i?this.ln(e,i,s):new Ii(e,i,s);if(mr(s)){if("=="!==i&&"!="!==i)throw new ut(J.INVALID_ARGUMENT,"Invalid query. Null only supports '==' and '!=' comparisons.");return new t(e,i,s)}if(Tr(s)){if("=="!==i&&"!="!==i)throw new ut(J.INVALID_ARGUMENT,"Invalid query. NaN only supports '==' and '!=' comparisons.");return new t(e,i,s)}return"array-contains"===i?new xi(e,s):"in"===i?new ho(e,s):"not-in"===i?new Si(e,s):"array-contains-any"===i?new $i(e,s):new t(e,i,s)},t.ln=function(e,i,s){return"in"===i?new Yi(e,s):new Xi(e,s)},t.prototype.matches=function(e){var i=e.field(this.field);return"!="===this.op?null!==i&&this._n(Pt(i,this.value)):null!==i&&W(this.value)===W(i)&&this._n(Pt(i,this.value))},t.prototype._n=function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ct()}},t.prototype.hn=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},t}(function(){}),Ii=function(n){function t(e,i,s){var l=this;return(l=n.call(this,e,i,s)||this).key=b.C(s.referenceValue),l}return B.__extends(t,n),t.prototype.matches=function(e){var i=b.i(e.key,this.key);return this._n(i)},t}(Jn),Yi=function(n){function t(e,i){var s=this;return(s=n.call(this,e,"in",i)||this).keys=Ti(0,i),s}return B.__extends(t,n),t.prototype.matches=function(e){return this.keys.some(function(i){return i.isEqual(e.key)})},t}(Jn),Xi=function(n){function t(e,i){var s=this;return(s=n.call(this,e,"not-in",i)||this).keys=Ti(0,i),s}return B.__extends(t,n),t.prototype.matches=function(e){return!this.keys.some(function(i){return i.isEqual(e.key)})},t}(Jn);function Ti(n,t){var e;return((null===(e=t.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(i){return b.C(i.referenceValue)})}var xi=function(n){function t(e,i){return n.call(this,e,"array-contains",i)||this}return B.__extends(t,n),t.prototype.matches=function(e){var i=e.field(this.field);return Ur(i)&&rt(i.arrayValue,this.value)},t}(Jn),ho=function(n){function t(e,i){return n.call(this,e,"in",i)||this}return B.__extends(t,n),t.prototype.matches=function(e){var i=e.field(this.field);return null!==i&&rt(this.value.arrayValue,i)},t}(Jn),Si=function(n){function t(e,i){return n.call(this,e,"not-in",i)||this}return B.__extends(t,n),t.prototype.matches=function(e){if(rt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var i=e.field(this.field);return null!==i&&!rt(this.value.arrayValue,i)},t}(Jn),$i=function(n){function t(e,i){return n.call(this,e,"array-contains-any",i)||this}return B.__extends(t,n),t.prototype.matches=function(e){var i=this,s=e.field(this.field);return!(!Ur(s)||!s.arrayValue.values)&&s.arrayValue.values.some(function(l){return rt(i.value.arrayValue,l)})},t}(Jn),Rr=function(n,t){this.position=n,this.before=t};function Nr(n){return(n.before?"b":"a")+":"+n.position.map(function(t){return he(t)}).join(",")}function Li(n,t,e){for(var i=0,s=0;s<n.position.length;s++){var l=t[s],f=n.position[s];if(i=l.field.p()?b.i(b.C(f.referenceValue),e.key):Pt(f,e.field(l.field)),"desc"===l.dir&&(i*=-1),0!==i)break}return n.before?i<=0:i<0}function Ji(n,t){if(null===n)return null===t;if(null===t||n.before!==t.before||n.position.length!==t.position.length)return!1;for(var e=0;e<n.position.length;e++)if(!Q(n.position[e],t.position[e]))return!1;return!0}var ei=function(n,t){void 0===t&&(t="asc"),this.field=n,this.dir=t};function po(n,t,e){var s,f,d,w,i=n.field.p()?b.i(t.key,e.key):(f=e,d=t.field(s=n.field),w=f.field(s),null!==d&&null!==w?Pt(d,w):ct());switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return ct()}}function ki(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var on=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},Mi=function(){function n(t,e,i,s,l){void 0===i&&(i=1e3),void 0===s&&(s=1.5),void 0===l&&(l=6e4),this.fn=t,this.dn=e,this.wn=i,this.mn=s,this.Tn=l,this.En=0,this.In=null,this.An=Date.now(),this.reset()}return n.prototype.reset=function(){this.En=0},n.prototype.Rn=function(){this.En=this.Tn},n.prototype.gn=function(t){var e=this;this.cancel();var i=Math.floor(this.En+this.Pn()),s=Math.max(0,Date.now()-this.An),l=Math.max(0,i-s);l>0&&Tt("ExponentialBackoff","Backing off for "+l+" ms (base delay: "+this.En+" ms, delay with jitter: "+i+" ms, last attempt: "+s+" ms ago)"),this.In=this.fn.yn(this.dn,l,function(){return e.An=Date.now(),t()}),this.En*=this.mn,this.En<this.wn&&(this.En=this.wn),this.En>this.Tn&&(this.En=this.Tn)},n.prototype.Vn=function(){null!==this.In&&(this.In.pn(),this.In=null)},n.prototype.cancel=function(){null!==this.In&&(this.In.cancel(),this.In=null)},n.prototype.Pn=function(){return(Math.random()-.5)*this.En},n}(),Wt=function(){function n(t){var e=this;this.bn=null,this.vn=null,this.result=void 0,this.error=void 0,this.Sn=!1,this.Dn=!1,t(function(i){e.Sn=!0,e.result=i,e.bn&&e.bn(i)},function(i){e.Sn=!0,e.error=i,e.vn&&e.vn(i)})}return n.prototype.catch=function(t){return this.next(void 0,t)},n.prototype.next=function(t,e){var i=this;return this.Dn&&ct(),this.Dn=!0,this.Sn?this.error?this.Cn(e,this.error):this.Nn(t,this.result):new n(function(s,l){i.bn=function(f){i.Nn(t,f).next(s,l)},i.vn=function(f){i.Cn(e,f).next(s,l)}})},n.prototype.Fn=function(){var t=this;return new Promise(function(e,i){t.next(e,i)})},n.prototype.xn=function(t){try{var e=t();return e instanceof n?e:n.resolve(e)}catch(i){return n.reject(i)}},n.prototype.Nn=function(t,e){return t?this.xn(function(){return t(e)}):n.resolve(e)},n.prototype.Cn=function(t,e){return t?this.xn(function(){return t(e)}):n.reject(e)},n.resolve=function(t){return new n(function(e,i){e(t)})},n.reject=function(t){return new n(function(e,i){i(t)})},n.$n=function(t){return new n(function(e,i){var s=0,l=0,f=!1;t.forEach(function(d){++s,d.next(function(){++l,f&&l===s&&e()},function(w){return i(w)})}),f=!0,l===s&&e()})},n.kn=function(t){for(var e=n.resolve(!1),i=function(f){e=e.next(function(d){return d?n.resolve(d):f()})},s=0,l=t;s<l.length;s++)i(l[s]);return e},n.forEach=function(t,e){var i=this,s=[];return t.forEach(function(l,f){s.push(e.call(i,l,f))}),this.$n(s)},n}(),un=function(){function n(t,e,i){this.name=t,this.version=e,this.Mn=i,12.2===n.On(Te.getUA())&&ge("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return n.delete=function(t){return Tt("SimpleDb","Removing database:",t),ni(window.indexedDB.deleteDatabase(t)).Fn()},n.Ln=function(){if("undefined"==typeof indexedDB)return!1;if(n.Bn())return!0;var t=Te.getUA(),e=n.On(t),i=0<e&&e<10,s=n.qn(t),l=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||i||l)},n.Bn=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Un)},n.Qn=function(t,e){return t.store(e)},n.On=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(i)},n.qn=function(t){var e=t.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)},n.prototype.Wn=function(t){return B.__awaiter(this,void 0,void 0,function(){var e,i=this;return B.__generator(this,function(s){switch(s.label){case 0:return this.db?[3,2]:(Tt("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(l,f){var d=indexedDB.open(i.name,i.version);d.onsuccess=function(w){l(w.target.result)},d.onblocked=function(){f(new pi(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},d.onerror=function(w){var O=w.target.error;f("VersionError"===O.name?new ut(J.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new pi(t,O))},d.onupgradeneeded=function(w){Tt("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',w.oldVersion),i.Mn.createOrUpgrade(w.target.result,d.transaction,w.oldVersion,i.version).next(function(){Tt("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=s.sent(),s.label=2;case 2:return[2,(this.jn&&(this.db.onversionchange=function(l){return i.jn(l)}),this.db)]}})})},n.prototype.Kn=function(t){this.jn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},n.prototype.runTransaction=function(t,e,i,s){return B.__awaiter(this,void 0,void 0,function(){var l,f,d,w,O;return B.__generator(this,function(U){switch(U.label){case 0:l="readonly"===e,f=0,d=function(){var X,$,st,vt,Et;return B.__generator(this,function(ce){switch(ce.label){case 0:++f,ce.label=1;case 1:return ce.trys.push([1,4,,5]),[4,w.Wn(t)];case 2:return w.db=ce.sent(),X=dr.open(w.db,t,l?"readonly":"readwrite",i),$=s(X).catch(function(oe){return X.abort(oe),Wt.reject(oe)}).Fn(),st={},$.catch(function(){}),[4,X.Gn];case 3:return[2,(st.value=(ce.sent(),$),st)];case 4:return Tt("SimpleDb","Transaction failed with error:",(vt=ce.sent()).message,"Retrying:",Et="FirebaseError"!==vt.name&&f<3),w.close(),Et?[3,5]:[2,{value:Promise.reject(vt)}];case 5:return[2]}})},w=this,U.label=1;case 1:return[5,d()];case 2:if("object"==typeof(O=U.sent()))return[2,O.value];U.label=3;case 3:return[3,1];case 4:return[2]}})})},n.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},n}(),Zi=function(){function n(t){this.zn=t,this.Hn=!1,this.Yn=null}return Object.defineProperty(n.prototype,"Sn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"Jn",{get:function(){return this.Yn},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cursor",{set:function(t){this.zn=t},enumerable:!1,configurable:!0}),n.prototype.done=function(){this.Hn=!0},n.prototype.Xn=function(t){this.Yn=t},n.prototype.delete=function(){return ni(this.zn.delete())},n}(),pi=function(n){function t(e,i){var s=this;return(s=n.call(this,J.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+i)||this).name="IndexedDbTransactionError",s}return B.__extends(t,n),t}(ut);function Hr(n){return"IndexedDbTransactionError"===n.name}var dr=function(){function n(t,e){var i=this;this.action=t,this.transaction=e,this.aborted=!1,this.Zn=new on,this.transaction.oncomplete=function(){i.Zn.resolve()},this.transaction.onabort=function(){e.error?i.Zn.reject(new pi(t,e.error)):i.Zn.resolve()},this.transaction.onerror=function(s){var l=u(s.target.error);i.Zn.reject(new pi(t,l))}}return n.open=function(t,e,i,s){try{return new n(e,t.transaction(s,i))}catch(l){throw new pi(e,l)}},Object.defineProperty(n.prototype,"Gn",{get:function(){return this.Zn.promise},enumerable:!1,configurable:!0}),n.prototype.abort=function(t){t&&this.Zn.reject(t),this.aborted||(Tt("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},n.prototype.store=function(t){var e=this.transaction.objectStore(t);return new to(e)},n}(),to=function(){function n(t){this.store=t}return n.prototype.put=function(t,e){var i;return void 0!==e?(Tt("SimpleDb","PUT",this.store.name,t,e),i=this.store.put(e,t)):(Tt("SimpleDb","PUT",this.store.name,"<auto-key>",t),i=this.store.put(t)),ni(i)},n.prototype.add=function(t){return Tt("SimpleDb","ADD",this.store.name,t,t),ni(this.store.add(t))},n.prototype.get=function(t){var e=this;return ni(this.store.get(t)).next(function(i){return void 0===i&&(i=null),Tt("SimpleDb","GET",e.store.name,t,i),i})},n.prototype.delete=function(t){return Tt("SimpleDb","DELETE",this.store.name,t),ni(this.store.delete(t))},n.prototype.count=function(){return Tt("SimpleDb","COUNT",this.store.name),ni(this.store.count())},n.prototype.ts=function(t,e){var i=this.cursor(this.options(t,e)),s=[];return this.es(i,function(l,f){s.push(f)}).next(function(){return s})},n.prototype.ns=function(t,e){Tt("SimpleDb","DELETE ALL",this.store.name);var i=this.options(t,e);i.ss=!1;var s=this.cursor(i);return this.es(s,function(l,f,d){return d.delete()})},n.prototype.rs=function(t,e){var i;e?i=t:(i={},e=t);var s=this.cursor(i);return this.es(s,e)},n.prototype.os=function(t){var e=this.cursor({});return new Wt(function(i,s){e.onerror=function(l){var f=u(l.target.error);s(f)},e.onsuccess=function(l){var f=l.target.result;f?t(f.primaryKey,f.value).next(function(d){d?f.continue():i()}):i()}})},n.prototype.es=function(t,e){var i=[];return new Wt(function(s,l){t.onerror=function(f){l(f.target.error)},t.onsuccess=function(f){var d=f.target.result;if(d){var w=new Zi(d),O=e(d.primaryKey,d.value,w);if(O instanceof Wt){var U=O.catch(function(X){return w.done(),Wt.reject(X)});i.push(U)}w.Sn?s():null===w.Jn?d.continue():d.continue(w.Jn)}else s()}}).next(function(){return Wt.$n(i)})},n.prototype.options=function(t,e){var i=void 0;return void 0!==t&&("string"==typeof t?i=t:e=t),{index:i,range:e}},n.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var i=this.store.index(t.index);return t.ss?i.openKeyCursor(t.range,e):i.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},n}();function ni(n){return new Wt(function(t,e){n.onsuccess=function(i){t(i.target.result)},n.onerror=function(i){var s=u(i.target.error);e(s)}})}var Rn=!1;function u(n){var t=un.On(Te.getUA());if(t>=12.2&&t<13){var e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){var i=new ut("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Rn||(Rn=!0,setTimeout(function(){throw i},0)),i}}return n}function v(){return"undefined"!=typeof window?window:null}function E(){return"undefined"!=typeof document?document:null}var L=function(){function n(t,e,i,s,l){this.cs=t,this.dn=e,this.us=i,this.op=s,this.hs=l,this.ls=new on,this.then=this.ls.promise.then.bind(this.ls.promise),this.ls.promise.catch(function(f){})}return n._s=function(t,e,i,s,l){var f=new n(t,e,Date.now()+i,s,l);return f.start(i),f},n.prototype.start=function(t){var e=this;this.fs=setTimeout(function(){return e.ds()},t)},n.prototype.pn=function(){return this.ds()},n.prototype.cancel=function(t){null!==this.fs&&(this.clearTimeout(),this.ls.reject(new ut(J.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},n.prototype.ds=function(){var t=this;this.cs.ws(function(){return null!==t.fs?(t.clearTimeout(),t.op().then(function(e){return t.ls.resolve(e)})):Promise.resolve()})},n.prototype.clearTimeout=function(){null!==this.fs&&(this.hs(this),clearTimeout(this.fs),this.fs=null)},n}(),Z=function(){function n(){var t=this;this.Ts=Promise.resolve(),this.Es=[],this.Is=!1,this.As=[],this.Rs=null,this.gs=!1,this.Ps=[],this.ys=new Mi(this,"async_queue_retry"),this.Vs=function(){var i=E();i&&Tt("AsyncQueue","Visibility state changed to  ",i.visibilityState),t.ys.Vn()};var e=E();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Vs)}return Object.defineProperty(n.prototype,"ps",{get:function(){return this.Is},enumerable:!1,configurable:!0}),n.prototype.ws=function(t){this.enqueue(t)},n.prototype.bs=function(t){this.vs(),this.Ss(t)},n.prototype.Ds=function(){if(!this.Is){this.Is=!0;var t=E();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vs)}},n.prototype.enqueue=function(t){return this.vs(),this.Is?new Promise(function(e){}):this.Ss(t)},n.prototype.Cs=function(t){var e=this;this.ws(function(){return e.Es.push(t),e.Ns()})},n.prototype.Ns=function(){return B.__awaiter(this,void 0,void 0,function(){var t,e=this;return B.__generator(this,function(i){switch(i.label){case 0:if(0===this.Es.length)return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.Es[0]()];case 2:return i.sent(),this.Es.shift(),this.ys.reset(),[3,4];case 3:if(!Hr(t=i.sent()))throw t;return Tt("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.Es.length>0&&this.ys.gn(function(){return e.Ns()}),i.label=5;case 5:return[2]}})})},n.prototype.Ss=function(t){var e=this,i=this.Ts.then(function(){return e.gs=!0,t().catch(function(s){throw e.Rs=s,e.gs=!1,ge("INTERNAL UNHANDLED ERROR: ",(f=(l=s).message||"",l.stack&&(f=l.stack.includes(l.message)?l.stack:l.message+"\n"+l.stack),f)),s;var l,f}).then(function(s){return e.gs=!1,s})});return this.Ts=i,i},n.prototype.yn=function(t,e,i){var s=this;this.vs(),this.Ps.indexOf(t)>-1&&(e=0);var l=L._s(this,t,e,i,function(f){return s.Fs(f)});return this.As.push(l),l},n.prototype.vs=function(){this.Rs&&ct()},n.prototype.xs=function(){},n.prototype.$s=function(){return B.__awaiter(this,void 0,void 0,function(){var t;return B.__generator(this,function(e){switch(e.label){case 0:return[4,t=this.Ts];case 1:e.sent(),e.label=2;case 2:if(t!==this.Ts)return[3,0];e.label=3;case 3:return[2]}})})},n.prototype.ks=function(t){for(var e=0,i=this.As;e<i.length;e++)if(i[e].dn===t)return!0;return!1},n.prototype.Ms=function(t){var e=this;return this.$s().then(function(){e.As.sort(function(f,d){return f.us-d.us});for(var i=0,s=e.As;i<s.length;i++){var l=s[i];if(l.pn(),"all"!==t&&l.dn===t)break}return e.$s()})},n.prototype.Os=function(t){this.Ps.push(t)},n.prototype.Fs=function(t){var e=this.As.indexOf(t);this.As.splice(e,1)},n}();function lt(n,t){if(ge("AsyncQueue",t+": "+n),Hr(n))return new ut(J.UNAVAILABLE,t+": "+n);throw n}var Jt=function(){this.Ls=void 0,this.listeners=[]},We=function(){this.Bs=new qe(function(n){return Qi(n)},Lr),this.onlineState="Unknown",this.qs=new Set};function Ue(n,t){return B.__awaiter(this,void 0,void 0,function(){var e,i,s,l,f,d,w;return B.__generator(this,function(O){switch(O.label){case 0:if(e=mt(n),s=!1,(l=e.Bs.get(i=t.query))||(s=!0,l=new Jt),!s)return[3,4];O.label=1;case 1:return O.trys.push([1,3,,4]),f=l,[4,e.Us(i)];case 2:return f.Ls=O.sent(),[3,4];case 3:return d=O.sent(),w=lt(d,"Initialization of query '"+ti(t.query)+"' failed"),[2,void t.onError(w)];case 4:return e.Bs.set(i,l),l.listeners.push(t),t.Qs(e.onlineState),l.Ls&&t.Ws(l.Ls)&&Ci(e),[2]}})})}function jn(n,t){return B.__awaiter(this,void 0,void 0,function(){var e,i,s,l,f;return B.__generator(this,function(d){return e=mt(n),s=!1,(l=e.Bs.get(i=t.query))&&(f=l.listeners.indexOf(t))>=0&&(l.listeners.splice(f,1),s=0===l.listeners.length),s?[2,(e.Bs.delete(i),e.js(i))]:[2]})})}function Ir(n,t){for(var e=mt(n),i=!1,s=0,l=t;s<l.length;s++){var f=l[s],w=e.Bs.get(f.query);if(w){for(var O=0,U=w.listeners;O<U.length;O++)U[O].Ws(f)&&(i=!0);w.Ls=f}}i&&Ci(e)}function vr(n,t,e){var i=mt(n),s=i.Bs.get(t);if(s)for(var l=0,f=s.listeners;l<f.length;l++)f[l].onError(e);i.Bs.delete(t)}function Ci(n){n.qs.forEach(function(t){t.next()})}var di=function(){function n(t,e,i){this.query=t,this.Ks=e,this.Gs=!1,this.zs=null,this.onlineState="Unknown",this.options=i||{}}return n.prototype.Ws=function(t){if(!this.options.includeMetadataChanges){for(var e=[],i=0,s=t.docChanges;i<s.length;i++){var l=s[i];3!==l.type&&e.push(l)}t=new Ft(t.query,t.docs,t.Qt,e,t.Wt,t.fromCache,t.jt,!0)}var f=!1;return this.Gs?this.Hs(t)&&(this.Ks.next(t),f=!0):this.Ys(t,this.onlineState)&&(this.Js(t),f=!0),this.zs=t,f},n.prototype.onError=function(t){this.Ks.error(t)},n.prototype.Qs=function(t){this.onlineState=t;var e=!1;return this.zs&&!this.Gs&&this.Ys(this.zs,t)&&(this.Js(this.zs),e=!0),e},n.prototype.Ys=function(t,e){return!t.fromCache||!(this.options.Xs&&"Offline"!==e||t.docs.m()&&"Offline"!==e)},n.prototype.Hs=function(t){return t.docChanges.length>0||!!(t.jt||this.zs&&this.zs.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},n.prototype.Js=function(t){t=Ft.Gt(t.query,t.docs,t.Wt,t.fromCache),this.Gs=!0,this.Ks.next(t)},n}(),Zn=function(){function n(t){this.uid=t}return n.prototype.Zs=function(){return null!=this.uid},n.prototype.ti=function(){return this.Zs()?"uid:"+this.uid:"anonymous-user"},n.prototype.isEqual=function(t){return t.uid===this.uid},n}();Zn.UNAUTHENTICATED=new Zn(null),Zn.ei=new Zn("google-credentials-uid"),Zn.ni=new Zn("first-party-uid");var ir=function(){function n(t,e){var i=this;this.previousValue=t,e&&(e.si=function(s){return i.ii(s)},this.ri=function(s){return e.oi(s)})}return n.prototype.ii=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},n.prototype.next=function(){var t=++this.previousValue;return this.ri&&this.ri(t),t},n}();function eo(n,t){return"firestore_clients_"+n+"_"+t}function jo(n,t,e){var i="firestore_mutations_"+n+"_"+e;return t.Zs()&&(i+="_"+t.uid),i}function Co(n,t){return"firestore_targets_"+n+"_"+t}ir.ai=-1;var Vo=function(){function n(t,e,i,s){this.user=t,this.batchId=e,this.state=i,this.error=s}return n.ci=function(t,e,i){var s=JSON.parse(i),l="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error),f=void 0;return l&&s.error&&(l="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(f=new ut(s.error.code,s.error.message)),l?new n(t,e,s.state,f):(ge("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+i),null)},n.prototype.ui=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},n}(),Ao=function(){function n(t,e,i){this.targetId=t,this.state=e,this.error=i}return n.ci=function(t,e){var i=JSON.parse(e),s="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),l=void 0;return s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(l=new ut(i.error.code,i.error.message)),s?new n(t,i.state,l):(ge("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},n.prototype.ui=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},n}(),Bo=function(){function n(t,e){this.clientId=t,this.activeTargetIds=e}return n.ci=function(t,e){for(var i=JSON.parse(e),s="object"==typeof i&&i.activeTargetIds instanceof Array,l=Mt(),f=0;s&&f<i.activeTargetIds.length;++f)s=fe(i.activeTargetIds[f]),l=l.add(i.activeTargetIds[f]);return s?new n(t,l):(ge("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},n}(),os=function(){function n(t,e){this.clientId=t,this.onlineState=e}return n.ci=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new n(e.clientId,e.onlineState):(ge("SharedClientState","Failed to parse online state: "+t),null)},n}(),Ro=function(){function n(){this.activeTargetIds=Mt()}return n.prototype.hi=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},n.prototype.li=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},n.prototype.ui=function(){var t={activeTargetIds:this.activeTargetIds.A(),updateTimeMs:Date.now()};return JSON.stringify(t)},n}(),No=function(){function n(t,e,i,s,l){this.window=t,this.fn=e,this.persistenceKey=i,this._i=s,this.fi=null,this.di=null,this.si=null,this.wi=this.mi.bind(this),this.Ti=new Qe(te),this.Ei=!1,this.Ii=[];var f=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=l,this.Ai=eo(this.persistenceKey,this._i),this.Ri="firestore_sequence_number_"+this.persistenceKey,this.Ti=this.Ti.ot(this._i,new Ro),this.gi=new RegExp("^firestore_clients_"+f+"_([^_]*)$"),this.Pi=new RegExp("^firestore_mutations_"+f+"_(\\d+)(?:_(.*))?$"),this.yi=new RegExp("^firestore_targets_"+f+"_(\\d+)$"),this.Vi="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.wi)}return n.Ln=function(t){return!(!t||!t.localStorage)},n.prototype.start=function(){return B.__awaiter(this,void 0,void 0,function(){var t,e,i,s,l,f,d,w,O,U,$=this;return B.__generator(this,function(st){switch(st.label){case 0:return[4,this.fi.pi()];case 1:for(t=st.sent(),e=0,i=t;e<i.length;e++)(s=i[e])!==this._i&&(l=this.getItem(eo(this.persistenceKey,s)))&&(f=Bo.ci(s,l))&&(this.Ti=this.Ti.ot(f.clientId,f));for(this.bi(),(d=this.storage.getItem(this.Vi))&&(w=this.vi(d))&&this.Si(w),O=0,U=this.Ii;O<U.length;O++)this.mi(U[O]);return this.Ii=[],this.window.addEventListener("unload",function(){return $.Di()}),this.Ei=!0,[2]}})})},n.prototype.oi=function(t){this.setItem(this.Ri,JSON.stringify(t))},n.prototype.Ci=function(){return this.Ni(this.Ti)},n.prototype.Fi=function(t){var e=!1;return this.Ti.forEach(function(i,s){s.activeTargetIds.has(t)&&(e=!0)}),e},n.prototype.xi=function(t){this.$i(t,"pending")},n.prototype.ki=function(t,e,i){this.$i(t,e,i),this.Mi(t)},n.prototype.Oi=function(t){var e="not-current";if(this.Fi(t)){var i=this.storage.getItem(Co(this.persistenceKey,t));if(i){var s=Ao.ci(t,i);s&&(e=s.state)}}return this.Li.hi(t),this.bi(),e},n.prototype.Bi=function(t){this.Li.li(t),this.bi()},n.prototype.qi=function(t){return this.Li.activeTargetIds.has(t)},n.prototype.Ui=function(t){this.removeItem(Co(this.persistenceKey,t))},n.prototype.Qi=function(t,e,i){this.Wi(t,e,i)},n.prototype.ji=function(t,e,i){var s=this;e.forEach(function(l){s.Mi(l)}),this.currentUser=t,i.forEach(function(l){s.xi(l)})},n.prototype.Ki=function(t){this.Gi(t)},n.prototype.Di=function(){this.Ei&&(this.window.removeEventListener("storage",this.wi),this.removeItem(this.Ai),this.Ei=!1)},n.prototype.getItem=function(t){var e=this.storage.getItem(t);return Tt("SharedClientState","READ",t,e),e},n.prototype.setItem=function(t,e){Tt("SharedClientState","SET",t,e),this.storage.setItem(t,e)},n.prototype.removeItem=function(t){Tt("SharedClientState","REMOVE",t),this.storage.removeItem(t)},n.prototype.mi=function(t){var e=this,i=t;if(i.storageArea===this.storage){if(Tt("SharedClientState","EVENT",i.key,i.newValue),i.key===this.Ai)return void ge("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.fn.Cs(function(){return B.__awaiter(e,void 0,void 0,function(){var s,l,f,d,w,O;return B.__generator(this,function(U){if(this.Ei){if(null!==i.key)if(this.gi.test(i.key)){if(null==i.newValue)return s=this.zi(i.key),[2,this.Hi(s,null)];if(l=this.Yi(i.key,i.newValue))return[2,this.Hi(l.clientId,l)]}else if(this.Pi.test(i.key)){if(null!==i.newValue&&(f=this.Ji(i.key,i.newValue)))return[2,this.Xi(f)]}else if(this.yi.test(i.key)){if(null!==i.newValue&&(d=this.Zi(i.key,i.newValue)))return[2,this.tr(d)]}else if(i.key===this.Vi){if(null!==i.newValue&&(w=this.vi(i.newValue)))return[2,this.Si(w)]}else i.key===this.Ri&&(O=function(X){var $=ir.ai;if(null!=X)try{var st=JSON.parse(X);Ct("number"==typeof st),$=st}catch(vt){ge("SharedClientState","Failed to read sequence number from WebStorage",vt)}return $}(i.newValue))!==ir.ai&&this.si(O)}else this.Ii.push(i);return[2]})})})}},Object.defineProperty(n.prototype,"Li",{get:function(){return this.Ti.get(this._i)},enumerable:!1,configurable:!0}),n.prototype.bi=function(){this.setItem(this.Ai,this.Li.ui())},n.prototype.$i=function(t,e,i){var s=new Vo(this.currentUser,t,e,i),l=jo(this.persistenceKey,this.currentUser,t);this.setItem(l,s.ui())},n.prototype.Mi=function(t){var e=jo(this.persistenceKey,this.currentUser,t);this.removeItem(e)},n.prototype.Gi=function(t){this.storage.setItem(this.Vi,JSON.stringify({clientId:this._i,onlineState:t}))},n.prototype.Wi=function(t,e,i){var s=Co(this.persistenceKey,t),l=new Ao(t,e,i);this.setItem(s,l.ui())},n.prototype.zi=function(t){var e=this.gi.exec(t);return e?e[1]:null},n.prototype.Yi=function(t,e){var i=this.zi(t);return Bo.ci(i,e)},n.prototype.Ji=function(t,e){var i=this.Pi.exec(t),s=Number(i[1]);return Vo.ci(new Zn(void 0!==i[2]?i[2]:null),s,e)},n.prototype.Zi=function(t,e){var i=this.yi.exec(t),s=Number(i[1]);return Ao.ci(s,e)},n.prototype.vi=function(t){return os.ci(t)},n.prototype.Xi=function(t){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.fi.er(t.batchId,t.state,t.error)]:(Tt("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},n.prototype.tr=function(t){return this.fi.nr(t.targetId,t.state,t.error)},n.prototype.Hi=function(t,e){var i=this,s=e?this.Ti.ot(t,e):this.Ti.remove(t),l=this.Ni(this.Ti),f=this.Ni(s),d=[],w=[];return f.forEach(function(O){l.has(O)||d.push(O)}),l.forEach(function(O){f.has(O)||w.push(O)}),this.fi.sr(d,w).then(function(){i.Ti=s})},n.prototype.Si=function(t){this.Ti.get(t.clientId)&&this.di(t.onlineState)},n.prototype.Ni=function(t){var e=Mt();return t.forEach(function(i,s){e=e.kt(s.activeTargetIds)}),e},n}(),vo=function(){function n(){this.ir=new Ro,this.rr={},this.di=null,this.si=null}return n.prototype.xi=function(t){},n.prototype.ki=function(t,e,i){},n.prototype.Oi=function(t){return this.ir.hi(t),this.rr[t]||"not-current"},n.prototype.Qi=function(t,e,i){this.rr[t]=e},n.prototype.Bi=function(t){this.ir.li(t)},n.prototype.qi=function(t){return this.ir.activeTargetIds.has(t)},n.prototype.Ui=function(t){delete this.rr[t]},n.prototype.Ci=function(){return this.ir.activeTargetIds},n.prototype.Fi=function(t){return this.ir.activeTargetIds.has(t)},n.prototype.start=function(){return this.ir=new Ro,Promise.resolve()},n.prototype.ji=function(t,e,i){},n.prototype.Ki=function(t){},n.prototype.Di=function(){},n.prototype.oi=function(t){},n}(),yo=function(){function n(t,e,i,s){this.batchId=t,this.ar=e,this.baseMutations=i,this.mutations=s}return n.prototype.cr=function(t,e,i){for(var s=i.ur,l=0;l<this.mutations.length;l++){var f=this.mutations[l];f.key.isEqual(t)&&(e=yn(f,e,s[l]))}return e},n.prototype.hr=function(t,e){for(var i=0,s=this.baseMutations;i<s.length;i++){var l=s[i];l.key.isEqual(t)&&(e=Ve(l,e,e,this.ar))}for(var f=e,d=0,w=this.mutations;d<w.length;d++){var O=w[d];O.key.isEqual(t)&&(e=Ve(O,e,f,this.ar))}return e},n.prototype.lr=function(t){var e=this,i=t;return this.mutations.forEach(function(s){var l=e.hr(s.key,t.get(s.key));l&&(i=i.ot(s.key,l))}),i},n.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},dt())},n.prototype.isEqual=function(t){return this.batchId===t.batchId&&_e(this.mutations,t.mutations,function(e,i){return rn(e,i)})&&_e(this.baseMutations,t.baseMutations,function(e,i){return rn(e,i)})},n}(),a=function(){function n(t,e,i,s){this.batch=t,this._r=e,this.ur=i,this.dr=s}return n.from=function(t,e,i){Ct(t.mutations.length===i.length);for(var s=at,l=t.mutations,f=0;f<l.length;f++)s=s.ot(l[f].key,i[f].version);return new n(t,e,i,s)},n}(),r=function(){function n(){this.wr=new qe(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.mr=!1}return Object.defineProperty(n.prototype,"readTime",{get:function(){return this.Tr},set:function(t){this.Tr=t},enumerable:!1,configurable:!0}),n.prototype.Er=function(t,e){this.Ir(),this.readTime=e,this.wr.set(t.key,t)},n.prototype.Ar=function(t,e){this.Ir(),e&&(this.readTime=e),this.wr.set(t,null)},n.prototype.Rr=function(t,e){this.Ir();var i=this.wr.get(e);return void 0!==i?Wt.resolve(i):this.gr(t,e)},n.prototype.getEntries=function(t,e){return this.Pr(t,e)},n.prototype.apply=function(t){return this.Ir(),this.mr=!0,this.yr(t)},n.prototype.Ir=function(){},n}(),o="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",c=function(){function n(){this.Vr=[]}return n.prototype.pr=function(t){this.Vr.push(t)},n.prototype.br=function(){this.Vr.forEach(function(t){return t()})},n}(),h=function(){function n(t,e,i){this.vr=t,this.Sr=e,this.Dr=i}return n.prototype.Cr=function(t,e){var i=this;return this.Sr.Nr(t,e).next(function(s){return i.Fr(t,e,s)})},n.prototype.Fr=function(t,e,i){return this.vr.Rr(t,e).next(function(s){for(var l=0,f=i;l<f.length;l++)s=f[l].hr(e,s);return s})},n.prototype.$r=function(t,e,i){var s=Hn();return e.forEach(function(l,f){for(var d=0,w=i;d<w.length;d++)f=w[d].hr(l,f);s=s.ot(l,f)}),s},n.prototype.kr=function(t,e){var i=this;return this.vr.getEntries(t,e).next(function(s){return i.Mr(t,s)})},n.prototype.Mr=function(t,e){var i=this;return this.Sr.Or(t,e).next(function(s){var l=i.$r(t,e,s),f=xn();return l.forEach(function(d,w){w||(w=new Ln(d,we.min())),f=f.ot(d,w)}),f})},n.prototype.Lr=function(t,e,i){return b.F((s=e).path)&&null===s.collectionGroup&&0===s.filters.length?this.Br(t,e.path):Cr(e)?this.qr(t,e,i):this.Ur(t,e,i);var s},n.prototype.Br=function(t,e){return this.Cr(t,new b(e)).next(function(i){var s=it();return i instanceof Ze&&(s=s.ot(i.key,i)),s})},n.prototype.qr=function(t,e,i){var s=this,l=e.collectionGroup,f=it();return this.Dr.Qr(t,l).next(function(d){return Wt.forEach(d,function(w){var U,X,O=(U=e,X=w.child(l),new xr(X,null,U.on.slice(),U.filters.slice(),U.limit,U.an,U.startAt,U.endAt));return s.Ur(t,O,i).next(function(U){U.forEach(function(X,$){f=f.ot(X,$)})})}).next(function(){return f})})},n.prototype.Ur=function(t,e,i){var s,l,f=this;return this.vr.Lr(t,e,i).next(function(d){return s=d,f.Sr.Wr(t,e)}).next(function(d){return f.jr(t,l=d,s).next(function(w){s=w;for(var O=0,U=l;O<U.length;O++)for(var X=U[O],$=0,st=X.mutations;$<st.length;$++){var vt=st[$],Et=vt.key,ce=s.get(Et),oe=Ve(vt,ce,ce,X.ar);s=oe instanceof Ze?s.ot(Et,oe):s.remove(Et)}})}).next(function(){return s.forEach(function(d,w){kr(e,w)||(s=s.remove(d))}),s})},n.prototype.jr=function(t,e,i){for(var s=dt(),l=0,f=e;l<f.length;l++)for(var d=0,w=f[l].mutations;d<w.length;d++){var O=w[d];O instanceof dn&&null===i.get(O.key)&&(s=s.add(O.key))}var U=i;return this.vr.getEntries(t,s).next(function(X){return X.forEach(function($,st){null!==st&&st instanceof Ze&&(U=U.ot($,st))}),U})},n}(),p=function(){function n(t,e,i,s){this.targetId=t,this.fromCache=e,this.Kr=i,this.Gr=s}return n.zr=function(t,e){for(var i=dt(),s=dt(),l=0,f=e.docChanges;l<f.length;l++){var d=f[l];switch(d.type){case 0:i=i.add(d.doc.key);break;case 1:s=s.add(d.doc.key)}}return new n(t,e.fromCache,i,s)},n}();function I(n,t){var i=n[1],l=t[1],f=te(n[0],t[0]);return 0===f?te(i,l):f}var R=function(){function n(t){this.Hr=t,this.buffer=new Je(I),this.Yr=0}return n.prototype.Jr=function(){return++this.Yr},n.prototype.Xr=function(t){var e=[t,this.Jr()];if(this.buffer.size<this.Hr)this.buffer=this.buffer.add(e);else{var i=this.buffer.last();I(e,i)<0&&(this.buffer=this.buffer.delete(i).add(e))}},Object.defineProperty(n.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),n}(),F={Zr:!1,eo:0,no:0,so:0},k=function(){function n(t,e,i){this.io=t,this.ro=e,this.oo=i}return n.ao=function(t){return new n(t,n.co,n.uo)},n}();k.ho=-1,k.lo=1048576,k._o=41943040,k.co=10,k.uo=1e3,k.fo=new k(k._o,k.co,k.uo),k.do=new k(k.ho,0,0);var ot=function(){function n(t,e){this.wo=t,this.cs=e,this.mo=!1,this.To=null}return n.prototype.start=function(t){this.wo.params.io!==k.ho&&this.Eo(t)},n.prototype.stop=function(){this.To&&(this.To.cancel(),this.To=null)},Object.defineProperty(n.prototype,"Ei",{get:function(){return null!==this.To},enumerable:!1,configurable:!0}),n.prototype.Eo=function(t){var e=this,i=this.mo?3e5:6e4;Tt("LruGarbageCollector","Garbage collection scheduled in "+i+"ms"),this.To=this.cs.yn("lru_garbage_collection",i,function(){return B.__awaiter(e,void 0,void 0,function(){var s;return B.__generator(this,function(l){switch(l.label){case 0:this.To=null,this.mo=!0,l.label=1;case 1:return l.trys.push([1,3,,7]),[4,t.Io(this.wo)];case 2:return l.sent(),[3,7];case 3:return Hr(s=l.sent())?(Tt("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",s),[3,6]):[3,4];case 4:return[4,ro(s)];case 5:l.sent(),l.label=6;case 6:return[3,7];case 7:return[4,this.Eo(t)];case 8:return l.sent(),[2]}})})})},n}(),pt=function(){function n(t,e){this.Ao=t,this.params=e}return n.prototype.Ro=function(t,e){return this.Ao.Po(t).next(function(i){return Math.floor(e/100*i)})},n.prototype.yo=function(t,e){var i=this;if(0===e)return Wt.resolve(ir.ai);var s=new R(e);return this.Ao.Ce(t,function(l){return s.Xr(l.sequenceNumber)}).next(function(){return i.Ao.Vo(t,function(l){return s.Xr(l)})}).next(function(){return s.maxValue})},n.prototype.po=function(t,e,i){return this.Ao.po(t,e,i)},n.prototype.bo=function(t,e){return this.Ao.bo(t,e)},n.prototype.vo=function(t,e){var i=this;return this.params.io===k.ho?(Tt("LruGarbageCollector","Garbage collection skipped; disabled"),Wt.resolve(F)):this.So(t).next(function(s){return s<i.params.io?(Tt("LruGarbageCollector","Garbage collection skipped; Cache size "+s+" is lower than threshold "+i.params.io),F):i.Do(t,e)})},n.prototype.So=function(t){return this.Ao.So(t)},n.prototype.Do=function(t,e){var i,s,l,f,d,w,O,U=this,X=Date.now();return this.Ro(t,this.params.ro).next(function($){return $>U.params.oo?(Tt("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+U.params.oo+" from "+$),s=U.params.oo):s=$,f=Date.now(),U.yo(t,s)}).next(function($){return i=$,d=Date.now(),U.po(t,i,e)}).next(function($){return l=$,w=Date.now(),U.bo(t,i)}).next(function($){return O=Date.now(),ee()<=D.LogLevel.DEBUG&&Tt("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(f-X)+"ms\n\tDetermined least recently used "+s+" in "+(d-f)+"ms\n\tRemoved "+l+" targets in "+(w-d)+"ms\n\tRemoved "+$+" documents in "+(O-w)+"ms\nTotal Duration: "+(O-X)+"ms"),Wt.resolve({Zr:!0,eo:s,no:l,so:$})})},n}();function _t(n){for(var t="",e=0;e<n.length;e++)t.length>0&&(t=$t(t)),t=Ut(n.get(e),t);return $t(t)}function Ut(n,t){for(var e=t,i=n.length,s=0;s<i;s++){var l=n.charAt(s);switch(l){case"\0":e+="\x01\x10";break;case"\x01":e+="\x01\x11";break;default:e+=l}}return e}function $t(n){return n+"\x01\x01"}function Zt(n){var t=n.length;if(Ct(t>=2),2===t)return Ct("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),At.P();for(var e=t-2,i=[],s="",l=0;l<t;){var f=n.indexOf("\x01",l);switch((f<0||f>e)&&ct(),n.charAt(f+1)){case"\x01":var d=n.substring(l,f),w=void 0;0===s.length?w=d:(w=s+=d,s=""),i.push(w);break;case"\x10":s+=n.substring(l,f),s+="\0";break;case"\x11":s+=n.substring(l,f+1);break;default:ct()}l=f+2}return new At(i)}var He=function(n){this.Co=n};function ze(n,t){if(t.document)return w=!!t.hasCommittedMutations,O=$n(n.Co,(d=t.document).name),U=tr(d.updateTime),X=new qr({mapValue:{fields:d.fields}}),new Ze(O,U,X,{hasCommittedMutations:!!w});var d,w,O,U,X;if(t.noDocument){var e=b.$(t.noDocument.path),i=Fi(t.noDocument.readTime);return new Ln(e,i,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){var s=b.$(t.unknownDocument.path),l=Fi(t.unknownDocument.version);return new Oi(s,l)}return ct()}function lr(n,t,e){var $,st,i=yr(e),s=t.key.path.h().A();if(t instanceof Ze){var l={name:qn($=n.Co,(st=t).key),fields:st.rn().mapValue.fields,updateTime:Qr($,st.version.Z())};return new Vn(null,null,l,t.hasCommittedMutations,i,s)}if(t instanceof Ln){var d=t.key.path.A(),w=zr(t.version),O=t.hasCommittedMutations;return new Vn(null,new Ua(d,w),null,O,i,s)}if(t instanceof Oi){var U=t.key.path.A(),X=zr(t.version);return new Vn(new ja(U,X),null,null,!0,i,s)}return ct()}function yr(n){var t=n.Z();return[t.seconds,t.nanoseconds]}function vi(n){var t=new Ce(n[0],n[1]);return we.J(t)}function zr(n){var t=n.Z();return new Fa(t.seconds,t.nanoseconds)}function Fi(n){var t=new Ce(n.seconds,n.nanoseconds);return we.J(t)}function Ui(n,t){var e=(t.baseMutations||[]).map(function(l){return cr(n.Co,l)}),i=t.mutations.map(function(l){return cr(n.Co,l)}),s=Ce.fromMillis(t.localWriteTimeMs);return new yo(t.batchId,s,e,i)}function Oo(n){var t,e,i=Fi(n.readTime),s=void 0!==n.lastLimboFreeSnapshotVersion?Fi(n.lastLimboFreeSnapshotVersion):we.min();return void 0!==n.query.documents?(Ct(1===(e=n.query).documents.length),t=Un(Wr(ai(e.documents[0])))):t=_r(n.query),new ln(t,n.targetId,0,n.lastListenSequenceNumber,i,s,le.fromBase64String(n.resumeToken))}function Fs(n,t){var e,i=zr(t.nt),s=zr(t.lastLimboFreeSnapshotVersion);e=Pe(t.target)?Tn(n.Co,t.target):ui(n.Co,t.target);var l=t.resumeToken.toBase64();return new Or(t.targetId,Ke(t.target),i,l,t.sequenceNumber,s,e)}var Da=function(){function n(t,e,i,s){this.userId=t,this.serializer=e,this.Dr=i,this.No=s,this.Fo={}}return n.xo=function(t,e,i,s){return Ct(""!==t.uid),new n(t.Zs()?t.uid:"",e,i,s)},n.prototype.$o=function(t){var e=!0,i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ji(t).rs({index:On.userMutationsIndex,range:i},function(s,l,f){e=!1,f.done()}).next(function(){return e})},n.prototype.ko=function(t,e,i,s){var l=this,f=go(t),d=ji(t);return d.add({}).next(function(w){Ct("number"==typeof w);for(var O=new yo(w,e,i,s),U=function(oe,Ie,Me){var tn=Me.baseMutations.map(function(Pn){return ur(oe.Co,Pn)}),mn=Me.mutations.map(function(Pn){return ur(oe.Co,Pn)});return new On(Ie,Me.batchId,Me.ar.toMillis(),tn,mn)}(l.serializer,l.userId,O),X=[],$=new Je(function(oe,Ie){return te(oe.R(),Ie.R())}),st=0,vt=s;st<vt.length;st++){var Et=vt[st],ce=gr.key(l.userId,Et.key.path,w);$=$.add(Et.key.path.h()),X.push(d.put(U)),X.push(f.put(ce,gr.PLACEHOLDER))}return $.forEach(function(oe){X.push(l.Dr.Mo(t,oe))}),t.pr(function(){l.Fo[w]=O.keys()}),Wt.$n(X).next(function(){return O})})},n.prototype.Oo=function(t,e){var i=this;return ji(t).get(e).next(function(s){return s?(Ct(s.userId===i.userId),Ui(i.serializer,s)):null})},n.prototype.Lo=function(t,e){var i=this;return this.Fo[e]?Wt.resolve(this.Fo[e]):this.Oo(t,e).next(function(s){if(s){var l=s.keys();return i.Fo[e]=l,l}return null})},n.prototype.Bo=function(t,e){var i=this,s=e+1,l=IDBKeyRange.lowerBound([this.userId,s]),f=null;return ji(t).rs({index:On.userMutationsIndex,range:l},function(d,w,O){w.userId===i.userId&&(Ct(w.batchId>=s),f=Ui(i.serializer,w)),O.done()}).next(function(){return f})},n.prototype.qo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),i=-1;return ji(t).rs({index:On.userMutationsIndex,range:e,reverse:!0},function(s,l,f){i=l.batchId,f.done()}).next(function(){return i})},n.prototype.Uo=function(t){var e=this,i=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ji(t).ts(On.userMutationsIndex,i).next(function(s){return s.map(function(l){return Ui(e.serializer,l)})})},n.prototype.Nr=function(t,e){var i=this,s=gr.prefixForPath(this.userId,e.path),l=IDBKeyRange.lowerBound(s),f=[];return go(t).rs({range:l},function(d,w,O){var U=d[0],$=d[2],st=Zt(d[1]);if(U===i.userId&&e.path.isEqual(st))return ji(t).get($).next(function(vt){if(!vt)throw ct();Ct(vt.userId===i.userId),f.push(Ui(i.serializer,vt))});O.done()}).next(function(){return f})},n.prototype.Or=function(t,e){var i=this,s=new Je(te),l=[];return e.forEach(function(f){var d=gr.prefixForPath(i.userId,f.path),w=IDBKeyRange.lowerBound(d),O=go(t).rs({range:w},function(U,X,$){var st=U[0],Et=U[2],ce=Zt(U[1]);st===i.userId&&f.path.isEqual(ce)?s=s.add(Et):$.done()});l.push(O)}),Wt.$n(l).next(function(){return i.Qo(t,s)})},n.prototype.Wr=function(t,e){var i=this,s=e.path,l=s.length+1,f=gr.prefixForPath(this.userId,s),d=IDBKeyRange.lowerBound(f),w=new Je(te);return go(t).rs({range:d},function(O,U,X){var $=O[0],vt=O[2],Et=Zt(O[1]);$===i.userId&&s.T(Et)?Et.length===l&&(w=w.add(vt)):X.done()}).next(function(){return i.Qo(t,w)})},n.prototype.Qo=function(t,e){var i=this,s=[],l=[];return e.forEach(function(f){l.push(ji(t).get(f).next(function(d){if(null===d)throw ct();Ct(d.userId===i.userId),s.push(Ui(i.serializer,d))}))}),Wt.$n(l).next(function(){return s})},n.prototype.Wo=function(t,e){var i=this;return js(t.jo,this.userId,e).next(function(s){return t.pr(function(){i.Ko(e.batchId)}),Wt.forEach(s,function(l){return i.No.Go(t,l)})})},n.prototype.Ko=function(t){delete this.Fo[t]},n.prototype.zo=function(t){var e=this;return this.$o(t).next(function(i){if(!i)return Wt.resolve();var s=IDBKeyRange.lowerBound(gr.prefixForUser(e.userId)),l=[];return go(t).rs({range:s},function(f,d,w){if(f[0]===e.userId){var O=Zt(f[1]);l.push(O)}else w.done()}).next(function(){Ct(0===l.length)})})},n.prototype.Ho=function(t,e){return Us(t,this.userId,e)},n.prototype.Yo=function(t){var e=this;return Vs(t).get(this.userId).next(function(i){return i||new Bi(e.userId,-1,"")})},n}();function Us(n,t,e){var i=gr.prefixForPath(t,e.path),s=i[1],l=IDBKeyRange.lowerBound(i),f=!1;return go(n).rs({range:l,ss:!0},function(d,w,O){d[0]===t&&d[1]===s&&(f=!0),O.done()}).next(function(){return f})}function js(n,t,e){var i=n.store(On.store),s=n.store(gr.store),l=[],f=IDBKeyRange.only(e.batchId),d=0,w=i.rs({range:f},function(vt,Et,ce){return d++,ce.delete()});l.push(w.next(function(){Ct(1===d)}));for(var O=[],U=0,X=e.mutations;U<X.length;U++){var $=X[U],st=gr.key(t,$.key.path,e.batchId);l.push(s.delete(st)),O.push($.key)}return Wt.$n(l).next(function(){return O})}function ji(n){return Kr.Qn(n,On.store)}function go(n){return Kr.Qn(n,gr.store)}function Vs(n){return Kr.Qn(n,Bi.store)}var xa=function(){function n(t,e){this.serializer=t,this.Dr=e}return n.prototype.Er=function(t,e,i){return Vi(t).put(qo(e),i)},n.prototype.Ar=function(t,e){var i=Vi(t),s=qo(e);return i.delete(s)},n.prototype.updateMetadata=function(t,e){var i=this;return this.getMetadata(t).next(function(s){return s.byteSize+=e,i.Jo(t,s)})},n.prototype.Rr=function(t,e){var i=this;return Vi(t).get(qo(e)).next(function(s){return i.Xo(s)})},n.prototype.Zo=function(t,e){var i=this;return Vi(t).get(qo(e)).next(function(s){var l=i.Xo(s);return l?{ta:l,size:Go(s)}:null})},n.prototype.getEntries=function(t,e){var i=this,s=Hn();return this.ea(t,e,function(l,f){var d=i.Xo(f);s=s.ot(l,d)}).next(function(){return s})},n.prototype.na=function(t,e){var i=this,s=Hn(),l=new Qe(b.i);return this.ea(t,e,function(f,d){var w=i.Xo(d);w?(s=s.ot(f,w),l=l.ot(f,Go(d))):(s=s.ot(f,null),l=l.ot(f,0))}).next(function(){return{sa:s,ia:l}})},n.prototype.ea=function(t,e,i){if(e.m())return Wt.resolve();var s=IDBKeyRange.bound(e.first().path.A(),e.last().path.A()),l=e._t(),f=l.It();return Vi(t).rs({range:s},function(d,w,O){for(var U=b.$(d);f&&b.i(f,U)<0;)i(f,null),f=l.It();f&&f.isEqual(U)&&(i(f,w),f=l.At()?l.It():null),f?O.Xn(f.path.A()):O.done()}).next(function(){for(;f;)i(f,null),f=l.At()?l.It():null})},n.prototype.Lr=function(t,e,i){var s=this,l=it(),f=e.path.length+1,d={};if(i.isEqual(we.min())){var w=e.path.A();d.range=IDBKeyRange.lowerBound(w)}else{var O=e.path.A(),U=yr(i);d.range=IDBKeyRange.lowerBound([O,U],!0),d.index=Vn.collectionReadTimeIndex}return Vi(t).rs(d,function(X,$,st){if(X.length===f){var vt=ze(s.serializer,$);e.path.T(vt.key.path)?vt instanceof Ze&&kr(e,vt)&&(l=l.ot(vt.key,vt)):st.done()}}).next(function(){return l})},n.prototype.ra=function(t){return new La(this,!!t&&t.oa)},n.prototype.aa=function(t){return this.getMetadata(t).next(function(e){return e.byteSize})},n.prototype.getMetadata=function(t){return Bs(t).get(yi.key).next(function(e){return Ct(!!e),e})},n.prototype.Jo=function(t,e){return Bs(t).put(yi.key,e)},n.prototype.Xo=function(t){if(t){var e=ze(this.serializer,t);return e instanceof Ln&&e.version.isEqual(we.min())?null:e}return null},n}(),La=function(n){function t(e,i){var s=this;return(s=n.call(this)||this).ca=e,s.oa=i,s.ua=new qe(function(l){return l.toString()},function(l,f){return l.isEqual(f)}),s}return B.__extends(t,n),t.prototype.yr=function(e){var i=this,s=[],l=0,f=new Je(function(d,w){return te(d.R(),w.R())});return this.wr.forEach(function(d,w){var O=i.ua.get(d);if(w){var U=lr(i.ca.serializer,w,i.readTime);f=f.add(d.path.h());var X=Go(U);l+=X-O,s.push(i.ca.Er(e,d,U))}else if(l-=O,i.oa){var $=lr(i.ca.serializer,new Ln(d,we.min()),i.readTime);s.push(i.ca.Er(e,d,$))}else s.push(i.ca.Ar(e,d))}),f.forEach(function(d){s.push(i.ca.Dr.Mo(e,d))}),s.push(this.ca.updateMetadata(e,l)),Wt.$n(s)},t.prototype.gr=function(e,i){var s=this;return this.ca.Zo(e,i).next(function(l){return null===l?(s.ua.set(i,0),null):(s.ua.set(i,l.size),l.ta)})},t.prototype.Pr=function(e,i){var s=this;return this.ca.na(e,i).next(function(l){var f=l.sa;return l.ia.forEach(function(d,w){s.ua.set(d,w)}),f})},t}(r);function Bs(n){return Kr.Qn(n,yi.store)}function Vi(n){return Kr.Qn(n,Vn.store)}function qo(n){return n.path.A()}function Go(n){var t;if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw ct();t=n.noDocument}return JSON.stringify(t).length}var ka=function(){function n(){this.ha=new ss}return n.prototype.Mo=function(t,e){return this.ha.add(e),Wt.resolve()},n.prototype.Qr=function(t,e){return Wt.resolve(this.ha.getEntries(e))},n}(),ss=function(){function n(){this.index={}}return n.prototype.add=function(t){var e=t._(),i=t.h(),s=this.index[e]||new Je(At.i),l=!s.has(i);return this.index[e]=s.add(i),l},n.prototype.has=function(t){var e=t._(),i=t.h(),s=this.index[e];return s&&s.has(i)},n.prototype.getEntries=function(t){return(this.index[t]||new Je(At.i)).A()},n}(),Ma=function(){function n(t){this.serializer=t}return n.prototype.createOrUpgrade=function(t,e,i,s){var l=this;Ct(i<s&&i>=0&&s<=10);var w,f=new dr("createOrUpgrade",e);i<1&&s>=1&&(t.createObjectStore(Mr.store),(w=t).createObjectStore(Bi.store,{keyPath:Bi.keyPath}),w.createObjectStore(On.store,{keyPath:On.keyPath,autoIncrement:!0}).createIndex(On.userMutationsIndex,On.userMutationsKeyPath,{unique:!0}),w.createObjectStore(gr.store),qs(t),function(w){w.createObjectStore(Vn.store)}(t));var d=Wt.resolve();return i<3&&s>=3&&(0!==i&&(function(w){w.deleteObjectStore(fr.store),w.deleteObjectStore(Or.store),w.deleteObjectStore(Fr.store)}(t),qs(t)),d=d.next(function(){return function(w){var O=w.store(Fr.store),U=new Fr(0,0,we.min().Z(),0);return O.put(Fr.key,U)}(f)})),i<4&&s>=4&&(0!==i&&(d=d.next(function(){return function(w,O){return O.store(On.store).ts().next(function(U){w.deleteObjectStore(On.store),w.createObjectStore(On.store,{keyPath:On.keyPath,autoIncrement:!0}).createIndex(On.userMutationsIndex,On.userMutationsKeyPath,{unique:!0});var X=O.store(On.store),$=U.map(function(st){return X.put(st)});return Wt.$n($)})}(t,f)})),d=d.next(function(){!function(w){w.createObjectStore(Ai.store,{keyPath:Ai.keyPath})}(t)})),i<5&&s>=5&&(d=d.next(function(){return l.removeAcknowledgedMutations(f)})),i<6&&s>=6&&(d=d.next(function(){return function(w){w.createObjectStore(yi.store)}(t),l.addDocumentGlobal(f)})),i<7&&s>=7&&(d=d.next(function(){return l.ensureSequenceNumbers(f)})),i<8&&s>=8&&(d=d.next(function(){return l.createCollectionParentIndex(t,f)})),i<9&&s>=9&&(d=d.next(function(){(function(w){w.objectStoreNames.contains("remoteDocumentChanges")&&w.deleteObjectStore("remoteDocumentChanges")})(t),function(w){var O=w.objectStore(Vn.store);O.createIndex(Vn.readTimeIndex,Vn.readTimeIndexPath,{unique:!1}),O.createIndex(Vn.collectionReadTimeIndex,Vn.collectionReadTimeIndexPath,{unique:!1})}(e)})),i<10&&s>=10&&(d=d.next(function(){return l.rewriteCanonicalIds(f)})),d},n.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Vn.store).rs(function(i,s){e+=Go(s)}).next(function(){var i=new yi(e);return t.store(yi.store).put(yi.key,i)})},n.prototype.removeAcknowledgedMutations=function(t){var e=this,i=t.store(Bi.store),s=t.store(On.store);return i.ts().next(function(l){return Wt.forEach(l,function(f){var d=IDBKeyRange.bound([f.userId,-1],[f.userId,f.lastAcknowledgedBatchId]);return s.ts(On.userMutationsIndex,d).next(function(w){return Wt.forEach(w,function(O){Ct(O.userId===f.userId);var U=Ui(e.serializer,O);return js(t,f.userId,U).next(function(){})})})})})},n.prototype.ensureSequenceNumbers=function(t){var e=t.store(fr.store),i=t.store(Vn.store);return t.store(Fr.store).get(Fr.key).next(function(s){var l=[];return i.rs(function(f,d){var w=new At(f),O=[0,_t(w)];l.push(e.get(O).next(function(U){return U?Wt.resolve():e.put(new fr(0,_t(w),s.highestListenSequenceNumber))}))}).next(function(){return Wt.$n(l)})})},n.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(no.store,{keyPath:no.keyPath});var i=e.store(no.store),s=new ss,l=function(f){if(s.add(f)){var d=f._(),w=f.h();return i.put({collectionId:d,parent:_t(w)})}};return e.store(Vn.store).rs({ss:!0},function(f,d){var w=new At(f);return l(w.h())}).next(function(){return e.store(gr.store).rs({ss:!0},function(f,d){var O=Zt(f[1]);return l(O.h())})})},n.prototype.rewriteCanonicalIds=function(t){var e=this,i=t.store(Or.store);return i.rs(function(s,l){var f=Oo(l),d=Fs(e.serializer,f);return i.put(d)})},n}(),Fa=function(n,t){this.seconds=n,this.nanoseconds=t},Mr=function(n,t,e){this.ownerId=n,this.allowTabSynchronization=t,this.leaseTimestampMs=e};Mr.store="owner",Mr.key="owner";var Bi=function(n,t,e){this.userId=n,this.lastAcknowledgedBatchId=t,this.lastStreamToken=e};Bi.store="mutationQueues",Bi.keyPath="userId";var On=function(n,t,e,i,s){this.userId=n,this.batchId=t,this.localWriteTimeMs=e,this.baseMutations=i,this.mutations=s};On.store="mutations",On.keyPath="batchId",On.userMutationsIndex="userMutationsIndex",On.userMutationsKeyPath=["userId","batchId"];var gr=function(){function n(){}return n.prefixForUser=function(t){return[t]},n.prefixForPath=function(t,e){return[t,_t(e)]},n.key=function(t,e,i){return[t,_t(e),i]},n}();gr.store="documentMutations",gr.PLACEHOLDER=new gr;var Ua=function(n,t){this.path=n,this.readTime=t},ja=function(n,t){this.path=n,this.version=t},Vn=function(n,t,e,i,s,l){this.unknownDocument=n,this.noDocument=t,this.document=e,this.hasCommittedMutations=i,this.readTime=s,this.parentPath=l};Vn.store="remoteDocuments",Vn.readTimeIndex="readTimeIndex",Vn.readTimeIndexPath="readTime",Vn.collectionReadTimeIndex="collectionReadTimeIndex",Vn.collectionReadTimeIndexPath=["parentPath","readTime"];var yi=function(n){this.byteSize=n};yi.store="remoteDocumentGlobal",yi.key="remoteDocumentGlobalKey";var Or=function(n,t,e,i,s,l,f){this.targetId=n,this.canonicalId=t,this.readTime=e,this.resumeToken=i,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=l,this.query=f};Or.store="targets",Or.keyPath="targetId",Or.queryTargetsIndexName="queryTargetsIndex",Or.queryTargetsKeyPath=["canonicalId","targetId"];var fr=function(n,t,e){this.targetId=n,this.path=t,this.sequenceNumber=e};fr.store="targetDocuments",fr.keyPath=["targetId","path"],fr.documentTargetsIndex="documentTargetsIndex",fr.documentTargetsKeyPath=["path","targetId"];var Fr=function(n,t,e,i){this.highestTargetId=n,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=e,this.targetCount=i};Fr.key="targetGlobalKey",Fr.store="targetGlobal";var no=function(n,t){this.collectionId=n,this.parent=t};function qs(n){n.createObjectStore(fr.store,{keyPath:fr.keyPath}).createIndex(fr.documentTargetsIndex,fr.documentTargetsKeyPath,{unique:!0}),n.createObjectStore(Or.store,{keyPath:Or.keyPath}).createIndex(Or.queryTargetsIndexName,Or.queryTargetsKeyPath,{unique:!0}),n.createObjectStore(Fr.store)}no.store="collectionParents",no.keyPath=["collectionId","parent"];var Ai=function(n,t,e,i){this.clientId=n,this.updateTimeMs=t,this.networkEnabled=e,this.inForeground=i};Ai.store="clientMetadata",Ai.keyPath="clientId";var Va=B.__spreadArrays(B.__spreadArrays(B.__spreadArrays([Bi.store,On.store,gr.store,Vn.store,Or.store,Mr.store,Fr.store,fr.store],[Ai.store]),[yi.store]),[no.store]),Ba=function(){function n(){this.la=new ss}return n.prototype.Mo=function(t,e){var i=this;if(!this.la.has(e)){var s=e._(),l=e.h();t.pr(function(){i.la.add(e)});var f={collectionId:s,parent:_t(l)};return Gs(t).put(f)}return Wt.resolve()},n.prototype.Qr=function(t,e){var i=[],s=IDBKeyRange.bound([e,""],[vn(e),""],!1,!0);return Gs(t).ts(s).next(function(l){for(var f=0,d=l;f<d.length;f++){var w=d[f];if(w.collectionId!==e)break;i.push(Zt(w.parent))}return i})},n}();function Gs(n){return Kr.Qn(n,no.store)}var Wo=function(){function n(t){this._a=t}return n.prototype.next=function(){return this._a+=2,this._a},n.fa=function(){return new n(0)},n.da=function(){return new n(-1)},n}(),qa=function(){function n(t,e){this.No=t,this.serializer=e}return n.prototype.wa=function(t){var e=this;return this.ma(t).next(function(i){var s=new Wo(i.highestTargetId);return i.highestTargetId=s.next(),e.Ta(t,i).next(function(){return i.highestTargetId})})},n.prototype.Ea=function(t){return this.ma(t).next(function(e){return we.J(new Ce(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))})},n.prototype.Ia=function(t){return this.ma(t).next(function(e){return e.highestListenSequenceNumber})},n.prototype.Aa=function(t,e,i){var s=this;return this.ma(t).next(function(l){return l.highestListenSequenceNumber=e,i&&(l.lastRemoteSnapshotVersion=i.Z()),e>l.highestListenSequenceNumber&&(l.highestListenSequenceNumber=e),s.Ta(t,l)})},n.prototype.Ra=function(t,e){var i=this;return this.ga(t,e).next(function(){return i.ma(t).next(function(s){return s.targetCount+=1,i.Pa(e,s),i.Ta(t,s)})})},n.prototype.ya=function(t,e){return this.ga(t,e)},n.prototype.Va=function(t,e){var i=this;return this.pa(t,e.targetId).next(function(){return mo(t).delete(e.targetId)}).next(function(){return i.ma(t)}).next(function(s){return Ct(s.targetCount>0),s.targetCount-=1,i.Ta(t,s)})},n.prototype.po=function(t,e,i){var s=this,l=0,f=[];return mo(t).rs(function(d,w){var O=Oo(w);O.sequenceNumber<=e&&null===i.get(O.targetId)&&(l++,f.push(s.Va(t,O)))}).next(function(){return Wt.$n(f)}).next(function(){return l})},n.prototype.Ce=function(t,e){return mo(t).rs(function(i,s){var l=Oo(s);e(l)})},n.prototype.ma=function(t){return Ws(t).get(Fr.key).next(function(e){return Ct(null!==e),e})},n.prototype.Ta=function(t,e){return Ws(t).put(Fr.key,e)},n.prototype.ga=function(t,e){return mo(t).put(Fs(this.serializer,e))},n.prototype.Pa=function(t,e){var i=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,i=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,i=!0),i},n.prototype.ba=function(t){return this.ma(t).next(function(e){return e.targetCount})},n.prototype.va=function(t,e){var i=Ke(e),s=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]),l=null;return mo(t).rs({range:s,index:Or.queryTargetsIndexName},function(f,d,w){var O=Oo(d);Ge(e,O.target)&&(l=O,w.done())}).next(function(){return l})},n.prototype.Sa=function(t,e,i){var s=this,l=[],f=qi(t);return e.forEach(function(d){var w=_t(d.path);l.push(f.put(new fr(i,w))),l.push(s.No.Da(t,i,d))}),Wt.$n(l)},n.prototype.Ca=function(t,e,i){var s=this,l=qi(t);return Wt.forEach(e,function(f){var d=_t(f.path);return Wt.$n([l.delete([i,d]),s.No.Na(t,i,f)])})},n.prototype.pa=function(t,e){var i=qi(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return i.delete(s)},n.prototype.Fa=function(t,e){var i=IDBKeyRange.bound([e],[e+1],!1,!0),s=qi(t),l=dt();return s.rs({range:i,ss:!0},function(f,d,w){var O=Zt(f[1]),U=new b(O);l=l.add(U)}).next(function(){return l})},n.prototype.Ho=function(t,e){var i=_t(e.path),s=IDBKeyRange.bound([i],[vn(i)],!1,!0),l=0;return qi(t).rs({index:fr.documentTargetsIndex,ss:!0,range:s},function(f,d,w){0!==f[0]&&(l++,w.done())}).next(function(){return l>0})},n.prototype.Ue=function(t,e){return mo(t).get(e).next(function(i){return i?Oo(i):null})},n}();function mo(n){return Kr.Qn(n,Or.store)}function Ws(n){return Kr.Qn(n,Fr.store)}function qi(n){return Kr.Qn(n,fr.store)}var as="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",us=function(n){function t(e,i){var s=this;return(s=n.call(this)||this).jo=e,s.xa=i,s}return B.__extends(t,n),t}(c),Kr=function(){function n(t,e,i,s,l,f,d,w,O,U){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=i,this.fn=l,this.window=f,this.document=d,this.$a=O,this.ka=U,this.Ma=null,this.Oa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.La=null,this.inForeground=!1,this.Ba=null,this.qa=null,this.Ua=Number.NEGATIVE_INFINITY,this.Qa=function(X){return Promise.resolve()},!n.Ln())throw new ut(J.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.No=new Ga(this,s),this.Wa=e+"main",this.serializer=new He(w),this.ja=new un(this.Wa,10,new Ma(this.serializer)),this.Ka=new qa(this.No,this.serializer),this.Dr=new Ba,this.vr=new xa(this.serializer,this.Dr),this.window&&this.window.localStorage?this.Ga=this.window.localStorage:(this.Ga=null,!1===U&&ge("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return n.Qn=function(t,e){if(t instanceof us)return un.Qn(t.jo,e);throw ct()},n.prototype.start=function(){var t=this;return this.za().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new ut(J.FAILED_PRECONDITION,as);return t.Ha(),t.Ya(),t.Ja(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.Ka.Ia(e)})}).then(function(e){t.Ma=new ir(e,t.$a)}).then(function(){t.Oa=!0}).catch(function(e){return t.ja&&t.ja.close(),Promise.reject(e)})},n.prototype.Xa=function(t){var e=this;return this.Qa=function(i){return B.__awaiter(e,void 0,void 0,function(){return B.__generator(this,function(s){return this.Ei?[2,t(i)]:[2]})})},t(this.isPrimary)},n.prototype.Za=function(t){var e=this;this.ja.Kn(function(i){return B.__awaiter(e,void 0,void 0,function(){return B.__generator(this,function(s){switch(s.label){case 0:return null===i.newVersion?[4,t()]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})})},n.prototype.tc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.fn.ws(function(){return B.__awaiter(e,void 0,void 0,function(){return B.__generator(this,function(i){switch(i.label){case 0:return this.Ei?[4,this.za()]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})}))},n.prototype.za=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Ho(e).put(new Ai(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.ec(e).next(function(i){i||(t.isPrimary=!1,t.fn.Cs(function(){return t.Qa(!1)}))})}).next(function(){return t.nc(e)}).next(function(i){return t.isPrimary&&!i?t.sc(e).next(function(){return!1}):!!i&&t.ic(e).next(function(){return!0})})}).catch(function(e){if(Hr(e))return Tt("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Tt("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.fn.Cs(function(){return t.Qa(e)}),t.isPrimary=e})},n.prototype.ec=function(t){var e=this;return Po(t).get(Mr.key).next(function(i){return Wt.resolve(e.rc(i))})},n.prototype.oc=function(t){return Ho(t).delete(this.clientId)},n.prototype.ac=function(){return B.__awaiter(this,void 0,void 0,function(){var t,e,i,l=this;return B.__generator(this,function(f){switch(f.label){case 0:return!this.isPrimary||this.cc(this.Ua,18e5)?[3,2]:(this.Ua=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(d){var w=n.Qn(d,Ai.store);return w.ts().next(function(O){var U=l.uc(O,18e5),X=O.filter(function($){return-1===U.indexOf($)});return Wt.forEach(X,function($){return w.delete($.clientId)}).next(function(){return X})})}).catch(function(){return[]})]);case 1:if(t=f.sent(),this.Ga)for(e=0,i=t;e<i.length;e++)this.Ga.removeItem(this.hc(i[e].clientId));f.label=2;case 2:return[2]}})})},n.prototype.Ja=function(){var t=this;this.qa=this.fn.yn("client_metadata_refresh",4e3,function(){return t.za().then(function(){return t.ac()}).then(function(){return t.Ja()})})},n.prototype.rc=function(t){return!!t&&t.ownerId===this.clientId},n.prototype.nc=function(t){var e=this;return this.ka?Wt.resolve(!0):Po(t).get(Mr.key).next(function(i){if(null!==i&&e.cc(i.leaseTimestampMs,5e3)&&!e.lc(i.ownerId)){if(e.rc(i)&&e.networkEnabled)return!0;if(!e.rc(i)){if(!i.allowTabSynchronization)throw new ut(J.FAILED_PRECONDITION,as);return!1}}return!(!e.networkEnabled||!e.inForeground)||Ho(t).ts().next(function(s){return void 0===e.uc(s,5e3).find(function(l){return!(e.clientId===l.clientId||!(!e.networkEnabled&&l.networkEnabled||!e.inForeground&&l.inForeground&&e.networkEnabled===l.networkEnabled))})})}).next(function(i){return e.isPrimary!==i&&Tt("IndexedDbPersistence","Client "+(i?"is":"is not")+" eligible for a primary lease."),i})},n.prototype.Di=function(){return B.__awaiter(this,void 0,void 0,function(){var t=this;return B.__generator(this,function(e){switch(e.label){case 0:return this.Oa=!1,this._c(),this.qa&&(this.qa.cancel(),this.qa=null),this.fc(),this.dc(),[4,this.ja.runTransaction("shutdown","readwrite",[Mr.store,Ai.store],function(i){var s=new us(i,ir.ai);return t.sc(s).next(function(){return t.oc(s)})})];case 1:return e.sent(),this.ja.close(),this.wc(),[2]}})})},n.prototype.uc=function(t,e){var i=this;return t.filter(function(s){return i.cc(s.updateTimeMs,e)&&!i.lc(s.clientId)})},n.prototype.pi=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Ho(e).ts().next(function(i){return t.uc(i,18e5).map(function(s){return s.clientId})})})},Object.defineProperty(n.prototype,"Ei",{get:function(){return this.Oa},enumerable:!1,configurable:!0}),n.prototype.mc=function(t){return Da.xo(t,this.serializer,this.Dr,this.No)},n.prototype.Tc=function(){return this.Ka},n.prototype.Ec=function(){return this.vr},n.prototype.Ic=function(){return this.Dr},n.prototype.runTransaction=function(t,e,i){var l,s=this;return Tt("IndexedDbPersistence","Starting transaction:",t),this.ja.runTransaction(t,"readonly"===e?"readonly":"readwrite",Va,function(d){return l=new us(d,s.Ma?s.Ma.next():ir.ai),"readwrite-primary"===e?s.ec(l).next(function(w){return!!w||s.nc(l)}).next(function(w){if(!w)throw ge("Failed to obtain primary lease for action '"+t+"'."),s.isPrimary=!1,s.fn.Cs(function(){return s.Qa(!1)}),new ut(J.FAILED_PRECONDITION,o);return i(l)}).next(function(w){return s.ic(l).next(function(){return w})}):s.Ac(l).next(function(){return i(l)})}).then(function(d){return l.br(),d})},n.prototype.Ac=function(t){var e=this;return Po(t).get(Mr.key).next(function(i){if(null!==i&&e.cc(i.leaseTimestampMs,5e3)&&!e.lc(i.ownerId)&&!e.rc(i)&&!(e.ka||e.allowTabSynchronization&&i.allowTabSynchronization))throw new ut(J.FAILED_PRECONDITION,as)})},n.prototype.ic=function(t){var e=new Mr(this.clientId,this.allowTabSynchronization,Date.now());return Po(t).put(Mr.key,e)},n.Ln=function(){return un.Ln()},n.prototype.sc=function(t){var e=this,i=Po(t);return i.get(Mr.key).next(function(s){return e.rc(s)?(Tt("IndexedDbPersistence","Releasing primary lease."),i.delete(Mr.key)):Wt.resolve()})},n.prototype.cc=function(t,e){var i=Date.now();return!(t<i-e||t>i&&(ge("Detected an update time that is in the future: "+t+" > "+i),1))},n.prototype.Ha=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ba=function(){t.fn.ws(function(){return t.inForeground="visible"===t.document.visibilityState,t.za()})},this.document.addEventListener("visibilitychange",this.Ba),this.inForeground="visible"===this.document.visibilityState)},n.prototype.fc=function(){this.Ba&&(this.document.removeEventListener("visibilitychange",this.Ba),this.Ba=null)},n.prototype.Ya=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.La=function(){e._c(),e.fn.ws(function(){return e.Di()})},this.window.addEventListener("unload",this.La))},n.prototype.dc=function(){this.La&&(this.window.removeEventListener("unload",this.La),this.La=null)},n.prototype.lc=function(t){var e;try{var i=null!==(null===(e=this.Ga)||void 0===e?void 0:e.getItem(this.hc(t)));return Tt("IndexedDbPersistence","Client '"+t+"' "+(i?"is":"is not")+" zombied in LocalStorage"),i}catch(s){return ge("IndexedDbPersistence","Failed to get zombied client id.",s),!1}},n.prototype._c=function(){if(this.Ga)try{this.Ga.setItem(this.hc(this.clientId),String(Date.now()))}catch(t){ge("Failed to set zombie client id.",t)}},n.prototype.wc=function(){if(this.Ga)try{this.Ga.removeItem(this.hc(this.clientId))}catch(t){}},n.prototype.hc=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},n}();function Po(n){return Kr.Qn(n,Mr.store)}function Ho(n){return Kr.Qn(n,Ai.store)}var Ga=function(){function n(t,e){this.db=t,this.wo=new pt(this,e)}return n.prototype.Po=function(t){var e=this.Rc(t);return this.db.Tc().ba(t).next(function(i){return e.next(function(s){return i+s})})},n.prototype.Rc=function(t){var e=0;return this.Vo(t,function(i){e++}).next(function(){return e})},n.prototype.Ce=function(t,e){return this.db.Tc().Ce(t,e)},n.prototype.Vo=function(t,e){return this.gc(t,function(i,s){return e(s)})},n.prototype.Da=function(t,e,i){return zo(t,i)},n.prototype.Na=function(t,e,i){return zo(t,i)},n.prototype.po=function(t,e,i){return this.db.Tc().po(t,e,i)},n.prototype.Go=function(t,e){return zo(t,e)},n.prototype.Pc=function(t,e){return s=e,l=!1,Vs(i=t).os(function(f){return Us(i,f,s).next(function(d){return d&&(l=!0),Wt.resolve(!d)})}).next(function(){return l});var i,s,l},n.prototype.bo=function(t,e){var i=this,s=this.db.Ec().ra(),l=[],f=0;return this.gc(t,function(d,w){if(w<=e){var O=i.Pc(t,d).next(function(U){if(!U)return f++,s.Rr(t,d).next(function(){return s.Ar(d),qi(t).delete([0,_t(d.path)])})});l.push(O)}}).next(function(){return Wt.$n(l)}).next(function(){return s.apply(t)}).next(function(){return f})},n.prototype.removeTarget=function(t,e){var i=e.st(t.xa);return this.db.Tc().ya(t,i)},n.prototype.yc=function(t,e){return zo(t,e)},n.prototype.gc=function(t,e){var i,s=qi(t),l=ir.ai;return s.rs({index:fr.documentTargetsIndex},function(f,d){var O=d.path,U=d.sequenceNumber;0===f[0]?(l!==ir.ai&&e(new b(Zt(i)),l),l=U,i=O):l=ir.ai}).next(function(){l!==ir.ai&&e(new b(Zt(i)),l)})},n.prototype.So=function(t){return this.db.Ec().aa(t)},n}();function zo(n,t){return qi(n).put((i=n.xa,new fr(0,_t(t.path),i)));var i}function cs(n,t){var e=n.projectId;return n.j||(e+="."+n.database),"firestore/"+t+"/"+e+"/"}var Wa=function(){function n(t,e,i){this.persistence=t,this.Vc=e,this.bc=new Qe(te),this.vc=new qe(function(s){return Ke(s)},Ge),this.Sc=we.min(),this.Sr=t.mc(i),this.Dc=t.Ec(),this.Ka=t.Tc(),this.Cc=new h(this.Dc,this.Sr,this.persistence.Ic()),this.Vc.Nc(this.Cc)}return n.prototype.Io=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(i){return t.vo(i,e.bc)})},n}();function Ha(n,t){var e=mt(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(i){var f,d,w,O,U,X,$,s=t.batch.keys(),l=e.Dc.ra({oa:!0});return(f=e,d=i,w=t,O=l,U=w.batch,X=U.keys(),$=Wt.resolve(),X.forEach(function(st){$=$.next(function(){return O.Rr(d,st)}).next(function(vt){var Et=vt,ce=w.dr.get(st);Ct(null!==ce),(!Et||Et.version.L(ce)<0)&&(Et=U.cr(st,Et,w))&&O.Er(Et,w._r)})}),$.next(function(){return f.Sr.Wo(d,U)})).next(function(){return l.apply(i)}).next(function(){return e.Sr.zo(i)}).next(function(){return e.Cc.kr(i,s)})})}function Hs(n){var t=mt(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.Ka.Ea(e)})}function za(n,t){var e=mt(n),i=t.nt,s=e.bc;return e.persistence.runTransaction("Apply remote event","readwrite-primary",function(l){var f=e.Dc.ra({oa:!0});s=e.bc;var d=[];t.zt.forEach(function(X,$){var ce,oe,Ie,st=s.get($);if(st){d.push(e.Ka.Ca(l,X.se,$).next(function(){return e.Ka.Sa(l,X.ee,$)}));var vt=X.resumeToken;if(vt.O()>0){var Et=st.it(vt,i).st(l.xa);s=s.ot($,Et),ce=st,Ie=X,Ct((oe=Et).resumeToken.O()>0),(0===ce.resumeToken.O()||oe.nt.X()-ce.nt.X()>=3e8||Ie.ee.size+Ie.ne.size+Ie.se.size>0)&&d.push(e.Ka.ya(l,Et))}}});var w=xn(),O=dt();if(t.Yt.forEach(function(X,$){O=O.add(X)}),d.push(f.getEntries(l,O).next(function(X){t.Yt.forEach(function($,st){var vt=X.get($);st instanceof Ln&&st.version.isEqual(we.min())?(f.Ar($,i),w=w.ot($,st)):null==vt||st.version.L(vt.version)>0||0===st.version.L(vt.version)&&vt.hasPendingWrites?(f.Er(st,i),w=w.ot($,st)):Tt("LocalStore","Ignoring outdated watch update for ",$,". Current version:",vt.version," Watch version:",st.version),t.Jt.has($)&&d.push(e.persistence.No.yc(l,$))})})),!i.isEqual(we.min())){var U=e.Ka.Ea(l).next(function(X){return e.Ka.Aa(l,l.xa,i)});d.push(U)}return Wt.$n(d).next(function(){return f.apply(l)}).next(function(){return e.Cc.Mr(l,w)})}).then(function(l){return e.bc=s,l})}function Ka(n,t){var e=mt(n);return e.persistence.runTransaction("Get next mutation batch","readonly",function(i){return void 0===t&&(t=-1),e.Sr.Bo(i,t)})}function Ko(n,t){var e=mt(n);return e.persistence.runTransaction("Allocate target","readwrite",function(i){var s;return e.Ka.va(i,t).next(function(l){return l?Wt.resolve(s=l):e.Ka.wa(i).next(function(f){return s=new ln(t,f,0,i.xa),e.Ka.Ra(i,s).next(function(){return s})})})}).then(function(i){var s=e.bc.get(i.targetId);return(null===s||i.nt.L(s.nt)>0)&&(e.bc=e.bc.ot(i.targetId,i),e.vc.set(t,i.targetId)),i})}function _o(n,t,e){return B.__awaiter(this,void 0,void 0,function(){var i,s,l,f;return B.__generator(this,function(d){switch(d.label){case 0:i=mt(n),s=i.bc.get(t),l=e?"readwrite":"readwrite-primary",d.label=1;case 1:return d.trys.push([1,4,,5]),e?[3,3]:[4,i.persistence.runTransaction("Release target",l,function(w){return i.persistence.No.removeTarget(w,s)})];case 2:d.sent(),d.label=3;case 3:return[3,5];case 4:if(!Hr(f=d.sent()))throw f;return Tt("LocalStore","Failed to update sequence numbers for target "+t+": "+f),[3,5];case 5:return i.bc=i.bc.remove(t),i.vc.delete(s.target),[2]}})})}function Qo(n,t,e){var i=mt(n),s=we.min(),l=dt();return i.persistence.runTransaction("Execute query","readonly",function(f){return(d=i,w=f,O=Un(t),U=mt(d),X=U.vc.get(O),void 0!==X?Wt.resolve(U.bc.get(X)):U.Ka.va(w,O)).next(function(d){if(d)return s=d.lastLimboFreeSnapshotVersion,i.Ka.Fa(f,d.targetId).next(function(w){l=w})}).next(function(){return i.Vc.Lr(f,t,e?s:we.min(),e?l:dt())}).next(function(d){return{documents:d,Fc:l}});var d,w,O,U,X})}function zs(n,t){var e=mt(n),i=mt(e.Ka),s=e.bc.get(t);return s?Promise.resolve(s.target):e.persistence.runTransaction("Get target data","readonly",function(l){return i.Ue(l,t).next(function(f){return f?f.target:null})})}function Qa(n){var t=mt(n);return t.persistence.runTransaction("Get new document changes","readonly",function(e){return s=e,l=t.Sc,f=mt(t.Dc),d=xn(),w=yr(l),O=Vi(s),U=IDBKeyRange.lowerBound(w,!0),O.rs({index:Vn.readTimeIndex,range:U},function(X,$){var st=ze(f.serializer,$);d=d.ot(st.key,st),w=$.readTime}).next(function(){return{xc:d,readTime:vi(w)}});var s,l,f,d,w,O,U}).then(function(e){var i=e.xc;return t.Sc=e.readTime,i})}function Ya(n){return B.__awaiter(this,void 0,void 0,function(){var t;return B.__generator(this,function(e){return[2,(t=mt(n)).persistence.runTransaction("Synchronize last document change read time","readonly",function(i){return l=Vi(i),f=we.min(),l.rs({index:Vn.readTimeIndex,reverse:!0},function(d,w,O){w.readTime&&(f=vi(w.readTime)),O.done()}).next(function(){return f});var l,f}).then(function(i){t.Sc=i})]})})}function ro(n){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(t){if(n.code!==J.FAILED_PRECONDITION||n.message!==o)throw n;return Tt("LocalStore","Unexpectedly lost primary lease"),[2]})})}var ls=function(){function n(){this.$c=new Je(or.kc),this.Mc=new Je(or.Oc)}return n.prototype.m=function(){return this.$c.m()},n.prototype.Da=function(t,e){var i=new or(t,e);this.$c=this.$c.add(i),this.Mc=this.Mc.add(i)},n.prototype.Lc=function(t,e){var i=this;t.forEach(function(s){return i.Da(s,e)})},n.prototype.Na=function(t,e){this.Bc(new or(t,e))},n.prototype.qc=function(t,e){var i=this;t.forEach(function(s){return i.Na(s,e)})},n.prototype.Uc=function(t){var e=this,i=new b(new At([])),s=new or(i,t),l=new or(i,t+1),f=[];return this.Mc.Ft([s,l],function(d){e.Bc(d),f.push(d.key)}),f},n.prototype.Qc=function(){var t=this;this.$c.forEach(function(e){return t.Bc(e)})},n.prototype.Bc=function(t){this.$c=this.$c.delete(t),this.Mc=this.Mc.delete(t)},n.prototype.Wc=function(t){var e=new b(new At([])),i=new or(e,t),s=new or(e,t+1),l=dt();return this.Mc.Ft([i,s],function(f){l=l.add(f.key)}),l},n.prototype.Ho=function(t){var e=new or(t,0),i=this.$c.$t(e);return null!==i&&t.isEqual(i.key)},n}(),or=function(){function n(t,e){this.key=t,this.jc=e}return n.kc=function(t,e){return b.i(t.key,e.key)||te(t.jc,e.jc)},n.Oc=function(t,e){return te(t.jc,e.jc)||b.i(t.key,e.key)},n}(),Xa=function(n,t){this.user=t,this.type="OAuth",this.Kc={},this.Kc.Authorization="Bearer "+n},Ks=function(){function n(){this.Gc=null}return n.prototype.getToken=function(){return Promise.resolve(null)},n.prototype.zc=function(){},n.prototype.Hc=function(t){this.Gc=t,t(Zn.UNAUTHENTICATED)},n.prototype.Yc=function(){this.Gc=null},n}(),$a=function(){function n(t){var e=this;this.Jc=null,this.currentUser=Zn.UNAUTHENTICATED,this.Xc=!1,this.Zc=0,this.Gc=null,this.forceRefresh=!1,this.Jc=function(){e.Zc++,e.currentUser=e.tu(),e.Xc=!0,e.Gc&&e.Gc(e.currentUser)},this.Zc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Jc):(this.Jc(null),t.get().then(function(i){e.auth=i,e.Jc&&e.auth.addAuthTokenListener(e.Jc)},function(){}))}return n.prototype.getToken=function(){var t=this,e=this.Zc,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(function(s){return t.Zc!==e?(Tt("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):s?(Ct("string"==typeof s.accessToken),new Xa(s.accessToken,t.currentUser)):null}):Promise.resolve(null)},n.prototype.zc=function(){this.forceRefresh=!0},n.prototype.Hc=function(t){this.Gc=t,this.Xc&&t(this.currentUser)},n.prototype.Yc=function(){this.auth&&this.auth.removeAuthTokenListener(this.Jc),this.Jc=null,this.Gc=null},n.prototype.tu=function(){var t=this.auth&&this.auth.getUid();return Ct(null===t||"string"==typeof t),new Zn(t)},n}(),Ja=function(){function n(t,e){this.eu=t,this.nu=e,this.type="FirstParty",this.user=Zn.ni}return Object.defineProperty(n.prototype,"Kc",{get:function(){var t={"X-Goog-AuthUser":this.nu},e=this.eu.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),n}(),Za=function(){function n(t,e){this.eu=t,this.nu=e}return n.prototype.getToken=function(){return Promise.resolve(new Ja(this.eu,this.nu))},n.prototype.Hc=function(t){t(Zn.ni)},n.prototype.Yc=function(){},n.prototype.zc=function(){},n}(),Qs=function(){function n(t,e,i,s,l,f){this.fn=t,this.su=i,this.iu=s,this.ru=l,this.listener=f,this.state=0,this.ou=0,this.au=null,this.stream=null,this.ys=new Mi(t,e)}return n.prototype.cu=function(){return 1===this.state||2===this.state||4===this.state},n.prototype.uu=function(){return 2===this.state},n.prototype.start=function(){3!==this.state?this.auth():this.hu()},n.prototype.stop=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(t){switch(t.label){case 0:return this.cu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},n.prototype.lu=function(){this.state=0,this.ys.reset()},n.prototype._u=function(){var t=this;this.uu()&&null===this.au&&(this.au=this.fn.yn(this.su,6e4,function(){return t.fu()}))},n.prototype.du=function(t){this.wu(),this.stream.send(t)},n.prototype.fu=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(t){return this.uu()?[2,this.close(0)]:[2]})})},n.prototype.wu=function(){this.au&&(this.au.cancel(),this.au=null)},n.prototype.close=function(t,e){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(i){switch(i.label){case 0:return this.wu(),this.ys.cancel(),this.ou++,3!==t?this.ys.reset():e&&e.code===J.RESOURCE_EXHAUSTED?(ge(e.toString()),ge("Using maximum backoff delay to prevent overloading the backend."),this.ys.Rn()):e&&e.code===J.UNAUTHENTICATED&&this.ru.zc(),null!==this.stream&&(this.mu(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Tu(e)];case 1:return i.sent(),[2]}})})},n.prototype.mu=function(){},n.prototype.auth=function(){var t=this;this.state=1;var e=this.Eu(this.ou),i=this.ou;this.ru.getToken().then(function(s){t.ou===i&&t.Iu(s)},function(s){e(function(){var l=new ut(J.UNKNOWN,"Fetching auth token failed: "+s.message);return t.Au(l)})})},n.prototype.Iu=function(t){var e=this,i=this.Eu(this.ou);this.stream=this.Ru(t),this.stream.gu(function(){i(function(){return e.state=2,e.listener.gu()})}),this.stream.Tu(function(s){i(function(){return e.Au(s)})}),this.stream.onMessage(function(s){i(function(){return e.onMessage(s)})})},n.prototype.hu=function(){var t=this;this.state=4,this.ys.gn(function(){return B.__awaiter(t,void 0,void 0,function(){return B.__generator(this,function(e){return this.state=0,this.start(),[2]})})})},n.prototype.Au=function(t){return Tt("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},n.prototype.Eu=function(t){var e=this;return function(i){e.fn.ws(function(){return e.ou===t?i():(Tt("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},n}(),tu=function(n){function t(e,i,s,l,f){var d=this;return(d=n.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",i,s,f)||this).serializer=l,d}return B.__extends(t,n),t.prototype.Ru=function(e){return this.iu.Pu("Listen",e)},t.prototype.onMessage=function(e){this.ys.reset();var i=function(l,f){var d,ri;if("targetChange"in f){var w="NO_CHANGE"===(ri=f.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===ri?1:"REMOVE"===ri?2:"CURRENT"===ri?3:"RESET"===ri?4:ct(),O=f.targetChange.targetIds||[],U=function(ri,zi){return ri.Qe?(Ct(void 0===zi||"string"==typeof zi),le.fromBase64String(zi||"")):(Ct(void 0===zi||zi instanceof Uint8Array),le.fromUint8Array(zi||new Uint8Array))}(l,f.targetChange.resumeToken),X=f.targetChange.cause,$=X&&function(ri){var zi=void 0===ri.code?J.UNKNOWN:Mn(ri.code);return new ut(zi,ri.message||"")}(X);d=new bn(w,O,U,$||null)}else if("documentChange"in f){var st=f.documentChange,vt=$n(l,st.document.name),Et=tr(st.document.updateTime),ce=new qr({mapValue:{fields:st.document.fields}}),oe=new Ze(vt,Et,ce,{});d=new De(st.targetIds||[],st.removedTargetIds||[],oe.key,oe)}else if("documentDelete"in f){var tn=f.documentDelete,mn=$n(l,tn.document),Pn=tn.readTime?tr(tn.readTime):we.min(),gi=new Ln(mn,Pn);d=new De([],tn.removedTargetIds||[],gi.key,gi)}else if("documentRemove"in f){var To=f.documentRemove,is=$n(l,To.document);d=new De([],To.removedTargetIds||[],is,null)}else{if(!("filter"in f))return ct();var So=f.filter,Ms=new wn(So.count||0);d=new Fe(So.targetId,Ms)}return d}(this.serializer,e),s=function(l){if(!("targetChange"in l))return we.min();var f=l.targetChange;return f.targetIds&&f.targetIds.length?we.min():f.readTime?tr(f.readTime):we.min()}(e);return this.listener.yu(i,s)},t.prototype.Vu=function(e){var l,f,d,w,i={};i.database=In(this.serializer),i.addTarget=(l=this.serializer,(d=Pe(w=(f=e).target)?{documents:Tn(l,w)}:{query:ui(l,w)}).targetId=f.targetId,f.resumeToken.O()>0&&(d.resumeToken=oi(l,f.resumeToken)),d);var s=function(l,f){var d=function(w,O){switch(O){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ct()}}(0,f.et);return null==d?null:{"goog-listen-tags":d}}(0,e);s&&(i.labels=s),this.du(i)},t.prototype.pu=function(e){var i={};i.database=In(this.serializer),i.removeTarget=e,this.du(i)},t}(Qs),eu=function(n){function t(e,i,s,l,f){var d=this;return(d=n.call(this,e,"write_stream_connection_backoff","write_stream_idle",i,s,f)||this).serializer=l,d.bu=!1,d}return B.__extends(t,n),Object.defineProperty(t.prototype,"vu",{get:function(){return this.bu},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.bu=!1,this.lastStreamToken=void 0,n.prototype.start.call(this)},t.prototype.mu=function(){this.bu&&this.Su([])},t.prototype.Ru=function(e){return this.iu.Pu("Write",e)},t.prototype.onMessage=function(e){if(Ct(!!e.streamToken),this.lastStreamToken=e.streamToken,this.bu){this.ys.reset();var i=(f=e.commitTime,(l=e.writeResults)&&l.length>0?(Ct(void 0!==f),l.map(function(d){return function(w,O){var U=tr(w.updateTime?w.updateTime:O);U.isEqual(we.min())&&(U=tr(O));var X=null;return w.transformResults&&w.transformResults.length>0&&(X=w.transformResults),new Gt(U,X)}(d,f)})):[]),s=tr(e.commitTime);return this.listener.Du(s,i)}var l,f;return Ct(!e.writeResults||0===e.writeResults.length),this.bu=!0,this.listener.Cu()},t.prototype.Nu=function(){var e={};e.database=In(this.serializer),this.du(e)},t.prototype.Su=function(e){var i=this,s={streamToken:this.lastStreamToken,writes:e.map(function(l){return ur(i.serializer,l)})};this.du(s)},t}(Qs),nu=function(n){function t(e,i,s){var l=this;return(l=n.call(this)||this).credentials=e,l.iu=i,l.serializer=s,l.Fu=!1,l}return B.__extends(t,n),t.prototype.xu=function(){if(this.Fu)throw new ut(J.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.$u=function(e,i,s){var l=this;return this.xu(),this.credentials.getToken().then(function(f){return l.iu.$u(e,i,s,f)}).catch(function(f){throw f.code===J.UNAUTHENTICATED&&l.credentials.zc(),f})},t.prototype.ku=function(e,i,s){var l=this;return this.xu(),this.credentials.getToken().then(function(f){return l.iu.ku(e,i,s,f)}).catch(function(f){throw f.code===J.UNAUTHENTICATED&&l.credentials.zc(),f})},t.prototype.terminate=function(){this.Fu=!1},t}(function(){}),ru=function(){function n(t,e){this.cs=t,this.di=e,this.state="Unknown",this.Mu=0,this.Ou=null,this.Lu=!0}return n.prototype.Bu=function(){var t=this;0===this.Mu&&(this.qu("Unknown"),this.Ou=this.cs.yn("online_state_timeout",1e4,function(){return t.Ou=null,t.Uu("Backend didn't respond within 10 seconds."),t.qu("Offline"),Promise.resolve()}))},n.prototype.Qu=function(t){"Online"===this.state?this.qu("Unknown"):(this.Mu++,this.Mu>=1&&(this.Wu(),this.Uu("Connection failed 1 times. Most recent error: "+t.toString()),this.qu("Offline")))},n.prototype.set=function(t){this.Wu(),this.Mu=0,"Online"===t&&(this.Lu=!1),this.qu(t)},n.prototype.qu=function(t){t!==this.state&&(this.state=t,this.di(t))},n.prototype.Uu=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Lu?(ge(e),this.Lu=!1):Tt("OnlineStateTracker",e)},n.prototype.Wu=function(){null!==this.Ou&&(this.Ou.cancel(),this.Ou=null)},n}(),iu=function(n,t,e,i,s){var l=this;this.ju=n,this.Ku=t,this.cs=e,this.Gu={},this.zu=[],this.Hu=new Map,this.Yu=new Set,this.Ju=[],this.Xu=s,this.Xu.Zu(function(f){e.ws(function(){return B.__awaiter(l,void 0,void 0,function(){return B.__generator(this,function(d){switch(d.label){case 0:return Gi(this)?(Tt("RemoteStore","Restarting streams for network reachability change."),[4,function(w){return B.__awaiter(this,void 0,void 0,function(){var O;return B.__generator(this,function(U){switch(U.label){case 0:return(O=mt(w)).Yu.add(4),[4,wo(O)];case 1:return U.sent(),O.th.set("Unknown"),O.Yu.delete(4),[4,Do(O)];case 2:return U.sent(),[2]}})})}(this)]):[3,2];case 1:d.sent(),d.label=2;case 2:return[2]}})})})}),this.th=new ru(e,i)};function Do(n){return B.__awaiter(this,void 0,void 0,function(){var t,e;return B.__generator(this,function(i){switch(i.label){case 0:if(!Gi(n))return[3,4];t=0,e=n.Ju,i.label=1;case 1:return t<e.length?[4,(0,e[t])(!0)]:[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function wo(n){return B.__awaiter(this,void 0,void 0,function(){var t,e;return B.__generator(this,function(i){switch(i.label){case 0:t=0,e=n.Ju,i.label=1;case 1:return t<e.length?[4,(0,e[t])(!1)]:[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function Ys(n){return B.__awaiter(this,void 0,void 0,function(){var t;return B.__generator(this,function(e){switch(e.label){case 0:return t=mt(n),Tt("RemoteStore","RemoteStore shutting down."),t.Yu.add(5),[4,wo(t)];case 1:return e.sent(),t.Xu.Di(),t.th.set("Unknown"),[2]}})})}function Yo(n,t){var e=mt(n);e.Hu.has(t.targetId)||(e.Hu.set(t.targetId,t),ps(e)?hs(e):Eo(e).uu()&&fs(e,t))}function xo(n,t){var e=mt(n),i=Eo(e);e.Hu.delete(t),i.uu()&&Xs(e,t),0===e.Hu.size&&(i.uu()?i._u():Gi(e)&&e.th.set("Unknown"))}function fs(n,t){n.eh.Ie(t.targetId),Eo(n).Vu(t)}function Xs(n,t){n.eh.Ie(t),Eo(n).pu(t)}function hs(n){n.eh=new j({qe:function(t){return n.Gu.qe(t)},Ue:function(t){return n.Hu.get(t)||null}}),Eo(n).start(),n.th.Bu()}function ps(n){return Gi(n)&&!Eo(n).cu()&&n.Hu.size>0}function Gi(n){return 0===mt(n).Yu.size}function $s(n){n.eh=void 0}function ou(n){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(t){return n.Hu.forEach(function(e,i){fs(n,e)}),[2]})})}function su(n,t){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){return $s(n),ps(n)?(n.th.Qu(t),hs(n)):n.th.set("Unknown"),[2]})})}function au(n,t,e){return B.__awaiter(this,void 0,void 0,function(){var i,s,l;return B.__generator(this,function(f){switch(f.label){case 0:if(n.th.set("Online"),!(t instanceof bn&&2===t.state&&t.cause))return[3,6];f.label=1;case 1:return f.trys.push([1,3,,5]),[4,function(d,w){return B.__awaiter(this,void 0,void 0,function(){var O,U,X,$;return B.__generator(this,function(st){switch(st.label){case 0:O=w.cause,U=0,X=w.targetIds,st.label=1;case 1:return U<X.length?d.Hu.has($=X[U])?[4,d.Gu.nh($,O)]:[3,3]:[3,5];case 2:st.sent(),d.Hu.delete($),d.eh.removeTarget($),st.label=3;case 3:st.label=4;case 4:return U++,[3,1];case 5:return[2]}})})}(n,t)];case 2:return f.sent(),[3,5];case 3:return i=f.sent(),Tt("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),i),[4,Xo(n,i)];case 4:return f.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof De?n.eh.be(t):t instanceof Fe?n.eh.$e(t):n.eh.De(t),e.isEqual(we.min()))return[3,13];f.label=7;case 7:return f.trys.push([7,11,,13]),[4,Hs(n.ju)];case 8:return s=f.sent(),e.L(s)>=0?[4,(d=n,w=e,O=d.eh.Oe(w),O.zt.forEach(function(U,X){if(U.resumeToken.O()>0){var $=d.Hu.get(X);$&&d.Hu.set(X,$.it(U.resumeToken,w))}}),O.Ht.forEach(function(U){var X=d.Hu.get(U);if(X){d.Hu.set(U,X.it(le.B,X.nt)),Xs(d,U);var $=new ln(X.target,U,1,X.sequenceNumber);fs(d,$)}}),d.Gu.sh(O))]:[3,10];case 9:f.sent(),f.label=10;case 10:return[3,13];case 11:return Tt("RemoteStore","Failed to raise snapshot:",l=f.sent()),[4,Xo(n,l)];case 12:return f.sent(),[3,13];case 13:return[2]}var d,w,O})})}function Xo(n,t,e){return B.__awaiter(this,void 0,void 0,function(){var i=this;return B.__generator(this,function(s){switch(s.label){case 0:if(!Hr(t))throw t;return n.Yu.add(1),[4,wo(n)];case 1:return s.sent(),n.th.set("Offline"),e||(e=function(){return Hs(n.ju)}),n.cs.Cs(function(){return B.__awaiter(i,void 0,void 0,function(){return B.__generator(this,function(l){switch(l.label){case 0:return Tt("RemoteStore","Retrying IndexedDB access"),[4,e()];case 1:return l.sent(),n.Yu.delete(1),[4,Do(n)];case 2:return l.sent(),[2]}})})}),[2]}})})}function Js(n,t){return t().catch(function(e){return Xo(n,e,t)})}function bo(n){return B.__awaiter(this,void 0,void 0,function(){var t,e,i,s,l;return B.__generator(this,function(f){switch(f.label){case 0:t=mt(n),e=Wi(t),i=t.zu.length>0?t.zu[t.zu.length-1].batchId:-1,f.label=1;case 1:if(!(Gi(d=t)&&d.zu.length<10))return[3,7];f.label=2;case 2:return f.trys.push([2,4,,6]),[4,Ka(t.ju,i)];case 3:return null===(s=f.sent())?(0===t.zu.length&&e._u(),[3,7]):(i=s.batchId,function(d,w){d.zu.push(w);var O=Wi(d);O.uu()&&O.vu&&O.Su(w.mutations)}(t,s),[3,6]);case 4:return l=f.sent(),[4,Xo(t,l)];case 5:return f.sent(),[3,6];case 6:return[3,1];case 7:return Zs(t)&&ta(t),[2]}var d})})}function Zs(n){return Gi(n)&&!Wi(n).cu()&&n.zu.length>0}function ta(n){Wi(n).start()}function uu(n){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(t){return Wi(n).Nu(),[2]})})}function cu(n){return B.__awaiter(this,void 0,void 0,function(){var t,e,i;return B.__generator(this,function(l){for(t=Wi(n),e=0,i=n.zu;e<i.length;e++)t.Su(i[e].mutations);return[2]})})}function lu(n,t,e){return B.__awaiter(this,void 0,void 0,function(){var i,s;return B.__generator(this,function(l){switch(l.label){case 0:return i=n.zu.shift(),s=a.from(i,t,e),[4,Js(n,function(){return n.Gu.ih(s)})];case 1:return l.sent(),[4,bo(n)];case 2:return l.sent(),[2]}})})}function fu(n,t){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:return t&&Wi(n).vu?[4,function(i,s){return B.__awaiter(this,void 0,void 0,function(){var l,f;return B.__generator(this,function(d){switch(d.label){case 0:return kn(f=s.code)&&f!==J.ABORTED?(l=i.zu.shift(),Wi(i).lu(),[4,Js(i,function(){return i.Gu.rh(l.batchId,s)})]):[3,3];case 1:return d.sent(),[4,bo(i)];case 2:d.sent(),d.label=3;case 3:return[2]}})})}(n,t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return Zs(n)&&ta(n),[2]}})})}function ds(n,t){return B.__awaiter(this,void 0,void 0,function(){var e;return B.__generator(this,function(s){switch(s.label){case 0:return e=mt(n),t?(e.Yu.delete(2),[4,Do(e)]):[3,2];case 1:return s.sent(),[3,5];case 2:return t?[3,4]:(e.Yu.add(2),[4,wo(e)]);case 3:s.sent(),e.th.set("Unknown"),s.label=4;case 4:s.label=5;case 5:return[2]}})})}function Eo(n){var e,i,s,l,t=this;return n.oh||(n.oh=(e=n.Ku,i=n.cs,s={gu:ou.bind(null,n),Tu:su.bind(null,n),yu:au.bind(null,n)},(l=mt(e)).xu(),new tu(i,l.iu,l.credentials,l.serializer,s)),n.Ju.push(function(e){return B.__awaiter(t,void 0,void 0,function(){return B.__generator(this,function(i){switch(i.label){case 0:return e?(n.oh.lu(),ps(n)?hs(n):n.th.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.oh.stop()];case 2:i.sent(),$s(n),i.label=3;case 3:return[2]}})})})),n.oh}function Wi(n){var e,i,s,l,t=this;return n.ah||(n.ah=(e=n.Ku,i=n.cs,s={gu:uu.bind(null,n),Tu:fu.bind(null,n),Cu:cu.bind(null,n),Du:lu.bind(null,n)},(l=mt(e)).xu(),new eu(i,l.iu,l.credentials,l.serializer,s)),n.Ju.push(function(e){return B.__awaiter(t,void 0,void 0,function(){return B.__generator(this,function(i){switch(i.label){case 0:return e?(n.ah.lu(),[4,bo(n)]):[3,2];case 1:return i.sent(),[3,4];case 2:return[4,n.ah.stop()];case 3:i.sent(),n.zu.length>0&&(Tt("RemoteStore","Stopping write stream with "+n.zu.length+" pending writes"),n.zu=[]),i.label=4;case 4:return[2]}})})})),n.ah}var ea=function(n){this.key=n},na=function(n){this.key=n},ra=function(){function n(t,e){this.query=t,this.uh=e,this.hh=null,this.te=!1,this.lh=dt(),this.Wt=dt(),this._h=fo(t),this.fh=new Ht(this._h)}return Object.defineProperty(n.prototype,"dh",{get:function(){return this.uh},enumerable:!1,configurable:!0}),n.prototype.wh=function(t,e){var i=this,s=e?e.mh:new ae,l=e?e.fh:this.fh,f=e?e.Wt:this.Wt,d=l,w=!1,O=Ei(this.query)&&l.size===this.query.limit?l.last():null,U=Zr(this.query)&&l.size===this.query.limit?l.first():null;if(t.ht(function($,st){var vt=l.get($),Et=st instanceof Ze?st:null;Et&&(Et=kr(i.query,Et)?Et:null);var ce=!!vt&&i.Wt.has(vt.key),oe=!!Et&&(Et.Je||i.Wt.has(Et.key)&&Et.hasCommittedMutations),Ie=!1;vt&&Et?vt.data().isEqual(Et.data())?ce!==oe&&(s.track({type:3,doc:Et}),Ie=!0):i.Th(vt,Et)||(s.track({type:2,doc:Et}),Ie=!0,(O&&i._h(Et,O)>0||U&&i._h(Et,U)<0)&&(w=!0)):!vt&&Et?(s.track({type:0,doc:Et}),Ie=!0):vt&&!Et&&(s.track({type:1,doc:vt}),Ie=!0,(O||U)&&(w=!0)),Ie&&(Et?(d=d.add(Et),f=oe?f.add($):f.delete($)):(d=d.delete($),f=f.delete($)))}),Ei(this.query)||Zr(this.query))for(;d.size>this.query.limit;){var X=Ei(this.query)?d.last():d.first();d=d.delete(X.key),f=f.delete(X.key),s.track({type:1,doc:X})}return{fh:d,mh:s,Eh:w,Wt:f}},n.prototype.Th=function(t,e){return t.Je&&e.hasCommittedMutations&&!e.Je},n.prototype.yr=function(t,e,i){var s=this,l=this.fh;this.fh=t.fh,this.Wt=t.Wt;var f=t.mh.Ut();f.sort(function(U,X){return st=X.type,(vt=function(Et){switch(Et){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ct()}})(U.type)-vt(st)||s._h(U.doc,X.doc);var st,vt}),this.Ih(i);var d=e?this.Ah():[],w=0===this.lh.size&&this.te?1:0,O=w!==this.hh;return this.hh=w,0!==f.length||O?{snapshot:new Ft(this.query,t.fh,l,f,t.Wt,0===w,O,!1),Rh:d}:{Rh:d}},n.prototype.Qs=function(t){return this.te&&"Offline"===t?(this.te=!1,this.yr({fh:this.fh,mh:new ae,Wt:this.Wt,Eh:!1},!1)):{Rh:[]}},n.prototype.gh=function(t){return!this.uh.has(t)&&!!this.fh.has(t)&&!this.fh.get(t).Je},n.prototype.Ih=function(t){var e=this;t&&(t.ee.forEach(function(i){return e.uh=e.uh.add(i)}),t.ne.forEach(function(i){}),t.se.forEach(function(i){return e.uh=e.uh.delete(i)}),this.te=t.te)},n.prototype.Ah=function(){var t=this;if(!this.te)return[];var e=this.lh;this.lh=dt(),this.fh.forEach(function(s){t.gh(s.key)&&(t.lh=t.lh.add(s.key))});var i=[];return e.forEach(function(s){t.lh.has(s)||i.push(new na(s))}),this.lh.forEach(function(s){e.has(s)||i.push(new ea(s))}),i},n.prototype.Ph=function(t){this.uh=t.Fc,this.lh=dt();var e=this.wh(t.documents);return this.yr(e,!0)},n.prototype.yh=function(){return Ft.Gt(this.query,this.fh,this.Wt,0===this.hh)},n}(),hu=function(n,t,e){this.query=n,this.targetId=t,this.view=e},pu=function(n){this.key=n,this.Vh=!1},du=function(){function n(t,e,i,s,l,f){this.ju=t,this.ph=e,this.bh=i,this.Sh=s,this.currentUser=l,this.Dh=f,this.Ch={},this.Nh=new qe(function(d){return Qi(d)},Lr),this.Fh=new Map,this.xh=[],this.$h=new Qe(b.i),this.kh=new Map,this.Mh=new ls,this.Oh={},this.Lh=new Map,this.Bh=Wo.da(),this.onlineState="Unknown",this.qh=void 0}return Object.defineProperty(n.prototype,"Uh",{get:function(){return!0===this.qh},enumerable:!1,configurable:!0}),n}();function vu(n,t){return B.__awaiter(this,void 0,void 0,function(){var e,s,l,f,d;return B.__generator(this,function(w){switch(w.label){case 0:return e=ws(n),(l=e.Nh.get(t))?(e.Sh.Oi(l.targetId),s=l.view.yh(),[3,4]):[3,1];case 1:return[4,Ko(e.ju,Un(t))];case 2:return f=w.sent(),d=e.Sh.Oi(f.targetId),[4,vs(e,t,f.targetId,"current"===d)];case 3:s=w.sent(),e.Uh&&Yo(e.ph,f),w.label=4;case 4:return[2,s]}})})}function vs(n,t,e,i){return B.__awaiter(this,void 0,void 0,function(){var s,l,f,d,w,O;return B.__generator(this,function(U){switch(U.label){case 0:return n.Qh=function(X,$,st){return function(vt,Et,ce,oe){return B.__awaiter(this,void 0,void 0,function(){var Ie,Me,tn;return B.__generator(this,function(mn){switch(mn.label){case 0:return(Ie=Et.view.wh(ce)).Eh?[4,Qo(vt.ju,Et.query,!1).then(function(Pn){return Et.view.wh(Pn.documents,Ie)})]:[3,2];case 1:Ie=mn.sent(),mn.label=2;case 2:return Me=oe&&oe.zt.get(Et.targetId),tn=Et.view.yr(Ie,vt.Uh,Me),[2,(ms(vt,Et.targetId,tn.Rh),tn.snapshot)]}})})}(n,X,$,st)},[4,Qo(n.ju,t,!0)];case 1:return s=U.sent(),l=new ra(t,s.Fc),f=l.wh(s.documents),d=je.Zt(e,i&&"Offline"!==n.onlineState),w=l.yr(f,n.Uh,d),ms(n,e,w.Rh),O=new hu(t,e,l),[2,(n.Nh.set(t,O),n.Fh.has(e)?n.Fh.get(e).push(t):n.Fh.set(e,[t]),w.snapshot)]}})})}function yu(n,t){return B.__awaiter(this,void 0,void 0,function(){var e,i,s;return B.__generator(this,function(l){switch(l.label){case 0:return e=mt(n),i=e.Nh.get(t),(s=e.Fh.get(i.targetId)).length>1?[2,(e.Fh.set(i.targetId,s.filter(function(f){return!Lr(f,t)})),void e.Nh.delete(t))]:e.Uh?(e.Sh.Bi(i.targetId),e.Sh.Fi(i.targetId)?[3,2]:[4,_o(e.ju,i.targetId,!1).then(function(){e.Sh.Ui(i.targetId),xo(e.ph,i.targetId),Io(e,i.targetId)}).catch(ro)]):[3,3];case 1:l.sent(),l.label=2;case 2:return[3,5];case 3:return Io(e,i.targetId),[4,_o(e.ju,i.targetId,!0)];case 4:l.sent(),l.label=5;case 5:return[2]}})})}function ia(n,t){return B.__awaiter(this,void 0,void 0,function(){var e,i;return B.__generator(this,function(s){switch(s.label){case 0:e=mt(n),s.label=1;case 1:return s.trys.push([1,4,,6]),[4,za(e.ju,t)];case 2:return i=s.sent(),t.zt.forEach(function(l,f){var d=e.kh.get(f);d&&(Ct(l.ee.size+l.ne.size+l.se.size<=1),l.ee.size>0?d.Vh=!0:l.ne.size>0?Ct(d.Vh):l.se.size>0&&(Ct(d.Vh),d.Vh=!1))}),[4,io(e,i,t)];case 3:return s.sent(),[3,6];case 4:return[4,ro(s.sent())];case 5:return s.sent(),[3,6];case 6:return[2]}})})}function oa(n,t,e){var i=mt(n);if(i.Uh&&0===e||!i.Uh&&1===e){var s=[];i.Nh.forEach(function(l,f){var d=f.view.Qs(t);d.snapshot&&s.push(d.snapshot)}),function(l,f){var d=mt(l);d.onlineState=f;var w=!1;d.Bs.forEach(function(O,U){for(var X=0,$=U.listeners;X<$.length;X++)$[X].Qs(f)&&(w=!0)}),w&&Ci(d)}(i.bh,t),s.length&&i.Ch.yu(s),i.onlineState=t,i.Uh&&i.Sh.Ki(t)}}function gu(n,t,e){return B.__awaiter(this,void 0,void 0,function(){var i,s,l,f,d,w;return B.__generator(this,function(O){switch(O.label){case 0:return(i=mt(n)).Sh.Qi(t,"rejected",e),s=i.kh.get(t),(l=s&&s.key)?(f=(f=new Qe(b.i)).ot(l,new Ln(l,we.min())),d=dt().add(l),w=new ue(we.min(),new Map,new Je(te),f,d),[4,ia(i,w)]):[3,2];case 1:return O.sent(),i.$h=i.$h.remove(l),i.kh.delete(t),_s(i),[3,4];case 2:return[4,_o(i.ju,t,!1).then(function(){return Io(i,t,e)}).catch(ro)];case 3:O.sent(),O.label=4;case 4:return[2]}})})}function mu(n,t){return B.__awaiter(this,void 0,void 0,function(){var e,i,s;return B.__generator(this,function(l){switch(l.label){case 0:e=mt(n),i=t.batch.batchId,l.label=1;case 1:return l.trys.push([1,4,,6]),[4,Ha(e.ju,t)];case 2:return s=l.sent(),gs(e,i,null),ys(e,i),e.Sh.ki(i,"acknowledged"),[4,io(e,s)];case 3:return l.sent(),[3,6];case 4:return[4,ro(l.sent())];case 5:return l.sent(),[3,6];case 6:return[2]}})})}function _u(n,t,e){return B.__awaiter(this,void 0,void 0,function(){var i,s;return B.__generator(this,function(l){switch(l.label){case 0:i=mt(n),l.label=1;case 1:return l.trys.push([1,4,,6]),[4,(f=i.ju,d=t,w=mt(f),w.persistence.runTransaction("Reject batch","readwrite-primary",function(O){var U;return w.Sr.Oo(O,d).next(function(X){return Ct(null!==X),U=X.keys(),w.Sr.Wo(O,X)}).next(function(){return w.Sr.zo(O)}).next(function(){return w.Cc.kr(O,U)})}))];case 2:return s=l.sent(),gs(i,t,e),ys(i,t),i.Sh.ki(t,"rejected",e),[4,io(i,s)];case 3:return l.sent(),[3,6];case 4:return[4,ro(l.sent())];case 5:return l.sent(),[3,6];case 6:return[2]}var f,d,w})})}function ys(n,t){(n.Lh.get(t)||[]).forEach(function(e){e.resolve()}),n.Lh.delete(t)}function gs(n,t,e){var i=mt(n),s=i.Oh[i.currentUser.ti()];if(s){var l=s.get(t);l&&(e?l.reject(e):l.resolve(),s=s.remove(t)),i.Oh[i.currentUser.ti()]=s}}function Io(n,t,e){void 0===e&&(e=null),n.Sh.Bi(t);for(var i=0,s=n.Fh.get(t);i<s.length;i++){var l=s[i];n.Nh.delete(l),e&&n.Ch.Wh(l,e)}n.Fh.delete(t),n.Uh&&n.Mh.Uc(t).forEach(function(f){n.Mh.Ho(f)||sa(n,f)})}function sa(n,t){var e=n.$h.get(t);null!==e&&(xo(n.ph,e),n.$h=n.$h.remove(t),n.kh.delete(e),_s(n))}function ms(n,t,e){for(var i=0,s=e;i<s.length;i++){var l=s[i];l instanceof ea?(n.Mh.Da(l.key,t),wu(n,l)):l instanceof na?(Tt("SyncEngine","Document no longer in limbo: "+l.key),n.Mh.Na(l.key,t),n.Mh.Ho(l.key)||sa(n,l.key)):ct()}}function wu(n,t){var e=t.key;n.$h.get(e)||(Tt("SyncEngine","New document in limbo: "+e),n.xh.push(e),_s(n))}function _s(n){for(;n.xh.length>0&&n.$h.size<n.Dh;){var t=n.xh.shift(),e=n.Bh.next();n.kh.set(e,new pu(t)),n.$h=n.$h.ot(t,e),Yo(n.ph,new ln(Un(Wr(t.path)),e,2,ir.ai))}}function io(n,t,e){return B.__awaiter(this,void 0,void 0,function(){var i,s,l,f;return B.__generator(this,function(d){switch(d.label){case 0:return i=mt(n),s=[],l=[],f=[],i.Nh.m()?[3,3]:(i.Nh.forEach(function(w,O){f.push(i.Qh(O,t,e).then(function(U){if(U){i.Uh&&i.Sh.Qi(O.targetId,U.fromCache?"not-current":"current"),s.push(U);var X=p.zr(O.targetId,U);l.push(X)}}))}),[4,Promise.all(f)]);case 1:return d.sent(),i.Ch.yu(s),[4,function(w,O){return B.__awaiter(this,void 0,void 0,function(){var U,X,$,st,vt,Et,ce,Ie;return B.__generator(this,function(Me){switch(Me.label){case 0:U=mt(w),Me.label=1;case 1:return Me.trys.push([1,3,,4]),[4,U.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(tn){return Wt.forEach(O,function(mn){return Wt.forEach(mn.Kr,function(Pn){return U.persistence.No.Da(tn,mn.targetId,Pn)}).next(function(){return Wt.forEach(mn.Gr,function(Pn){return U.persistence.No.Na(tn,mn.targetId,Pn)})})})})];case 2:return Me.sent(),[3,4];case 3:if(!Hr(X=Me.sent()))throw X;return Tt("LocalStore","Failed to update sequence numbers: "+X),[3,4];case 4:for($=0,st=O;$<st.length;$++)Et=(vt=st[$]).targetId,vt.fromCache||(ce=U.bc.get(Et),Ie=ce.rt(ce.nt),U.bc=U.bc.ot(Et,Ie));return[2]}})})}(i.ju,l)];case 2:d.sent(),d.label=3;case 3:return[2]}})})}function bu(n,t){return B.__awaiter(this,void 0,void 0,function(){var e,i;return B.__generator(this,function(s){switch(s.label){case 0:return(e=mt(n)).currentUser.isEqual(t)?[3,3]:(Tt("SyncEngine","User change. New user:",t.ti()),[4,function(l,f){return B.__awaiter(this,void 0,void 0,function(){var d,w,O,U;return B.__generator(this,function(X){switch(X.label){case 0:return d=mt(l),w=d.Sr,O=d.Cc,[4,d.persistence.runTransaction("Handle user change","readonly",function($){var st;return d.Sr.Uo($).next(function(vt){return st=vt,w=d.persistence.mc(f),O=new h(d.Dc,w,d.persistence.Ic()),w.Uo($)}).next(function(vt){for(var Et=[],ce=[],oe=dt(),Ie=0,Me=st;Ie<Me.length;Ie++){var tn=Me[Ie];Et.push(tn.batchId);for(var mn=0,Pn=tn.mutations;mn<Pn.length;mn++)oe=oe.add(Pn[mn].key)}for(var Ni=0,To=vt;Ni<To.length;Ni++){var is=To[Ni];ce.push(is.batchId);for(var Uo=0,So=is.mutations;Uo<So.length;Uo++)oe=oe.add(So[Uo].key)}return O.kr($,oe).next(function(Ms){return{jh:Ms,Kh:Et,Gh:ce}})})})];case 1:return U=X.sent(),[2,(d.Sr=w,d.Cc=O,d.Vc.Nc(d.Cc),U)]}})})}(e.ju,t)]);case 1:return i=s.sent(),e.currentUser=t,(l=e).Lh.forEach(function(d){d.forEach(function(w){w.reject(new ut(J.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),l.Lh.clear(),e.Sh.ji(t,i.Kh,i.Gh),[4,io(e,i.jh)];case 2:s.sent(),s.label=3;case 3:return[2]}var l})})}function Eu(n,t){var e=mt(n),i=e.kh.get(t);if(i&&i.Vh)return dt().add(i.key);var s=dt(),l=e.Fh.get(t);if(!l)return s;for(var f=0,d=l;f<d.length;f++){var O=e.Nh.get(d[f]);s=s.kt(O.view.dh)}return s}function Iu(n,t){return B.__awaiter(this,void 0,void 0,function(){var e,i,s;return B.__generator(this,function(l){switch(l.label){case 0:return[4,Qo((e=mt(n)).ju,t.query,!0)];case 1:return i=l.sent(),s=t.view.Ph(i),[2,(e.Uh&&ms(e,t.targetId,s.Rh),s)]}})})}function Tu(n,t,e,i){return B.__awaiter(this,void 0,void 0,function(){var s,l;return B.__generator(this,function(f){switch(f.label){case 0:return[4,(d=(s=mt(n)).ju,w=t,O=mt(d),U=mt(O.Sr),O.persistence.runTransaction("Lookup mutation documents","readonly",function(X){return U.Lo(X,w).next(function($){return $?O.Cc.kr(X,$):Wt.resolve(null)})}))];case 1:return null===(l=f.sent())?[3,6]:"pending"!==e?[3,3]:[4,bo(s.ph)];case 2:return f.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(gs(s,t,i||null),ys(s,t),function(d,w){mt(mt(d).Sr).Ko(w)}(s.ju,t)):ct(),f.label=4;case 4:return[4,io(s,l)];case 5:return f.sent(),[3,7];case 6:Tt("SyncEngine","Cannot apply mutation batch with id: "+t),f.label=7;case 7:return[2]}var d,w,O,U})})}function Su(n,t){return B.__awaiter(this,void 0,void 0,function(){var e,i,s,l,f,w,O;return B.__generator(this,function(U){switch(U.label){case 0:return ws(e=mt(n)),bs(e),!0!==t||!0===e.qh?[3,3]:(i=e.Sh.Ci(),[4,aa(e,i.A())]);case 1:return s=U.sent(),e.qh=!0,[4,ds(e.ph,!0)];case 2:for(U.sent(),l=0,f=s;l<f.length;l++)Yo(e.ph,f[l]);return[3,7];case 3:return!1!==t||!1===e.qh?[3,7]:(w=[],O=Promise.resolve(),e.Fh.forEach(function(X,$){e.Sh.qi($)?w.push($):O=O.then(function(){return Io(e,$),_o(e.ju,$,!0)}),xo(e.ph,$)}),[4,O]);case 4:return U.sent(),[4,aa(e,w)];case 5:return U.sent(),($=mt(e)).kh.forEach(function(st,vt){xo($.ph,vt)}),$.Mh.Qc(),$.kh=new Map,$.$h=new Qe(b.i),e.qh=!1,[4,ds(e.ph,!1)];case 6:U.sent(),U.label=7;case 7:return[2]}var $})})}function aa(n,t,e){return B.__awaiter(this,void 0,void 0,function(){var i,s,l,f,d,w,O,U,X,$,vt,Et,ce;return B.__generator(this,function(oe){switch(oe.label){case 0:i=mt(n),s=[],l=[],f=0,d=t,oe.label=1;case 1:return f<d.length?(O=void 0,(U=i.Fh.get(w=d[f]))&&0!==U.length?[4,Ko(i.ju,Un(U[0]))]:[3,7]):[3,13];case 2:O=oe.sent(),X=0,$=U,oe.label=3;case 3:return X<$.length?(vt=i.Nh.get($[X]),[4,Iu(i,vt)]):[3,6];case 4:(Et=oe.sent()).snapshot&&l.push(Et.snapshot),oe.label=5;case 5:return X++,[3,3];case 6:return[3,11];case 7:return[4,zs(i.ju,w)];case 8:return ce=oe.sent(),[4,Ko(i.ju,ce)];case 9:return O=oe.sent(),[4,vs(i,ua(ce),w,!1)];case 10:oe.sent(),oe.label=11;case 11:s.push(O),oe.label=12;case 12:return f++,[3,1];case 13:return[2,(i.Ch.yu(l),s)]}})})}function ua(n){return lo(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Cu(n){var t=mt(n);return mt(mt(t.ju).persistence).pi()}function Au(n,t,e,i){return B.__awaiter(this,void 0,void 0,function(){var s,l,f;return B.__generator(this,function(d){switch(d.label){case 0:return(s=mt(n)).qh?(Tt("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!s.Fh.has(t))return[3,8];switch(e){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Qa(s.ju)];case 3:return l=d.sent(),f=ue.Xt(t,"current"===e),[4,io(s,l,f)];case 4:return d.sent(),[3,8];case 5:return[4,_o(s.ju,t,!0)];case 6:return d.sent(),Io(s,t,i),[3,8];case 7:ct(),d.label=8;case 8:return[2]}})})}function Ru(n,t,e){return B.__awaiter(this,void 0,void 0,function(){var i,s,l,f,d,w,O,U,X;return B.__generator(this,function(st){switch(st.label){case 0:if(!(i=ws(n)).qh)return[3,10];s=0,l=t,st.label=1;case 1:return s<l.length?i.Fh.has(f=l[s])?(Tt("SyncEngine","Adding an already active target "+f),[3,5]):[4,zs(i.ju,f)]:[3,6];case 2:return d=st.sent(),[4,Ko(i.ju,d)];case 3:return w=st.sent(),[4,vs(i,ua(d),w.targetId,!1)];case 4:st.sent(),Yo(i.ph,w),st.label=5;case 5:return s++,[3,1];case 6:O=function(vt){return B.__generator(this,function(Et){switch(Et.label){case 0:return i.Fh.has(vt)?[4,_o(i.ju,vt,!1).then(function(){xo(i.ph,vt),Io(i,vt)}).catch(ro)]:[3,2];case 1:Et.sent(),Et.label=2;case 2:return[2]}})},U=0,X=e,st.label=7;case 7:return U<X.length?[5,O(X[U])]:[3,10];case 8:st.sent(),st.label=9;case 9:return U++,[3,7];case 10:return[2]}})})}function ws(n){var t=mt(n);return t.ph.Gu.sh=ia.bind(null,t),t.ph.Gu.qe=Eu.bind(null,t),t.ph.Gu.nh=gu.bind(null,t),t.Ch.yu=Ir.bind(null,t.bh),t.Ch.Wh=vr.bind(null,t.bh),t}function bs(n){var t=mt(n);return t.ph.Gu.ih=mu.bind(null,t),t.ph.Gu.rh=_u.bind(null,t),t}var Nu=function(){function n(){}return n.prototype.Nc=function(t){this.zh=t},n.prototype.Lr=function(t,e,i,s){var f,l=this;return 0===(f=e).filters.length&&null===f.limit&&null==f.startAt&&null==f.endAt&&(0===f.on.length||1===f.on.length&&f.on[0].field.p())||i.isEqual(we.min())?this.Hh(t,e):this.zh.kr(t,s).next(function(f){var d=l.Yh(e,f);return(Ei(e)||Zr(e))&&l.Eh(e.an,d,s,i)?l.Hh(t,e):(ee()<=D.LogLevel.DEBUG&&Tt("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ti(e)),l.zh.Lr(t,e,i).next(function(w){return d.forEach(function(O){w=w.ot(O.key,O)}),w}))})},n.prototype.Yh=function(t,e){var i=new Je(fo(t));return e.forEach(function(s,l){l instanceof Ze&&kr(t,l)&&(i=i.add(l))}),i},n.prototype.Eh=function(t,e,i,s){if(i.size!==e.size)return!0;var l="F"===t?e.last():e.first();return!!l&&(l.hasPendingWrites||l.version.L(s)>0)},n.prototype.Hh=function(t,e){return ee()<=D.LogLevel.DEBUG&&Tt("IndexFreeQueryEngine","Using full collection scan to execute query:",ti(e)),this.zh.Lr(t,e,we.min())},n}(),Ou=function(){function n(t,e){this.Dr=t,this.No=e,this.Sr=[],this.Jh=1,this.Xh=new Je(or.kc)}return n.prototype.$o=function(t){return Wt.resolve(0===this.Sr.length)},n.prototype.ko=function(t,e,i,s){var l=this.Jh;this.Jh++;var f=new yo(l,e,i,s);this.Sr.push(f);for(var d=0,w=s;d<w.length;d++){var O=w[d];this.Xh=this.Xh.add(new or(O.key,l)),this.Dr.Mo(t,O.key.path.h())}return Wt.resolve(f)},n.prototype.Oo=function(t,e){return Wt.resolve(this.Zh(e))},n.prototype.Bo=function(t,e){var s=this.tl(e+1),l=s<0?0:s;return Wt.resolve(this.Sr.length>l?this.Sr[l]:null)},n.prototype.qo=function(){return Wt.resolve(0===this.Sr.length?-1:this.Jh-1)},n.prototype.Uo=function(t){return Wt.resolve(this.Sr.slice())},n.prototype.Nr=function(t,e){var i=this,s=new or(e,0),l=new or(e,Number.POSITIVE_INFINITY),f=[];return this.Xh.Ft([s,l],function(d){var w=i.Zh(d.jc);f.push(w)}),Wt.resolve(f)},n.prototype.Or=function(t,e){var i=this,s=new Je(te);return e.forEach(function(l){var f=new or(l,0),d=new or(l,Number.POSITIVE_INFINITY);i.Xh.Ft([f,d],function(w){s=s.add(w.jc)})}),Wt.resolve(this.el(s))},n.prototype.Wr=function(t,e){var i=e.path,s=i.length+1,l=i;b.F(l)||(l=l.child(""));var f=new or(new b(l),0),d=new Je(te);return this.Xh.xt(function(w){var O=w.key.path;return!!i.T(O)&&(O.length===s&&(d=d.add(w.jc)),!0)},f),Wt.resolve(this.el(d))},n.prototype.el=function(t){var e=this,i=[];return t.forEach(function(s){var l=e.Zh(s);null!==l&&i.push(l)}),i},n.prototype.Wo=function(t,e){var i=this;Ct(0===this.nl(e.batchId,"removed")),this.Sr.shift();var s=this.Xh;return Wt.forEach(e.mutations,function(l){var f=new or(l.key,e.batchId);return s=s.delete(f),i.No.Go(t,l.key)}).next(function(){i.Xh=s})},n.prototype.Ko=function(t){},n.prototype.Ho=function(t,e){var i=new or(e,0),s=this.Xh.$t(i);return Wt.resolve(e.isEqual(s&&s.key))},n.prototype.zo=function(t){return Wt.resolve()},n.prototype.nl=function(t,e){return this.tl(t)},n.prototype.tl=function(t){return 0===this.Sr.length?0:t-this.Sr[0].batchId},n.prototype.Zh=function(t){var e=this.tl(t);return e<0||e>=this.Sr.length?null:this.Sr[e]},n}(),Pu=function(){function n(t,e){this.Dr=t,this.sl=e,this.docs=new Qe(b.i),this.size=0}return n.prototype.Er=function(t,e,i){var s=e.key,l=this.docs.get(s),f=l?l.size:0,d=this.sl(e);return this.docs=this.docs.ot(s,{ta:e,size:d,readTime:i}),this.size+=d-f,this.Dr.Mo(t,s.path.h())},n.prototype.Ar=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},n.prototype.Rr=function(t,e){var i=this.docs.get(e);return Wt.resolve(i?i.ta:null)},n.prototype.getEntries=function(t,e){var i=this,s=Hn();return e.forEach(function(l){var f=i.docs.get(l);s=s.ot(l,f?f.ta:null)}),Wt.resolve(s)},n.prototype.Lr=function(t,e,i){for(var s=it(),l=new b(e.path.child("")),f=this.docs.ft(l);f.At();){var d=f.It(),O=d.value,U=O.ta,X=O.readTime;if(!e.path.T(d.key.path))break;X.L(i)<=0||U instanceof Ze&&kr(e,U)&&(s=s.ot(U.key,U))}return Wt.resolve(s)},n.prototype.il=function(t,e){return Wt.forEach(this.docs,function(i){return e(i)})},n.prototype.ra=function(t){return new Du(this)},n.prototype.aa=function(t){return Wt.resolve(this.size)},n}(),Du=function(n){function t(e){var i=this;return(i=n.call(this)||this).ca=e,i}return B.__extends(t,n),t.prototype.yr=function(e){var i=this,s=[];return this.wr.forEach(function(l,f){f?s.push(i.ca.Er(e,f,i.readTime)):i.ca.Ar(l)}),Wt.$n(s)},t.prototype.gr=function(e,i){return this.ca.Rr(e,i)},t.prototype.Pr=function(e,i){return this.ca.getEntries(e,i)},t}(r),xu=function(){function n(t){this.persistence=t,this.rl=new qe(function(e){return Ke(e)},Ge),this.lastRemoteSnapshotVersion=we.min(),this.highestTargetId=0,this.ol=0,this.al=new ls,this.targetCount=0,this.cl=Wo.fa()}return n.prototype.Ce=function(t,e){return this.rl.forEach(function(i,s){return e(s)}),Wt.resolve()},n.prototype.Ea=function(t){return Wt.resolve(this.lastRemoteSnapshotVersion)},n.prototype.Ia=function(t){return Wt.resolve(this.ol)},n.prototype.wa=function(t){return this.highestTargetId=this.cl.next(),Wt.resolve(this.highestTargetId)},n.prototype.Aa=function(t,e,i){return i&&(this.lastRemoteSnapshotVersion=i),e>this.ol&&(this.ol=e),Wt.resolve()},n.prototype.ga=function(t){this.rl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.cl=new Wo(e),this.highestTargetId=e),t.sequenceNumber>this.ol&&(this.ol=t.sequenceNumber)},n.prototype.Ra=function(t,e){return this.ga(e),this.targetCount+=1,Wt.resolve()},n.prototype.ya=function(t,e){return this.ga(e),Wt.resolve()},n.prototype.Va=function(t,e){return this.rl.delete(e.target),this.al.Uc(e.targetId),this.targetCount-=1,Wt.resolve()},n.prototype.po=function(t,e,i){var s=this,l=0,f=[];return this.rl.forEach(function(d,w){w.sequenceNumber<=e&&null===i.get(w.targetId)&&(s.rl.delete(d),f.push(s.pa(t,w.targetId)),l++)}),Wt.$n(f).next(function(){return l})},n.prototype.ba=function(t){return Wt.resolve(this.targetCount)},n.prototype.va=function(t,e){var i=this.rl.get(e)||null;return Wt.resolve(i)},n.prototype.Sa=function(t,e,i){return this.al.Lc(e,i),Wt.resolve()},n.prototype.Ca=function(t,e,i){this.al.qc(e,i);var s=this.persistence.No,l=[];return s&&e.forEach(function(f){l.push(s.Go(t,f))}),Wt.$n(l)},n.prototype.pa=function(t,e){return this.al.Uc(e),Wt.resolve()},n.prototype.Fa=function(t,e){var i=this.al.Wc(e);return Wt.resolve(i)},n.prototype.Ho=function(t,e){return Wt.resolve(this.al.Ho(e))},n}(),Lu=function(){function n(t){var e=this;this.ul={},this.Ma=new ir(0),this.Oa=!1,this.Oa=!0,this.No=t(this),this.Ka=new xu(this),this.Dr=new ka,this.vr=new Pu(this.Dr,function(l){return e.No.hl(l)})}return n.prototype.start=function(){return Promise.resolve()},n.prototype.Di=function(){return this.Oa=!1,Promise.resolve()},Object.defineProperty(n.prototype,"Ei",{get:function(){return this.Oa},enumerable:!1,configurable:!0}),n.prototype.Za=function(){},n.prototype.tc=function(){},n.prototype.Ic=function(){return this.Dr},n.prototype.mc=function(t){var e=this.ul[t.ti()];return e||(e=new Ou(this.Dr,this.No),this.ul[t.ti()]=e),e},n.prototype.Tc=function(){return this.Ka},n.prototype.Ec=function(){return this.vr},n.prototype.runTransaction=function(t,e,i){var s=this;Tt("MemoryPersistence","Starting transaction:",t);var l=new ku(this.Ma.next());return this.No.ll(),i(l).next(function(f){return s.No._l(l).next(function(){return f})}).Fn().then(function(f){return l.br(),f})},n.prototype.fl=function(t,e){return Wt.kn(Object.values(this.ul).map(function(i){return function(){return i.Ho(t,e)}}))},n}(),ku=function(n){function t(e){var i=this;return(i=n.call(this)||this).xa=e,i}return B.__extends(t,n),t}(c),Mu=function(){function n(t){this.persistence=t,this.dl=new ls,this.wl=null}return n.ml=function(t){return new n(t)},Object.defineProperty(n.prototype,"Tl",{get:function(){if(this.wl)return this.wl;throw ct()},enumerable:!1,configurable:!0}),n.prototype.Da=function(t,e,i){return this.dl.Da(i,e),this.Tl.delete(i.toString()),Wt.resolve()},n.prototype.Na=function(t,e,i){return this.dl.Na(i,e),this.Tl.add(i.toString()),Wt.resolve()},n.prototype.Go=function(t,e){return this.Tl.add(e.toString()),Wt.resolve()},n.prototype.removeTarget=function(t,e){var i=this;this.dl.Uc(e.targetId).forEach(function(l){return i.Tl.add(l.toString())});var s=this.persistence.Tc();return s.Fa(t,e.targetId).next(function(l){l.forEach(function(f){return i.Tl.add(f.toString())})}).next(function(){return s.Va(t,e)})},n.prototype.ll=function(){this.wl=new Set},n.prototype._l=function(t){var e=this,i=this.persistence.Ec().ra();return Wt.forEach(this.Tl,function(s){var l=b.D(s);return e.El(t,l).next(function(f){f||i.Ar(l)})}).next(function(){return e.wl=null,i.apply(t)})},n.prototype.yc=function(t,e){var i=this;return this.El(t,e).next(function(s){s?i.Tl.delete(e.toString()):i.Tl.add(e.toString())})},n.prototype.hl=function(t){return 0},n.prototype.El=function(t,e){var i=this;return Wt.kn([function(){return Wt.resolve(i.dl.Ho(e))},function(){return i.persistence.Tc().Ho(t,e)},function(){return i.persistence.fl(t,e)}])},n}(),Fu=function(){function n(t){this.Il=t.Il,this.Al=t.Al}return n.prototype.gu=function(t){this.Rl=t},n.prototype.Tu=function(t){this.gl=t},n.prototype.onMessage=function(t){this.Pl=t},n.prototype.close=function(){this.Al()},n.prototype.send=function(t){this.Il(t)},n.prototype.yl=function(){this.Rl()},n.prototype.Vl=function(t){this.gl(t)},n.prototype.pl=function(t){this.Pl(t)},n}(),Uu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},ju=function(n){function t(e){var i=this;return(i=n.call(this,e)||this).forceLongPolling=e.forceLongPolling,i.W=e.W,i}return B.__extends(t,n),t.prototype.Nl=function(e,i,s,l){return new Promise(function(f,d){var w=new St.XhrIo;w.listenOnce(St.EventType.COMPLETE,function(){try{switch(w.getLastErrorCode()){case St.ErrorCode.NO_ERROR:var U=w.getResponseJson();Tt("Connection","XHR received:",JSON.stringify(U)),f(U);break;case St.ErrorCode.TIMEOUT:Tt("Connection",'RPC "'+e+'" timed out'),d(new ut(J.DEADLINE_EXCEEDED,"Request time out"));break;case St.ErrorCode.HTTP_ERROR:var X=w.getStatus();if(Tt("Connection",'RPC "'+e+'" failed with status:',X,"response text:",w.getResponseText()),X>0){var $=w.getResponseJson().error;if($&&$.status&&$.message){var st=(Et=$.status.toLowerCase().replace("_","-"),Object.values(J).indexOf(Et)>=0?Et:J.UNKNOWN);d(new ut(st,$.message))}else d(new ut(J.UNKNOWN,"Server responded with status "+w.getStatus()))}else d(new ut(J.UNAVAILABLE,"Connection failed."));break;default:ct()}}finally{Tt("Connection",'RPC "'+e+'" completed.')}var Et});var O=JSON.stringify(l);w.send(i,"POST",O,s,15)})},t.prototype.Pu=function(e,i){var s=[this.vl,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=St.createWebChannelTransport(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.U.projectId+"/databases/"+this.U.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.W};this.Cl(f.initMessageHeaders,i),Te.isMobileCordova()||Te.isReactNative()||Te.isElectron()||Te.isIE()||Te.isUWP()||Te.isBrowserExtension()||(f.httpHeadersOverwriteParam="$httpHeaders");var d=s.join("");Tt("Connection","Creating WebChannel: "+d,f);var w=l.createWebChannel(d,f),O=!1,U=!1,X=new Fu({Il:function(st){U?Tt("Connection","Not sending because WebChannel is closed:",st):(O||(Tt("Connection","Opening WebChannel transport."),w.open(),O=!0),Tt("Connection","WebChannel sending:",st),w.send(st))},Al:function(){return w.close()}}),$=function(st,vt){w.listen(st,function(Et){try{vt(Et)}catch(ce){setTimeout(function(){throw ce},0)}})};return $(St.WebChannel.EventType.OPEN,function(){U||Tt("Connection","WebChannel transport opened.")}),$(St.WebChannel.EventType.CLOSE,function(){U||(U=!0,Tt("Connection","WebChannel transport closed"),X.Vl())}),$(St.WebChannel.EventType.ERROR,function(st){U||(U=!0,Xe("Connection","WebChannel transport errored:",st),X.Vl(new ut(J.UNAVAILABLE,"The operation could not be completed")))}),$(St.WebChannel.EventType.MESSAGE,function(st){var vt;if(!U){var Et=st.data[0];Ct(!!Et);var oe=Et.error||(null===(vt=Et[0])||void 0===vt?void 0:vt.error);if(oe){Tt("Connection","WebChannel received error:",oe);var Ie=oe.status,Me=function(mn){var Pn=Se[mn];if(void 0!==Pn)return Mn(Pn)}(Ie),tn=oe.message;void 0===Me&&(Me=J.INTERNAL,tn="Unknown error status: "+Ie+" with message "+oe.message),U=!0,X.Vl(new ut(Me,tn)),w.close()}else Tt("Connection","WebChannel received:",Et),X.pl(Et)}}),setTimeout(function(){X.yl()},0),X},t}(function(){function n(t){this.bl=t,this.U=t.U,this.vl=(t.ssl?"https":"http")+"://"+t.host,this.Sl="projects/"+this.U.projectId+"/databases/"+this.U.database+"/documents"}return n.prototype.$u=function(t,e,i,s){var l=this.Dl(t,e);Tt("RestConnection","Sending: ",l,i);var f={};return this.Cl(f,s),this.Nl(t,l,f,i).then(function(d){return Tt("RestConnection","Received: ",d),d},function(d){throw Xe("RestConnection",t+" failed with error: ",d,"url: ",l,"request:",i),d})},n.prototype.ku=function(t,e,i,s){return this.$u(t,e,i,s)},n.prototype.Cl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.24.0",t["Content-Type"]="text/plain",e)for(var i in e.Kc)e.Kc.hasOwnProperty(i)&&(t[i]=e.Kc[i])},n.prototype.Dl=function(t,e){return this.vl+"/v1/"+e+":"+Uu[t]},n}()),ca=function(){function n(){var t=this;this.Fl=function(){return t.xl()},this.$l=function(){return t.kl()},this.Ml=[],this.Ol()}return n.prototype.Zu=function(t){this.Ml.push(t)},n.prototype.Di=function(){window.removeEventListener("online",this.Fl),window.removeEventListener("offline",this.$l)},n.prototype.Ol=function(){window.addEventListener("online",this.Fl),window.addEventListener("offline",this.$l)},n.prototype.xl=function(){Tt("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Ml;t<e.length;t++)(0,e[t])(0)},n.prototype.kl=function(){Tt("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Ml;t<e.length;t++)(0,e[t])(1)},n.Ln=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},n}(),Vu=function(){function n(){}return n.prototype.Zu=function(t){},n.prototype.Di=function(){},n}();function Es(n){return new _i(n,!0)}var la="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",$o=function(){function n(){}return n.prototype.initialize=function(t){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:return this.Sh=this.Ll(t),this.persistence=this.Bl(t),[4,this.persistence.start()];case 1:return e.sent(),this.ql=this.Ul(t),this.ju=this.Ql(t),[2]}})})},n.prototype.Ul=function(t){return null},n.prototype.Ql=function(t){return e=this.persistence,i=new Nu,new Wa(e,i,t.Wl);var e,i},n.prototype.Bl=function(t){if(t.persistenceSettings.jl)throw new ut(J.FAILED_PRECONDITION,la);return new Lu(Mu.ml)},n.prototype.Ll=function(t){return new vo},n.prototype.terminate=function(){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(t){switch(t.label){case 0:return this.ql&&this.ql.stop(),[4,this.Sh.Di()];case 1:return t.sent(),[4,this.persistence.Di()];case 2:return t.sent(),[2]}})})},n.prototype.clearPersistence=function(t,e){throw new ut(J.FAILED_PRECONDITION,la)},n}(),Bu=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return B.__extends(t,n),t.prototype.initialize=function(e){return B.__awaiter(this,void 0,void 0,function(){var i,s=this;return B.__generator(this,function(l){switch(l.label){case 0:return[4,n.prototype.initialize.call(this,e)];case 1:return l.sent(),i=this.Kl.fi,this.Sh instanceof No?(this.Sh.fi={er:Tu.bind(null,i),nr:Au.bind(null,i),sr:Ru.bind(null,i),pi:Cu.bind(null,i)},[4,this.Sh.start()]):[3,3];case 2:l.sent(),l.label=3;case 3:return[4,this.persistence.Xa(function(f){return B.__awaiter(s,void 0,void 0,function(){return B.__generator(this,function(d){switch(d.label){case 0:return[4,Su(this.Kl.fi,f)];case 1:return d.sent(),this.ql&&(f&&!this.ql.Ei?this.ql.start(this.ju):f||this.ql.stop()),[2]}})})})];case 4:return l.sent(),[2]}})})},t.prototype.Ll=function(e){if(e.persistenceSettings.jl&&e.persistenceSettings.synchronizeTabs){var i=v();if(!No.Ln(i))throw new ut(J.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var s=cs(e.bl.U,e.bl.persistenceKey);return new No(i,e.cs,s,e.clientId,e.Wl)}return new vo},t}(function(n){function t(e){var i=this;return(i=n.call(this)||this).Kl=e,i}return B.__extends(t,n),t.prototype.initialize=function(e){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(i){switch(i.label){case 0:return[4,n.prototype.initialize.call(this,e)];case 1:return i.sent(),[4,Ya(this.ju)];case 2:return i.sent(),[4,this.Kl.initialize(this,e)];case 3:return i.sent(),[4,bs(this.Kl.fi)];case 4:return i.sent(),[4,bo(this.Kl.ph)];case 5:return i.sent(),[2]}})})},t.prototype.Ul=function(e){return new ot(this.persistence.No.wo,e.cs)},t.prototype.Bl=function(e){var i=cs(e.bl.U,e.bl.persistenceKey),s=Es(e.bl.U);return new Kr(e.persistenceSettings.synchronizeTabs,i,e.clientId,k.ao(e.persistenceSettings.cacheSizeBytes),e.cs,v(),E(),s,this.Sh,e.persistenceSettings.ka)},t.prototype.Ll=function(e){return new vo},t.prototype.clearPersistence=function(e,i){return function(s){return B.__awaiter(this,void 0,void 0,function(){return B.__generator(this,function(f){switch(f.label){case 0:return un.Ln()?[4,un.delete(s+"main")]:[2,Promise.resolve()];case 1:return f.sent(),[2]}})})}(cs(e,i))},t}($o)),Jo=function(){function n(){}return n.prototype.initialize=function(t,e){return B.__awaiter(this,void 0,void 0,function(){var i=this;return B.__generator(this,function(s){switch(s.label){case 0:return this.ju?[3,2]:(this.ju=t.ju,this.Sh=t.Sh,this.Ku=this.Gl(e),this.ph=this.zl(e),this.bh=this.Hl(e),this.fi=this.Yl(e),this.Sh.di=function(l){return oa(i.fi,l,1)},this.ph.Gu.Jl=bu.bind(null,this.fi),[4,ds(this.ph,this.fi.Uh)]);case 1:s.sent(),s.label=2;case 2:return[2]}})})},n.prototype.Hl=function(t){return new We},n.prototype.Gl=function(t){var i=Es(t.bl.U),s=new ju(t.bl);return new nu(t.credentials,s,i)},n.prototype.zl=function(t){var e,i,s,l,f,d=this;return e=this.ju,i=this.Ku,s=t.cs,l=function(w){return oa(d.fi,w,0)},f=ca.Ln()?new ca:new Vu,new iu(e,i,s,l,f)},n.prototype.Yl=function(t){return w=!t.persistenceSettings.jl||!t.persistenceSettings.synchronizeTabs,O=new du(this.ju,this.ph,this.bh,this.Sh,t.Wl,t.Dh),w&&(O.qh=!0),O;var w,O},n.prototype.terminate=function(){return Ys(this.ph)},n}(),Zo=function(){function n(t){this.observer=t,this.muted=!1}return n.prototype.next=function(t){this.observer.next&&this.Xl(this.observer.next,t)},n.prototype.error=function(t){this.observer.error?this.Xl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},n.prototype.Zl=function(){this.muted=!0},n.prototype.Xl=function(t,e){var i=this;this.muted||setTimeout(function(){i.muted||t(e)},0)},n}(),Is=function(n){!function(e,i,s,l){if(!(i instanceof Array)||i.length<1)throw new ut(J.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Oe(1,"element")+".")}(0,n);for(var t=0;t<n.length;++t)if(Y("FieldPath","string",t,n[t]),0===n[t].length)throw new ut(J.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.t_=new S(n)},oo=function(n){function t(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return n.call(this,e)||this}return B.__extends(t,n),t.documentId=function(){return new t(S.v().R())},t.prototype.isEqual=function(e){if(!(e instanceof t))throw se("isEqual","FieldPath",1,e);return this.t_.isEqual(e.t_)},t}(Is),qu=new RegExp("[~\\*/\\[\\]]"),so=function(n){this.e_=n},Lo=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return B.__extends(t,n),t.prototype.n_=function(e){if(2!==e.s_)throw e.i_(1===e.s_?this.e_+"() can only appear at the top level of your update data":this.e_+"() cannot be used with set() unless you pass {merge:true}");return e.We.push(e.path),null},t.prototype.isEqual=function(e){return e instanceof t},t}(so);function fa(n,t,e){return new da({s_:3,r_:t.settings.r_,methodName:n.e_,o_:e},t.U,t.serializer,t.ignoreUndefinedProperties)}var Gu=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return B.__extends(t,n),t.prototype.n_=function(e){return new It(e.path,new rr)},t.prototype.isEqual=function(e){return e instanceof t},t}(so),Wu=function(n){function t(e,i){var s=this;return(s=n.call(this,e)||this).a_=i,s}return B.__extends(t,n),t.prototype.n_=function(e){var i=fa(this,e,!0),s=this.a_.map(function(f){return ao(f,i)}),l=new _(s);return new It(e.path,l)},t.prototype.isEqual=function(e){return this===e},t}(so),Hu=function(n){function t(e,i){var s=this;return(s=n.call(this,e)||this).a_=i,s}return B.__extends(t,n),t.prototype.n_=function(e){var i=fa(this,e,!0),s=this.a_.map(function(f){return ao(f,i)}),l=new N(s);return new It(e.path,l)},t.prototype.isEqual=function(e){return this===e},t}(so),zu=function(n){function t(e,i){var s=this;return(s=n.call(this,e)||this).c_=i,s}return B.__extends(t,n),t.prototype.n_=function(e){var i=new H(e.serializer,Pr(e.serializer,this.c_));return new It(e.path,i)},t.prototype.isEqual=function(e){return this===e},t}(so),ts=function(){function n(t,e){if(x("GeoPoint",arguments,2),Y("GeoPoint","number",1,t),Y("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new ut(J.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ut(J.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.u_=t,this.h_=e}return Object.defineProperty(n.prototype,"latitude",{get:function(){return this.u_},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"longitude",{get:function(){return this.h_},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return this.u_===t.u_&&this.h_===t.h_},n.prototype.toJSON=function(){return{latitude:this.u_,longitude:this.h_}},n.prototype.Y=function(t){return te(this.u_,t.u_)||te(this.h_,t.h_)},n}(),es=function(n){this.l_=n},Ku=/^__.*__$/,ko=function(n,t,e){this.__=n,this.f_=t,this.d_=e},Qu=function(){function n(t,e,i){this.data=t,this.We=e,this.fieldTransforms=i}return n.prototype.w_=function(t,e){var i=[];return i.push(null!==this.We?new dn(t,this.data,this.We,e):new pn(t,this.data,e)),this.fieldTransforms.length>0&&i.push(new Gn(t,this.fieldTransforms)),i},n}(),ha=function(){function n(t,e,i){this.data=t,this.We=e,this.fieldTransforms=i}return n.prototype.w_=function(t,e){var i=[new dn(t,this.data,this.We,e)];return this.fieldTransforms.length>0&&i.push(new Gn(t,this.fieldTransforms)),i},n}();function pa(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ct()}}var da=function(){function n(t,e,i,s,l,f){this.settings=t,this.U=e,this.serializer=i,this.ignoreUndefinedProperties=s,void 0===l&&this.m_(),this.fieldTransforms=l||[],this.We=f||[]}return Object.defineProperty(n.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"s_",{get:function(){return this.settings.s_},enumerable:!1,configurable:!0}),n.prototype.T_=function(t){return new n(Object.assign(Object.assign({},this.settings),t),this.U,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.We)},n.prototype.E_=function(t){var e,i=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.T_({path:i,o_:!1});return s.I_(t),s},n.prototype.A_=function(t){var e,i=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.T_({path:i,o_:!1});return s.m_(),s},n.prototype.R_=function(t){return this.T_({path:void 0,o_:!0})},n.prototype.i_=function(t){return Ns(t,this.settings.methodName,this.settings.g_||!1,this.path,this.settings.r_)},n.prototype.contains=function(t){return void 0!==this.We.find(function(e){return t.T(e)})||void 0!==this.fieldTransforms.find(function(e){return t.T(e.field)})},n.prototype.m_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.I_(this.path.get(t))},n.prototype.I_=function(t){if(0===t.length)throw this.i_("Document fields must not be empty");if(pa(this.s_)&&Ku.test(t))throw this.i_('Document fields cannot begin and end with "__"')},n}(),Yu=function(){function n(t,e,i){this.U=t,this.ignoreUndefinedProperties=e,this.serializer=i||Es(t)}return n.prototype.P_=function(t,e,i,s){return void 0===s&&(s=!1),new da({s_:t,methodName:e,r_:i,path:S.P(),o_:!1,g_:s},this.U,this.serializer,this.ignoreUndefinedProperties)},n}();function Ts(n,t,e,i,s,l){void 0===l&&(l={});var f=n.P_(l.merge||l.mergeFields?2:0,t,e,s);As("Data must be an object, but it was:",f,i);var d,w,O=ya(i,f);if(l.merge)d=new kt(f.We),w=f.fieldTransforms;else if(l.mergeFields){for(var U=[],X=0,$=l.mergeFields;X<$.length;X++){var st=$[X],vt=void 0;if(st instanceof Is)vt=st.t_;else{if("string"!=typeof st)throw ct();vt=Rs(t,st,e)}if(!f.contains(vt))throw new ut(J.INVALID_ARGUMENT,"Field '"+vt+"' is specified in your field mask but missing from your input data.");ma(U,vt)||U.push(vt)}d=new kt(U),w=f.fieldTransforms.filter(function(Et){return d.Ye(Et.field)})}else d=null,w=f.fieldTransforms;return new Qu(new qr(O),d,w)}function Ss(n,t,e,i){var s=n.P_(1,t,e);As("Data must be an object, but it was:",s,i);var l=[],f=new Gr;ne(i,function(w,O){var U=Rs(t,w,e),X=s.A_(U);if(O instanceof Lo||O instanceof es&&O.l_ instanceof Lo)l.push(U);else{var $=ao(O,X);null!=$&&(l.push(U),f.set(U,$))}});var d=new kt(l);return new ha(f.Xe(),d,s.fieldTransforms)}function Cs(n,t,e,i,s,l){var f=n.P_(1,t,e),d=[Mo(t,i,e)],w=[s];if(l.length%2!=0)throw new ut(J.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var O=0;O<l.length;O+=2)d.push(Mo(t,l[O])),w.push(l[O+1]);for(var U=[],X=new Gr,$=d.length-1;$>=0;--$)if(!ma(U,d[$])){var st=d[$],vt=w[$],Et=f.A_(st);if(vt instanceof Lo||vt instanceof es&&vt.l_ instanceof Lo)U.push(st);else{var ce=ao(vt,Et);null!=ce&&(U.push(st),X.set(st,ce))}}var oe=new kt(U);return new ha(X.Xe(),oe,f.fieldTransforms)}function va(n,t,e,i){return void 0===i&&(i=!1),ao(e,n.P_(i?4:3,t))}function ao(n,t){if(n instanceof es&&(n=n.l_),ga(n))return As("Unsupported field value:",t,n),ya(n,t);if(n instanceof so)return function(e,i){if(!pa(i.s_))throw i.i_(e.e_+"() can only be used with update() and set()");if(!i.path)throw i.i_(e.e_+"() is not currently supported inside arrays");var s=e.n_(i);s&&i.fieldTransforms.push(s)}(n,t),null;if(t.path&&t.We.push(t.path),n instanceof Array){if(t.settings.o_&&4!==t.s_)throw t.i_("Nested arrays are not supported");return function(e,i){for(var s=[],l=0,f=0,d=e;f<d.length;f++){var w=ao(d[f],i.R_(l));null==w&&(w={nullValue:"NULL_VALUE"}),s.push(w),l++}return{arrayValue:{values:s}}}(n,t)}return function(e,i){if(null===e)return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Pr(i.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var s=Ce.fromDate(e);return{timestampValue:Qr(i.serializer,s)}}if(e instanceof Ce){var l=new Ce(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Qr(i.serializer,l)}}if(e instanceof ts)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof en)return{bytesValue:oi(i.serializer,e.q)};if(e instanceof ko){var f=i.U,d=e.__;if(!d.isEqual(f))throw i.i_("Document reference is for database "+d.projectId+"/"+d.database+" but should be for database "+f.projectId+"/"+f.database);return{referenceValue:si(e.__||i.U,e.f_.path)}}if(void 0===e&&i.ignoreUndefinedProperties)return null;throw i.i_("Unsupported field value: "+Nt(e))}(n,t)}function ya(n,t){var e={};return qt(n)?t.path&&t.path.length>0&&t.We.push(t.path):ne(n,function(i,s){var l=ao(s,t.E_(i));null!=l&&(e[i]=l)}),{mapValue:{fields:e}}}function ga(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Ce||n instanceof ts||n instanceof en||n instanceof ko||n instanceof so)}function As(n,t,e){if(!ga(e)||!ht(e)){var i=Nt(e);throw t.i_("an object"===i?n+" a custom object":n+" "+i)}}function Mo(n,t,e){if(t instanceof Is)return t.t_;if("string"==typeof t)return Rs(n,t);throw Ns("Field path arguments must be of type string or FieldPath.",n,!1,void 0,e)}function Rs(n,t,e){try{return function(s){if(s.search(qu)>=0)throw new ut(J.INVALID_ARGUMENT,"Invalid field path ("+s+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(oo.bind.apply(oo,B.__spreadArrays([void 0],s.split("."))))}catch(l){throw new ut(J.INVALID_ARGUMENT,"Invalid field path ("+s+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t).t_}catch(s){throw Ns((i=s)instanceof Error?i.message:i.toString(),n,!1,void 0,e)}var i}function Ns(n,t,e,i,s){var l=i&&!i.m(),f=void 0!==s,d="Function "+t+"() called with invalid data";e&&(d+=" (via `toFirestore()`)");var w="";return(l||f)&&(w+=" (found",l&&(w+=" in field "+i),f&&(w+=" in document "+s),w+=")"),new ut(J.INVALID_ARGUMENT,(d+=". ")+n+w)}function ma(n,t){return n.some(function(e){return e.isEqual(t)})}var Xu=function(){function n(t){this.Ku=t,this.y_=new Map,this.mutations=[],this.V_=!1,this.p_=null,this.b_=new Set}return n.prototype.v_=function(t){return B.__awaiter(this,void 0,void 0,function(){var e,i=this;return B.__generator(this,function(s){switch(s.label){case 0:if(this.S_(),this.mutations.length>0)throw new ut(J.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(l,f){return B.__awaiter(this,void 0,void 0,function(){var d,w,O,U,X,$;return B.__generator(this,function(st){switch(st.label){case 0:return d=mt(l),w=In(d.serializer)+"/documents",O={documents:f.map(function(vt){return qn(d.serializer,vt)})},[4,d.ku("BatchGetDocuments",w,O)];case 1:return U=st.sent(),X=new Map,U.forEach(function(vt){var ce,oe,Et=(ce=d.serializer,"found"in(oe=vt)?function(Ie,Me){Ct(!!Me.found);var tn=$n(Ie,Me.found.name),mn=tr(Me.found.updateTime),Pn=new qr({mapValue:{fields:Me.found.fields}});return new Ze(tn,mn,Pn,{})}(ce,oe):"missing"in oe?function(Ie,Me){Ct(!!Me.missing),Ct(!!Me.readTime);var tn=$n(Ie,Me.missing),mn=tr(Me.readTime);return new Ln(tn,mn)}(ce,oe):ct());X.set(Et.key.toString(),Et)}),$=[],[2,(f.forEach(function(vt){var Et=X.get(vt.toString());Ct(!!Et),$.push(Et)}),$)]}})})}(this.Ku,t)];case 1:return[2,((e=s.sent()).forEach(function(l){l instanceof Ln||l instanceof Ze?i.D_(l):ct()}),e)]}})})},n.prototype.set=function(t,e){this.write(e.w_(t,this.Ge(t))),this.b_.add(t.toString())},n.prototype.update=function(t,e){try{this.write(e.w_(t,this.C_(t)))}catch(i){this.p_=i}this.b_.add(t.toString())},n.prototype.delete=function(t){this.write([new Yn(t,this.Ge(t))]),this.b_.add(t.toString())},n.prototype.commit=function(){return B.__awaiter(this,void 0,void 0,function(){var t,e=this;return B.__generator(this,function(i){switch(i.label){case 0:if(this.S_(),this.p_)throw this.p_;return t=this.y_,this.mutations.forEach(function(s){t.delete(s.key.toString())}),t.forEach(function(s,l){var f=b.D(l);e.mutations.push(new Jr(f,e.Ge(f)))}),[4,function(s,l){return B.__awaiter(this,void 0,void 0,function(){var f,d,w;return B.__generator(this,function(O){switch(O.label){case 0:return f=mt(s),d=In(f.serializer)+"/documents",w={writes:l.map(function(U){return ur(f.serializer,U)})},[4,f.$u("Commit",d,w)];case 1:return O.sent(),[2]}})})}(this.Ku,this.mutations)];case 1:return i.sent(),this.V_=!0,[2]}})})},n.prototype.D_=function(t){var e;if(t instanceof Ze)e=t.version;else{if(!(t instanceof Ln))throw ct();e=we.min()}var i=this.y_.get(t.key.toString());if(i){if(!e.isEqual(i))throw new ut(J.ABORTED,"Document version changed between two reads.")}else this.y_.set(t.key.toString(),e)},n.prototype.Ge=function(t){var e=this.y_.get(t.toString());return!this.b_.has(t.toString())&&e?Qt.updateTime(e):Qt.ze()},n.prototype.C_=function(t){var e=this.y_.get(t.toString());if(!this.b_.has(t.toString())&&e){if(e.isEqual(we.min()))throw new ut(J.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Qt.updateTime(e)}return Qt.exists(!0)},n.prototype.write=function(t){this.S_(),this.mutations=this.mutations.concat(t)},n.prototype.S_=function(){},n}(),$u=function(){function n(t,e,i,s){this.cs=t,this.Ku=e,this.updateFunction=i,this.ls=s,this.N_=5,this.ys=new Mi(this.cs,"transaction_retry")}return n.prototype.run=function(){this.F_()},n.prototype.F_=function(){var t=this;this.ys.gn(function(){return B.__awaiter(t,void 0,void 0,function(){var e,i,s=this;return B.__generator(this,function(l){return e=new Xu(this.Ku),(i=this.x_(e))&&i.then(function(f){s.cs.ws(function(){return e.commit().then(function(){s.ls.resolve(f)}).catch(function(d){s.k_(d)})})}).catch(function(f){s.k_(f)}),[2]})})})},n.prototype.x_=function(t){try{var e=this.updateFunction(t);return!Cn(e)&&e.catch&&e.then?e:(this.ls.reject(Error("Transaction callback must return a Promise")),null)}catch(i){return this.ls.reject(i),null}},n.prototype.k_=function(t){var e=this;this.N_>0&&this.M_(t)?(this.N_-=1,this.cs.ws(function(){return e.F_(),Promise.resolve()})):this.ls.reject(t)},n.prototype.M_=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!kn(e)}return!1},n}(),Ju=function(){function n(t,e){this.credentials=t,this.cs=e,this.clientId=Be.k(),this.O_=new on}return n.prototype.start=function(t,e,i,s){var l=this;this.L_(),this.bl=t;var f=new on,d=!1;return this.credentials.Hc(function(w){if(!d)return d=!0,Tt("FirestoreClient","Initializing. user=",w.uid),l.B_(e,i,s,w,f).then(l.O_.resolve,l.O_.reject);l.cs.Cs(function(){return function(O,U){return B.__awaiter(this,void 0,void 0,function(){var X,$;return B.__generator(this,function(st){switch(st.label){case 0:return(X=mt(O)).cs.xs(),Tt("RemoteStore","RemoteStore received new credentials"),$=Gi(X),X.Yu.add(3),[4,wo(X)];case 1:return st.sent(),$&&X.th.set("Unknown"),[4,X.Gu.Jl(U)];case 2:return st.sent(),X.Yu.delete(3),[4,Do(X)];case 3:return st.sent(),[2]}})})}(l.ph,w)})}),this.cs.ws(function(){return l.O_.promise}),f.promise},n.prototype.enableNetwork=function(){var t=this;return this.L_(),this.cs.enqueue(function(){return t.persistence.tc(!0),(i=mt(t.ph)).Yu.delete(0),Do(i);var i})},n.prototype.B_=function(t,e,i,s,l){return B.__awaiter(this,void 0,void 0,function(){var f,d,w=this;return B.__generator(this,function(O){switch(O.label){case 0:return O.trys.push([0,3,,4]),[4,t.initialize(f={cs:this.cs,bl:this.bl,clientId:this.clientId,credentials:this.credentials,Wl:s,Dh:100,persistenceSettings:i})];case 1:return O.sent(),[4,e.initialize(t,f)];case 2:return O.sent(),this.persistence=t.persistence,this.Sh=t.Sh,this.ju=t.ju,this.ql=t.ql,this.Ku=e.Ku,this.ph=e.ph,this.fi=e.fi,this.q_=e.bh,this.q_.Us=vu.bind(null,this.fi),this.q_.js=yu.bind(null,this.fi),this.persistence.Za(function(){return B.__awaiter(w,void 0,void 0,function(){return B.__generator(this,function(U){switch(U.label){case 0:return[4,this.terminate()];case 1:return U.sent(),[2]}})})}),l.resolve(),[3,4];case 3:if(d=O.sent(),l.reject(d),!this.U_(d))throw d;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+d),this.B_(new $o,new Jo,{jl:!1},s,l))];case 4:return[2]}})})},n.prototype.U_=function(t){return"FirebaseError"===t.name?t.code===J.FAILED_PRECONDITION||t.code===J.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},n.prototype.L_=function(){if(this.cs.ps)throw new ut(J.FAILED_PRECONDITION,"The client has already been terminated.")},n.prototype.disableNetwork=function(){var t=this;return this.L_(),this.cs.enqueue(function(){return t.persistence.tc(!1),function(e){return B.__awaiter(this,void 0,void 0,function(){var i;return B.__generator(this,function(s){switch(s.label){case 0:return(i=mt(e)).Yu.add(0),[4,wo(i)];case 1:return s.sent(),i.th.set("Offline"),[2]}})})}(t.ph)})},n.prototype.terminate=function(){var t=this;this.cs.Ds();var e=new on;return this.cs.bs(function(){return B.__awaiter(t,void 0,void 0,function(){var i,s;return B.__generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,4,,5]),this.ql&&this.ql.stop(),[4,Ys(this.ph)];case 1:return l.sent(),[4,this.Sh.Di()];case 2:return l.sent(),[4,this.persistence.Di()];case 3:return l.sent(),this.credentials.Yc(),e.resolve(),[3,5];case 4:return i=l.sent(),s=lt(i,"Failed to shutdown persistence"),e.reject(s),[3,5];case 5:return[2]}})})}),e.promise},n.prototype.waitForPendingWrites=function(){var t=this;this.L_();var e=new on;return this.cs.ws(function(){return function(i,s){return B.__awaiter(this,void 0,void 0,function(){var l,f,d,w,O;return B.__generator(this,function(U){switch(U.label){case 0:Gi((l=mt(i)).ph)||Tt("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),U.label=1;case 1:return U.trys.push([1,3,,4]),[4,(X=l.ju,$=mt(X),$.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(st){return $.Sr.qo(st)}))];case 2:return-1===(f=U.sent())?[2,void s.resolve()]:((d=l.Lh.get(f)||[]).push(s),l.Lh.set(f,d),[3,4]);case 3:return w=U.sent(),O=lt(w,"Initialization of waitForPendingWrites() operation failed"),s.reject(O),[3,4];case 4:return[2]}var X,$})})}(t.fi,e)}),e.promise},n.prototype.listen=function(t,e,i){var s=this;this.L_();var l=new Zo(i),f=new di(t,l,e);return this.cs.ws(function(){return Ue(s.q_,f)}),function(){l.Zl(),s.cs.ws(function(){return jn(s.q_,f)})}},n.prototype.Q_=function(t){return B.__awaiter(this,void 0,void 0,function(){var e,i=this;return B.__generator(this,function(s){switch(s.label){case 0:return this.L_(),[4,this.O_.promise];case 1:return s.sent(),e=new on,[2,(this.cs.ws(function(){return function(l,f,d){return B.__awaiter(this,void 0,void 0,function(){var w,O,U;return B.__generator(this,function(X){switch(X.label){case 0:return X.trys.push([0,2,,3]),[4,($=l,st=f,vt=mt($),vt.persistence.runTransaction("read document","readonly",function(Et){return vt.Cc.Cr(Et,st)}))];case 1:return(w=X.sent())instanceof Ze?d.resolve(w):w instanceof Ln?d.resolve(null):d.reject(new ut(J.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return O=X.sent(),U=lt(O,"Failed to get document '"+f+" from cache"),d.reject(U),[3,3];case 3:return[2]}var $,st,vt})})}(i.ju,t,e)}),e.promise)]}})})},n.prototype.W_=function(t,e){return void 0===e&&(e={}),B.__awaiter(this,void 0,void 0,function(){var i,s=this;return B.__generator(this,function(l){switch(l.label){case 0:return this.L_(),[4,this.O_.promise];case 1:return l.sent(),i=new on,[2,(this.cs.ws(function(){return f=s.q_,d=s.cs,w=t,O=e,U=i,X=new Zo({next:function(st){d.ws(function(){return jn(f,$)});var vt=st.docs.has(w);!vt&&st.fromCache?U.reject(new ut(J.UNAVAILABLE,"Failed to get document because the client is offline.")):vt&&st.fromCache&&O&&"server"===O.source?U.reject(new ut(J.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):U.resolve(st)},error:function(st){return U.reject(st)}}),$=new di(Wr(w.path),X,{includeMetadataChanges:!0,Xs:!0}),Ue(f,$);var f,d,w,O,U,X,$}),i.promise)]}})})},n.prototype.j_=function(t){return B.__awaiter(this,void 0,void 0,function(){var e,i=this;return B.__generator(this,function(s){switch(s.label){case 0:return this.L_(),[4,this.O_.promise];case 1:return s.sent(),e=new on,[2,(this.cs.ws(function(){return function(l,f,d){return B.__awaiter(this,void 0,void 0,function(){var w,O,U,X,$,st;return B.__generator(this,function(vt){switch(vt.label){case 0:return vt.trys.push([0,2,,3]),[4,Qo(l,f,!0)];case 1:return w=vt.sent(),O=new ra(f,w.Fc),U=O.wh(w.documents),X=O.yr(U,!1),d.resolve(X.snapshot),[3,3];case 2:return $=vt.sent(),st=lt($,"Failed to execute query '"+f+" against cache"),d.reject(st),[3,3];case 3:return[2]}})})}(i.ju,t,e)}),e.promise)]}})})},n.prototype.K_=function(t,e){return void 0===e&&(e={}),B.__awaiter(this,void 0,void 0,function(){var i,s=this;return B.__generator(this,function(l){switch(l.label){case 0:return this.L_(),[4,this.O_.promise];case 1:return l.sent(),i=new on,[2,(this.cs.ws(function(){return f=s.q_,d=s.cs,w=t,O=e,U=i,X=new Zo({next:function(st){d.ws(function(){return jn(f,$)}),st.fromCache&&"server"===O.source?U.reject(new ut(J.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):U.resolve(st)},error:function(st){return U.reject(st)}}),$=new di(w,X,{includeMetadataChanges:!0,Xs:!0}),Ue(f,$);var f,d,w,O,U,X,$}),i.promise)]}})})},n.prototype.write=function(t){var e=this;this.L_();var i=new on;return this.cs.ws(function(){return function(s,l,f){return B.__awaiter(this,void 0,void 0,function(){var d,w,O,U;return B.__generator(this,function(X){switch(X.label){case 0:d=bs(s),X.label=1;case 1:return X.trys.push([1,5,,6]),[4,($=d.ju,st=l,Et=mt($),ce=Ce.now(),oe=st.reduce(function(Ie,Me){return Ie.add(Me.key)},dt()),Et.persistence.runTransaction("Locally write mutations","readwrite",function(Ie){return Et.Cc.kr(Ie,oe).next(function(Me){vt=Me;for(var tn=[],mn=0,Pn=st;mn<Pn.length;mn++){var gi=Pn[mn],Ni=gn(gi,vt.get(gi.key));null!=Ni&&tn.push(new dn(gi.key,Ni,co(Ni.proto.mapValue),Qt.exists(!0)))}return Et.Sr.ko(Ie,ce,tn,st)})}).then(function(Ie){var Me=Ie.lr(vt);return{batchId:Ie.batchId,wr:Me}}))];case 2:return w=X.sent(),d.Sh.xi(w.batchId),function($,st,vt){var Et=$.Oh[$.currentUser.ti()];Et||(Et=new Qe(te)),Et=Et.ot(st,vt),$.Oh[$.currentUser.ti()]=Et}(d,w.batchId,f),[4,io(d,w.wr)];case 3:return X.sent(),[4,bo(d.ph)];case 4:return X.sent(),[3,6];case 5:return O=X.sent(),U=lt(O,"Failed to persist write"),f.reject(U),[3,6];case 6:return[2]}var $,st,vt,Et,ce,oe})})}(e.fi,t,i)}),i.promise},n.prototype.U=function(){return this.bl.U},n.prototype.G_=function(t){var e=this;this.L_();var i=new Zo(t);return this.cs.ws(function(){return B.__awaiter(e,void 0,void 0,function(){return B.__generator(this,function(s){return[2,(l=this.q_,f=i,mt(l).qs.add(f),void f.next())];var l,f})})}),function(){i.Zl(),e.cs.ws(function(){return B.__awaiter(e,void 0,void 0,function(){return B.__generator(this,function(s){return[2,(l=this.q_,f=i,void mt(l).qs.delete(f))];var l,f})})})}},Object.defineProperty(n.prototype,"z_",{get:function(){return this.cs.ps},enumerable:!1,configurable:!0}),n.prototype.transaction=function(t){var e=this;this.L_();var i=new on;return this.cs.ws(function(){return new $u(e.cs,e.Ku,t,i).run(),Promise.resolve()}),i.promise},n}();function Fo(n){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var i=t,s=0,l=["next","error","complete"];s<l.length;s++){var f=l[s];if(f in i&&"function"==typeof i[f])return!0}return!1}(n)}var _a=function(){function n(t,e,i,s,l){this.U=t,this.timestampsInSnapshots=e,this.H_=i,this.Y_=s,this.J_=l}return n.prototype.X_=function(t){switch(W(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ye(t.integerValue||t.doubleValue);case 3:return this.Z_(t.timestampValue);case 4:return this.tf(t);case 5:return t.stringValue;case 6:return this.J_(Ae(t.bytesValue));case 7:return this.ef(t.referenceValue);case 8:return this.nf(t.geoPointValue);case 9:return this.sf(t.arrayValue);case 10:return this.if(t.mapValue);default:throw ct()}},n.prototype.if=function(t){var e=this,i={};return ne(t.fields||{},function(s,l){i[s]=e.X_(l)}),i},n.prototype.nf=function(t){return new ts(Ye(t.latitude),Ye(t.longitude))},n.prototype.sf=function(t){var e=this;return(t.values||[]).map(function(i){return e.X_(i)})},n.prototype.tf=function(t){switch(this.H_){case"previous":var e=y(t);return null==e?null:this.X_(e);case"estimate":return this.Z_(C(t));default:return null}},n.prototype.Z_=function(t){var e=zt(t),i=new Ce(e.seconds,e.nanos);return this.timestampsInSnapshots?i:i.toDate()},n.prototype.ef=function(t){var e=At.g(t);Ct(wi(e));var i=new _n(e.get(1),e.get(3)),s=new b(e.u(5));return i.isEqual(this.U)||ge("Document "+s+" contains a document reference within a different database ("+i.projectId+"/"+i.database+") which is not supported. It will be treated as a reference in the current database ("+this.U.projectId+"/"+this.U.database+") instead."),this.Y_(s)},n}(),wa=k.ho,ba=function(){function n(t){var e,i,s,l,f;if(void 0===t.host){if(void 0!==t.ssl)throw new ut(J.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else tt("settings","non-empty string","host",t.host),this.host=t.host,yt("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(jt("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","experimentalAutoDetectLongPolling","ignoreUndefinedProperties"]),yt("settings","object","credentials",t.credentials),this.credentials=t.credentials,yt("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),yt("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?ge("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&ge("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(i=t.timestampsInSnapshots)||void 0===i||i,this.ignoreUndefinedProperties=null!==(s=t.ignoreUndefinedProperties)&&void 0!==s&&s,yt("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=k._o;else{if(t.cacheSizeBytes!==wa&&t.cacheSizeBytes<k.lo)throw new ut(J.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+k.lo);this.cacheSizeBytes=t.cacheSizeBytes}yt("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.experimentalForceLongPolling=null!==(l=t.experimentalForceLongPolling)&&void 0!==l&&l,yt("settings","boolean","experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalAutoDetectLongPolling=null!==(f=t.experimentalAutoDetectLongPolling)&&void 0!==f&&f,function(d,w,O,U){if(!0===w&&!0===U)throw new ut(J.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}return n.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},n}(),Os=function(){function n(t,e,i,s){var l=this;if(void 0===i&&(i=new $o),void 0===s&&(s=new Jo),this.rf=i,this.af=s,this.cf=null,this.uf=new Z,this.INTERNAL={delete:function(){return B.__awaiter(l,void 0,void 0,function(){return B.__generator(this,function(w){switch(w.label){case 0:return this.hf(),[4,this.lf.terminate()];case 1:return w.sent(),[2]}})})}},"object"==typeof t.options){var f=t;this.cf=f,this.__=n._f(f),this.ff=f.name,this.df=new $a(e)}else{var d=t;if(!d.projectId)throw new ut(J.INVALID_ARGUMENT,"Must provide projectId");this.__=new _n(d.projectId,d.database),this.ff="[DEFAULT]",this.df=new Ks}this.wf=new ba({})}return Object.defineProperty(n.prototype,"mf",{get:function(){return this.Tf||(this.Tf=new Yu(this.__,this.wf.ignoreUndefinedProperties)),this.Tf},enumerable:!1,configurable:!0}),n.prototype.settings=function(t){x("Firestore.settings",arguments,1),Y("Firestore.settings","object",1,t),t.merge&&delete(t=Object.assign(Object.assign({},this.wf),t)).merge;var e=new ba(t);if(this.lf&&!this.wf.isEqual(e))throw new ut(J.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this.wf=e,void 0!==e.credentials&&(this.df=function(i){if(!i)return new Ks;switch(i.type){case"gapi":var s=i.client;return Ct(!("object"!=typeof s||null===s||!s.auth||!s.auth.getAuthHeaderValueForFirstParty)),new Za(s,i.sessionIndex||"0");case"provider":return i.client;default:throw new ut(J.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},n.prototype.enableNetwork=function(){return this.hf(),this.lf.enableNetwork()},n.prototype.disableNetwork=function(){return this.hf(),this.lf.disableNetwork()},n.prototype.enablePersistence=function(t){var e,i;if(this.lf)throw new ut(J.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var s=!1,l=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&ge("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),s=null!==(i=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==i&&i,l=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,s&&l))throw new ut(J.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Ef(this.rf,this.af,{jl:!0,cacheSizeBytes:this.wf.cacheSizeBytes,synchronizeTabs:s,ka:l})},n.prototype.clearPersistence=function(){return B.__awaiter(this,void 0,void 0,function(){var t,e=this;return B.__generator(this,function(i){if(void 0!==this.lf&&!this.lf.z_)throw new ut(J.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return t=new on,[2,(this.uf.bs(function(){return B.__awaiter(e,void 0,void 0,function(){var s;return B.__generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,this.rf.clearPersistence(this.__,this.ff)];case 1:return l.sent(),t.resolve(),[3,3];case 2:return s=l.sent(),t.reject(s),[3,3];case 3:return[2]}})})}),t.promise)]})})},n.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(n.prototype,"If",{get:function(){return this.hf(),this.lf.z_},enumerable:!1,configurable:!0}),n.prototype.waitForPendingWrites=function(){return this.hf(),this.lf.waitForPendingWrites()},n.prototype.onSnapshotsInSync=function(t){return this.hf(),Fo(t)?this.lf.G_(t):(Y("Firestore.onSnapshotsInSync","function",1,t),this.lf.G_({next:t}))},n.prototype.hf=function(){return this.lf||this.Ef(new $o,new Jo,{jl:!1}),this.lf},n.prototype.Af=function(){return new cn(this.__,this.ff,this.wf.host,this.wf.ssl,this.wf.experimentalForceLongPolling,this.wf.experimentalAutoDetectLongPolling)},n.prototype.Ef=function(t,e,i){var s=this.Af();return this.lf=new Ju(this.df,this.uf),this.lf.start(s,t,e,i)},n._f=function(t){if(!Object.prototype.hasOwnProperty.call(t.options,"projectId"))throw new ut(J.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var i=t.options.projectId;if(!i||"string"!=typeof i)throw new ut(J.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new _n(i)},Object.defineProperty(n.prototype,"app",{get:function(){if(!this.cf)throw new ut(J.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.cf},enumerable:!1,configurable:!0}),n.prototype.collection=function(t){return x("Firestore.collection",arguments,1),Y("Firestore.collection","non-empty string",1,t),this.hf(),new rs(At.g(t),this,null)},n.prototype.doc=function(t){return x("Firestore.doc",arguments,1),Y("Firestore.doc","non-empty string",1,t),this.hf(),Hi.Rf(At.g(t),this,null)},n.prototype.collectionGroup=function(t){if(x("Firestore.collectionGroup",arguments,1),Y("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new ut(J.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.hf(),new ns((e=t,new xr(At.P(),e)),this,null);var e},n.prototype.runTransaction=function(t){var e=this;return x("Firestore.runTransaction",arguments,1),Y("Firestore.runTransaction","function",1,t),this.hf().transaction(function(i){return t(new Ea(e,i))})},n.prototype.batch=function(){return this.hf(),new Ia(this)},Object.defineProperty(n,"logLevel",{get:function(){switch(ee()){case D.LogLevel.DEBUG:return"debug";case D.LogLevel.ERROR:return"error";case D.LogLevel.SILENT:return"silent";case D.LogLevel.WARN:return"warn";case D.LogLevel.INFO:return"info";case D.LogLevel.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),n.setLogLevel=function(t){x("Firestore.setLogLevel",arguments,1),Ot("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),Lt.setLogLevel(t)},n.prototype.gf=function(){return this.wf.timestampsInSnapshots},n.prototype.Pf=function(){return this.wf},n}(),Ea=function(){function n(t,e){this.yf=t,this.Vf=e}return n.prototype.get=function(t){var e=this;x("Transaction.get",arguments,1);var i=Ri("Transaction.get",t,this.yf);return this.Vf.v_([i.f_]).then(function(s){if(!s||1!==s.length)return ct();var l=s[0];if(l instanceof Ln)return new uo(e.yf,i.f_,null,!1,!1,i.d_);if(l instanceof Ze)return new uo(e.yf,i.f_,l,!1,!1,i.d_);throw ct()})},n.prototype.set=function(t,e,i){z("Transaction.set",arguments,2,3);var s=Ri("Transaction.set",t,this.yf);i=xs("Transaction.set",i);var l=Ls(s.d_,e,i),f=Ts(this.yf.mf,"Transaction.set",s.f_,l,null!==s.d_,i);return this.Vf.set(s.f_,f),this},n.prototype.update=function(t,e,i){for(var s,l,f=[],d=3;d<arguments.length;d++)f[d-3]=arguments[d];return"string"==typeof e||e instanceof oo?(T("Transaction.update",arguments,3),s=Ri("Transaction.update",t,this.yf),l=Cs(this.yf.mf,"Transaction.update",s.f_,e,i,f)):(x("Transaction.update",arguments,2),s=Ri("Transaction.update",t,this.yf),l=Ss(this.yf.mf,"Transaction.update",s.f_,e)),this.Vf.update(s.f_,l),this},n.prototype.delete=function(t){x("Transaction.delete",arguments,1);var e=Ri("Transaction.delete",t,this.yf);return this.Vf.delete(e.f_),this},n}(),Ia=function(){function n(t){this.yf=t,this.pf=[],this.bf=!1}return n.prototype.set=function(t,e,i){z("WriteBatch.set",arguments,2,3),this.vf();var s=Ri("WriteBatch.set",t,this.yf);i=xs("WriteBatch.set",i);var l=Ls(s.d_,e,i),f=Ts(this.yf.mf,"WriteBatch.set",s.f_,l,null!==s.d_,i);return this.pf=this.pf.concat(f.w_(s.f_,Qt.ze())),this},n.prototype.update=function(t,e,i){for(var s,l,f=[],d=3;d<arguments.length;d++)f[d-3]=arguments[d];return this.vf(),"string"==typeof e||e instanceof oo?(T("WriteBatch.update",arguments,3),s=Ri("WriteBatch.update",t,this.yf),l=Cs(this.yf.mf,"WriteBatch.update",s.f_,e,i,f)):(x("WriteBatch.update",arguments,2),s=Ri("WriteBatch.update",t,this.yf),l=Ss(this.yf.mf,"WriteBatch.update",s.f_,e)),this.pf=this.pf.concat(l.w_(s.f_,Qt.exists(!0))),this},n.prototype.delete=function(t){x("WriteBatch.delete",arguments,1),this.vf();var e=Ri("WriteBatch.delete",t,this.yf);return this.pf=this.pf.concat(new Yn(e.f_,Qt.ze())),this},n.prototype.commit=function(){return this.vf(),this.bf=!0,this.pf.length>0?this.yf.hf().write(this.pf):Promise.resolve()},n.prototype.vf=function(){if(this.bf)throw new ut(J.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},n}(),Hi=function(n){function t(e,i,s){var l=this;return(l=n.call(this,i.__,e,s)||this).f_=e,l.firestore=i,l.d_=s,l.lf=l.firestore.hf(),l}return B.__extends(t,n),t.Rf=function(e,i,s){if(e.length%2!=0)throw new ut(J.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.R()+" has "+e.length);return new t(new b(e),i,s)},Object.defineProperty(t.prototype,"id",{get:function(){return this.f_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new rs(this.f_.path.h(),this.firestore,this.d_)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this.f_.path.R()},enumerable:!1,configurable:!0}),t.prototype.collection=function(e){if(x("DocumentReference.collection",arguments,1),Y("DocumentReference.collection","non-empty string",1,e),!e)throw new ut(J.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var i=At.g(e);return new rs(this.f_.path.child(i),this.firestore,null)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw se("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this.f_.isEqual(e.f_)&&this.d_===e.d_},t.prototype.set=function(e,i){z("DocumentReference.set",arguments,1,2),i=xs("DocumentReference.set",i);var s=Ls(this.d_,e,i),l=Ts(this.firestore.mf,"DocumentReference.set",this.f_,s,null!==this.d_,i);return this.lf.write(l.w_(this.f_,Qt.ze()))},t.prototype.update=function(e,i){for(var s,l=[],f=2;f<arguments.length;f++)l[f-2]=arguments[f];return"string"==typeof e||e instanceof oo?(T("DocumentReference.update",arguments,2),s=Cs(this.firestore.mf,"DocumentReference.update",this.f_,e,i,l)):(x("DocumentReference.update",arguments,1),s=Ss(this.firestore.mf,"DocumentReference.update",this.f_,e)),this.lf.write(s.w_(this.f_,Qt.exists(!0)))},t.prototype.delete=function(){return x("DocumentReference.delete",arguments,0),this.lf.write([new Yn(this.f_,Qt.ze())])},t.prototype.onSnapshot=function(){for(var e,i,s,l=this,f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];z("DocumentReference.onSnapshot",arguments,1,4);var w={includeMetadataChanges:!1},O=0;"object"!=typeof f[O]||Fo(f[O])||(jt("DocumentReference.onSnapshot",w=f[O],["includeMetadataChanges"]),yt("DocumentReference.onSnapshot","boolean","includeMetadataChanges",w.includeMetadataChanges),O++);var U={includeMetadataChanges:w.includeMetadataChanges};if(Fo(f[O])){var X=f[O];f[O]=null===(e=X.next)||void 0===e?void 0:e.bind(X),f[O+1]=null===(i=X.error)||void 0===i?void 0:i.bind(X),f[O+2]=null===(s=X.complete)||void 0===s?void 0:s.bind(X)}else Y("DocumentReference.onSnapshot","function",O,f[O]),Xt("DocumentReference.onSnapshot","function",O+1,f[O+1]),Xt("DocumentReference.onSnapshot","function",O+2,f[O+2]);var $={next:function(st){f[O]&&f[O](l.Sf(st))},error:f[O+1],complete:f[O+2]};return this.lf.listen(Wr(this.f_.path),U,$)},t.prototype.get=function(e){var i=this;z("DocumentReference.get",arguments,0,1),Oa("DocumentReference.get",e);var s=this.firestore.hf();return e&&"cache"===e.source?s.Q_(this.f_).then(function(l){return new uo(i.firestore,i.f_,l,!0,l instanceof Ze&&l.Je,i.d_)}):s.W_(this.f_,e).then(function(l){return i.Sf(l)})},t.prototype.withConverter=function(e){return new t(this.f_,this.firestore,e)},t.prototype.Sf=function(e){var i=e.docs.get(this.f_);return new uo(this.firestore,this.f_,i,e.fromCache,e.hasPendingWrites,this.d_)},t}(ko),Ta=function(){function n(t,e){this.hasPendingWrites=t,this.fromCache=e}return n.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},n}(),uo=function(){function n(t,e,i,s,l,f){this.yf=t,this.f_=e,this.Df=i,this.Cf=s,this.Nf=l,this.d_=f}return n.prototype.data=function(t){var e=this;if(z("DocumentSnapshot.data",arguments,0,1),t=Na("DocumentSnapshot.data",t),this.Df){if(this.d_){var i=new Ps(this.yf,this.f_,this.Df,this.Cf,this.Nf,null);return this.d_.fromFirestore(i,t)}return new _a(this.yf.__,this.yf.gf(),t.serverTimestamps||"none",function(s){return new Hi(s,e.yf,null)},function(s){return new hn(s)}).X_(this.Df.rn())}},n.prototype.get=function(t,e){var i=this;if(z("DocumentSnapshot.get",arguments,1,2),e=Na("DocumentSnapshot.get",e),this.Df){var s=this.Df.data().field(Mo("DocumentSnapshot.get",t,this.f_));if(null!==s)return new _a(this.yf.__,this.yf.gf(),e.serverTimestamps||"none",function(l){return new Hi(l,i.yf,i.d_)},function(l){return new hn(l)}).X_(s)}},Object.defineProperty(n.prototype,"id",{get:function(){return this.f_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ref",{get:function(){return new Hi(this.f_,this.yf,this.d_)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"exists",{get:function(){return null!==this.Df},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"metadata",{get:function(){return new Ta(this.Nf,this.Cf)},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){if(!(t instanceof n))throw se("isEqual","DocumentSnapshot",1,t);return this.yf===t.yf&&this.Cf===t.Cf&&this.f_.isEqual(t.f_)&&(null===this.Df?null===t.Df:this.Df.isEqual(t.Df))&&this.d_===t.d_},n}(),Ps=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return B.__extends(t,n),t.prototype.data=function(e){return n.prototype.data.call(this,e)},t}(uo);function Zu(n,t,e,i,s,l,f){var d;if(s.p()){if("array-contains"===l||"array-contains-any"===l)throw new ut(J.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+l+"' queries on FieldPath.documentId().");if("in"===l||"not-in"===l){Ca(f,l);for(var w=[],O=0,U=f;O<U.length;O++)w.push(Sa(i,n,U[O]));d={arrayValue:{values:w}}}else d=Sa(i,n,f)}else"in"!==l&&"not-in"!==l&&"array-contains-any"!==l||Ca(f,l),d=va(e,t,f,"in"===l||"not-in"===l);var $=Jn.create(s,l,d);return function(st,vt){if(vt.hn()){var Et=Pi(st);if(null!==Et&&!Et.isEqual(vt.field))throw new ut(J.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+Et.toString()+"' and '"+vt.field.toString()+"'");var ce=fi(st);null!==ce&&Aa(0,vt.field,ce)}var oe=function(Ie,Me){for(var tn=0,mn=Ie.filters;tn<mn.length;tn++){var Pn=mn[tn];if(Me.indexOf(Pn.op)>=0)return Pn.op}return null}(st,function(Ie){switch(Ie){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(vt.op));if(null!==oe)throw new ut(J.INVALID_ARGUMENT,oe===vt.op?"Invalid query. You cannot use more than one '"+vt.op.toString()+"' filter.":"Invalid query. You cannot use '"+vt.op.toString()+"' filters with '"+oe.toString()+"' filters.")}(n,$),$}function tc(n,t,e){if(null!==n.startAt)throw new ut(J.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==n.endAt)throw new ut(J.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var i=new ei(t,e);return function(s,l){if(null===fi(s)){var f=Pi(s);null!==f&&Aa(0,f,l.field)}}(n,i),i}function Sa(n,t,e){if("string"==typeof e){if(""===e)throw new ut(J.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Cr(t)&&-1!==e.indexOf("/"))throw new ut(J.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+e+"' contains a '/' character.");var i=t.path.child(At.g(e));if(!b.F(i))throw new ut(J.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+i+"' is not because it has an odd number of segments ("+i.length+").");return Bn(n,new b(i))}if(e instanceof ko)return Bn(n,e.f_);throw new ut(J.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Nt(e)+".")}function Ca(n,t){if(!Array.isArray(n)||0===n.length)throw new ut(J.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(n.length>10)throw new ut(J.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===t||"array-contains-any"===t){if(n.indexOf(null)>=0)throw new ut(J.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters cannot contain 'null' in the value array.");if(n.filter(function(e){return Number.isNaN(e)}).length>0)throw new ut(J.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters cannot contain 'NaN' in the value array.")}}function Aa(n,t,e){if(!e.isEqual(t))throw new ut(J.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+e.toString()+"' instead.")}function Ra(n){if(Zr(n)&&0===n.on.length)throw new ut(J.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ns=function(){function n(t,e,i){this.Ff=t,this.firestore=e,this.d_=i}return n.prototype.where=function(t,e,i){x("Query.where",arguments,3),re("Query.where",3,i);var d,O,s=Ot("Query.where",["<","<=","==","!=",">=",">","array-contains","in","array-contains-any","not-in"],2,e),l=Mo("Query.where",t),f=Zu(this.Ff,"Query.where",this.firestore.mf,this.firestore.__,l,s,i);return new n((O=(d=this.Ff).filters.concat([f]),new xr(d.path,d.collectionGroup,d.on.slice(),O,d.limit,d.an,d.startAt,d.endAt)),this.firestore,this.d_)},n.prototype.orderBy=function(t,e){var i;if(z("Query.orderBy",arguments,1,2),Xt("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)i="asc";else{if("desc"!==e)throw new ut(J.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");i="desc"}var f,w,s=Mo("Query.orderBy",t),l=tc(this.Ff,s,i);return new n((w=(f=this.Ff).on.concat([l]),new xr(f.path,f.collectionGroup,w,f.filters.slice(),f.limit,f.an,f.startAt,f.endAt)),this.firestore,this.d_)},n.prototype.limit=function(t){return x("Query.limit",arguments,1),Y("Query.limit","number",1,t),ye("Query.limit",1,t),new n(hi(this.Ff,t,"F"),this.firestore,this.d_)},n.prototype.limitToLast=function(t){return x("Query.limitToLast",arguments,1),Y("Query.limitToLast","number",1,t),ye("Query.limitToLast",1,t),new n(hi(this.Ff,t,"L"),this.firestore,this.d_)},n.prototype.startAt=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];T("Query.startAt",arguments,1);var s=this.xf("Query.startAt",t,e,!0);return new n(Ki(this.Ff,s),this.firestore,this.d_)},n.prototype.startAfter=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];T("Query.startAfter",arguments,1);var s=this.xf("Query.startAfter",t,e,!1);return new n(Ki(this.Ff,s),this.firestore,this.d_)},n.prototype.endBefore=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];T("Query.endBefore",arguments,1);var s=this.xf("Query.endBefore",t,e,!0);return new n(Di(this.Ff,s),this.firestore,this.d_)},n.prototype.endAt=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];T("Query.endAt",arguments,1);var s=this.xf("Query.endAt",t,e,!1);return new n(Di(this.Ff,s),this.firestore,this.d_)},n.prototype.isEqual=function(t){if(!(t instanceof n))throw se("isEqual","Query",1,t);return this.firestore===t.firestore&&Lr(this.Ff,t.Ff)&&this.d_===t.d_},n.prototype.withConverter=function(t){return new n(this.Ff,this.firestore,t)},n.prototype.xf=function(t,e,i,s){if(re(t,1,e),e instanceof uo)return x(t,B.__spreadArrays([e],i),1),function(f,d,w,O,U){if(!O)throw new ut(J.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+w+"().");for(var X=[],$=0,st=Ar(f);$<st.length;$++){var vt=st[$];if(vt.field.p())X.push(Bn(d,O.key));else{var Et=O.field(vt.field);if(P(Et))throw new ut(J.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+vt.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===Et){var ce=vt.field.R();throw new ut(J.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+ce+"' (used as the orderBy) does not exist.")}X.push(Et)}}return new Rr(X,U)}(this.Ff,this.firestore.__,t,e.Df,s);var l=[e].concat(i);return function(f,d,w,O,U,X){var $=f.on;if(U.length>$.length)throw new ut(J.INVALID_ARGUMENT,"Too many arguments provided to "+O+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var st=[],vt=0;vt<U.length;vt++){var Et=U[vt];if($[vt].field.p()){if("string"!=typeof Et)throw new ut(J.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+O+"(), but got a "+typeof Et);if(!Cr(f)&&-1!==Et.indexOf("/"))throw new ut(J.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+O+"() must be a plain document ID, but '"+Et+"' contains a slash.");var ce=f.path.child(At.g(Et));if(!b.F(ce))throw new ut(J.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+O+"() must result in a valid document path, but '"+ce+"' is not because it contains an odd number of segments.");var oe=new b(ce);st.push(Bn(d,oe))}else{var Ie=va(w,O,Et);st.push(Ie)}}return new Rr(st,X)}(this.Ff,this.firestore.__,this.firestore.mf,t,l,s)},n.prototype.onSnapshot=function(){for(var t,e,i,s=this,l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];z("Query.onSnapshot",arguments,1,4);var d={},w=0;if("object"!=typeof l[w]||Fo(l[w])||(jt("Query.onSnapshot",d=l[w],["includeMetadataChanges"]),yt("Query.onSnapshot","boolean","includeMetadataChanges",d.includeMetadataChanges),w++),Fo(l[w])){var O=l[w];l[w]=null===(t=O.next)||void 0===t?void 0:t.bind(O),l[w+1]=null===(e=O.error)||void 0===e?void 0:e.bind(O),l[w+2]=null===(i=O.complete)||void 0===i?void 0:i.bind(O)}else Y("Query.onSnapshot","function",w,l[w]),Xt("Query.onSnapshot","function",w+1,l[w+1]),Xt("Query.onSnapshot","function",w+2,l[w+2]);var U={next:function(X){l[w]&&l[w](new Ds(s.firestore,s.Ff,X,s.d_))},error:l[w+1],complete:l[w+2]};return Ra(this.Ff),this.firestore.hf().listen(this.Ff,d,U)},n.prototype.get=function(t){var e=this;z("Query.get",arguments,0,1),Oa("Query.get",t),Ra(this.Ff);var i=this.firestore.hf();return(t&&"cache"===t.source?i.j_(this.Ff):i.K_(this.Ff,t)).then(function(s){return new Ds(e.firestore,e.Ff,s,e.d_)})},n}(),Ds=function(){function n(t,e,i,s){this.yf=t,this.$f=e,this.kf=i,this.d_=s,this.Mf=null,this.Of=null,this.metadata=new Ta(i.hasPendingWrites,i.fromCache)}return Object.defineProperty(n.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"empty",{get:function(){return this.kf.docs.m()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){return this.kf.docs.size},enumerable:!1,configurable:!0}),n.prototype.forEach=function(t,e){var i=this;z("QuerySnapshot.forEach",arguments,1,2),Y("QuerySnapshot.forEach","function",1,t),this.kf.docs.forEach(function(s){t.call(e,i.Lf(s,i.metadata.fromCache,i.kf.Wt.has(s.key)))})},Object.defineProperty(n.prototype,"query",{get:function(){return new ns(this.$f,this.yf,this.d_)},enumerable:!1,configurable:!0}),n.prototype.docChanges=function(t){t&&(jt("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),yt("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.kf.Kt)throw new ut(J.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Mf&&this.Of===e||(this.Mf=function(i,s,l){if(i.Qt.m()){var f=0;return i.docChanges.map(function(w){return{type:"added",doc:l(w.doc,i.fromCache,i.Wt.has(w.doc.key)),oldIndex:-1,newIndex:f++}})}var d=i.Qt;return i.docChanges.filter(function(w){return s||3!==w.type}).map(function(w){var O=l(w.doc,i.fromCache,i.Wt.has(w.doc.key)),U=-1,X=-1;return 0!==w.type&&(U=d.indexOf(w.doc.key),d=d.delete(w.doc.key)),1!==w.type&&(X=(d=d.add(w.doc)).indexOf(w.doc.key)),{type:ec(w.type),doc:O,oldIndex:U,newIndex:X}})}(this.kf,e,this.Lf.bind(this)),this.Of=e),this.Mf},n.prototype.isEqual=function(t){if(!(t instanceof n))throw se("isEqual","QuerySnapshot",1,t);return this.yf===t.yf&&Lr(this.$f,t.$f)&&this.kf.isEqual(t.kf)&&this.d_===t.d_},n.prototype.Lf=function(t,e,i){return new Ps(this.yf,t.key,t,e,i,this.d_)},n}(),rs=function(n){function t(e,i,s){var l=this;if((l=n.call(this,Wr(e),i,s)||this).Bf=e,e.length%2!=1)throw new ut(J.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.R()+" has "+e.length);return l}return B.__extends(t,n),Object.defineProperty(t.prototype,"id",{get:function(){return this.Ff.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=this.Ff.path.h();return e.m()?null:new Hi(new b(e),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this.Ff.path.R()},enumerable:!1,configurable:!0}),t.prototype.doc=function(e){z("CollectionReference.doc",arguments,0,1),0===arguments.length&&(e=Be.k()),Y("CollectionReference.doc","non-empty string",1,e);var i=At.g(e);return Hi.Rf(this.Ff.path.child(i),this.firestore,this.d_)},t.prototype.add=function(e){x("CollectionReference.add",arguments,1);var i=this.d_?this.d_.toFirestore(e):e;Y("CollectionReference.add","object",1,i);var s=this.doc();return new Hi(s.f_,this.firestore,null).set(i).then(function(){return s})},t.prototype.withConverter=function(e){return new t(this.Bf,this.firestore,e)},t}(ns);function xs(n,t){if(void 0===t)return{merge:!1};if(jt(n,t,["merge","mergeFields"]),yt(n,"boolean","merge",t.merge),void 0!==(l=t.mergeFields)&&function(d,w,O,U,X){if(!(U instanceof Array))throw new ut(J.INVALID_ARGUMENT,"Function "+d+"() requires its "+w+" option to be an array, but it was: "+Nt(U));for(var $=0;$<U.length;++$)if(!X(U[$]))throw new ut(J.INVALID_ARGUMENT,"Function "+d+"() requires all "+w+" elements to be a string or a FieldPath, but the value at index "+$+" was: "+Nt(U[$]))}(n,"mergeFields",0,l,function(e){return"string"==typeof e||e instanceof oo}),void 0!==t.mergeFields&&void 0!==t.merge)throw new ut(J.INVALID_ARGUMENT,"Invalid options passed to function "+n+'(): You cannot specify both "merge" and "mergeFields".');var l;return t}function Na(n,t){return void 0===t?{}:(jt(n,t,["serverTimestamps"]),pe(n,0,"serverTimestamps",t.serverTimestamps,["estimate","previous","none"]),t)}function Oa(n,t){Xt(n,"object",1,t),t&&(jt(n,t,["source"]),pe(n,0,"source",t.source,["default","server","cache"]))}function Ri(n,t,e){if(t instanceof ko){if(t.firestore!==e)throw new ut(J.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}throw se(n,"DocumentReference",1,t)}function ec(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ct()}}function Ls(n,t,e){return n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t}var nc=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return B.__extends(t,n),t.serverTimestamp=function(){A("FieldValue.serverTimestamp",arguments);var e=new Gu("serverTimestamp");return e.e_="FieldValue.serverTimestamp",new t(e)},t.delete=function(){A("FieldValue.delete",arguments);var e=new Lo("deleteField");return e.e_="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];T("FieldValue.arrayUnion",arguments,1);var s=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];return T("arrayUnion()",arguments,1),new Wu("arrayUnion",l)}.apply(void 0,e);return s.e_="FieldValue.arrayUnion",new t(s)},t.arrayRemove=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];T("FieldValue.arrayRemove",arguments,1);var s=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];return T("arrayRemove()",arguments,1),new Hu("arrayRemove",l)}.apply(void 0,e);return s.e_="FieldValue.arrayRemove",new t(s)},t.increment=function(e){Y("FieldValue.increment","number",1,e),x("FieldValue.increment",arguments,1);var i=new zu("increment",e);return i.e_="FieldValue.increment",new t(i)},t.prototype.isEqual=function(e){return this.l_.isEqual(e.l_)},t}(es),rc={Firestore:Os,GeoPoint:ts,Timestamp:Ce,Blob:hn,Transaction:Ea,WriteBatch:Ia,DocumentReference:Hi,DocumentSnapshot:uo,Query:ns,QueryDocumentSnapshot:Ps,QuerySnapshot:Ds,CollectionReference:rs,FieldPath:oo,FieldValue:nc,setLogLevel:Os.setLogLevel,CACHE_SIZE_UNLIMITED:wa};function Pa(n){n.INTERNAL.registerComponent(new Ne.Component("firestore",function(i){return s=i.getProvider("app").getImmediate(),l=i.getProvider("auth-internal"),f=new Jo,d=new Bu(f),new Os(s,l,d,f);var s,l,f,d},"PUBLIC").setServiceProps(Object.assign({},rc))),n.registerVersion("@firebase/firestore","1.18.0")}Pa(de.default),be.__PRIVATE_registerFirestore=Pa},9800:(Xn,be,Bt)=>{"use strict";var B=Bt(6279),Dt=Bt(2483),D=Bt(1100);function Te(qt){return qt&&"object"==typeof qt&&"default"in qt?qt:{default:qt}}var St=Te(B),Ne={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Yt=function(qt){function xt(At,m,S){var b=qt.call(this,m)||this;return Object.setPrototypeOf(b,xt.prototype),b.code=At,b.details=S,b}return Dt.__extends(xt,qt),xt}(Error),ut=function(){function qt(xt,At){var m=this;this.auth=null,this.messaging=null,this.auth=xt.getImmediate({optional:!0}),this.messaging=At.getImmediate({optional:!0}),this.auth||xt.get().then(function(S){return m.auth=S},function(){}),this.messaging||At.get().then(function(S){return m.messaging=S},function(){})}return qt.prototype.getAuthToken=function(){return Dt.__awaiter(this,void 0,void 0,function(){var xt;return Dt.__generator(this,function(m){switch(m.label){case 0:if(!this.auth)return[2,void 0];m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(xt=m.sent())?[2,xt.accessToken]:[2,void 0];case 3:return m.sent(),[2,void 0];case 4:return[2]}})})},qt.prototype.getInstanceIdToken=function(){return Dt.__awaiter(this,void 0,void 0,function(){return Dt.__generator(this,function(xt){if(!this.messaging||!("Notification"in self)||"granted"!==Notification.permission)return[2,void 0];try{return[2,this.messaging.getToken()]}catch(At){return[2,void 0]}return[2]})})},qt.prototype.getContext=function(){return Dt.__awaiter(this,void 0,void 0,function(){var xt,At;return Dt.__generator(this,function(m){switch(m.label){case 0:return[4,this.getAuthToken()];case 1:return xt=m.sent(),[4,this.getInstanceIdToken()];case 2:return At=m.sent(),[2,{authToken:xt,instanceIdToken:At}]}})})},qt}();function Tt(qt,xt){var At={};for(var m in qt)qt.hasOwnProperty(m)&&(At[m]=xt(qt[m]));return At}var qt,xt,At,ge=function(){function qt(){}return qt.prototype.encode=function(xt){var At=this;if(null==xt)return null;if(xt instanceof Number&&(xt=xt.valueOf()),"number"==typeof xt&&isFinite(xt)||!0===xt||!1===xt||"[object String]"===Object.prototype.toString.call(xt))return xt;if(Array.isArray(xt))return xt.map(function(m){return At.encode(m)});if("function"==typeof xt||"object"==typeof xt)return Tt(xt,function(m){return At.encode(m)});throw new Error("Data cannot be encoded in JSON: "+xt)},qt.prototype.decode=function(xt){var At=this;if(null==xt)return xt;if(xt["@type"])switch(xt["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var m=Number(xt.value);if(isNaN(m))throw new Error("Data cannot be decoded from JSON: "+xt);return m;default:throw new Error("Data cannot be decoded from JSON: "+xt)}return Array.isArray(xt)?xt.map(function(S){return At.decode(S)}):"function"==typeof xt||"object"==typeof xt?Tt(xt,function(S){return At.decode(S)}):xt},qt}(),ve=function(){function qt(xt,At,m,S,b){var A=this;void 0===S&&(S="us-central1"),this.app_=xt,this.fetchImpl=b,this.serializer=new ge,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return Promise.resolve(A.deleteService())}},this.contextProvider=new ut(At,m),this.cancelAllRequests=new Promise(function(T){A.deleteService=function(){return T()}});try{var x=new URL(S);this.customDomain=x.origin,this.region="us-central1"}catch(T){this.customDomain=null,this.region=S}}return Object.defineProperty(qt.prototype,"app",{get:function(){return this.app_},enumerable:!1,configurable:!0}),qt.prototype._url=function(xt){var At=this.app_.options.projectId;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+At+"/"+this.region+"/"+xt:null!==this.customDomain?this.customDomain+"/"+xt:"https://"+this.region+"-"+At+".cloudfunctions.net/"+xt},qt.prototype.useFunctionsEmulator=function(xt){this.emulatorOrigin=xt},qt.prototype.httpsCallable=function(xt,At){var m=this;return function(S){return m.call(xt,S,At||{})}},qt.prototype.postJSON=function(xt,At,m){return Dt.__awaiter(this,void 0,void 0,function(){var S,A;return Dt.__generator(this,function(T){switch(T.label){case 0:m["Content-Type"]="application/json",T.label=1;case 1:return T.trys.push([1,3,,4]),[4,this.fetchImpl(xt,{method:"POST",body:JSON.stringify(At),headers:m})];case 2:return S=T.sent(),[3,4];case 3:return T.sent(),[2,{status:0,json:null}];case 4:A=null,T.label=5;case 5:return T.trys.push([5,7,,8]),[4,S.json()];case 6:return A=T.sent(),[3,8];case 7:return T.sent(),[3,8];case 8:return[2,{status:S.status,json:A}]}})})},qt.prototype.call=function(xt,At,m){return Dt.__awaiter(this,void 0,void 0,function(){var S,b,A,x,z,Y,Xt,tt,yt,pe;return Dt.__generator(this,function(ft){switch(ft.label){case 0:return S=this._url(xt),At=this.serializer.encode(At),b={data:At},A={},[4,this.contextProvider.getContext()];case 1:return(x=ft.sent()).authToken&&(A.Authorization="Bearer "+x.authToken),x.instanceIdToken&&(A["Firebase-Instance-ID-Token"]=x.instanceIdToken),z=function(qt){var xt,At=new Promise(function(m,S){xt=setTimeout(function(){S(new Yt("deadline-exceeded","deadline-exceeded"))},qt)});return{timer:xt,promise:At}}(m.timeout||7e4),Y=z.timer,Xt=z.promise,[4,Promise.race([ct(Y,this.postJSON(S,b,A)),Xt,ct(Y,this.cancelAllRequests)])];case 2:if(!(tt=ft.sent()))throw new Yt("cancelled","Firebase Functions instance was deleted.");if(yt=function(qt,xt,At){var m=function(qt){if(qt>=200&&qt<300)return"ok";switch(qt){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(qt),S=m,b=void 0;try{var A=xt&&xt.error;if(A){var x=A.status;if("string"==typeof x){if(!Ne[x])return new Yt("internal","internal");m=Ne[x],S=x}var T=A.message;"string"==typeof T&&(S=T),void 0!==(b=A.details)&&(b=At.decode(b))}}catch(z){}return"ok"===m?null:new Yt(m,S,b)}(tt.status,tt.json,this.serializer))throw yt;if(!tt.json)throw new Yt("internal","Response is not valid JSON object.");if(void 0===(pe=tt.json.data)&&(pe=tt.json.result),void 0===pe)throw new Yt("internal","Response is missing data field.");return[2,{data:this.serializer.decode(pe)}]}})})},qt}();function ct(qt,xt){return Dt.__awaiter(this,void 0,void 0,function(){var At;return Dt.__generator(this,function(m){switch(m.label){case 0:return[4,xt];case 1:return At=m.sent(),clearTimeout(qt),[2,At]}})})}qt=St.default,xt=fetch.bind(self),At={Functions:ve},qt.INTERNAL.registerComponent(new D.Component("functions",function(S,b){var A=S.getProvider("app").getImmediate(),x=S.getProvider("auth-internal"),T=S.getProvider("messaging");return new ve(A,x,T,b,xt)},"PUBLIC").setServiceProps(At).setMultipleInstances(!0)),St.default.registerVersion("@firebase/functions","0.5.1")},7918:(Xn,be,Bt)=>{"use strict";Bt.r(be),Bt.d(be,{registerInstallations:()=>P});var B=Bt(6279),Dt=Bt(1100),St=function(){return(St=Object.assign||function(C){for(var M,W=1,Q=arguments.length;W<Q;W++)for(var rt in M=arguments[W])Object.prototype.hasOwnProperty.call(M,rt)&&(C[rt]=M[rt]);return C}).apply(this,arguments)};function ut(y,C,M,W){return new(M||(M=Promise))(function(rt,Pt){function Vt(zt){try{ie(W.next(zt))}catch(Ye){Pt(Ye)}}function he(zt){try{ie(W.throw(zt))}catch(Ye){Pt(Ye)}}function ie(zt){zt.done?rt(zt.value):function(rt){return rt instanceof M?rt:new M(function(Pt){Pt(rt)})}(zt.value).then(Vt,he)}ie((W=W.apply(y,C||[])).next())})}function Lt(y,C){var W,Q,rt,Pt,M={label:0,sent:function(){if(1&rt[0])throw rt[1];return rt[1]},trys:[],ops:[]};return Pt={next:Vt(0),throw:Vt(1),return:Vt(2)},"function"==typeof Symbol&&(Pt[Symbol.iterator]=function(){return this}),Pt;function Vt(ie){return function(zt){return function(ie){if(W)throw new TypeError("Generator is already executing.");for(;M;)try{if(W=1,Q&&(rt=2&ie[0]?Q.return:ie[0]?Q.throw||((rt=Q.return)&&rt.call(Q),0):Q.next)&&!(rt=rt.call(Q,ie[1])).done)return rt;switch(Q=0,rt&&(ie=[2&ie[0],rt.value]),ie[0]){case 0:case 1:rt=ie;break;case 4:return M.label++,{value:ie[1],done:!1};case 5:M.label++,Q=ie[1],ie=[0];continue;case 7:ie=M.ops.pop(),M.trys.pop();continue;default:if(!(rt=(rt=M.trys).length>0&&rt[rt.length-1])&&(6===ie[0]||2===ie[0])){M=0;continue}if(3===ie[0]&&(!rt||ie[1]>rt[0]&&ie[1]<rt[3])){M.label=ie[1];break}if(6===ie[0]&&M.label<rt[1]){M.label=rt[1],rt=ie;break}if(rt&&M.label<rt[2]){M.label=rt[2],M.ops.push(ie);break}rt[2]&&M.ops.pop(),M.trys.pop();continue}ie=C.call(y,M)}catch(zt){ie=[6,zt],Q=0}finally{W=rt=0}if(5&ie[0])throw ie[1];return{value:ie[0]?ie[1]:void 0,done:!0}}([ie,zt])}}}function ge(y){var C="function"==typeof Symbol&&Symbol.iterator,M=C&&y[C],W=0;if(M)return M.call(y);if(y&&"number"==typeof y.length)return{next:function(){return y&&W>=y.length&&(y=void 0),{value:y&&y[W++],done:!y}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xe(y,C){var M="function"==typeof Symbol&&y[Symbol.iterator];if(!M)return y;var Q,Pt,W=M.call(y),rt=[];try{for(;(void 0===C||C-- >0)&&!(Q=W.next()).done;)rt.push(Q.value)}catch(Vt){Pt={error:Vt}}finally{try{Q&&!Q.done&&(M=W.return)&&M.call(W)}finally{if(Pt)throw Pt.error}}return rt}var ft,b=Bt(1704),A=Bt(6676),T="0.4.17",Y="w:"+T,ht=((ft={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',ft["not-registered"]="Firebase Installation is not registered.",ft["installation-not-found"]="Firebase Installation not found.",ft["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',ft["app-offline"]="Could not process request. Application offline.",ft["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",ft),Nt=new b.ErrorFactory("installations","Installations",ht);function re(y){return y instanceof b.FirebaseError&&y.code.includes("request-failed")}function jt(y){return"https://firebaseinstallations.googleapis.com/v1/projects/"+y.projectId+"/installations"}function se(y){return{token:y.token,requestStatus:2,expiresIn:Be(y.expiresIn),creationTime:Date.now()}}function ye(y,C){return ut(this,void 0,void 0,function(){var M,W;return Lt(this,function(Q){switch(Q.label){case 0:return[4,C.json()];case 1:return M=Q.sent(),[2,Nt.create("request-failed",{requestName:y,serverCode:(W=M.error).code,serverMessage:W.message,serverStatus:W.status})]}})})}function Rt(y){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":y.apiKey})}function Oe(y,C){var M=C.refreshToken,W=Rt(y);return W.append("Authorization",function(y){return"FIS_v2 "+y}(M)),W}function nn(y){return ut(this,void 0,void 0,function(){var C;return Lt(this,function(M){switch(M.label){case 0:return[4,y()];case 1:return(C=M.sent()).status>=500&&C.status<600?[2,y()]:[2,C]}})})}function Be(y){return Number(y.replace("s","000"))}function _e(y,C){var M=C.fid;return ut(this,void 0,void 0,function(){var W,Q,Pt,Vt,he;return Lt(this,function(zt){switch(zt.label){case 0:return W=jt(y),Q=Rt(y),Pt={method:"POST",headers:Q,body:JSON.stringify({fid:M,authVersion:"FIS_v2",appId:y.appId,sdkVersion:Y})},[4,nn(function(){return fetch(W,Pt)})];case 1:return(Vt=zt.sent()).ok?[4,Vt.json()]:[3,3];case 2:return[2,{fid:(he=zt.sent()).fid||M,registrationStatus:2,refreshToken:he.refreshToken,authToken:se(he.authToken)}];case 3:return[4,ye("Create Installation",Vt)];case 4:throw zt.sent()}})})}function vn(y){return new Promise(function(C){setTimeout(C,y)})}var en=/^[cdef][\w-]{21}$/;function Sn(){try{var y=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(y),y[0]=112+y[0]%16;var M=function(y){return function(y){return btoa(String.fromCharCode.apply(String,function(){for(var y=[],C=0;C<arguments.length;C++)y=y.concat(Xe(arguments[C]));return y}(y))).replace(/\+/g,"-").replace(/\//g,"_")}(y).substr(0,22)}(y);return en.test(M)?M:""}catch(W){return""}}function cn(y){return y.appName+"!"+y.appId}var _n=new Map;function qe(y,C){var M=cn(y);Cn(M,C),function(y,C){var M=$e();M&&M.postMessage({key:y,fid:C}),sn()}(M,C)}function Cn(y,C){var M,W,Q=_n.get(y);if(Q)try{for(var rt=ge(Q),Pt=rt.next();!Pt.done;Pt=rt.next())(0,Pt.value)(C)}catch(he){M={error:he}}finally{try{Pt&&!Pt.done&&(W=rt.return)&&W.call(rt)}finally{if(M)throw M.error}}}var fe=null;function $e(){return!fe&&"BroadcastChannel"in self&&((fe=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(y){Cn(y.data.key,y.data.fid)}),fe}function sn(){0===_n.size&&fe&&(fe.close(),fe=null)}var Pe="firebase-installations-store",Se=null;function Ee(){return Se||(Se=(0,A.openDb)("firebase-installations-database",1,function(y){switch(y.oldVersion){case 0:y.createObjectStore(Pe)}})),Se}function ln(y,C){return ut(this,void 0,void 0,function(){var M,W,Q,rt,Pt;return Lt(this,function(Vt){switch(Vt.label){case 0:return M=cn(y),[4,Ee()];case 1:return W=Vt.sent(),Q=W.transaction(Pe,"readwrite"),[4,(rt=Q.objectStore(Pe)).get(M)];case 2:return Pt=Vt.sent(),[4,rt.put(C,M)];case 3:return Vt.sent(),[4,Q.complete];case 4:return Vt.sent(),(!Pt||Pt.fid!==C.fid)&&qe(y,C.fid),[2,C]}})})}function wn(y){return ut(this,void 0,void 0,function(){var C,M,W;return Lt(this,function(Q){switch(Q.label){case 0:return C=cn(y),[4,Ee()];case 1:return M=Q.sent(),[4,(W=M.transaction(Pe,"readwrite")).objectStore(Pe).delete(C)];case 2:return Q.sent(),[4,W.complete];case 3:return Q.sent(),[2]}})})}function kn(y,C){return ut(this,void 0,void 0,function(){var M,W,Q,rt,Pt,Vt;return Lt(this,function(he){switch(he.label){case 0:return M=cn(y),[4,Ee()];case 1:return W=he.sent(),Q=W.transaction(Pe,"readwrite"),[4,(rt=Q.objectStore(Pe)).get(M)];case 2:return Pt=he.sent(),void 0!==(Vt=C(Pt))?[3,4]:[4,rt.delete(M)];case 3:return he.sent(),[3,6];case 4:return[4,rt.put(Vt,M)];case 5:he.sent(),he.label=6;case 6:return[4,Q.complete];case 7:return he.sent(),Vt&&(!Pt||Pt.fid!==Vt.fid)&&qe(y,Vt.fid),[2,Vt]}})})}function Mn(y){return ut(this,void 0,void 0,function(){var C,M,W;return Lt(this,function(Q){switch(Q.label){case 0:return[4,kn(y,function(rt){var Pt=function(y){return Fn(y||{fid:Sn(),registrationStatus:0})}(rt),Vt=function(y,C){if(0===C.registrationStatus){if(!navigator.onLine)return{installationEntry:C,registrationPromise:Promise.reject(Nt.create("app-offline"))};var W={fid:C.fid,registrationStatus:1,registrationTime:Date.now()},Q=function(y,C){return ut(this,void 0,void 0,function(){var M,W;return Lt(this,function(Q){switch(Q.label){case 0:return Q.trys.push([0,2,,7]),[4,_e(y,C)];case 1:return M=Q.sent(),[2,ln(y,M)];case 2:return re(W=Q.sent())&&409===W.serverCode?[4,wn(y)]:[3,4];case 3:return Q.sent(),[3,6];case 4:return[4,ln(y,{fid:C.fid,registrationStatus:0})];case 5:Q.sent(),Q.label=6;case 6:throw W;case 7:return[2]}})})}(y,W);return{installationEntry:W,registrationPromise:Q}}return 1===C.registrationStatus?{installationEntry:C,registrationPromise:Je(y)}:{installationEntry:C}}(y,Pt);return C=Vt.registrationPromise,Vt.installationEntry})];case 1:return""!==(M=Q.sent()).fid?[3,3]:(W={},[4,C]);case 2:return[2,(W.installationEntry=Q.sent(),W)];case 3:return[2,{installationEntry:M,registrationPromise:C}]}})})}function Je(y){return ut(this,void 0,void 0,function(){var C,M,W,Q;return Lt(this,function(rt){switch(rt.label){case 0:return[4,Wn(y)];case 1:C=rt.sent(),rt.label=2;case 2:return 1!==C.registrationStatus?[3,5]:[4,vn(100)];case 3:return rt.sent(),[4,Wn(y)];case 4:return C=rt.sent(),[3,2];case 5:return 0!==C.registrationStatus?[3,7]:[4,Mn(y)];case 6:return M=rt.sent(),W=M.installationEntry,(Q=M.registrationPromise)?[2,Q]:[2,W];case 7:return[2,C]}})})}function Wn(y){return kn(y,function(C){if(!C)throw Nt.create("installation-not-found");return Fn(C)})}function Fn(y){return function(y){return 1===y.registrationStatus&&y.registrationTime+1e4<Date.now()}(y)?{fid:y.fid,registrationStatus:0}:y}function Hn(y,C){var M=y.appConfig,W=y.platformLoggerProvider;return ut(this,void 0,void 0,function(){var Q,rt,Pt,he,ie;return Lt(this,function(Ae){switch(Ae.label){case 0:return Q=function(y,C){var M=C.fid;return jt(y)+"/"+M+"/authTokens:generate"}(M,C),rt=Oe(M,C),(Pt=W.getImmediate({optional:!0}))&&rt.append("x-firebase-client",Pt.getPlatformInfoString()),he={method:"POST",headers:rt,body:JSON.stringify({installation:{sdkVersion:Y}})},[4,nn(function(){return fetch(Q,he)})];case 1:return(ie=Ae.sent()).ok?[4,ie.json()]:[3,3];case 2:return[2,se(Ae.sent())];case 3:return[4,ye("Generate Auth Token",ie)];case 4:throw Ae.sent()}})})}function it(y,C){return void 0===C&&(C=!1),ut(this,void 0,void 0,function(){var M,W,rt;return Lt(this,function(Pt){switch(Pt.label){case 0:return[4,kn(y.appConfig,function(Vt){if(!gt(Vt))throw Nt.create("not-registered");var he=Vt.authToken;if(!C&&function(y){return 2===y.requestStatus&&!function(y){var C=Date.now();return C<y.creationTime||y.creationTime+y.expiresIn<C+36e5}(y)}(he))return Vt;if(1===he.requestStatus)return M=function(y,C){return ut(this,void 0,void 0,function(){var M,W;return Lt(this,function(Q){switch(Q.label){case 0:return[4,wt(y.appConfig)];case 1:M=Q.sent(),Q.label=2;case 2:return 1!==M.authToken.requestStatus?[3,5]:[4,vn(100)];case 3:return Q.sent(),[4,wt(y.appConfig)];case 4:return M=Q.sent(),[3,2];case 5:return 0===(W=M.authToken).requestStatus?[2,it(y,C)]:[2,W]}})})}(y,C),Vt;if(!navigator.onLine)throw Nt.create("app-offline");var ie=function(y){var C={requestStatus:1,requestTime:Date.now()};return St(St({},y),{authToken:C})}(Vt);return M=function(y,C){return ut(this,void 0,void 0,function(){var M,Q,W;return Lt(this,function(rt){switch(rt.label){case 0:return rt.trys.push([0,3,,8]),[4,Hn(y,C)];case 1:return M=rt.sent(),W=St(St({},C),{authToken:M}),[4,ln(y.appConfig,W)];case 2:return rt.sent(),[2,M];case 3:return!re(Q=rt.sent())||401!==Q.serverCode&&404!==Q.serverCode?[3,5]:[4,wn(y.appConfig)];case 4:return rt.sent(),[3,7];case 5:return W=St(St({},C),{authToken:{requestStatus:0}}),[4,ln(y.appConfig,W)];case 6:rt.sent(),rt.label=7;case 7:throw Q;case 8:return[2]}})})}(y,ie),ie})];case 1:return W=Pt.sent(),M?[4,M]:[3,3];case 2:return rt=Pt.sent(),[3,4];case 3:rt=W.authToken,Pt.label=4;case 4:return[2,rt]}})})}function wt(y){return kn(y,function(C){if(!gt(C))throw Nt.create("not-registered");return function(y){return 1===y.requestStatus&&y.requestTime+1e4<Date.now()}(C.authToken)?St(St({},C),{authToken:{requestStatus:0}}):C})}function gt(y){return void 0!==y&&2===y.registrationStatus}function De(y){return ut(this,void 0,void 0,function(){var C;return Lt(this,function(M){switch(M.label){case 0:return[4,Mn(y)];case 1:return(C=M.sent().registrationPromise)?[4,C]:[3,3];case 2:M.sent(),M.label=3;case 3:return[2]}})})}function Fe(y,C){return ut(this,void 0,void 0,function(){var M,W,Q,rt;return Lt(this,function(Pt){switch(Pt.label){case 0:return M=function(y,C){var M=C.fid;return jt(y)+"/"+M}(y,C),W=Oe(y,C),Q={method:"DELETE",headers:W},[4,nn(function(){return fetch(M,Q)})];case 1:return(rt=Pt.sent()).ok?[3,3]:[4,ye("Delete Installation",rt)];case 2:throw Pt.sent();case 3:return[2]}})})}function et(y){return Nt.create("missing-app-config-values",{valueName:y})}function P(y){y.INTERNAL.registerComponent(new Dt.Component("installations",function(M){var W=M.getProvider("app").getImmediate(),Pt={appConfig:function(y){var C,M;if(!y||!y.options)throw et("App Configuration");if(!y.name)throw et("App Name");try{for(var Q=ge(["projectId","apiKey","appId"]),rt=Q.next();!rt.done;rt=Q.next()){var Pt=rt.value;if(!y.options[Pt])throw et(Pt)}}catch(Vt){C={error:Vt}}finally{try{rt&&!rt.done&&(M=Q.return)&&M.call(Q)}finally{if(C)throw C.error}}return{appName:y.name,projectId:y.options.projectId,apiKey:y.options.apiKey,appId:y.options.appId}}(W),platformLoggerProvider:M.getProvider("platform-logger")};return{app:W,getId:function(){return function(y){return ut(this,void 0,void 0,function(){var C,M,W;return Lt(this,function(Q){switch(Q.label){case 0:return[4,Mn(y.appConfig)];case 1:return C=Q.sent(),M=C.installationEntry,(W=C.registrationPromise)?W.catch(console.error):it(y).catch(console.error),[2,M.fid]}})})}(Pt)},getToken:function(he){return function(y,C){return void 0===C&&(C=!1),ut(this,void 0,void 0,function(){return Lt(this,function(W){switch(W.label){case 0:return[4,De(y.appConfig)];case 1:return W.sent(),[4,it(y,C)];case 2:return[2,W.sent().token]}})})}(Pt,he)},delete:function(){return function(y){return ut(this,void 0,void 0,function(){var C,M;return Lt(this,function(W){switch(W.label){case 0:return[4,kn(C=y.appConfig,function(Q){if(!Q||0!==Q.registrationStatus)return Q})];case 1:if(!(M=W.sent()))return[3,6];if(1!==M.registrationStatus)return[3,2];throw Nt.create("delete-pending-registration");case 2:if(2!==M.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw Nt.create("app-offline");case 3:return[4,Fe(C,M)];case 4:return W.sent(),[4,wn(C)];case 5:W.sent(),W.label=6;case 6:return[2]}})})}(Pt)},onIdChange:function(he){return function(y,C){var M=y.appConfig;return function(y,C){$e();var M=cn(y),W=_n.get(M);W||(W=new Set,_n.set(M,W)),W.add(C)}(M,C),function(){!function(y,C){var M=cn(y),W=_n.get(M);!W||(W.delete(C),0===W.size&&_n.delete(M),sn())}(M,C)}}(Pt,he)}}},"PUBLIC")),y.registerVersion("@firebase/installations",T)}P(B.default)},7450:(Xn,be,Bt)=>{"use strict";Bt.r(be),Bt(7918);var Dt=Bt(1100),D=Bt(1704),Ne=function(){return(Ne=Object.assign||function(j){for(var K,et=1,P=arguments.length;et<P;et++)for(var y in K=arguments[et])Object.prototype.hasOwnProperty.call(K,y)&&(j[y]=K[y]);return j}).apply(this,arguments)};function Lt(G,j,K,et){return new(K||(K=Promise))(function(y,C){function M(rt){try{Q(et.next(rt))}catch(Pt){C(Pt)}}function W(rt){try{Q(et.throw(rt))}catch(Pt){C(Pt)}}function Q(rt){rt.done?y(rt.value):function(y){return y instanceof K?y:new K(function(C){C(y)})}(rt.value).then(M,W)}Q((et=et.apply(G,j||[])).next())})}function ee(G,j){var et,P,y,C,K={label:0,sent:function(){if(1&y[0])throw y[1];return y[1]},trys:[],ops:[]};return C={next:M(0),throw:M(1),return:M(2)},"function"==typeof Symbol&&(C[Symbol.iterator]=function(){return this}),C;function M(Q){return function(rt){return function(Q){if(et)throw new TypeError("Generator is already executing.");for(;K;)try{if(et=1,P&&(y=2&Q[0]?P.return:Q[0]?P.throw||((y=P.return)&&y.call(P),0):P.next)&&!(y=y.call(P,Q[1])).done)return y;switch(P=0,y&&(Q=[2&Q[0],y.value]),Q[0]){case 0:case 1:y=Q;break;case 4:return K.label++,{value:Q[1],done:!1};case 5:K.label++,P=Q[1],Q=[0];continue;case 7:Q=K.ops.pop(),K.trys.pop();continue;default:if(!(y=(y=K.trys).length>0&&y[y.length-1])&&(6===Q[0]||2===Q[0])){K=0;continue}if(3===Q[0]&&(!y||Q[1]>y[0]&&Q[1]<y[3])){K.label=Q[1];break}if(6===Q[0]&&K.label<y[1]){K.label=y[1],y=Q;break}if(y&&K.label<y[2]){K.label=y[2],K.ops.push(Q);break}y[2]&&K.ops.pop(),K.trys.pop();continue}Q=j.call(G,K)}catch(rt){Q=[6,rt],P=0}finally{et=y=0}if(5&Q[0])throw Q[1];return{value:Q[0]?Q[1]:void 0,done:!0}}([Q,rt])}}}function Xe(G){var j="function"==typeof Symbol&&Symbol.iterator,K=j&&G[j],et=0;if(K)return K.call(G);if(G&&"number"==typeof G.length)return{next:function(){return G&&et>=G.length&&(G=void 0),{value:G&&G[et++],done:!G}}};throw new TypeError(j?"Object is not iterable.":"Symbol.iterator is not defined.")}function ve(G,j){var K="function"==typeof Symbol&&G[Symbol.iterator];if(!K)return G;var P,C,et=K.call(G),y=[];try{for(;(void 0===j||j-- >0)&&!(P=et.next()).done;)y.push(P.value)}catch(M){C={error:M}}finally{try{P&&!P.done&&(K=et.return)&&K.call(et)}finally{if(C)throw C.error}}return y}var T,A=Bt(6676),x=Bt(6279),z=((T={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',T["only-available-in-window"]="This method is available in a Window context.",T["only-available-in-sw"]="This method is available in a service worker context.",T["permission-default"]="The notification permission was not granted and dismissed instead.",T["permission-blocked"]="The notification permission was not granted and blocked instead.",T["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",T["failed-service-worker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",T["token-subscribe-failed"]="A problem occurred while subscribing the user to FCM: {$errorInfo}",T["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",T["token-unsubscribe-failed"]="A problem occurred while unsubscribing the user from FCM: {$errorInfo}",T["token-update-failed"]="A problem occurred while updating the user from FCM: {$errorInfo}",T["token-update-no-token"]="FCM returned no token when updating the user to push.",T["use-sw-after-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",T["invalid-sw-registration"]="The input to useServiceWorker() must be a ServiceWorkerRegistration.",T["invalid-bg-handler"]="The input to setBackgroundMessageHandler() must be a function.",T["invalid-vapid-key"]="The public VAPID key must be a string.",T["use-vapid-key-after-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",T),Y=new D.ErrorFactory("messaging","Messaging",z),yt="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Ot="FCM_MSG",ft="google.c.a.c_id",se=(()=>{return(G=se||(se={})).PUSH_RECEIVED="push-received",G.NOTIFICATION_CLICKED="notification-clicked",se;var G})();function ye(G){var j=new Uint8Array(G);return btoa(String.fromCharCode.apply(String,function(){for(var G=[],j=0;j<arguments.length;j++)G=G.concat(ve(arguments[j]));return G}(j))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Rt(G){for(var K=(G+"=".repeat((4-G.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),et=atob(K),P=new Uint8Array(et.length),y=0;y<et.length;++y)P[y]=et.charCodeAt(y);return P}var Oe="fcm_token_details_db",Be="fcm_token_object_Store";function te(G){return Lt(this,void 0,void 0,function(){var et,y=this;return ee(this,function(C){switch(C.label){case 0:return"databases"in indexedDB?[4,indexedDB.databases()]:[3,2];case 1:if(!C.sent().map(function(M){return M.name}).includes(Oe))return[2,null];C.label=2;case 2:return et=null,[4,(0,A.openDb)(Oe,5,function(M){return Lt(y,void 0,void 0,function(){var W,Q,rt,Pt;return ee(this,function(Vt){switch(Vt.label){case 0:return M.oldVersion<2?[2]:M.objectStoreNames.contains(Be)?[4,(W=M.transaction.objectStore(Be)).index("fcmSenderId").get(G)]:[2];case 1:return Q=Vt.sent(),[4,W.clear()];case 2:if(Vt.sent(),!Q)return[2];if(2===M.oldVersion){if(!(rt=Q).auth||!rt.p256dh||!rt.endpoint)return[2];et={token:rt.fcmToken,createTime:null!==(Pt=rt.createTime)&&void 0!==Pt?Pt:Date.now(),subscriptionOptions:{auth:rt.auth,p256dh:rt.p256dh,endpoint:rt.endpoint,swScope:rt.swScope,vapidKey:"string"==typeof rt.vapidKey?rt.vapidKey:ye(rt.vapidKey)}}}else(3===M.oldVersion||4===M.oldVersion)&&(et={token:(rt=Q).fcmToken,createTime:rt.createTime,subscriptionOptions:{auth:ye(rt.auth),p256dh:ye(rt.p256dh),endpoint:rt.endpoint,swScope:rt.swScope,vapidKey:ye(rt.vapidKey)}});return[2]}})})})];case 3:return C.sent().close(),[4,(0,A.deleteDb)(Oe)];case 4:return C.sent(),[4,(0,A.deleteDb)("fcm_vapid_details_db")];case 5:return C.sent(),[4,(0,A.deleteDb)("undefined")];case 6:return C.sent(),[2,_e(et)?et:null]}})})}function _e(G){if(!G||!G.subscriptionOptions)return!1;var j=G.subscriptionOptions;return"number"==typeof G.createTime&&G.createTime>0&&"string"==typeof G.token&&G.token.length>0&&"string"==typeof j.auth&&j.auth.length>0&&"string"==typeof j.p256dh&&j.p256dh.length>0&&"string"==typeof j.endpoint&&j.endpoint.length>0&&"string"==typeof j.swScope&&j.swScope.length>0&&"string"==typeof j.vapidKey&&j.vapidKey.length>0}var en="firebase-messaging-store",fn=null;function Sn(){return fn||(fn=(0,A.openDb)("firebase-messaging-database",1,function(G){switch(G.oldVersion){case 0:G.createObjectStore(en)}})),fn}function hn(G){return Lt(this,void 0,void 0,function(){var j,et,P;return ee(this,function(y){switch(y.label){case 0:return j=qe(G),[4,Sn()];case 1:return[4,y.sent().transaction(en).objectStore(en).get(j)];case 2:return(et=y.sent())?[2,et]:[3,3];case 3:return[4,te(G.appConfig.senderId)];case 4:return(P=y.sent())?[4,cn(G,P)]:[3,6];case 5:return y.sent(),[2,P];case 6:return[2]}})})}function cn(G,j){return Lt(this,void 0,void 0,function(){var K,et,P;return ee(this,function(y){switch(y.label){case 0:return K=qe(G),[4,Sn()];case 1:return et=y.sent(),[4,(P=et.transaction(en,"readwrite")).objectStore(en).put(j,K)];case 2:return y.sent(),[4,P.complete];case 3:return y.sent(),[2,j]}})})}function _n(G){return Lt(this,void 0,void 0,function(){var j,K,et;return ee(this,function(P){switch(P.label){case 0:return j=qe(G),[4,Sn()];case 1:return K=P.sent(),[4,(et=K.transaction(en,"readwrite")).objectStore(en).delete(j)];case 2:return P.sent(),[4,et.complete];case 3:return P.sent(),[2]}})})}function qe(G){return G.appConfig.appId}function Ce(G,j){return Lt(this,void 0,void 0,function(){var K,et,P,y,M;return ee(this,function(Q){switch(Q.label){case 0:return[4,fe(G)];case 1:K=Q.sent(),et=$e(j),P={method:"POST",headers:K,body:JSON.stringify(et)},Q.label=2;case 2:return Q.trys.push([2,5,,6]),[4,fetch(An(G.appConfig),P)];case 3:return[4,Q.sent().json()];case 4:return y=Q.sent(),[3,6];case 5:throw M=Q.sent(),Y.create("token-subscribe-failed",{errorInfo:M});case 6:if(y.error)throw Y.create("token-subscribe-failed",{errorInfo:y.error.message});if(!y.token)throw Y.create("token-subscribe-no-token");return[2,y.token]}})})}function we(G,j){return Lt(this,void 0,void 0,function(){var K,et,P,y,M;return ee(this,function(Q){switch(Q.label){case 0:return[4,fe(G)];case 1:K=Q.sent(),et=$e(j.subscriptionOptions),P={method:"PATCH",headers:K,body:JSON.stringify(et)},Q.label=2;case 2:return Q.trys.push([2,5,,6]),[4,fetch(An(G.appConfig)+"/"+j.token,P)];case 3:return[4,Q.sent().json()];case 4:return y=Q.sent(),[3,6];case 5:throw M=Q.sent(),Y.create("token-update-failed",{errorInfo:M});case 6:if(y.error)throw Y.create("token-update-failed",{errorInfo:y.error.message});if(!y.token)throw Y.create("token-update-no-token");return[2,y.token]}})})}function Cn(G,j){return Lt(this,void 0,void 0,function(){var K,et,y,M;return ee(this,function(W){switch(W.label){case 0:return[4,fe(G)];case 1:K=W.sent(),et={method:"DELETE",headers:K},W.label=2;case 2:return W.trys.push([2,5,,6]),[4,fetch(An(G.appConfig)+"/"+j,et)];case 3:return[4,W.sent().json()];case 4:if((y=W.sent()).error)throw Y.create("token-unsubscribe-failed",{errorInfo:y.error.message});return[3,6];case 5:throw M=W.sent(),Y.create("token-unsubscribe-failed",{errorInfo:M});case 6:return[2]}})})}function An(G){return"https://fcmregistrations.googleapis.com/v1/projects/"+G.projectId+"/registrations"}function fe(G){var j=G.appConfig,K=G.installations;return Lt(this,void 0,void 0,function(){var et;return ee(this,function(P){switch(P.label){case 0:return[4,K.getToken()];case 1:return et=P.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":j.apiKey,"x-goog-firebase-installations-auth":"FIS "+et})]}})})}function $e(G){var P=G.vapidKey,y={web:{endpoint:G.endpoint,auth:G.auth,p256dh:G.p256dh}};return P!==yt&&(y.web.applicationPubKey=P),y}function Ke(G,j,K){return Lt(this,void 0,void 0,function(){var et,P,y,C;return ee(this,function(M){switch(M.label){case 0:if("granted"!==Notification.permission)throw Y.create("permission-blocked");return[4,Ee(j,K)];case 1:return et=M.sent(),[4,hn(G)];case 2:return P=M.sent(),y={vapidKey:K,swScope:j.scope,endpoint:et.endpoint,auth:ye(et.getKey("auth")),p256dh:ye(et.getKey("p256dh"))},P?[3,3]:[2,Se(G,y)];case 3:if(function(G,j){return j.vapidKey===G.vapidKey&&j.endpoint===G.endpoint&&j.auth===G.auth&&j.p256dh===G.p256dh}(P.subscriptionOptions,y))return[3,8];M.label=4;case 4:return M.trys.push([4,6,,7]),[4,Cn(G,P.token)];case 5:return M.sent(),[3,7];case 6:return C=M.sent(),console.warn(C),[3,7];case 7:return[2,Se(G,y)];case 8:return Date.now()>=P.createTime+6048e5?[2,Pe({token:P.token,createTime:Date.now(),subscriptionOptions:y},G,j)]:[2,P.token];case 9:return[2]}})})}function Ge(G,j){return Lt(this,void 0,void 0,function(){var K,et;return ee(this,function(P){switch(P.label){case 0:return[4,hn(G)];case 1:return(K=P.sent())?[4,Cn(G,K.token)]:[3,4];case 2:return P.sent(),[4,_n(G)];case 3:P.sent(),P.label=4;case 4:return[4,j.pushManager.getSubscription()];case 5:return(et=P.sent())?[2,et.unsubscribe()]:[2,!0]}})})}function Pe(G,j,K){return Lt(this,void 0,void 0,function(){var et,P,y;return ee(this,function(C){switch(C.label){case 0:return C.trys.push([0,3,,5]),[4,we(j,G)];case 1:return et=C.sent(),P=Ne(Ne({},G),{token:et,createTime:Date.now()}),[4,cn(j,P)];case 2:return C.sent(),[2,et];case 3:return y=C.sent(),[4,Ge(j,K)];case 4:throw C.sent(),y;case 5:return[2]}})})}function Se(G,j){return Lt(this,void 0,void 0,function(){var K,et;return ee(this,function(P){switch(P.label){case 0:return[4,Ce(G,j)];case 1:return K=P.sent(),et={token:K,createTime:Date.now(),subscriptionOptions:j},[4,cn(G,et)];case 2:return P.sent(),[2,et.token]}})})}function Ee(G,j){return Lt(this,void 0,void 0,function(){var K;return ee(this,function(et){switch(et.label){case 0:return[4,G.pushManager.getSubscription()];case 1:return(K=et.sent())?[2,K]:[2,G.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Rt(j)})]}})})}function Dn(G){return"object"==typeof G&&!!G&&ft in G}function ke(G){return new Promise(function(j){setTimeout(j,G)})}var Je=function(){function G(j){var K=this;this.firebaseDependencies=j,this.isOnBackgroundMessageUsed=null,this.vapidKey=null,this.bgMessageHandler=null,self.addEventListener("push",function(et){et.waitUntil(K.onPush(et))}),self.addEventListener("pushsubscriptionchange",function(et){et.waitUntil(K.onSubChange(et))}),self.addEventListener("notificationclick",function(et){et.waitUntil(K.onNotificationClick(et))})}return Object.defineProperty(G.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),G.prototype.setBackgroundMessageHandler=function(j){if(this.isOnBackgroundMessageUsed=!1,!j||"function"!=typeof j)throw Y.create("invalid-bg-handler");this.bgMessageHandler=j},G.prototype.onBackgroundMessage=function(j){var K=this;return this.isOnBackgroundMessageUsed=!0,this.bgMessageHandler=j,function(){K.bgMessageHandler=null}},G.prototype.getToken=function(){var j,K;return Lt(this,void 0,void 0,function(){var et;return ee(this,function(P){switch(P.label){case 0:return this.vapidKey?[3,2]:[4,hn(this.firebaseDependencies)];case 1:et=P.sent(),this.vapidKey=null!==(K=null===(j=null==et?void 0:et.subscriptionOptions)||void 0===j?void 0:j.vapidKey)&&void 0!==K?K:yt,P.label=2;case 2:return[2,Ke(this.firebaseDependencies,self.registration,this.vapidKey)]}})})},G.prototype.deleteToken=function(){return Ge(this.firebaseDependencies,self.registration)},G.prototype.requestPermission=function(){throw Y.create("only-available-in-window")},G.prototype.usePublicVapidKey=function(j){if(null!==this.vapidKey)throw Y.create("use-vapid-key-after-get-token");if("string"!=typeof j||0===j.length)throw Y.create("invalid-vapid-key");this.vapidKey=j},G.prototype.useServiceWorker=function(){throw Y.create("only-available-in-window")},G.prototype.onMessage=function(){throw Y.create("only-available-in-window")},G.prototype.onTokenRefresh=function(){throw Y.create("only-available-in-window")},G.prototype.onPush=function(j){return Lt(this,void 0,void 0,function(){var K,et,P,y;return ee(this,function(C){switch(C.label){case 0:return(K=function(G){var j=G.data;if(!j)return null;try{return j.json()}catch(K){return null}}(j))?[4,it()]:(console.debug("FirebaseMessaging: failed to get parsed MessagePayload from the PushEvent. Skip handling the push."),[2]);case 1:return function(G){return G.some(function(j){return"visible"===j.visibilityState&&!j.url.startsWith("chrome-extension://")})}(et=C.sent())?[2,q(et,K)]:(P=!1,K.notification?[4,at(Wn(K))]:[3,3]);case 2:C.sent(),P=!0,C.label=3;case 3:return!0===P&&!1===this.isOnBackgroundMessageUsed||this.bgMessageHandler&&(y=function(G){var j={from:G.from,collapseKey:G.collapse_key};return function(G,j){if(j.notification){G.notification={};var K=j.notification.title;K&&(G.notification.title=K);var et=j.notification.body;et&&(G.notification.body=et);var P=j.notification.image;P&&(G.notification.image=P)}}(j,G),function(G,j){!j.data||(G.data=j.data)}(j,G),function(G,j){if(j.fcmOptions){G.fcmOptions={};var K=j.fcmOptions.link;K&&(G.fcmOptions.link=K);var et=j.fcmOptions.analytics_label;et&&(G.fcmOptions.analyticsLabel=et)}}(j,G),j}(K),"function"==typeof this.bgMessageHandler?this.bgMessageHandler(y):this.bgMessageHandler.next(y)),[2]}})})},G.prototype.onSubChange=function(j){var K,et;return Lt(this,void 0,void 0,function(){var y;return ee(this,function(C){switch(C.label){case 0:return j.newSubscription?[3,2]:[4,Ge(this.firebaseDependencies,self.registration)];case 1:return C.sent(),[2];case 2:return[4,hn(this.firebaseDependencies)];case 3:return y=C.sent(),[4,Ge(this.firebaseDependencies,self.registration)];case 4:return C.sent(),[4,Ke(this.firebaseDependencies,self.registration,null!==(et=null===(K=null==y?void 0:y.subscriptionOptions)||void 0===K?void 0:K.vapidKey)&&void 0!==et?et:yt)];case 5:return C.sent(),[2]}})})},G.prototype.onNotificationClick=function(j){var K,et;return Lt(this,void 0,void 0,function(){var P,y,C,M,W;return ee(this,function(Q){switch(Q.label){case 0:return(P=null===(et=null===(K=j.notification)||void 0===K?void 0:K.data)||void 0===et?void 0:et[Ot])?j.action?[2]:(j.stopImmediatePropagation(),j.notification.close(),(y=function(G){var j,K,et;return(null!==(K=null===(j=G.fcmOptions)||void 0===j?void 0:j.link)&&void 0!==K?K:null===(et=G.notification)||void 0===et?void 0:et.click_action)||(Dn(G.data)?self.location.origin:null)}(P))?(C=new URL(y,self.location.href),M=new URL(self.location.origin),C.host!==M.host?[2]:[4,xn(C)]):[2]):[2];case 1:return(W=Q.sent())?[3,4]:[4,self.clients.openWindow(y)];case 2:return W=Q.sent(),[4,ke(3e3)];case 3:return Q.sent(),[3,6];case 4:return[4,W.focus()];case 5:W=Q.sent(),Q.label=6;case 6:return W?(P.messageType=se.NOTIFICATION_CLICKED,P.isFirebaseMessaging=!0,[2,W.postMessage(P)]):[2]}})})},G}();function Wn(G){var j,K=Ne({},G.notification);return K.data=((j={})[Ot]=G,j),K}function xn(G){return Lt(this,void 0,void 0,function(){var j,K,et,P,y,C,M;return ee(this,function(W){switch(W.label){case 0:return[4,it()];case 1:j=W.sent();try{for(K=Xe(j),et=K.next();!et.done;et=K.next())if(P=et.value,y=new URL(P.url,self.location.href),G.host===y.host)return[2,P]}catch(Q){C={error:Q}}finally{try{et&&!et.done&&(M=K.return)&&M.call(K)}finally{if(C)throw C.error}}return[2,null]}})})}function q(G,j){var K,et;j.isFirebaseMessaging=!0,j.messageType=se.PUSH_RECEIVED;try{for(var P=Xe(G),y=P.next();!y.done;y=P.next())y.value.postMessage(j)}catch(M){K={error:M}}finally{try{y&&!y.done&&(et=P.return)&&et.call(P)}finally{if(K)throw K.error}}}function it(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function at(G){var j,K=G.actions,et=Notification.maxActions;return K&&et&&K.length>et&&console.warn("This browser only supports "+et+" actions. The remaining actions will not be displayed."),self.registration.showNotification(null!==(j=G.title)&&void 0!==j?j:"",G)}var dt=function(){function G(j){var K=this;this.firebaseDependencies=j,this.vapidKey=null,this.onMessageCallback=null,navigator.serviceWorker.addEventListener("message",function(et){return K.messageEventListener(et)})}return Object.defineProperty(G.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),G.prototype.messageEventListener=function(j){return Lt(this,void 0,void 0,function(){var K,et;return ee(this,function(P){switch(P.label){case 0:return(K=j.data).isFirebaseMessaging?(this.onMessageCallback&&K.messageType===se.PUSH_RECEIVED&&("function"==typeof this.onMessageCallback?this.onMessageCallback(function(G){return delete G.messageType,delete G.isFirebaseMessaging,G}(Object.assign({},K))):this.onMessageCallback.next(Object.assign({},K))),Dn(et=K.data)&&"1"===et["google.c.a.e"]?[4,this.logEvent(K.messageType,et)]:[3,2]):[2];case 1:P.sent(),P.label=2;case 2:return[2]}})})},G.prototype.getVapidKey=function(){return this.vapidKey},G.prototype.getSwReg=function(){return this.swRegistration},G.prototype.getToken=function(j){return Lt(this,void 0,void 0,function(){return ee(this,function(K){switch(K.label){case 0:return"default"!==Notification.permission?[3,2]:[4,Notification.requestPermission()];case 1:K.sent(),K.label=2;case 2:if("granted"!==Notification.permission)throw Y.create("permission-blocked");return[4,this.updateVapidKey(null==j?void 0:j.vapidKey)];case 3:return K.sent(),[4,this.updateSwReg(null==j?void 0:j.serviceWorkerRegistration)];case 4:return K.sent(),[2,Ke(this.firebaseDependencies,this.swRegistration,this.vapidKey)]}})})},G.prototype.updateVapidKey=function(j){return Lt(this,void 0,void 0,function(){return ee(this,function(K){return j?this.vapidKey=j:this.vapidKey||(this.vapidKey=yt),[2]})})},G.prototype.updateSwReg=function(j){return Lt(this,void 0,void 0,function(){return ee(this,function(K){switch(K.label){case 0:return j||this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:K.sent(),K.label=2;case 2:if(!j&&this.swRegistration)return[2];if(!(j instanceof ServiceWorkerRegistration))throw Y.create("invalid-sw-registration");return this.swRegistration=j,[2]}})})},G.prototype.registerDefaultSw=function(){return Lt(this,void 0,void 0,function(){var j,K;return ee(this,function(et){switch(et.label){case 0:return et.trys.push([0,2,,3]),j=this,[4,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"})];case 1:return j.swRegistration=et.sent(),this.swRegistration.update().catch(function(){}),[3,3];case 2:throw K=et.sent(),Y.create("failed-service-worker-registration",{browserErrorMessage:K.message});case 3:return[2]}})})},G.prototype.deleteToken=function(){return Lt(this,void 0,void 0,function(){return ee(this,function(j){switch(j.label){case 0:return this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:j.sent(),j.label=2;case 2:return[2,Ge(this.firebaseDependencies,this.swRegistration)]}})})},G.prototype.requestPermission=function(){return Lt(this,void 0,void 0,function(){var j;return ee(this,function(K){switch(K.label){case 0:return"granted"===Notification.permission?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(j=K.sent()))return[2];throw Y.create("denied"===j?"permission-blocked":"permission-default")}})})},G.prototype.usePublicVapidKey=function(j){if(null!==this.vapidKey)throw Y.create("use-vapid-key-after-get-token");if("string"!=typeof j||0===j.length)throw Y.create("invalid-vapid-key");this.vapidKey=j},G.prototype.useServiceWorker=function(j){if(!(j instanceof ServiceWorkerRegistration))throw Y.create("invalid-sw-registration");if(this.swRegistration)throw Y.create("use-sw-after-get-token");this.swRegistration=j},G.prototype.onMessage=function(j){var K=this;return this.onMessageCallback=j,function(){K.onMessageCallback=null}},G.prototype.setBackgroundMessageHandler=function(){throw Y.create("only-available-in-sw")},G.prototype.onBackgroundMessage=function(){throw Y.create("only-available-in-sw")},G.prototype.onTokenRefresh=function(){return function(){}},G.prototype.logEvent=function(j,K){return Lt(this,void 0,void 0,function(){var et;return ee(this,function(y){switch(y.label){case 0:return et=function(G){switch(G){case se.NOTIFICATION_CLICKED:return"notification_open";case se.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(j),[4,this.firebaseDependencies.analyticsProvider.get()];case 1:return y.sent().logEvent(et,{message_id:K[ft],message_name:K["google.c.a.c_l"],message_time:K["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)}),[2]}})})},G}();function ae(G){return Y.create("missing-app-config-values",{valueName:G})}var je={isSupported:De};function De(){return self&&"ServiceWorkerGlobalScope"in self?"indexedDB"in self&&null!==indexedDB&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"indexedDB"in window&&null!==indexedDB&&navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}x.default.INTERNAL.registerComponent(new Dt.Component("messaging",function(G){var j=G.getProvider("app").getImmediate(),K=function(G){var j,K;if(!G||!G.options)throw ae("App Configuration Object");if(!G.name)throw ae("App Name");var P=G.options;try{for(var y=Xe(["projectId","apiKey","appId","messagingSenderId"]),C=y.next();!C.done;C=y.next()){var M=C.value;if(!P[M])throw ae(M)}}catch(W){j={error:W}}finally{try{C&&!C.done&&(K=y.return)&&K.call(y)}finally{if(j)throw j.error}}return{appName:G.name,projectId:P.projectId,apiKey:P.apiKey,appId:P.appId,senderId:P.messagingSenderId}}(j),y={app:j,appConfig:K,installations:G.getProvider("installations").getImmediate(),analyticsProvider:G.getProvider("analytics-internal")};if(!De())throw Y.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new Je(y):new dt(y)},"PUBLIC").setServiceProps(je))},5062:(Xn,be,Bt)=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});var B=Bt(6279);Bt(7918);var Dt=Bt(9009),D=Bt(1704),Te=Bt(300),St=Bt(1100);function Ne(P){return P&&"object"==typeof P&&"default"in P?P:{default:P}}var qt,Yt=Ne(B),J="0.4.2",Tt="FB-PERF-TRACE-MEASURE",Ct="@firebase/performance/config",mt="@firebase/performance/configexpire",ne="Performance",xt=((qt={})["trace started"]="Trace {$traceName} was started before.",qt["trace stopped"]="Trace {$traceName} is not running.",qt["nonpositive trace startTime"]="Trace {$traceName} startTime should be positive.",qt["nonpositive trace duration"]="Trace {$traceName} duration should be positive.",qt["no window"]="Window is not available.",qt["no app id"]="App id is not available.",qt["no project id"]="Project id is not available.",qt["no api key"]="Api key is not available.",qt["invalid cc log"]="Attempted to queue invalid cc event",qt["FB not default"]="Performance can only start when Firebase app instance is the default one.",qt["RC response not ok"]="RC response is not ok",qt["invalid attribute name"]="Attribute name {$attributeName} is invalid.",qt["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",qt["invalid custom metric name"]="Custom metric name {$customMetricName} is invalid",qt["invalid String merger input"]="Input for String merger is invalid, contact support team to resolve.",qt),At=new D.ErrorFactory("performance",ne,xt),m=new Te.Logger(ne);m.logLevel=Te.LogLevel.INFO;var S,b,A=function(){function P(y){if(this.window=y,!y)throw At.create("no window");this.performance=y.performance,this.PerformanceObserver=y.PerformanceObserver,this.windowLocation=y.location,this.navigator=y.navigator,this.document=y.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=y.localStorage),y.perfMetrics&&y.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=y.perfMetrics.onFirstInputDelay)}return P.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},P.prototype.mark=function(y){!this.performance||!this.performance.mark||this.performance.mark(y)},P.prototype.measure=function(y,C,M){!this.performance||!this.performance.measure||this.performance.measure(y,C,M)},P.prototype.getEntriesByType=function(y){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(y):[]},P.prototype.getEntriesByName=function(y){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(y):[]},P.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},P.prototype.requiredApisAvailable=function(){return fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled?!!D.isIndexedDBAvailable()||(m.info("IndexedDB is not supported by current browswer"),!1):(m.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)},P.prototype.setupObserver=function(y,C){this.PerformanceObserver&&new this.PerformanceObserver(function(W){for(var Q=0,rt=W.getEntries();Q<rt.length;Q++)C(rt[Q])}).observe({entryTypes:[y]})},P.getInstance=function(){return void 0===S&&(S=new P(b)),S},P}();function T(P,y){var C=P.length-y.length;if(C<0||C>1)throw At.create("invalid String merger input");for(var M=[],W=0;W<P.length;W++)M.push(P.charAt(W)),y.length>W&&M.push(y.charAt(W));return M.join("")}var z,Xt,Y=function(){function P(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=T("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=T("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}return P.prototype.getAppId=function(){var y=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!y)throw At.create("no app id");return y},P.prototype.getProjectId=function(){var y=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!y)throw At.create("no project id");return y},P.prototype.getApiKey=function(){var y=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!y)throw At.create("no api key");return y},P.prototype.getFlTransportFullUrl=function(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)},P.getInstance=function(){return void 0===z&&(z=new P),z},P}();function yt(){return Xt}var Ot=(()=>{return(P=Ot||(Ot={}))[P.UNKNOWN=0]="UNKNOWN",P[P.VISIBLE=1]="VISIBLE",P[P.HIDDEN=2]="HIDDEN",Ot;var P})(),ft=["firebase_","google_","ga_"],ht=new RegExp("^[a-zA-Z]\\w*$");function se(){switch(A.getInstance().document.visibilityState){case"visible":return Ot.VISIBLE;case"hidden":return Ot.HIDDEN;default:return Ot.UNKNOWN}}function ye(){var y=A.getInstance().navigator.connection;switch(y&&y.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}var en="Could not fetch config, will use default configs";function Sn(P){if(!P)return P;var y=Y.getInstance(),C=P.entries||{};return y.loggingEnabled=void 0===C.fpr_enabled||"true"===String(C.fpr_enabled),C.fpr_log_source&&(y.logSource=Number(C.fpr_log_source)),C.fpr_log_endpoint_url&&(y.logEndPointUrl=C.fpr_log_endpoint_url),C.fpr_log_transport_key&&(y.transportKey=C.fpr_log_transport_key),void 0!==C.fpr_vc_network_request_sampling_rate&&(y.networkRequestsSamplingRate=Number(C.fpr_vc_network_request_sampling_rate)),void 0!==C.fpr_vc_trace_sampling_rate&&(y.tracesSamplingRate=Number(C.fpr_vc_trace_sampling_rate)),y.logTraceAfterSampling=cn(y.tracesSamplingRate),y.logNetworkAfterSampling=cn(y.networkRequestsSamplingRate),P}function cn(P){return Math.random()<=P}var qe,_n=1;function Ce(){return _n=2,qe=qe||(P=A.getInstance().document,new Promise(function(y){if(P&&"complete"!==P.readyState){var C=function(){"complete"===P.readyState&&(P.removeEventListener("readystatechange",C),y())};P.addEventListener("readystatechange",C)}else y()})).then(function(){return function(){var P=Y.getInstance().installationsService.getId();return P.then(function(y){Xt=y}),P}()}).then(function(P){return function(P){var y=function(){var P=A.getInstance().localStorage;if(P){var y=P.getItem(mt);if(y&&function(P){return Number(P)>Date.now()}(y)){var C=P.getItem(Ct);if(C)try{return JSON.parse(C)}catch(W){return}}}}();return y?(Sn(y),Promise.resolve()):function(P){return function(){var P=Y.getInstance().installationsService.getToken();return P.then(function(y){}),P}().then(function(y){var M="https://firebaseremoteconfig.googleapis.com/v1/projects/"+Y.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+Y.getInstance().getApiKey(),W=new Request(M,{method:"POST",headers:{Authorization:"FIREBASE_INSTALLATIONS_AUTH "+y},body:JSON.stringify({app_instance_id:P,app_instance_id_token:y,app_id:Y.getInstance().getAppId(),app_version:"0.4.2",sdk_version:"0.0.1"})});return fetch(W).then(function(Q){if(Q.ok)return Q.json();throw At.create("RC response not ok")})}).catch(function(){m.info(en)})}(P).then(Sn).then(function(C){return function(P){var y=A.getInstance().localStorage;!P||!y||(y.setItem(Ct,JSON.stringify(P)),y.setItem(mt,String(Date.now()+60*Y.getInstance().configTimeToLive*60*1e3)))}(C)},function(){})}(P)}).then(function(){return fe()},function(){return fe()});var P}function fe(){_n=3}var ke,Ge=3,Pe=[],Se=!1;function ln(P){setTimeout(function(){if(0!==Ge){if(!Pe.length)return ln(1e4);!function(){var P=Dt.__spreadArrays(Pe);Pe=[];var y=P.map(function(M){return{source_extension_json_proto3:M.message,event_time_ms:String(M.eventTime)}});(function(P,y){return function(P){var y=Y.getInstance().getFlTransportFullUrl();return fetch(y,{method:"POST",body:JSON.stringify(P)})}(P).then(function(C){return C.ok||m.info("Call to Firebase backend failed."),C.json()}).then(function(C){var M=Number(C.nextRequestWaitMillis),W=1e4;isNaN(M)||(W=Math.max(M,W));var Q=C.logResponseDetails;Array.isArray(Q)&&Q.length>0&&"RETRY_REQUEST_LATER"===Q[0].responseAction&&(Pe=Dt.__spreadArrays(y,Pe),m.info("Retry transport request later.")),Ge=3,ln(W)})})({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Y.getInstance().logSource,log_event:y},P).catch(function(){Pe=Dt.__spreadArrays(P,Pe),Ge--,m.info("Tries left: "+Ge+"."),ln(1e4)})}()}},P)}function Qe(P){if(!P.eventTime||!P.message)throw At.create("invalid cc log");Pe=Dt.__spreadArrays(Pe,[P])}function Je(P,y){ke||(ke=function(P){return function(){for(var y=[],C=0;C<arguments.length;C++)y[C]=arguments[C];Qe({message:P.apply(void 0,y),eventTime:Date.now()})}}(Hn)),ke(P,y)}function Wn(P){var y=Y.getInstance();!y.instrumentationEnabled&&P.isAuto||!y.dataCollectionEnabled&&!P.isAuto||!A.getInstance().requiredApisAvailable()||P.isAuto&&se()!==Ot.VISIBLE||(3===_n?Fn(P):Ce().then(function(){return Fn(P)},function(){return Fn(P)}))}function Fn(P){if(yt()){var y=Y.getInstance();!y.loggingEnabled||!y.logTraceAfterSampling||setTimeout(function(){return Je(P,1)},0)}}function Hn(P,y){return 0===y?function(P){var y={url:P.url,http_method:P.httpMethod||0,http_response_code:200,response_payload_bytes:P.responsePayloadBytes,client_start_time_us:P.startTimeUs,time_to_response_initiated_us:P.timeToResponseInitiatedUs,time_to_response_completed_us:P.timeToResponseCompletedUs},C={application_info:at(),network_request_metric:y};return JSON.stringify(C)}(P):function(P){var y={name:P.name,is_auto:P.isAuto,client_start_time_us:P.startTimeUs,duration_us:P.durationUs};0!==Object.keys(P.counters).length&&(y.counters=P.counters);var C=P.getAttributes();0!==Object.keys(C).length&&(y.custom_attributes=C);var M={application_info:at(),trace_metric:y};return JSON.stringify(M)}(P)}function at(){return{google_app_id:Y.getInstance().getAppId(),app_instance_id:yt(),web_app_info:{sdk_version:"0.4.2",page_url:A.getInstance().getUrl(),service_worker_status:(P=A.getInstance().navigator,"serviceWorker"in P?P.serviceWorker.controller?2:3:1),visibility_state:se(),effective_connection_type:ye()},application_process_state:0};var P}var gt=["_fp","_fcp","_fid"],ae=function(){function P(y,C,M){void 0===C&&(C=!1),this.name=y,this.isAuto=C,this.state=1,this.customAttributes={},this.counters={},this.api=A.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=M||Tt+"-"+this.randomId+"-"+this.name,M&&this.calculateTraceMetrics())}return P.prototype.start=function(){if(1!==this.state)throw At.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},P.prototype.stop=function(){if(2!==this.state)throw At.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Wn(this)},P.prototype.record=function(y,C,M){if(y<=0)throw At.create("nonpositive trace startTime",{traceName:this.name});if(C<=0)throw At.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*C),this.startTimeUs=Math.floor(1e3*y),M&&M.attributes&&(this.customAttributes=Dt.__assign({},M.attributes)),M&&M.metrics)for(var W=0,Q=Object.keys(M.metrics);W<Q.length;W++){var rt=Q[W];isNaN(Number(M.metrics[rt]))||(this.counters[rt]=Number(Math.floor(M.metrics[rt])))}Wn(this)},P.prototype.incrementMetric=function(y,C){void 0===C&&(C=1),this.putMetric(y,void 0===this.counters[y]?C:this.counters[y]+C)},P.prototype.putMetric=function(y,C){if(!function(P,y){return!(0===P.length||P.length>100)&&(y&&y.startsWith("_wt_")&&gt.indexOf(P)>-1||!P.startsWith("_"))}(y,this.name))throw At.create("invalid custom metric name",{customMetricName:y});this.counters[y]=function(P){var y=Math.floor(P);return y<P&&m.info("Metric value should be an Integer, setting the value as : "+y+"."),y}(C)},P.prototype.getMetric=function(y){return this.counters[y]||0},P.prototype.putAttribute=function(y,C){var M=function(P){return!(0===P.length||P.length>40||ft.some(function(C){return P.startsWith(C)})||!P.match(ht))}(y),W=function(P){return 0!==P.length&&P.length<=100}(C);if(M&&W)this.customAttributes[y]=C;else{if(!M)throw At.create("invalid attribute name",{attributeName:y});if(!W)throw At.create("invalid attribute value",{attributeValue:C})}},P.prototype.getAttribute=function(y){return this.customAttributes[y]},P.prototype.removeAttribute=function(y){void 0!==this.customAttributes[y]&&delete this.customAttributes[y]},P.prototype.getAttributes=function(){return Dt.__assign({},this.customAttributes)},P.prototype.setStartTime=function(y){this.startTimeUs=y},P.prototype.setDuration=function(y){this.durationUs=y},P.prototype.calculateTraceMetrics=function(){var y=this.api.getEntriesByName(this.traceMeasure),C=y&&y[0];C&&(this.durationUs=Math.floor(1e3*C.duration),this.startTimeUs=Math.floor(1e3*(C.startTime+this.api.getTimeOrigin())))},P.createOobTrace=function(y,C,M){var W=A.getInstance().getUrl();if(W){var Q=new P("_wt_"+W,!0),rt=Math.floor(1e3*A.getInstance().getTimeOrigin());if(Q.setStartTime(rt),y&&y[0]&&(Q.setDuration(Math.floor(1e3*y[0].duration)),Q.putMetric("domInteractive",Math.floor(1e3*y[0].domInteractive)),Q.putMetric("domContentLoadedEventEnd",Math.floor(1e3*y[0].domContentLoadedEventEnd)),Q.putMetric("loadEventEnd",Math.floor(1e3*y[0].loadEventEnd))),C){var he=C.find(function(zt){return"first-paint"===zt.name});he&&he.startTime&&Q.putMetric("_fp",Math.floor(1e3*he.startTime));var ie=C.find(function(zt){return"first-contentful-paint"===zt.name});ie&&ie.startTime&&Q.putMetric("_fcp",Math.floor(1e3*ie.startTime)),M&&Q.putMetric("_fid",Math.floor(1e3*M))}Wn(Q)}},P.createUserTimingTrace=function(y){Wn(new P(y,!1,y))},P}();function Ft(P){var y=P;if(y&&void 0!==y.responseStart){var C=A.getInstance().getTimeOrigin(),M=Math.floor(1e3*(y.startTime+C)),W=y.responseStart?Math.floor(1e3*(y.responseStart-y.startTime)):void 0,Q=Math.floor(1e3*(y.responseEnd-y.startTime));!function(P){var y=Y.getInstance();if(y.instrumentationEnabled){var C=P.url,M=y.logEndPointUrl.split("?")[0],W=y.flTransportEndpointUrl.split("?")[0];C===M||C===W||!y.loggingEnabled||!y.logNetworkAfterSampling||setTimeout(function(){return Je(P,0)},0)}}({url:y.name&&y.name.split("?")[0],responsePayloadBytes:y.transferSize,startTimeUs:M,timeToResponseInitiatedUs:W,timeToResponseCompletedUs:Q})}}function je(){!yt()||(setTimeout(function(){return function(){var P=A.getInstance(),y=P.getEntriesByType("navigation"),C=P.getEntriesByType("paint");if(P.onFirstInputDelay){var M=setTimeout(function(){ae.createOobTrace(y,C),M=void 0},5e3);P.onFirstInputDelay(function(W){M&&(clearTimeout(M),ae.createOobTrace(y,C,W))})}else ae.createOobTrace(y,C)}()},0),setTimeout(function(){return function(){for(var P=A.getInstance(),C=0,M=P.getEntriesByType("resource");C<M.length;C++)Ft(M[C]);P.setupObserver("resource",Ft)}()},0),setTimeout(function(){return function(){for(var P=A.getInstance(),C=0,M=P.getEntriesByType("measure");C<M.length;C++)G(M[C]);P.setupObserver("measure",G)}()},0))}function G(P){var y=P.name;y.substring(0,Tt.length)!==Tt&&ae.createUserTimingTrace(y)}var j=function(){function P(y){this.app=y,A.getInstance().requiredApisAvailable()&&D.validateIndexedDBOpenable().then(function(C){C&&(Se||(ln(5500),Se=!0),Ce().then(je,je))}).catch(function(C){m.info("Environment doesn't support IndexedDB: "+C)})}return P.prototype.trace=function(y){return new ae(y)},Object.defineProperty(P.prototype,"instrumentationEnabled",{get:function(){return Y.getInstance().instrumentationEnabled},set:function(y){Y.getInstance().instrumentationEnabled=y},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"dataCollectionEnabled",{get:function(){return Y.getInstance().dataCollectionEnabled},set:function(y){Y.getInstance().dataCollectionEnabled=y},enumerable:!1,configurable:!0}),P}();function et(P){P.INTERNAL.registerComponent(new St.Component("performance",function(C){return function(C,M){if("[DEFAULT]"!==C.name)throw At.create("FB not default");if("undefined"==typeof window)throw At.create("no window");return function(P){b=P}(window),Y.getInstance().firebaseAppInstance=C,Y.getInstance().installationsService=M,new j(C)}(C.getProvider("app").getImmediate(),C.getProvider("installations").getImmediate())},"PUBLIC")),P.registerVersion("@firebase/performance",J)}et(Yt.default),be.registerPerformance=et},2136:(Xn,be,Bt)=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});var B=Bt(6279);Bt(7918);var Dt=Bt(7698),D=Bt(1704),Te=Bt(300),St=Bt(1100);function Ne(ft){return ft&&"object"==typeof ft&&"default"in ft?ft:{default:ft}}var J,Yt=Ne(B),de=function(){function ft(ht,Nt,re,jt){this.client=ht,this.storage=Nt,this.storageCache=re,this.logger=jt}return ft.prototype.isCachedDataFresh=function(ht,Nt){if(!Nt)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var re=Date.now()-Nt,jt=re<=ht;return this.logger.debug("Config fetch cache check. Cache age millis: "+re+". Cache max age millis (minimumFetchIntervalMillis setting): "+ht+". Is cache hit: "+jt+"."),jt},ft.prototype.fetch=function(ht){return Dt.__awaiter(this,void 0,void 0,function(){var Nt,re,jt,se,ye;return Dt.__generator(this,function(Rt){switch(Rt.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return Nt=Rt.sent(),re=Nt[0],(jt=Nt[1])&&this.isCachedDataFresh(ht.cacheMaxAgeMillis,re)?[2,jt]:(ht.eTag=jt&&jt.eTag,[4,this.client.fetch(ht)]);case 2:return se=Rt.sent(),ye=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===se.status&&ye.push(this.storage.setLastSuccessfulFetchResponse(se)),[4,Promise.all(ye)];case 3:return Rt.sent(),[2,se]}})})},ft}(),ut=((J={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",J["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",J["registration-api-key"]="Undefined API key. Check Firebase app initialization.",J["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",J["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",J["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",J["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",J["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",J["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",J["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',J["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',J["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",J["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",J),Lt=new D.ErrorFactory("remoteconfig","Remote Config",ut);function Tt(ft){return void 0===ft&&(ft=navigator),ft.languages&&ft.languages[0]||ft.language}var ge=function(){function ft(ht,Nt,re,jt,se,ye){this.firebaseInstallations=ht,this.sdkVersion=Nt,this.namespace=re,this.projectId=jt,this.apiKey=se,this.appId=ye}return ft.prototype.fetch=function(ht){return Dt.__awaiter(this,void 0,void 0,function(){var Nt,se,ye,Rt,Oe,nn,Be,te,_e,vn,le,en,fn,Sn,hn,cn,_n;return Dt.__generator(this,function(qe){switch(qe.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:Nt=qe.sent(),se=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",ye=se+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,Rt={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":ht.eTag||"*"},Oe={sdk_version:this.sdkVersion,app_instance_id:Nt[0],app_instance_id_token:Nt[1],app_id:this.appId,language_code:Tt()},nn={method:"POST",headers:Rt,body:JSON.stringify(Oe)},Be=fetch(ye,nn),te=new Promise(function(Ce,we){ht.signal.addEventListener(function(){var Cn=new Error("The operation was aborted.");Cn.name="AbortError",we(Cn)})}),qe.label=2;case 2:return qe.trys.push([2,5,,6]),[4,Promise.race([Be,te])];case 3:return qe.sent(),[4,Be];case 4:return _e=qe.sent(),[3,6];case 5:throw vn=qe.sent(),le="fetch-client-network","AbortError"===vn.name&&(le="fetch-timeout"),Lt.create(le,{originalErrorMessage:vn.message});case 6:if(en=_e.status,fn=_e.headers.get("ETag")||void 0,200!==_e.status)return[3,11];cn=void 0,qe.label=7;case 7:return qe.trys.push([7,9,,10]),[4,_e.json()];case 8:return cn=qe.sent(),[3,10];case 9:throw _n=qe.sent(),Lt.create("fetch-client-parse",{originalErrorMessage:_n.message});case 10:Sn=cn.entries,hn=cn.state,qe.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===hn?en=500:"NO_CHANGE"===hn?en=304:("NO_TEMPLATE"===hn||"EMPTY_CONFIG"===hn)&&(Sn={}),304!==en&&200!==en)throw Lt.create("fetch-status",{httpStatus:en});return[2,{status:en,eTag:fn,config:Sn}]}})})},ft}(),Xe=function(){function ft(){this.listeners=[]}return ft.prototype.addEventListener=function(ht){this.listeners.push(ht)},ft.prototype.abort=function(){this.listeners.forEach(function(ht){return ht()})},ft}(),mt=["1","true","t","yes","y","on"],Kt=function(){function ft(ht,Nt){void 0===Nt&&(Nt=""),this._source=ht,this._value=Nt}return ft.prototype.asString=function(){return this._value},ft.prototype.asBoolean=function(){return"static"!==this._source&&mt.indexOf(this._value.toLowerCase())>=0},ft.prototype.asNumber=function(){if("static"===this._source)return 0;var ht=Number(this._value);return isNaN(ht)&&(ht=0),ht},ft.prototype.getSource=function(){return this._source},ft}(),xt=function(){function ft(ht,Nt,re,jt,se){this.app=ht,this._client=Nt,this._storageCache=re,this._storage=jt,this._logger=se,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}return ft.prototype.setLogLevel=function(ht){switch(ht){case"debug":this._logger.logLevel=Te.LogLevel.DEBUG;break;case"silent":this._logger.logLevel=Te.LogLevel.SILENT;break;default:this._logger.logLevel=Te.LogLevel.ERROR}},Object.defineProperty(ft.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!1,configurable:!0}),Object.defineProperty(ft.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!1,configurable:!0}),ft.prototype.activate=function(){return Dt.__awaiter(this,void 0,void 0,function(){var ht,Nt,re;return Dt.__generator(this,function(jt){switch(jt.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return ht=jt.sent(),re=ht[1],(Nt=ht[0])&&Nt.config&&Nt.eTag&&Nt.eTag!==re?[4,Promise.all([this._storageCache.setActiveConfig(Nt.config),this._storage.setActiveConfigEtag(Nt.eTag)])]:[2,!1];case 2:return jt.sent(),[2,!0]}})})},ft.prototype.ensureInitialized=function(){var ht=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then(function(){ht._isInitializationComplete=!0})),this._initializePromise},ft.prototype.fetch=function(){return Dt.__awaiter(this,void 0,void 0,function(){var ht,Nt,re,jt=this;return Dt.__generator(this,function(se){switch(se.label){case 0:ht=new Xe,setTimeout(function(){return Dt.__awaiter(jt,void 0,void 0,function(){return Dt.__generator(this,function(ye){return ht.abort(),[2]})})},this.settings.fetchTimeoutMillis),se.label=1;case 1:return se.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:ht})];case 2:return se.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return se.sent(),[3,6];case 4:return Nt=se.sent(),re=function(ft,ht){return ft instanceof D.FirebaseError&&-1!==ft.code.indexOf("fetch-throttle")}(Nt)?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(re)];case 5:throw se.sent(),Nt;case 6:return[2]}})})},ft.prototype.fetchAndActivate=function(){return Dt.__awaiter(this,void 0,void 0,function(){return Dt.__generator(this,function(ht){switch(ht.label){case 0:return[4,this.fetch()];case 1:return ht.sent(),[2,this.activate()]}})})},ft.prototype.getAll=function(){var ht=this;return function(ft,ht){return void 0===ft&&(ft={}),void 0===ht&&(ht={}),Object.keys(Dt.__assign(Dt.__assign({},ft),ht))}(this._storageCache.getActiveConfig(),this.defaultConfig).reduce(function(Nt,re){return Nt[re]=ht.getValue(re),Nt},{})},ft.prototype.getBoolean=function(ht){return this.getValue(ht).asBoolean()},ft.prototype.getNumber=function(ht){return this.getValue(ht).asNumber()},ft.prototype.getString=function(ht){return this.getValue(ht).asString()},ft.prototype.getValue=function(ht){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+ht+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var Nt=this._storageCache.getActiveConfig();return Nt&&void 0!==Nt[ht]?new Kt("remote",Nt[ht]):this.defaultConfig&&void 0!==this.defaultConfig[ht]?new Kt("default",String(this.defaultConfig[ht])):(this._logger.debug('Returning static value for key "'+ht+'". Define a default or remote value if this is unintentional.'),new Kt("static"))},ft}();function m(ft,ht){var Nt=ft.target.error||void 0;return Lt.create(ht,{originalErrorMessage:Nt&&Nt.message})}var S="app_namespace_store",T=function(){function ft(ht,Nt,re,jt){void 0===jt&&(jt=new Promise(function(ft,ht){var Nt=indexedDB.open("firebase_remote_config",1);Nt.onerror=function(re){ht(m(re,"storage-open"))},Nt.onsuccess=function(re){ft(re.target.result)},Nt.onupgradeneeded=function(re){var jt=re.target.result;switch(re.oldVersion){case 0:jt.createObjectStore(S,{keyPath:"compositeKey"})}}})),this.appId=ht,this.appName=Nt,this.namespace=re,this.openDbPromise=jt}return ft.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},ft.prototype.setLastFetchStatus=function(ht){return this.set("last_fetch_status",ht)},ft.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},ft.prototype.setLastSuccessfulFetchTimestampMillis=function(ht){return this.set("last_successful_fetch_timestamp_millis",ht)},ft.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},ft.prototype.setLastSuccessfulFetchResponse=function(ht){return this.set("last_successful_fetch_response",ht)},ft.prototype.getActiveConfig=function(){return this.get("active_config")},ft.prototype.setActiveConfig=function(ht){return this.set("active_config",ht)},ft.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},ft.prototype.setActiveConfigEtag=function(ht){return this.set("active_config_etag",ht)},ft.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},ft.prototype.setThrottleMetadata=function(ht){return this.set("throttle_metadata",ht)},ft.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},ft.prototype.get=function(ht){return Dt.__awaiter(this,void 0,void 0,function(){var Nt,re=this;return Dt.__generator(this,function(jt){switch(jt.label){case 0:return[4,this.openDbPromise];case 1:return Nt=jt.sent(),[2,new Promise(function(se,ye){var Oe=Nt.transaction([S],"readonly").objectStore(S),nn=re.createCompositeKey(ht);try{var Be=Oe.get(nn);Be.onerror=function(te){ye(m(te,"storage-get"))},Be.onsuccess=function(te){var _e=te.target.result;se(_e?_e.value:void 0)}}catch(te){ye(Lt.create("storage-get",{originalErrorMessage:te&&te.message}))}})]}})})},ft.prototype.set=function(ht,Nt){return Dt.__awaiter(this,void 0,void 0,function(){var re,jt=this;return Dt.__generator(this,function(se){switch(se.label){case 0:return[4,this.openDbPromise];case 1:return re=se.sent(),[2,new Promise(function(ye,Rt){var nn=re.transaction([S],"readwrite").objectStore(S),Be=jt.createCompositeKey(ht);try{var te=nn.put({compositeKey:Be,value:Nt});te.onerror=function(_e){Rt(m(_e,"storage-set"))},te.onsuccess=function(){ye()}}catch(_e){Rt(Lt.create("storage-set",{originalErrorMessage:_e&&_e.message}))}})]}})})},ft.prototype.delete=function(ht){return Dt.__awaiter(this,void 0,void 0,function(){var Nt,re=this;return Dt.__generator(this,function(jt){switch(jt.label){case 0:return[4,this.openDbPromise];case 1:return Nt=jt.sent(),[2,new Promise(function(se,ye){var Oe=Nt.transaction([S],"readwrite").objectStore(S),nn=re.createCompositeKey(ht);try{var Be=Oe.delete(nn);Be.onerror=function(te){ye(m(te,"storage-delete"))},Be.onsuccess=function(){se()}}catch(te){ye(Lt.create("storage-delete",{originalErrorMessage:te&&te.message}))}})]}})})},ft.prototype.createCompositeKey=function(ht){return[this.appId,this.appName,this.namespace,ht].join()},ft}(),z=function(){function ft(ht){this.storage=ht}return ft.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},ft.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},ft.prototype.getActiveConfig=function(){return this.activeConfig},ft.prototype.loadFromStorage=function(){return Dt.__awaiter(this,void 0,void 0,function(){var ht,Nt,re,jt,se,ye;return Dt.__generator(this,function(Rt){switch(Rt.label){case 0:return ht=this.storage.getLastFetchStatus(),Nt=this.storage.getLastSuccessfulFetchTimestampMillis(),re=this.storage.getActiveConfig(),[4,ht];case 1:return(jt=Rt.sent())&&(this.lastFetchStatus=jt),[4,Nt];case 2:return(se=Rt.sent())&&(this.lastSuccessfulFetchTimestampMillis=se),[4,re];case 3:return(ye=Rt.sent())&&(this.activeConfig=ye),[2]}})})},ft.prototype.setLastFetchStatus=function(ht){return this.lastFetchStatus=ht,this.storage.setLastFetchStatus(ht)},ft.prototype.setLastSuccessfulFetchTimestampMillis=function(ht){return this.lastSuccessfulFetchTimestampMillis=ht,this.storage.setLastSuccessfulFetchTimestampMillis(ht)},ft.prototype.setActiveConfig=function(ht){return this.activeConfig=ht,this.storage.setActiveConfig(ht)},ft}();function Y(ft,ht){return new Promise(function(Nt,re){var jt=Math.max(ht-Date.now(),0),se=setTimeout(Nt,jt);ft.addEventListener(function(){clearTimeout(se),re(Lt.create("fetch-throttle",{throttleEndTimeMillis:ht}))})})}var tt=function(){function ft(ht,Nt){this.client=ht,this.storage=Nt}return ft.prototype.fetch=function(ht){return Dt.__awaiter(this,void 0,void 0,function(){var Nt;return Dt.__generator(this,function(re){switch(re.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return Nt=re.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(ht,Nt)]}})})},ft.prototype.attemptFetch=function(ht,Nt){var re=Nt.throttleEndTimeMillis,jt=Nt.backoffCount;return Dt.__awaiter(this,void 0,void 0,function(){var se,ye,Rt;return Dt.__generator(this,function(Oe){switch(Oe.label){case 0:return[4,Y(ht.signal,re)];case 1:Oe.sent(),Oe.label=2;case 2:return Oe.trys.push([2,5,,7]),[4,this.client.fetch(ht)];case 3:return se=Oe.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return Oe.sent(),[2,se];case 5:if(!function(ft){if(!(ft instanceof D.FirebaseError))return!1;var ht=Number(ft.httpStatus);return 429===ht||500===ht||503===ht||504===ht}(ye=Oe.sent()))throw ye;return Rt={throttleEndTimeMillis:Date.now()+D.calculateBackoffMillis(jt),backoffCount:jt+1},[4,this.storage.setThrottleMetadata(Rt)];case 6:return Oe.sent(),[2,this.attemptFetch(ht,Rt)];case 7:return[2]}})})},ft}(),yt="@firebase/remote-config";function Ot(ft){ft.INTERNAL.registerComponent(new St.Component("remoteConfig",function(Nt,re){var jt=Nt.getProvider("app").getImmediate(),se=Nt.getProvider("installations").getImmediate();if("undefined"==typeof window)throw Lt.create("registration-window");var ye=jt.options,Rt=ye.projectId,Oe=ye.apiKey,nn=ye.appId;if(!Rt)throw Lt.create("registration-project-id");if(!Oe)throw Lt.create("registration-api-key");if(!nn)throw Lt.create("registration-app-id");var Be=new T(nn,jt.name,re=re||"firebase"),te=new z(Be),_e=new Te.Logger(yt);_e.logLevel=Te.LogLevel.ERROR;var vn=new ge(se,ft.SDK_VERSION,re,Rt,Oe,nn),le=new tt(vn,Be),en=new de(le,Be,te,_e),fn=new xt(jt,en,te,Be,_e);return fn.ensureInitialized(),fn},"PUBLIC").setMultipleInstances(!0)),ft.registerVersion(yt,"0.1.28")}Ot(Yt.default),be.registerRemoteConfig=Ot},6035:(Xn,be,Bt)=>{"use strict";Bt.r(be),Bt.d(be,{registerStorage:()=>rr});var B=Bt(6279);function J(_,g,N,V){return new(N||(N=Promise))(function(nt,bt){function kt(Qt){try{Gt(V.next(Qt))}catch(xe){bt(xe)}}function It(Qt){try{Gt(V.throw(Qt))}catch(xe){bt(xe)}}function Gt(Qt){Qt.done?nt(Qt.value):function(nt){return nt instanceof N?nt:new N(function(bt){bt(nt)})}(Qt.value).then(kt,It)}Gt((V=V.apply(_,g||[])).next())})}function ut(_,g){var V,H,nt,bt,N={label:0,sent:function(){if(1&nt[0])throw nt[1];return nt[1]},trys:[],ops:[]};return bt={next:kt(0),throw:kt(1),return:kt(2)},"function"==typeof Symbol&&(bt[Symbol.iterator]=function(){return this}),bt;function kt(Gt){return function(Qt){return function(Gt){if(V)throw new TypeError("Generator is already executing.");for(;N;)try{if(V=1,H&&(nt=2&Gt[0]?H.return:Gt[0]?H.throw||((nt=H.return)&&nt.call(H),0):H.next)&&!(nt=nt.call(H,Gt[1])).done)return nt;switch(H=0,nt&&(Gt=[2&Gt[0],nt.value]),Gt[0]){case 0:case 1:nt=Gt;break;case 4:return N.label++,{value:Gt[1],done:!1};case 5:N.label++,H=Gt[1],Gt=[0];continue;case 7:Gt=N.ops.pop(),N.trys.pop();continue;default:if(!(nt=(nt=N.trys).length>0&&nt[nt.length-1])&&(6===Gt[0]||2===Gt[0])){N=0;continue}if(3===Gt[0]&&(!nt||Gt[1]>nt[0]&&Gt[1]<nt[3])){N.label=Gt[1];break}if(6===Gt[0]&&N.label<nt[1]){N.label=nt[1],nt=Gt;break}if(nt&&N.label<nt[2]){N.label=nt[2],N.ops.push(Gt);break}nt[2]&&N.ops.pop(),N.trys.pop();continue}Gt=g.call(_,N)}catch(Qt){Gt=[6,Qt],H=0}finally{V=nt=0}if(5&Gt[0])throw Gt[1];return{value:Gt[0]?Gt[1]:void 0,done:!0}}([Gt,Qt])}}}function ve(){for(var _=0,g=0,N=arguments.length;g<N;g++)_+=arguments[g].length;var V=Array(_),H=0;for(g=0;g<N;g++)for(var nt=arguments[g],bt=0,kt=nt.length;bt<kt;bt++,H++)V[H]=nt[bt];return V}var S=Bt(1100),b="firebasestorage.googleapis.com",z=function(){function _(g,N){this.code_=Xt(g),this.message_="Firebase Storage: "+N,this.serverResponse_=null,this.name_="FirebaseError"}return _.prototype.codeProp=function(){return this.code},_.prototype.codeEquals=function(g){return Xt(g)===this.codeProp()},_.prototype.serverResponseProp=function(){return this.serverResponse_},_.prototype.setServerResponseProp=function(g){this.serverResponse_=g},Object.defineProperty(_.prototype,"name",{get:function(){return this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"code",{get:function(){return this.code_},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"message",{get:function(){return this.serverResponse_?this.message_+"\n"+this.serverResponse_:this.message_},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!1,configurable:!0}),_}();function Xt(_){return"storage/"+_}function tt(){return new z("unknown","An unknown error occurred, please check the error payload for server response.")}function Nt(){return new z("canceled","User canceled the upload/download.")}function se(){return new z("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function Rt(){return new z("no-download-url","The given file does not have any download URLs.")}function Oe(_,g,N){return new z("invalid-argument","Invalid argument in `"+g+"` at index "+_+": "+N)}function Be(){return new z("app-deleted","The Firebase app was deleted.")}function _e(_,g){return new z("invalid-format","String does not match format '"+_+"': "+g)}function vn(_){throw new z("internal-error","Internal error: "+_)}var le={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function en(_){switch(_){case le.RAW:case le.BASE64:case le.BASE64URL:case le.DATA_URL:return;default:throw"Expected one of the event types: ["+le.RAW+", "+le.BASE64+", "+le.BASE64URL+", "+le.DATA_URL+"]."}}var fn=function(g,N){this.data=g,this.contentType=N||null};function Sn(_,g){switch(_){case le.RAW:return new fn(hn(g));case le.BASE64:case le.BASE64URL:return new fn(_n(_,g));case le.DATA_URL:return new fn(function(_){var g=new qe(_);return g.base64?_n(le.BASE64,g.rest):function(_){var g;try{g=decodeURIComponent(_)}catch(N){throw _e(le.DATA_URL,"Malformed data URL.")}return hn(g)}(g.rest)}(g),function(_){return new qe(_).contentType}(g))}throw tt()}function hn(_){for(var g=[],N=0;N<_.length;N++){var V=_.charCodeAt(N);if(V<=127)g.push(V);else if(V<=2047)g.push(192|V>>6,128|63&V);else if(55296==(64512&V))if(N<_.length-1&&56320==(64512&_.charCodeAt(N+1))){var nt=V,bt=_.charCodeAt(++N);g.push(240|(V=65536|(1023&nt)<<10|1023&bt)>>18,128|V>>12&63,128|V>>6&63,128|63&V)}else g.push(239,191,189);else 56320==(64512&V)?g.push(239,191,189):g.push(224|V>>12,128|V>>6&63,128|63&V)}return new Uint8Array(g)}function _n(_,g){switch(_){case le.BASE64:var N=-1!==g.indexOf("-"),V=-1!==g.indexOf("_");if(N||V)throw _e(_,"Invalid character '"+(N?"-":"_")+"' found: is it base64url encoded?");break;case le.BASE64URL:var nt=-1!==g.indexOf("+"),bt=-1!==g.indexOf("/");if(nt||bt)throw _e(_,"Invalid character '"+(nt?"+":"/")+"' found: is it base64 encoded?");g=g.replace(/-/g,"+").replace(/_/g,"/")}var kt;try{kt=atob(g)}catch(Qt){throw _e(_,"Invalid character found")}for(var It=new Uint8Array(kt.length),Gt=0;Gt<kt.length;Gt++)It[Gt]=kt.charCodeAt(Gt);return It}var qe=function(g){this.base64=!1,this.contentType=null;var N=g.match(/^data:([^,]+)?,/);if(null===N)throw _e(le.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var V=N[1]||null;null!=V&&(this.base64=function(_,g){return _.length>=g.length&&_.substring(_.length-g.length)===g}(V,";base64"),this.contentType=this.base64?V.substring(0,V.length-";base64".length):V),this.rest=g.substring(g.indexOf(",")+1)},An={STATE_CHANGED:"state_changed"},$e={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function sn(_){switch(_){case"running":case"pausing":case"canceling":return $e.RUNNING;case"paused":return $e.PAUSED;case"success":return $e.SUCCESS;case"canceled":return $e.CANCELED;case"error":default:return $e.ERROR}}function Ke(_){return null!=_}function Ge(_){return void 0!==_}function Pe(_){return"function"==typeof _}function Se(_){return"object"==typeof _}function Ee(_){return Se(_)&&null!==_}function wn(_){return"string"==typeof _||_ instanceof String}function kn(_){return Mn(_)&&Number.isInteger(_)}function Mn(_){return"number"==typeof _||_ instanceof Number}function Qe(_){return Dn()&&_ instanceof Blob}function Dn(){return"undefined"!=typeof Blob}var ke=(()=>{return(_=ke||(ke={}))[_.NO_ERROR=0]="NO_ERROR",_[_.NETWORK_ERROR=1]="NETWORK_ERROR",_[_.ABORT=2]="ABORT",ke;var _})(),Je=function(){function _(){var g=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=ke.NO_ERROR,this.sendPromise_=new Promise(function(N){g.xhr_.addEventListener("abort",function(){g.errorCode_=ke.ABORT,N(g)}),g.xhr_.addEventListener("error",function(){g.errorCode_=ke.NETWORK_ERROR,N(g)}),g.xhr_.addEventListener("load",function(){N(g)})})}return _.prototype.send=function(g,N,V,H){if(this.sent_)throw vn("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(N,g,!0),Ke(H))for(var nt in H)H.hasOwnProperty(nt)&&this.xhr_.setRequestHeader(nt,H[nt].toString());return Ke(V)?this.xhr_.send(V):this.xhr_.send(),this.sendPromise_},_.prototype.getErrorCode=function(){if(!this.sent_)throw vn("cannot .getErrorCode() before sending");return this.errorCode_},_.prototype.getStatus=function(){if(!this.sent_)throw vn("cannot .getStatus() before sending");try{return this.xhr_.status}catch(g){return-1}},_.prototype.getResponseText=function(){if(!this.sent_)throw vn("cannot .getResponseText() before sending");return this.xhr_.responseText},_.prototype.abort=function(){this.xhr_.abort()},_.prototype.getResponseHeader=function(g){return this.xhr_.getResponseHeader(g)},_.prototype.addUploadProgressListener=function(g){Ke(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",g)},_.prototype.removeUploadProgressListener=function(g){Ke(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",g)},_}(),Wn=function(){function _(){}return _.prototype.createXhrIo=function(){return new Je},_}();function Fn(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function xn(){for(var _=[],g=0;g<arguments.length;g++)_[g]=arguments[g];var N=Fn();if(void 0!==N){for(var V=new N,H=0;H<_.length;H++)V.append(_[H]);return V.getBlob()}if(Dn())return new Blob(_);throw Error("This browser doesn't seem to support creating Blobs")}var q=function(){function _(g,N){var V=0,H="";Qe(g)?(this.data_=g,V=g.size,H=g.type):g instanceof ArrayBuffer?(N?this.data_=new Uint8Array(g):(this.data_=new Uint8Array(g.byteLength),this.data_.set(new Uint8Array(g))),V=this.data_.length):g instanceof Uint8Array&&(N?this.data_=g:(this.data_=new Uint8Array(g.length),this.data_.set(g)),V=g.length),this.size_=V,this.type_=H}return _.prototype.size=function(){return this.size_},_.prototype.type=function(){return this.type_},_.prototype.slice=function(g,N){if(Qe(this.data_)){var H=function(_,g,N){return _.webkitSlice?_.webkitSlice(g,N):_.mozSlice?_.mozSlice(g,N):_.slice?_.slice(g,N):null}(this.data_,g,N);return null===H?null:new _(H)}return new _(new Uint8Array(this.data_.buffer,g,N-g),!0)},_.getBlob=function(){for(var g=[],N=0;N<arguments.length;N++)g[N]=arguments[N];if(Dn()){var V=g.map(function(It){return It instanceof _?It.data_:It});return new _(xn.apply(null,V))}var H=g.map(function(It){return wn(It)?Sn(le.RAW,It).data:It.data_}),nt=0;H.forEach(function(It){nt+=It.byteLength});var bt=new Uint8Array(nt),kt=0;return H.forEach(function(It){for(var Gt=0;Gt<It.length;Gt++)bt[kt++]=It[Gt]}),new _(bt,!0)},_.prototype.uploadData=function(){return this.data_},_}(),it=function(){function _(g,N){this.bucket=g,this.path_=N}return Object.defineProperty(_.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),_.prototype.fullServerUrl=function(){var g=encodeURIComponent;return"/b/"+g(this.bucket)+"/o/"+g(this.path)},_.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},_.makeFromBucketSpec=function(g){var N;try{N=_.makeFromUrl(g)}catch(V){return new _(g,"")}if(""===N.path)return N;throw function(_){return new z("invalid-default-bucket","Invalid default bucket '"+_+"'.")}(g)},_.makeFromUrl=function(g){var N=null,V="([A-Za-z0-9.\\-_]+)",bt=new RegExp("^gs://"+V+"(/(.*))?$","i");function It(Yn){Yn.path_=decodeURIComponent(Yn.path)}for(var Qt=b.replace(/[.]/g,"\\."),pn=[{regex:bt,indices:{bucket:1,path:3},postModify:function(Yn){"/"===Yn.path.charAt(Yn.path.length-1)&&(Yn.path_=Yn.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+Qt+"/v[A-Za-z0-9_]+/b/"+V+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:It},{regex:new RegExp("^https?://(?:storage.googleapis.com|storage.cloud.google.com)/"+V+"/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:It}],dn=0;dn<pn.length;dn++){var Qn=pn[dn],Gn=Qn.regex.exec(g);if(Gn){var Er=Gn[Qn.indices.path];Er||(Er=""),N=new _(Gn[Qn.indices.bucket],Er),Qn.postModify(N);break}}if(null==N)throw function(_){return new z("invalid-url","Invalid URL '"+_+"'.")}(g);return N},_}();function at(_){var g;try{g=JSON.parse(_)}catch(N){return null}return function(_){return Se(_)&&!Array.isArray(_)}(g)?g:null}function dt(_,g){var N=g.split("/").filter(function(V){return V.length>0}).join("/");return 0===_.length?N:_+"/"+N}function gt(_){var g=_.lastIndexOf("/",_.length-2);return-1===g?_:_.slice(g+1)}function Mt(_){return"https://"+b+"/v0"+_}function Ht(_){var g=encodeURIComponent,N="?";for(var V in _)_.hasOwnProperty(V)&&(N=N+(g(V)+"=")+g(_[V])+"&");return N.slice(0,-1)}function ae(_,g){return g}var Ft=function(g,N,V,H){this.server=g,this.local=N||g,this.writable=!!V,this.xform=H||ae},ue=null;function G(_,g,N){var V=at(g);return null===V?null:function(_,g,N){for(var V={type:"file"},H=N.length,nt=0;nt<H;nt++){var bt=N[nt];V[bt.local]=bt.xform(V,g[bt.server])}return function(_,g){Object.defineProperty(_,"ref",{get:function(){var nt=new it(_.bucket,_.fullPath);return g.makeStorageReference(nt)}})}(V,_),V}(_,V,N)}function K(_,g){for(var N={},V=g.length,H=0;H<V;H++){var nt=g[H];nt.writable&&(N[nt.server]=_[nt.local])}return JSON.stringify(N)}function et(_){if(!Se(_)||!_)throw"Expected Metadata object.";for(var g in _)if(_.hasOwnProperty(g)){var N=_[g];if("customMetadata"===g){if(!Se(N))throw"Expected object for 'customMetadata' mapping."}else if(Ee(N))throw"Mapping for '"+g+"' cannot be an object."}}var P="maxResults",C="pageToken",M="prefixes",W="items";function Pt(_){if(!Se(_)||!_)throw"Expected ListOptions object.";for(var g in _)if(g===P){if(!kn(_[P])||_[P]<=0)throw"Expected maxResults to be a positive number.";if(_[P]>1e3)throw"Expected maxResults to be less than or equal to 1000."}else{if(g!==C)throw"Unknown option: "+g;if(_[C]&&!wn(_[C]))throw"Expected pageToken to be string."}}var Vt=function(g,N,V,H){this.url=g,this.method=N,this.handler=V,this.timeout=H,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function he(_){if(!_)throw tt()}function ie(_,g){return function(V,H){var nt=G(_,H,g);return he(null!==nt),nt}}function Ae(_){return function(N,V){var H;return(H=401===N.getStatus()?new z("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===N.getStatus()?function(_){return new z("quota-exceeded","Quota for bucket '"+_+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(_.bucket):403===N.getStatus()?function(_){return new z("unauthorized","User does not have permission to access '"+_+"'.")}(_.path):V).setServerResponseProp(V.serverResponseProp()),H}}function Bn(_){var g=Ae(_);return function(V,H){var nt=g(V,H);return 404===V.getStatus()&&(nt=function(_){return new z("object-not-found","Object '"+_+"' does not exist.")}(_.path)),nt.setServerResponseProp(H.serverResponseProp()),nt}}function Re(_,g,N){var H=Mt(g.fullServerUrl()),bt=_.maxOperationRetryTime,kt=new Vt(H,"GET",ie(_,N),bt);return kt.errorHandler=Bn(g),kt}function Ur(_,g,N,V,H){var nt={};nt.prefix=g.isRoot?"":g.path+"/",N&&N.length>0&&(nt.delimiter=N),V&&(nt.pageToken=V),H&&(nt.maxResults=H);var kt=Mt(g.bucketOnlyServerUrl()),Gt=_.maxOperationRetryTime,Qt=new Vt(kt,"GET",function(_,g){return function(V,H){var nt=function(_,g,N){var V=at(N);return null===V?null:function(_,g,N){var V={prefixes:[],items:[],nextPageToken:N.nextPageToken};if(N[M])for(var H=0,nt=N[M];H<nt.length;H++){var kt=nt[H].replace(/\/$/,""),It=_.makeStorageReference(new it(g,kt));V.prefixes.push(It)}if(N[W])for(var Gt=0,Qt=N[W];Gt<Qt.length;Gt++)It=_.makeStorageReference(new it(g,Qt[Gt].name)),V.items.push(It);return V}(_,g,V)}(_,g,H);return he(null!==nt),nt}}(_,g.bucket),Gt);return Qt.urlParams=nt,Qt.errorHandler=Ae(g),Qt}function mr(_,g,N){var H=Mt(g.fullServerUrl()),bt=_.maxOperationRetryTime,kt=new Vt(H,"GET",function(_,g){return function(V,H){var nt=G(_,H,g);return he(null!==nt),function(_,g){var N=at(g);if(null===N||!wn(N.downloadTokens))return null;var V=N.downloadTokens;if(0===V.length)return null;var H=encodeURIComponent;return V.split(",").map(function(kt){var Gt=_.fullPath;return Mt("/b/"+H(_.bucket)+"/o/"+H(Gt))+Ht({alt:"media",token:kt})})[0]}(nt,H)}}(_,N),bt);return kt.errorHandler=Bn(g),kt}function Tr(_,g,N,V){var nt=Mt(g.fullServerUrl()),kt=K(N,V),Gt=_.maxOperationRetryTime,Qt=new Vt(nt,"PATCH",ie(_,V),Gt);return Qt.headers={"Content-Type":"application/json; charset=utf-8"},Qt.body=kt,Qt.errorHandler=Bn(g),Qt}function hr(_,g){var V=Mt(g.fullServerUrl()),kt=new Vt(V,"DELETE",function(It,Gt){},_.maxOperationRetryTime);return kt.successCodes=[200,204],kt.errorHandler=Bn(g),kt}function ii(_,g,N){var V=Object.assign({},N);return V.fullPath=_.path,V.size=g.size(),V.contentType||(V.contentType=function(_,g){return g&&g.type()||"application/octet-stream"}(0,g)),V}var pr=function(g,N,V,H){this.current=g,this.total=N,this.finalized=!!V,this.metadata=H||null};function Sr(_,g){var N=null;try{N=_.getResponseHeader("X-Goog-Upload-Status")}catch(H){he(!1)}return he(!!N&&-1!==(g||["active"]).indexOf(N)),N}var tr=function(g,N,V){if(Pe(g)||Ke(N)||Ke(V))this.next=g,this.error=N||null,this.complete=V||null;else{var nt=g;this.next=nt.next||null,this.error=nt.error||null,this.complete=nt.complete||null}},si=function(g,N,V,H,nt,bt){this.bytesTransferred=g,this.totalBytes=N,this.state=V,this.metadata=H,this.task=nt,this.ref=bt};function En(_,g,N){for(var V=g.length,H=g.length,nt=0;nt<g.length;nt++)if(g[nt].optional){V=nt;break}if(!(V<=N.length&&N.length<=H))throw function(_,g,N,V){var H,nt;return _===g?(H=_,nt=1===_?"argument":"arguments"):(H="between "+_+" and "+g,nt="arguments"),new z("invalid-argument-count","Invalid argument count in `"+N+"`: Expected "+H+" "+nt+", received "+V+".")}(V,H,_,N.length);for(nt=0;nt<N.length;nt++)try{g[nt].validator(N[nt])}catch(It){throw It instanceof Error?Oe(nt,_,It.message):Oe(nt,_,It)}}var qn=function(g,N){var V=this;this.validator=function(H){V.optional&&!Ge(H)||g(H)},this.optional=!!N};function sr(_,g){function N(H){if(!wn(H))throw"Expected string."}var V;return V=_?function(_,g){return function(N){_(N),g(N)}}(N,_):N,new qn(V,g)}function ai(){return new qn(function(g){if(!(g instanceof Uint8Array||g instanceof ArrayBuffer||Dn()&&g instanceof Blob))throw"Expected Blob or File."})}function In(_){return new qn(et,_)}function ar(_){return new qn(Pt,_)}function jr(){return new qn(function(g){if(!(Mn(g)&&g>=0))throw"Expected a number 0 or greater."})}function ur(_,g){return new qn(function(V){if(!(null===V||Ke(V)&&V instanceof Object))throw"Expected an Object.";null!=_&&_(V)},g)}function cr(_){return new qn(function(N){if(null!==N&&!Pe(N))throw"Expected a Function."},_)}function Tn(_){return function(){for(var g=[],N=0;N<arguments.length;N++)g[N]=arguments[N];Promise.resolve().then(function(){return _.apply(void 0,g)})}}var ui=function(){function _(g,N,V,H,nt,bt){var kt=this;void 0===bt&&(bt=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=g,this.service_=N,this.location_=V,this.blob_=nt,this.metadata_=bt,this.mappings_=H,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_="running",this.errorHandler_=function(It){kt.request_=null,kt.chunkMultiplier_=1,It.codeEquals("canceled")?(kt.needToFetchStatus_=!0,kt.completeTransitions_()):(kt.error_=It,kt.transition_("error"))},this.metadataErrorHandler_=function(It){kt.request_=null,It.codeEquals("canceled")?kt.completeTransitions_():(kt.error_=It,kt.transition_("error"))},this.promise_=new Promise(function(It,Gt){kt.resolve_=It,kt.reject_=Gt,kt.start_()}),this.promise_.then(null,function(){})}return _.prototype.makeProgressCallback_=function(){var g=this,N=this.transferred_;return function(V){return g.updateProgress_(N+V)}},_.prototype.shouldDoResumable_=function(g){return g.size()>262144},_.prototype.start_=function(){"running"===this.state_&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},_.prototype.resolveToken_=function(g){var N=this;this.service_.getAuthToken().then(function(V){switch(N.state_){case"running":g(V);break;case"canceling":N.transition_("canceled");break;case"pausing":N.transition_("paused")}})},_.prototype.createResumable_=function(){var g=this;this.resolveToken_(function(N){var V=function(_,g,N,V,H){var nt=g.bucketOnlyServerUrl(),bt=ii(g,V,H),kt={name:bt.fullPath},It=Mt(nt),Qt={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":V.size(),"X-Goog-Upload-Header-Content-Type":bt.contentType,"Content-Type":"application/json; charset=utf-8"},xe=K(bt,N),Ve=new Vt(It,"POST",function(gn){var rn;Sr(gn);try{rn=gn.getResponseHeader("X-Goog-Upload-URL")}catch(Kn){he(!1)}return he(wn(rn)),rn},_.maxUploadRetryTime);return Ve.urlParams=kt,Ve.headers=Qt,Ve.body=xe,Ve.errorHandler=Ae(g),Ve}(g.service_,g.location_,g.mappings_,g.blob_,g.metadata_),H=g.service_.makeRequest(V,N);g.request_=H,H.getPromise().then(function(nt){g.request_=null,g.uploadUrl_=nt,g.needToFetchStatus_=!1,g.completeTransitions_()},g.errorHandler_)})},_.prototype.fetchStatus_=function(){var g=this,N=this.uploadUrl_;this.resolveToken_(function(V){var H=function(_,g,N,V){var It=new Vt(N,"POST",function(Gt){var Qt=Sr(Gt,["active","final"]),xe=null;try{xe=Gt.getResponseHeader("X-Goog-Upload-Size-Received")}catch(yn){he(!1)}xe||he(!1);var me=Number(xe);return he(!isNaN(me)),new pr(me,V.size(),"final"===Qt)},_.maxUploadRetryTime);return It.headers={"X-Goog-Upload-Command":"query"},It.errorHandler=Ae(g),It}(g.service_,g.location_,N,g.blob_),nt=g.service_.makeRequest(H,V);g.request_=nt,nt.getPromise().then(function(bt){bt=bt,g.request_=null,g.updateProgress_(bt.current),g.needToFetchStatus_=!1,bt.finalized&&(g.needToFetchMetadata_=!0),g.completeTransitions_()},g.errorHandler_)})},_.prototype.continueUpload_=function(){var g=this,N=262144*this.chunkMultiplier_,V=new pr(this.transferred_,this.blob_.size()),H=this.uploadUrl_;this.resolveToken_(function(nt){var bt;try{bt=function(_,g,N,V,H,nt,bt,kt){var It=new pr(0,0);if(bt?(It.current=bt.current,It.total=bt.total):(It.current=0,It.total=V.size()),V.size()!==It.total)throw new z("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var Gt=It.total-It.current,Qt=Gt;H>0&&(Qt=Math.min(Qt,H));var xe=It.current,Ve={"X-Goog-Upload-Command":Qt===Gt?"upload, finalize":"upload","X-Goog-Upload-Offset":It.current},gn=V.slice(xe,xe+Qt);if(null===gn)throw se();var dn=new Vt(N,"POST",function(Qn,Gn){var Jr,Dr=Sr(Qn,["active","final"]),Er=It.current+Qt,Yn=V.size();return Jr="final"===Dr?ie(g,nt)(Qn,Gn):null,new pr(Er,Yn,"final"===Dr,Jr)},g.maxUploadRetryTime);return dn.headers=Ve,dn.body=gn.uploadData(),dn.progressCallback=kt||null,dn.errorHandler=Ae(_),dn}(g.location_,g.service_,H,g.blob_,N,g.mappings_,V,g.makeProgressCallback_())}catch(It){return g.error_=It,void g.transition_("error")}var kt=g.service_.makeRequest(bt,nt);g.request_=kt,kt.getPromise().then(function(It){g.increaseMultiplier_(),g.request_=null,g.updateProgress_(It.current),It.finalized?(g.metadata_=It.metadata,g.transition_("success")):g.completeTransitions_()},g.errorHandler_)})},_.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},_.prototype.fetchMetadata_=function(){var g=this;this.resolveToken_(function(N){var V=Re(g.service_,g.location_,g.mappings_),H=g.service_.makeRequest(V,N);g.request_=H,H.getPromise().then(function(nt){g.request_=null,g.metadata_=nt,g.transition_("success")},g.metadataErrorHandler_)})},_.prototype.oneShotUpload_=function(){var g=this;this.resolveToken_(function(N){var V=function(_,g,N,V,H){var nt=g.bucketOnlyServerUrl(),bt={"X-Goog-Upload-Protocol":"multipart"},It=function(){for(var dn="",Qn=0;Qn<2;Qn++)dn+=Math.random().toString().slice(2);return dn}();bt["Content-Type"]="multipart/related; boundary="+It;var Gt=ii(g,V,H),Qt=K(Gt,N),yn=q.getBlob("--"+It+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Qt+"\r\n--"+It+"\r\nContent-Type: "+Gt.contentType+"\r\n\r\n",V,"\r\n--"+It+"--");if(null===yn)throw se();var Ve={name:Gt.fullPath},gn=Mt(nt),Kn=_.maxUploadRetryTime,pn=new Vt(gn,"POST",ie(_,N),Kn);return pn.urlParams=Ve,pn.headers=bt,pn.body=yn.uploadData(),pn.errorHandler=Ae(g),pn}(g.service_,g.location_,g.mappings_,g.blob_,g.metadata_),H=g.service_.makeRequest(V,N);g.request_=H,H.getPromise().then(function(nt){g.request_=null,g.metadata_=nt,g.updateProgress_(g.blob_.size()),g.transition_("success")},g.errorHandler_)})},_.prototype.updateProgress_=function(g){var N=this.transferred_;this.transferred_=g,this.transferred_!==N&&this.notifyObservers_()},_.prototype.transition_=function(g){if(this.state_!==g)switch(g){case"canceling":case"pausing":this.state_=g,null!==this.request_&&this.request_.cancel();break;case"running":var N="paused"===this.state_;this.state_=g,N&&(this.notifyObservers_(),this.start_());break;case"paused":this.state_=g,this.notifyObservers_();break;case"canceled":this.error_=Nt(),this.state_=g,this.notifyObservers_();break;case"error":case"success":this.state_=g,this.notifyObservers_()}},_.prototype.completeTransitions_=function(){switch(this.state_){case"pausing":this.transition_("paused");break;case"canceling":this.transition_("canceled");break;case"running":this.start_()}},Object.defineProperty(_.prototype,"snapshot",{get:function(){var g=sn(this.state_);return new si(this.transferred_,this.blob_.size(),g,this.metadata_,this,this.ref_)},enumerable:!1,configurable:!0}),_.prototype.on=function(g,N,V,H){function nt(){if(g!==An.STATE_CHANGED)throw"Expected one of the event types: ["+An.STATE_CHANGED+"]."}var bt="Expected a function or an Object with one of `next`, `error`, `complete` properties.",kt=cr(!0).validator,It=ur(null,!0).validator;function Gt(rn){try{return void kt(rn)}catch(pn){}try{if(It(rn),!(Ge(rn.next)||Ge(rn.error)||Ge(rn.complete)))throw"";return}catch(pn){throw bt}}var Qt=[sr(nt),ur(Gt,!0),cr(!0),cr(!0)];En("on",Qt,arguments);var xe=this;function me(rn){return function(pn,dn,Qn){null!==rn&&En("on",rn,arguments);var Gn=new tr(pn,dn,H);return xe.addObserver_(Gn),function(){xe.removeObserver_(Gn)}}}function yn(rn){if(null===rn)throw bt;Gt(rn)}var Ve=[ur(yn),cr(!0),cr(!0)],gn=!(Ge(N)||Ge(V)||Ge(H));return gn?me(Ve):me(null)(N,V,H)},_.prototype.then=function(g,N){return this.promise_.then(g,N)},_.prototype.catch=function(g){return this.then(null,g)},_.prototype.addObserver_=function(g){this.observers_.push(g),this.notifyObserver_(g)},_.prototype.removeObserver_=function(g){var N=this.observers_.indexOf(g);-1!==N&&this.observers_.splice(N,1)},_.prototype.notifyObservers_=function(){var g=this;this.finishPromise_(),this.observers_.slice().forEach(function(V){g.notifyObserver_(V)})},_.prototype.finishPromise_=function(){if(null!==this.resolve_){var g=!0;switch(sn(this.state_)){case $e.SUCCESS:Tn(this.resolve_.bind(null,this.snapshot))();break;case $e.CANCELED:case $e.ERROR:Tn(this.reject_.bind(null,this.error_))();break;default:g=!1}g&&(this.resolve_=null,this.reject_=null)}},_.prototype.notifyObserver_=function(g){switch(sn(this.state_)){case $e.RUNNING:case $e.PAUSED:g.next&&Tn(g.next.bind(g,this.snapshot))();break;case $e.SUCCESS:g.complete&&Tn(g.complete.bind(g))();break;case $e.CANCELED:case $e.ERROR:g.error&&Tn(g.error.bind(g,this.error_))();break;default:g.error&&Tn(g.error.bind(g,this.error_))()}},_.prototype.resume=function(){En("resume",[],arguments);var g="paused"===this.state_||"pausing"===this.state_;return g&&this.transition_("running"),g},_.prototype.pause=function(){En("pause",[],arguments);var g="running"===this.state_;return g&&this.transition_("pausing"),g},_.prototype.cancel=function(){En("cancel",[],arguments);var g="running"===this.state_||"pausing"===this.state_;return g&&this.transition_("canceling"),g},_}(),_r=function(){function _(g,N){this.service=g,this.location=N instanceof it?N:it.makeFromUrl(N)}return _.prototype.toString=function(){return En("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},_.prototype.newRef=function(g,N){return new _(g,N)},_.prototype.mappings=function(){return function(){if(ue)return ue;var _=[];_.push(new Ft("bucket")),_.push(new Ft("generation")),_.push(new Ft("metageneration")),_.push(new Ft("name","fullPath",!0));var N=new Ft("name");N.xform=function(nt,bt){return function(_){return!wn(_)||_.length<2?_:gt(_)}(bt)},_.push(N);var H=new Ft("size");return H.xform=function(nt,bt){return Ke(bt)?Number(bt):bt},_.push(H),_.push(new Ft("timeCreated")),_.push(new Ft("updated")),_.push(new Ft("md5Hash",null,!0)),_.push(new Ft("cacheControl",null,!0)),_.push(new Ft("contentDisposition",null,!0)),_.push(new Ft("contentEncoding",null,!0)),_.push(new Ft("contentLanguage",null,!0)),_.push(new Ft("contentType",null,!0)),_.push(new Ft("metadata","customMetadata",!0)),ue=_}()},_.prototype.child=function(g){En("child",[sr()],arguments);var N=dt(this.location.path,g),V=new it(this.location.bucket,N);return this.newRef(this.service,V)},Object.defineProperty(_.prototype,"parent",{get:function(){var g=function(_){if(0===_.length)return null;var g=_.lastIndexOf("/");return-1===g?"":_.slice(0,g)}(this.location.path);if(null===g)return null;var N=new it(this.location.bucket,g);return this.newRef(this.service,N)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"root",{get:function(){var g=new it(this.location.bucket,"");return this.newRef(this.service,g)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"name",{get:function(){return gt(this.location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"storage",{get:function(){return this.service},enumerable:!1,configurable:!0}),_.prototype.put=function(g,N){return void 0===N&&(N=null),En("put",[ai(),In(!0)],arguments),this.throwIfRoot_("put"),new ui(this,this.service,this.location,this.mappings(),new q(g),N)},_.prototype.putString=function(g,N,V){void 0===N&&(N=le.RAW),En("putString",[sr(),sr(en,!0),In(!0)],arguments),this.throwIfRoot_("putString");var H=Sn(N,g),nt=Object.assign({},V);return!Ke(nt.contentType)&&Ke(H.contentType)&&(nt.contentType=H.contentType),new ui(this,this.service,this.location,this.mappings(),new q(H.data,!0),nt)},_.prototype.delete=function(){var g=this;return En("delete",[],arguments),this.throwIfRoot_("delete"),this.service.getAuthToken().then(function(N){var V=hr(g.service,g.location);return g.service.makeRequest(V,N).getPromise()})},_.prototype.listAll=function(){En("listAll",[],arguments);var g={prefixes:[],items:[]};return this.listAllHelper(g).then(function(){return g})},_.prototype.listAllHelper=function(g,N){return J(this,void 0,void 0,function(){var H,nt,bt;return ut(this,function(kt){switch(kt.label){case 0:return[4,this.list({pageToken:N})];case 1:return H=kt.sent(),(nt=g.prefixes).push.apply(nt,H.prefixes),(bt=g.items).push.apply(bt,H.items),null==H.nextPageToken?[3,3]:[4,this.listAllHelper(g,H.nextPageToken)];case 2:kt.sent(),kt.label=3;case 3:return[2]}})})},_.prototype.list=function(g){En("list",[ar(!0)],arguments);var N=this;return this.service.getAuthToken().then(function(V){var H=g||{},nt=Ur(N.service,N.location,"/",H.pageToken,H.maxResults);return N.service.makeRequest(nt,V).getPromise()})},_.prototype.getMetadata=function(){var g=this;return En("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.service.getAuthToken().then(function(N){var V=Re(g.service,g.location,g.mappings());return g.service.makeRequest(V,N).getPromise()})},_.prototype.updateMetadata=function(g){var N=this;return En("updateMetadata",[In()],arguments),this.throwIfRoot_("updateMetadata"),this.service.getAuthToken().then(function(V){var H=Tr(N.service,N.location,g,N.mappings());return N.service.makeRequest(H,V).getPromise()})},_.prototype.getDownloadURL=function(){var g=this;return En("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.service.getAuthToken().then(function(N){var V=mr(g.service,g.location,g.mappings());return g.service.makeRequest(V,N).getPromise().then(function(H){if(null===H)throw Rt();return H})})},_.prototype.throwIfRoot_=function(g){if(""===this.location.path)throw function(_){return new z("invalid-root-operation","The operation '"+_+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(g)},_}(),wr=function(){function _(g){this.promise_=Promise.reject(g)}return _.prototype.getPromise=function(){return this.promise_},_.prototype.cancel=function(g){},_}(),Le=function(){function _(g,N,V,H,nt,bt,kt,It,Gt,Qt,xe){var me=this;this.pendingXhr_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=g,this.method_=N,this.headers_=V,this.body_=H,this.successCodes_=nt.slice(),this.additionalRetryCodes_=bt.slice(),this.callback_=kt,this.errorCallback_=It,this.progressCallback_=Qt,this.timeout_=Gt,this.pool_=xe,this.promise_=new Promise(function(yn,Ve){me.resolve_=yn,me.reject_=Ve,me.start_()})}return _.prototype.start_=function(){var g=this;function V(H,nt){var bt=g.resolve_,kt=g.reject_,It=nt.xhr;if(nt.wasSuccessCode)try{var Gt=g.callback_(It,It.getResponseText());Ge(Gt)?bt(Gt):bt()}catch(xe){kt(xe)}else if(null!==It)(Qt=tt()).setServerResponseProp(It.getResponseText()),kt(g.errorCallback_?g.errorCallback_(It,Qt):Qt);else if(nt.canceled)kt(Qt=g.appDelete_?Be():Nt());else{var Qt;kt(Qt=new z("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}}this.canceled_?V(0,new Vr(!1,null,!0)):this.backoffId_=function(_,g,N){var V=1,H=null,nt=!1,bt=0;function kt(){return 2===bt}var It=!1;function Gt(){for(var Ve=[],gn=0;gn<arguments.length;gn++)Ve[gn]=arguments[gn];It||(It=!0,g.apply(null,Ve))}function Qt(Ve){H=setTimeout(function(){H=null,_(xe,kt())},Ve)}function xe(Ve){for(var gn=[],rn=1;rn<arguments.length;rn++)gn[rn-1]=arguments[rn];if(!It){if(Ve)return void Gt.call.apply(Gt,ve([null,Ve],gn));var pn;if(kt()||nt)return void Gt.call.apply(Gt,ve([null,Ve],gn));V<64&&(V*=2),1===bt?(bt=2,pn=0):pn=1e3*(V+Math.random()),Qt(pn)}}var me=!1;function yn(Ve){me||(me=!0,!It&&(null!==H?(Ve||(bt=2),clearTimeout(H),Qt(0)):Ve||(bt=1)))}return Qt(0),setTimeout(function(){nt=!0,yn(!0)},N),yn}(function(H,nt){if(nt)H(!1,new Vr(!1,null,!0));else{var bt=g.pool_.createXhrIo();g.pendingXhr_=bt,null!==g.progressCallback_&&bt.addUploadProgressListener(kt),bt.send(g.url_,g.method_,g.body_,g.headers_).then(function(It){null!==g.progressCallback_&&It.removeUploadProgressListener(kt),g.pendingXhr_=null;var Gt=(It=It).getErrorCode()===ke.NO_ERROR,Qt=It.getStatus();if(Gt&&!g.isRetryStatusCode_(Qt)){var me=-1!==g.successCodes_.indexOf(Qt);H(!0,new Vr(me,It))}else{var xe=It.getErrorCode()===ke.ABORT;H(!1,new Vr(!1,null,xe))}})}function kt(It){null!==g.progressCallback_&&g.progressCallback_(It.loaded,It.lengthComputable?It.total:-1)}},V,this.timeout_)},_.prototype.getPromise=function(){return this.promise_},_.prototype.cancel=function(g){this.canceled_=!0,this.appDelete_=g||!1,null!==this.backoffId_&&function(_){_(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},_.prototype.isRetryStatusCode_=function(g){var N=g>=500&&g<600,H=-1!==[408,429].indexOf(g),nt=-1!==this.additionalRetryCodes_.indexOf(g);return N||H||nt},_}(),Vr=function(g,N,V){this.wasSuccessCode=g,this.xhr=N,this.canceled=!!V};var $r=function(){function _(g,N,V,H){var nt;this.bucket_=null,this.appId_=null,this.deleted_=!1,this.app_=g,this.authProvider_=N,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e5,this.requests_=new Set,this.pool_=V,this.bucket_=null!=H?it.makeFromBucketSpec(H):_.extractBucket_(null===(nt=this.app_)||void 0===nt?void 0:nt.options),this.internals_=new wi(this)}return _.extractBucket_=function(g){var N=null==g?void 0:g.storageBucket;return null==N?null:it.makeFromBucketSpec(N)},_.prototype.getAuthToken=function(){return J(this,void 0,void 0,function(){var g,N;return ut(this,function(V){switch(V.label){case 0:return(g=this.authProvider_.getImmediate({optional:!0}))?[4,g.getToken()]:[3,2];case 1:if(null!==(N=V.sent()))return[2,N.accessToken];V.label=2;case 2:return[2,null]}})})},_.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requests_.forEach(function(g){return g.cancel()}),this.requests_.clear()},_.prototype.makeStorageReference=function(g){return new _r(this,g)},_.prototype.makeRequest=function(g,N){var V=this;if(this.deleted_)return new wr(Be());var H=function(_,g,N,V){var H=Ht(_.urlParams),nt=_.url+H,bt=Object.assign({},_.headers);return function(_,g){g&&(_["X-Firebase-GMPID"]=g)}(bt,g),function(_,g){null!==g&&g.length>0&&(_.Authorization="Firebase "+g)}(bt,N),function(_){_["X-Firebase-Storage-Version"]="webjs/"+(void 0!==B.default?B.default.SDK_VERSION:"AppManager")}(bt),new Le(nt,_.method,bt,_.body,_.successCodes,_.additionalRetryCodes,_.handler,_.errorHandler,_.timeout,_.progressCallback,V)}(g,this.appId_,N,this.pool_);return this.requests_.add(H),H.getPromise().then(function(){return V.requests_.delete(H)},function(){return V.requests_.delete(H)}),H},_.prototype.ref=function(g){function N(H){if("string"!=typeof H)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(H))throw"Expected child path but got a URL, use refFromURL instead."}if(En("ref",[sr(N,!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var V=new _r(this,this.bucket_);return null!=g?V.child(g):V},_.prototype.refFromURL=function(g){function N(V){if("string"!=typeof V)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(V))throw"Expected full URL but got a child path, use ref instead.";try{it.makeFromUrl(V)}catch(H){throw"Expected valid full URL but got an invalid one."}}return En("refFromURL",[sr(N,!1)],arguments),new _r(this,g)},Object.defineProperty(_.prototype,"maxUploadRetryTime",{get:function(){return this.maxUploadRetryTime_},enumerable:!1,configurable:!0}),_.prototype.setMaxUploadRetryTime=function(g){En("setMaxUploadRetryTime",[jr()],arguments),this.maxUploadRetryTime_=g},Object.defineProperty(_.prototype,"maxOperationRetryTime",{get:function(){return this.maxOperationRetryTime_},enumerable:!1,configurable:!0}),_.prototype.setMaxOperationRetryTime=function(g){En("setMaxOperationRetryTime",[jr()],arguments),this.maxOperationRetryTime_=g},Object.defineProperty(_.prototype,"app",{get:function(){return this.app_},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!1,configurable:!0}),_}(),wi=function(){function _(g){this.service_=g}return _.prototype.delete=function(){return this.service_.deleteApp(),Promise.resolve()},_}();function bi(_,g){var N=_.getProvider("app").getImmediate(),V=_.getProvider("auth-internal");return new $r(N,V,new Wn,g)}function rr(_){var g={TaskState:$e,TaskEvent:An,StringFormat:le,Storage:$r,Reference:_r};_.INTERNAL.registerComponent(new S.Component("storage",bi,"PUBLIC").setServiceProps(g).setMultipleInstances(!0)),_.registerVersion("@firebase/storage","0.3.43")}rr(B.default)},2870:(Xn,be,Bt)=>{"use strict";Bt.r(be),Bt.d(be,{default:()=>Rn,ErrorCode:()=>pi,EventType:()=>Hr,WebChannel:()=>dr,XhrIo:()=>to,createWebChannelTransport:()=>Zi});var B=function(u,v){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,L){E.__proto__=L}||function(E,L){for(var Z in L)Object.prototype.hasOwnProperty.call(L,Z)&&(E[Z]=L[Z])})(u,v)};function D(u){var v="function"==typeof Symbol&&Symbol.iterator,E=v&&u[v],L=0;if(E)return E.call(u);if(u&&"number"==typeof u.length)return{next:function(){return u&&L>=u.length&&(u=void 0),{value:u&&u[L++],done:!u}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")}var St,Te="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ne=Ne||{},Yt=Te||self;function de(){}function J(u){var v=typeof u;return"object"!=v?v:u?Array.isArray(u)?"array":v:"null"}function ut(u){var v=J(u);return"array"==v||"object"==v&&"number"==typeof u.length}function Lt(u){var v=typeof u;return"object"==v&&null!=u||"function"==v}var Tt="closure_uid_"+(1e9*Math.random()>>>0),ge=0;function Xe(u,v,E){return u.call.apply(u.bind,arguments)}function ve(u,v,E){if(!u)throw Error();if(2<arguments.length){var L=Array.prototype.slice.call(arguments,2);return function(){var Z=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Z,L),u.apply(v,Z)}}return function(){return u.apply(v,arguments)}}function ct(u,v,E){return(ct=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Xe:ve).apply(null,arguments)}function Ct(u,v){var E=Array.prototype.slice.call(arguments,1);return function(){var L=E.slice();return L.push.apply(L,arguments),u.apply(this,L)}}var mt=Date.now;function Kt(u,v){function E(){}E.prototype=v.prototype,u.S=v.prototype,u.prototype=new E,u.prototype.constructor=u}function ne(){this.j=this.j,this.i=this.i}ne.prototype.j=!1,ne.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&function(u){Object.prototype.hasOwnProperty.call(u,Tt)&&u[Tt]||(u[Tt]=++ge)}(this)},ne.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var xt=Array.prototype.indexOf?function(u,v){return Array.prototype.indexOf.call(u,v,void 0)}:function(u,v){if("string"==typeof u)return"string"!=typeof v||1!=v.length?-1:u.indexOf(v,0);for(var E=0;E<u.length;E++)if(E in u&&u[E]===v)return E;return-1},At=Array.prototype.forEach?function(u,v,E){Array.prototype.forEach.call(u,v,E)}:function(u,v,E){for(var L=u.length,Z="string"==typeof u?u.split(""):u,lt=0;lt<L;lt++)lt in Z&&v.call(E,Z[lt],lt,u)};function S(u){return Array.prototype.concat.apply([],arguments)}function b(u){var v=u.length;if(0<v){for(var E=Array(v),L=0;L<v;L++)E[L]=u[L];return E}return[]}function A(u){return/^[\s\xa0]*$/.test(u)}var Y,x=String.prototype.trim?function(u){return u.trim()}:function(u){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(u)[1]};function T(u,v){return-1!=u.indexOf(v)}function z(u,v){return u<v?-1:u>v?1:0}t:{var Xt=Yt.navigator;if(Xt){var tt=Xt.userAgent;if(tt){Y=tt;break t}}Y=""}function yt(u,v,E){for(var L in u)v.call(E,u[L],L,u)}function pe(u){var v={};for(var E in u)v[E]=u[E];return v}var Ot="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ft(u,v){for(var E,L,Z=1;Z<arguments.length;Z++){for(E in L=arguments[Z])u[E]=L[E];for(var lt=0;lt<Ot.length;lt++)E=Ot[lt],Object.prototype.hasOwnProperty.call(L,E)&&(u[E]=L[E])}}function ht(u){return ht[" "](u),u}ht[" "]=de;var Be,u,re=T(Y,"Opera"),jt=T(Y,"Trident")||T(Y,"MSIE"),se=T(Y,"Edge"),ye=se||jt,Rt=T(Y,"Gecko")&&!(T(Y.toLowerCase(),"webkit")&&!T(Y,"Edge"))&&!(T(Y,"Trident")||T(Y,"MSIE"))&&!T(Y,"Edge"),Oe=T(Y.toLowerCase(),"webkit")&&!T(Y,"Edge");function nn(){var u=Yt.document;return u?u.documentMode:void 0}t:{var te="",_e=(u=Y,Rt?/rv:([^\);]+)(\)|;)/.exec(u):se?/Edge\/([\d\.]+)/.exec(u):jt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(u):Oe?/WebKit\/(\S+)/.exec(u):re?/(?:Version)[ \/]?(\S+)/.exec(u):void 0);if(_e&&(te=_e?_e[1]:""),jt){var vn=nn();if(null!=vn&&vn>parseFloat(te)){Be=String(vn);break t}}Be=te}var le={};function en(u){return function(u,v){var E=le;return Object.prototype.hasOwnProperty.call(E,u)?E[u]:E[u]=v()}(u,function(){for(var v=0,E=x(String(Be)).split("."),L=x(String(u)).split("."),Z=Math.max(E.length,L.length),lt=0;0==v&&lt<Z;lt++){var Jt=E[lt]||"",We=L[lt]||"";do{if(Jt=/(\d*)(\D*)(.*)/.exec(Jt)||["","","",""],We=/(\d*)(\D*)(.*)/.exec(We)||["","","",""],0==Jt[0].length&&0==We[0].length)break;v=z(0==Jt[1].length?0:parseInt(Jt[1],10),0==We[1].length?0:parseInt(We[1],10))||z(0==Jt[2].length,0==We[2].length)||z(Jt[2],We[2]),Jt=Jt[3],We=We[3]}while(0==v)}return 0<=v})}var hn=Yt.document&&jt&&(nn()||parseInt(Be,10))||void 0,cn=!jt||9<=Number(hn),_n=jt&&!en("9"),qe=function(){if(!Yt.addEventListener||!Object.defineProperty)return!1;var u=!1,v=Object.defineProperty({},"passive",{get:function(){u=!0}});try{Yt.addEventListener("test",de,v),Yt.removeEventListener("test",de,v)}catch(E){}return u}();function Ce(u,v){this.type=u,this.a=this.target=v,this.defaultPrevented=!1}function we(u,v){if(Ce.call(this,u?u.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,u){var E=this.type=u.type,L=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.a=v,v=u.relatedTarget){if(Rt){t:{try{ht(v.nodeName);var Z=!0;break t}catch(lt){}Z=!1}Z||(v=null)}}else"mouseover"==E?v=u.fromElement:"mouseout"==E&&(v=u.toElement);this.relatedTarget=v,L?(this.clientX=void 0!==L.clientX?L.clientX:L.pageX,this.clientY=void 0!==L.clientY?L.clientY:L.pageY,this.screenX=L.screenX||0,this.screenY=L.screenY||0):(this.clientX=void 0!==u.clientX?u.clientX:u.pageX,this.clientY=void 0!==u.clientY?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType="string"==typeof u.pointerType?u.pointerType:Cn[u.pointerType]||"",this.c=u,u.defaultPrevented&&this.b()}}Ce.prototype.b=function(){this.defaultPrevented=!0},Kt(we,Ce);var Cn={2:"touch",3:"pen",4:"mouse"};we.prototype.b=function(){we.S.b.call(this);var u=this.c;if(u.preventDefault)u.preventDefault();else if(u.returnValue=!1,_n)try{(u.ctrlKey||112<=u.keyCode&&123>=u.keyCode)&&(u.keyCode=-1)}catch(v){}};var An="closure_listenable_"+(1e6*Math.random()|0),fe=0;function $e(u,v,E,L,Z){this.listener=u,this.proxy=null,this.src=v,this.type=E,this.capture=!!L,this.ca=Z,this.key=++fe,this.Y=this.Z=!1}function sn(u){u.Y=!0,u.listener=null,u.proxy=null,u.src=null,u.ca=null}function Ke(u){this.src=u,this.a={},this.b=0}function Ge(u,v){var E=v.type;if(E in u.a){var lt,L=u.a[E],Z=xt(L,v);(lt=0<=Z)&&Array.prototype.splice.call(L,Z,1),lt&&(sn(v),0==u.a[E].length&&(delete u.a[E],u.b--))}}function Pe(u,v,E,L){for(var Z=0;Z<u.length;++Z){var lt=u[Z];if(!lt.Y&&lt.listener==v&&lt.capture==!!E&&lt.ca==L)return Z}return-1}Ke.prototype.add=function(u,v,E,L,Z){var lt=u.toString();(u=this.a[lt])||(u=this.a[lt]=[],this.b++);var Jt=Pe(u,v,L,Z);return-1<Jt?(v=u[Jt],E||(v.Z=!1)):((v=new $e(v,this.src,lt,!!L,Z)).Z=E,u.push(v)),v};var Se="closure_lm_"+(1e6*Math.random()|0),Ee={};function ln(u,v,E,L,Z){if(L&&L.once)return Mn(u,v,E,L,Z);if(Array.isArray(v)){for(var lt=0;lt<v.length;lt++)ln(u,v[lt],E,L,Z);return null}return E=Hn(E),u&&u[An]?u.va(v,E,Lt(L)?!!L.capture:!!L,Z):wn(u,v,E,!1,L,Z)}function wn(u,v,E,L,Z,lt){if(!v)throw Error("Invalid event type");var Jt=Lt(Z)?!!Z.capture:!!Z;if(Jt&&!cn)return null;var We=Fn(u);if(We||(u[Se]=We=new Ke(u)),(E=We.add(v,E,L,Jt,lt)).proxy)return E;if(L=function(){var u=Wn,v=cn?function(E){return u.call(v.src,v.listener,E)}:function(E){if(!(E=u.call(v.src,v.listener,E)))return E};return v}(),E.proxy=L,L.src=u,L.listener=E,u.addEventListener)qe||(Z=Jt),void 0===Z&&(Z=!1),u.addEventListener(v.toString(),L,Z);else if(u.attachEvent)u.attachEvent(ke(v.toString()),L);else{if(!u.addListener||!u.removeListener)throw Error("addEventListener and attachEvent are unavailable.");u.addListener(L)}return E}function Mn(u,v,E,L,Z){if(Array.isArray(v)){for(var lt=0;lt<v.length;lt++)Mn(u,v[lt],E,L,Z);return null}return E=Hn(E),u&&u[An]?u.wa(v,E,Lt(L)?!!L.capture:!!L,Z):wn(u,v,E,!0,L,Z)}function Qe(u,v,E,L,Z){if(Array.isArray(v))for(var lt=0;lt<v.length;lt++)Qe(u,v[lt],E,L,Z);else L=Lt(L)?!!L.capture:!!L,E=Hn(E),u&&u[An]?(u=u.c,(v=String(v).toString())in u.a&&-1<(E=Pe(lt=u.a[v],E,L,Z))&&(sn(lt[E]),Array.prototype.splice.call(lt,E,1),0==lt.length&&(delete u.a[v],u.b--))):u&&(u=Fn(u))&&(v=u.a[v.toString()],u=-1,v&&(u=Pe(v,E,L,Z)),(E=-1<u?v[u]:null)&&Dn(E))}function Dn(u){if("number"!=typeof u&&u&&!u.Y){var v=u.src;if(v&&v[An])Ge(v.c,u);else{var E=u.type,L=u.proxy;v.removeEventListener?v.removeEventListener(E,L,u.capture):v.detachEvent?v.detachEvent(ke(E),L):v.addListener&&v.removeListener&&v.removeListener(L),(E=Fn(v))?(Ge(E,u),0==E.b&&(E.src=null,v[Se]=null)):sn(u)}}}function ke(u){return u in Ee?Ee[u]:Ee[u]="on"+u}function Je(u,v){var E=u.listener,L=u.ca||u.src;return u.Z&&Dn(u),E.call(L,v)}function Wn(u,v){if(u.Y)return!0;if(!cn){if(!v)t:{v=["window","event"];for(var E=Yt,L=0;L<v.length;L++)if(null==(E=E[v[L]])){v=null;break t}v=E}return Je(u,v=new we(v,this))}return Je(u,new we(v,this))}function Fn(u){return(u=u[Se])instanceof Ke?u:null}var xn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Hn(u){return"function"==J(u)?u:(u[xn]||(u[xn]=function(v){return u.handleEvent(v)}),u[xn])}function q(){ne.call(this),this.c=new Ke(this),this.J=this,this.C=null}function it(u,v,E,L){if(!(v=u.c.a[String(v)]))return!0;v=v.concat();for(var Z=!0,lt=0;lt<v.length;++lt){var Jt=v[lt];if(Jt&&!Jt.Y&&Jt.capture==E){var We=Jt.listener,Ue=Jt.ca||Jt.src;Jt.Z&&Ge(u.c,Jt),Z=!1!==We.call(Ue,L)&&Z}}return Z&&!L.defaultPrevented}Kt(q,ne),q.prototype[An]=!0,(St=q.prototype).addEventListener=function(u,v,E,L){ln(this,u,v,E,L)},St.removeEventListener=function(u,v,E,L){Qe(this,u,v,E,L)},St.dispatchEvent=function(u){var v,E=this.C;if(E)for(v=[];E;E=E.C)v.push(E);E=this.J;var L=u.type||u;if("string"==typeof u)u=new Ce(u,E);else if(u instanceof Ce)u.target=u.target||E;else{var Z=u;ft(u=new Ce(L,E),Z)}if(Z=!0,v)for(var lt=v.length-1;0<=lt;lt--){var Jt=u.a=v[lt];Z=it(Jt,L,!0,u)&&Z}if(Z=it(Jt=u.a=E,L,!0,u)&&Z,Z=it(Jt,L,!1,u)&&Z,v)for(lt=0;lt<v.length;lt++)Z=it(Jt=u.a=v[lt],L,!1,u)&&Z;return Z},St.G=function(){if(q.S.G.call(this),this.c){var v,u=this.c;for(v in u.a){for(var E=u.a[v],L=0;L<E.length;L++)sn(E[L]);delete u.a[v],u.b--}}this.C=null},St.va=function(u,v,E,L){return this.c.add(String(u),v,!1,E,L)},St.wa=function(u,v,E,L){return this.c.add(String(u),v,!0,E,L)};var at=Yt.JSON.stringify;function wt(){this.b=this.a=null}var Ft,dt=new(function(){function u(v,E,L){this.f=L,this.c=v,this.g=E,this.b=0,this.a=null}return u.prototype.get=function(){var v;return 0<this.b?(this.b--,this.a=(v=this.a).next,v.next=null):v=this.c(),v},u}())(function(){return new Mt},function(u){u.reset()},100);function gt(){var u=De,v=null;return u.a&&(v=u.a,u.a=u.a.next,u.a||(u.b=null),v.next=null),v}function Mt(){this.next=this.b=this.a=null}function Ht(u){Yt.setTimeout(function(){throw u},0)}function ae(u,v){Ft||function(){var u=Yt.Promise.resolve(void 0);Ft=function(){u.then(Fe)}}(),je||(Ft(),je=!0),De.add(u,v)}wt.prototype.add=function(u,v){var E=dt.get();E.set(u,v),this.b?this.b.next=E:this.a=E,this.b=E},Mt.prototype.set=function(u,v){this.a=u,this.b=v,this.next=null},Mt.prototype.reset=function(){this.next=this.b=this.a=null};var je=!1,De=new wt;function Fe(){for(var u;u=gt();){try{u.a.call(u.b)}catch(E){Ht(E)}var v=dt;v.g(u),v.b<v.f&&(v.b++,u.next=v.a,v.a=u)}je=!1}function bn(u,v){q.call(this),this.b=u||1,this.a=v||Yt,this.f=ct(this.Ya,this),this.g=mt()}function G(u){u.aa=!1,u.M&&(u.a.clearTimeout(u.M),u.M=null)}function j(u,v,E){if("function"==J(u))E&&(u=ct(u,E));else{if(!u||"function"!=typeof u.handleEvent)throw Error("Invalid listener argument");u=ct(u.handleEvent,u)}return 2147483647<Number(v)?-1:Yt.setTimeout(u,v||0)}function K(u){u.a=j(function(){u.a=null,u.c&&(u.c=!1,K(u))},u.h);var v=u.b;u.b=null,u.g.apply(null,v)}Kt(bn,q),(St=bn.prototype).aa=!1,St.M=null,St.Ya=function(){if(this.aa){var u=mt()-this.g;0<u&&u<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-u):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(G(this),this.start()))}},St.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=mt())},St.G=function(){bn.S.G.call(this),G(this),delete this.a};var et=function(u){function v(E,L,Z){var lt=u.call(this)||this;return lt.g=null!=Z?E.bind(Z):E,lt.h=L,lt.b=null,lt.c=!1,lt.a=null,lt}return function(u,v){function E(){this.constructor=u}B(u,v),u.prototype=null===v?Object.create(v):(E.prototype=v.prototype,new E)}(v,u),v.prototype.f=function(E){this.b=arguments,this.a?this.c=!0:K(this)},v.prototype.G=function(){u.prototype.G.call(this),this.a&&(Yt.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},v}(ne);function P(u){ne.call(this),this.b=u,this.a={}}Kt(P,ne);var y=[];function C(u,v,E,L){Array.isArray(E)||(E&&(y[0]=E.toString()),E=y);for(var Z=0;Z<E.length;Z++){var lt=ln(v,E[Z],L||u.handleEvent,!1,u.b||u);if(!lt)break;u.a[lt.key]=lt}}function M(u){yt(u.a,function(v,E){this.a.hasOwnProperty(E)&&Dn(v)},u),u.a={}}function W(){this.a=!0}function Pt(u,v,E,L){u.info(function(){return"XMLHTTP TEXT ("+v+"): "+function(u,v){if(!u.a)return v;if(!v)return null;try{var E=JSON.parse(v);if(E)for(u=0;u<E.length;u++)if(Array.isArray(E[u])){var L=E[u];if(!(2>L.length)){var Z=L[1];if(Array.isArray(Z)&&!(1>Z.length)){var lt=Z[0];if("noop"!=lt&&"stop"!=lt&&"close"!=lt)for(var Jt=1;Jt<Z.length;Jt++)Z[Jt]=""}}}return at(E)}catch(We){return v}}(u,E)+(L?" "+L:"")})}P.prototype.G=function(){P.S.G.call(this),M(this)},P.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},W.prototype.info=function(){};var ie=null;function zt(){return ie=ie||new q}function Ye(u){Ce.call(this,"serverreachability",u)}function Ae(u){var v=zt();v.dispatchEvent(new Ye(v,u))}function Bn(u){Ce.call(this,"statevent",u)}function Re(u){var v=zt();v.dispatchEvent(new Bn(v,u))}function Ur(u){Ce.call(this,"timingevent",u)}function mr(u,v){if("function"!=J(u))throw Error("Fn must not be null and must be a function");return Yt.setTimeout(function(){u()},v)}Kt(Ye,Ce),Kt(Bn,Ce),Kt(Ur,Ce);var Tr={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},hr={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function mi(){}function _i(){}mi.prototype.a=null;var Qr,pr={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Sr(){Ce.call(this,"d")}function Pr(){Ce.call(this,"c")}function oi(){}function Yr(u,v,E,L){this.g=u,this.c=v,this.f=E,this.T=L||1,this.J=new P(this),this.P=tr,this.R=new bn(u=ye?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}Kt(Sr,Ce),Kt(Pr,Ce),Kt(oi,mi),Qr=new oi;var tr=45e3,si={},En={};function qn(u,v,E){u.H=1,u.i=ci(zn(v)),u.j=E,u.I=!0,$n(u,null)}function $n(u,v){u.u=mt(),In(u),u.l=zn(u.i);var E=u.l,L=u.T;Array.isArray(L)||(L=[String(L)]),xe(E.b,"t",L),u.D=0,u.a=ei(u.g,u.g.C?v:null),0<u.O&&(u.F=new et(ct(u.Ca,u,u.a),u.O)),C(u.J,u.a,"readystatechange",u.Wa),v=u.B?pe(u.B):{},u.j?(u.m||(u.m="POST"),v["Content-Type"]="application/x-www-form-urlencoded",u.a.ba(u.l,u.m,u.j,v)):(u.m="GET",u.a.ba(u.l,u.m,null,v)),Ae(1),function(u,v,E,L,Z,lt){u.info(function(){if(u.a)if(lt)for(var Jt="",We=lt.split("&"),Ue=0;Ue<We.length;Ue++){var jn=We[Ue].split("=");if(1<jn.length){var Ir=jn[0];jn=jn[1];var vr=Ir.split("_");Jt=2<=vr.length&&"type"==vr[1]?Jt+(Ir+"=")+jn+"&":Jt+(Ir+"=redacted&")}}else Jt=null;else Jt=lt;return"XMLHTTP REQ ("+L+") [attempt "+Z+"]: "+v+"\n"+E+"\n"+Jt})}(u.c,u.m,u.l,u.f,u.T,u.j)}function sr(u,v,E){for(var L=!0;!u.A&&u.D<E.length;){var Z=ai(u,E);if(Z==En){4==v&&(u.h=4,Re(14),L=!1),Pt(u.c,u.f,null,"[Incomplete Response]");break}if(Z==si){u.h=4,Re(15),Pt(u.c,u.f,E,"[Invalid Chunk]"),L=!1;break}Pt(u.c,u.f,Z,null),Tn(u,Z)}4==v&&0==E.length&&(u.h=1,Re(16),L=!1),u.b=u.b&&L,L?0<E.length&&!u.W&&(u.W=!0,(v=u.g).a==u&&v.V&&!v.F&&(v.c.info("Great, no buffering proxy detected. Bytes received: "+E.length),xi(v),v.F=!0)):(Pt(u.c,u.f,E,"[Invalid Chunked Response]"),cr(u),ur(u))}function ai(u,v){var E=u.D,L=v.indexOf("\n",E);return-1==L?En:(E=Number(v.substring(E,L)),isNaN(E)?si:(L+=1)+E>v.length?En:(v=v.substr(L,E),u.D=L+E,v))}function In(u){u.U=mt()+u.P,ar(u,u.P)}function ar(u,v){if(null!=u.o)throw Error("WatchDog timer not null");u.o=mr(ct(u.Ua,u),v)}function jr(u){u.o&&(Yt.clearTimeout(u.o),u.o=null)}function ur(u){0==u.g.v||u.A||$i(u.g,u)}function cr(u){jr(u);var v=u.F;v&&"function"==typeof v.ja&&v.ja(),u.F=null,G(u.R),M(u.J),u.a&&(v=u.a,u.a=null,v.abort(),v.ja())}function Tn(u,v){try{var E=u.g;if(0!=E.v&&(E.a==u||dn(E.b,u)))if(E.I=u.N,!u.C&&dn(E.b,u)&&3==E.v){try{var L=E.ka.a.parse(v)}catch(eo){L=null}if(Array.isArray(L)&&3==L.length){var Z=L;if(0==Z[0])t:if(E.j)E.oa=Z[1],0<E.oa-E.P&&37500>Z[2]&&E.H&&0==E.o&&!E.m&&(E.m=mr(ct(E.Ra,E),6e3));else{if(E.a){if(!(E.a.u+3e3<u.u))break t;Si(E),Lr(E)}Ti(E),Re(18)}if(1>=pn(E.b)&&E.ea){try{E.ea()}catch(eo){}E.ea=void 0}}else Nr(E,11)}else if((u.C||E.a==u)&&Si(E),!A(v))for(v=L=E.ka.a.parse(v),L=0;L<v.length;L++)if(E.P=(Z=v[L])[0],Z=Z[1],2==E.v)if("c"==Z[0]){E.J=Z[1],E.ga=Z[2];var lt=Z[3];null!=lt&&(E.ha=lt,E.c.info("VER="+E.ha));var Jt=Z[4];null!=Jt&&(E.pa=Jt,E.c.info("SVER="+E.pa));var We=Z[5];if(null!=We&&"number"==typeof We&&0<We){var Ue=1.5*We;E.D=Ue,E.c.info("backChannelRequestTimeoutMs_="+Ue)}Ue=E;var jn=u.a;if(jn){var Ir=jn.a?jn.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ir){var vr=Ue.b;!vr.a&&(T(Ir,"spdy")||T(Ir,"quic")||T(Ir,"h2"))&&(vr.f=vr.g,vr.a=new Set,vr.b&&(Qn(vr,vr.b),vr.b=null))}if(Ue.A){var Ci=jn.a?jn.a.getResponseHeader("X-HTTP-Session-Id"):null;Ci&&(Ue.na=Ci,an(Ue.B,Ue.A,Ci))}}E.v=3,E.f&&E.f.ta(),E.V&&(E.N=mt()-u.u,E.c.info("Handshake RTT: "+E.N+"ms"));var di=u;if((Ue=E).la=Ji(Ue,Ue.C?Ue.ga:null,Ue.fa),di.C){Gn(Ue.b,di);var Zn=di,ir=Ue.D;ir&&Zn.setTimeout(ir),Zn.o&&(jr(Zn),In(Zn)),Ue.a=di}else Xi(Ue);0<E.g.length&&kr(E)}else"stop"!=Z[0]&&"close"!=Z[0]||Nr(E,7);else 3==E.v&&("stop"==Z[0]||"close"==Z[0]?"stop"==Z[0]?Nr(E,7):Di(E):"noop"!=Z[0]&&E.f&&E.f.sa(Z),E.o=0);Ae(4)}catch(eo){}}function _r(u,v){if(u.forEach&&"function"==typeof u.forEach)u.forEach(v,void 0);else if(ut(u)||"string"==typeof u)At(u,v,void 0);else{if(u.L&&"function"==typeof u.L)var E=u.L();else if(u.K&&"function"==typeof u.K)E=void 0;else if(ut(u)||"string"==typeof u){E=[];for(var L=u.length,Z=0;Z<L;Z++)E.push(Z)}else for(Z in E=[],L=0,u)E[L++]=Z;Z=(L=function(u){if(u.K&&"function"==typeof u.K)return u.K();if("string"==typeof u)return u.split("");if(ut(u)){for(var v=[],E=u.length,L=0;L<E;L++)v.push(u[L]);return v}for(L in v=[],E=0,u)v[E++]=u[L];return v}(u)).length;for(var lt=0;lt<Z;lt++)v.call(void 0,L[lt],E&&E[lt],u)}}function wr(u,v){this.b={},this.a=[],this.c=0;var E=arguments.length;if(1<E){if(E%2)throw Error("Uneven number of arguments");for(var L=0;L<E;L+=2)this.set(arguments[L],arguments[L+1])}else if(u)if(u instanceof wr)for(E=u.L(),L=0;L<E.length;L++)this.set(E[L],u.get(E[L]));else for(L in u)this.set(L,u[L])}function er(u){if(u.c!=u.a.length){for(var v=0,E=0;v<u.a.length;){var L=u.a[v];br(u.b,L)&&(u.a[E++]=L),v++}u.a.length=E}if(u.c!=u.a.length){var Z={};for(E=v=0;v<u.a.length;)br(Z,L=u.a[v])||(u.a[E++]=L,Z[L]=1),v++;u.a.length=E}}function br(u,v){return Object.prototype.hasOwnProperty.call(u,v)}(St=Yr.prototype).setTimeout=function(u){this.P=u},St.Wa=function(u){u=u.target;var v=this.F;v&&3==Cr(u)?v.f():this.Ca(u)},St.Ca=function(u){try{if(u==this.a)t:{var v=Cr(this.a),E=this.a.ua(),L=this.a.X();if(!(3>v||3==v&&!ye&&!this.a.$())){this.A||4!=v||7==E||Ae(8==E||0>=L?3:2),jr(this);var Z=this.a.X();this.N=Z;var lt=this.a.$();if(this.b=200==Z,function(u,v,E,L,Z,lt,Jt){u.info(function(){return"XMLHTTP RESP ("+L+") [ attempt "+Z+"]: "+v+"\n"+E+"\n"+lt+" "+Jt})}(this.c,this.m,this.l,this.f,this.T,v,Z),this.b){if(this.V&&!this.C){e:{if(this.a){var Jt,We=this.a;if((Jt=We.a?We.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(Jt)){var Ue=Jt;break e}}Ue=null}if(!Ue){this.b=!1,this.h=3,Re(12),cr(this),ur(this);break t}Pt(this.c,this.f,Ue,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Tn(this,Ue)}this.I?(sr(this,v,lt),ye&&this.b&&3==v&&(C(this.J,this.R,"tick",this.Va),this.R.start())):(Pt(this.c,this.f,lt,null),Tn(this,lt)),4==v&&cr(this),this.b&&!this.A&&(4==v?$i(this.g,this):(this.b=!1,In(this)))}else 400==Z&&0<lt.indexOf("Unknown SID")?(this.h=3,Re(12)):(this.h=0,Re(13)),cr(this),ur(this)}}}catch(jn){}},St.Va=function(){if(this.a){var u=Cr(this.a),v=this.a.$();this.D<v.length&&(jr(this),sr(this,u,v),this.b&&4!=u&&In(this))}},St.cancel=function(){this.A=!0,cr(this)},St.Ua=function(){this.o=null;var u=mt();0<=u-this.U?(function(u,v){u.info(function(){return"TIMEOUT: "+v})}(this.c,this.l),2!=this.H&&(Ae(3),Re(17)),cr(this),this.h=2,ur(this)):ar(this,this.U-u)},(St=wr.prototype).K=function(){er(this);for(var u=[],v=0;v<this.a.length;v++)u.push(this.b[this.a[v]]);return u},St.L=function(){return er(this),this.a.concat()},St.get=function(u,v){return br(this.b,u)?this.b[u]:v},St.set=function(u,v){br(this.b,u)||(this.c++,this.a.push(u)),this.b[u]=v},St.forEach=function(u,v){for(var E=this.L(),L=0;L<E.length;L++){var Z=E[L],lt=this.get(Z);u.call(v,lt,Z,this)}};var Le=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function nr(u,v){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,u instanceof nr){this.a=void 0!==v?v:u.a,Xr(this,u.f),this.j=u.j,Br(this,u.c),$r(this,u.h),this.g=u.g,v=u.b;var E=new kt;E.c=v.c,v.a&&(E.a=new wr(v.a),E.b=v.b),wi(this,E),this.i=u.i}else u&&(E=String(u).match(Le))?(this.a=!!v,Xr(this,E[1]||"",!0),this.j=rr(E[2]||""),Br(this,E[3]||"",!0),$r(this,E[4]),this.g=rr(E[5]||"",!0),wi(this,E[6]||"",!0),this.i=rr(E[7]||"")):(this.a=!!v,this.b=new kt(null,this.a))}function zn(u){return new nr(u)}function Xr(u,v,E){u.f=E?rr(v,!0):v,u.f&&(u.f=u.f.replace(/:$/,""))}function Br(u,v,E){u.c=E?rr(v,!0):v}function $r(u,v){if(v){if(v=Number(v),isNaN(v)||0>v)throw Error("Bad port number "+v);u.h=v}else u.h=null}function wi(u,v,E){v instanceof kt?(u.b=v,function(u,v){v&&!u.f&&(It(u),u.c=null,u.a.forEach(function(E,L){var Z=L.toLowerCase();L!=Z&&(Gt(this,L),xe(this,Z,E))},u)),u.f=v}(u.b,u.a)):(E||(v=_(v,nt)),u.b=new kt(v,u.a))}function an(u,v,E){u.b.set(v,E)}function ci(u){return an(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^mt()).toString(36)),u}function rr(u,v){return u?v?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function _(u,v,E){return"string"==typeof u?(u=encodeURI(u).replace(v,g),E&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function g(u){return"%"+((u=u.charCodeAt(0))>>4&15).toString(16)+(15&u).toString(16)}nr.prototype.toString=function(){var u=[],v=this.f;v&&u.push(_(v,N,!0),":");var E=this.c;return(E||"file"==v)&&(u.push("//"),(v=this.j)&&u.push(_(v,N,!0),"@"),u.push(encodeURIComponent(String(E)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(E=this.h)&&u.push(":",String(E))),(E=this.g)&&(this.c&&"/"!=E.charAt(0)&&u.push("/"),u.push(_(E,"/"==E.charAt(0)?H:V,!0))),(E=this.b.toString())&&u.push("?",E),(E=this.i)&&u.push("#",_(E,bt)),u.join("")};var N=/[#\/\?@]/g,V=/[#\?:]/g,H=/[#\?]/g,nt=/[#\?@]/g,bt=/#/g;function kt(u,v){this.b=this.a=null,this.c=u||null,this.f=!!v}function It(u){u.a||(u.a=new wr,u.b=0,u.c&&function(u,v){if(u){u=u.split("&");for(var E=0;E<u.length;E++){var L=u[E].indexOf("="),Z=null;if(0<=L){var lt=u[E].substring(0,L);Z=u[E].substring(L+1)}else lt=u[E];v(lt,Z?decodeURIComponent(Z.replace(/\+/g," ")):"")}}}(u.c,function(v,E){u.add(decodeURIComponent(v.replace(/\+/g," ")),E)}))}function Gt(u,v){It(u),v=me(u,v),br(u.a.b,v)&&(u.c=null,u.b-=u.a.get(v).length,br((u=u.a).b,v)&&(delete u.b[v],u.c--,u.a.length>2*u.c&&er(u)))}function Qt(u,v){return It(u),v=me(u,v),br(u.a.b,v)}function xe(u,v,E){Gt(u,v),0<E.length&&(u.c=null,u.a.set(me(u,v),b(E)),u.b+=E.length)}function me(u,v){return v=String(v),u.f&&(v=v.toLowerCase()),v}function Ve(u,v){this.b=u,this.a=v}function gn(u){this.g=u||rn,u=Yt.PerformanceNavigationTiming?0<(u=Yt.performance.getEntriesByType("navigation")).length&&("hq"==u[0].nextHopProtocol||"h2"==u[0].nextHopProtocol):!!(Yt.ia&&Yt.ia.ya&&Yt.ia.ya()&&Yt.ia.ya().qb),this.f=u?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(St=kt.prototype).add=function(u,v){It(this),this.c=null,u=me(this,u);var E=this.a.get(u);return E||this.a.set(u,E=[]),E.push(v),this.b+=1,this},St.forEach=function(u,v){It(this),this.a.forEach(function(E,L){At(E,function(Z){u.call(v,Z,L,this)},this)},this)},St.L=function(){It(this);for(var u=this.a.K(),v=this.a.L(),E=[],L=0;L<v.length;L++)for(var Z=u[L],lt=0;lt<Z.length;lt++)E.push(v[L]);return E},St.K=function(u){It(this);var v=[];if("string"==typeof u)Qt(this,u)&&(v=S(v,this.a.get(me(this,u))));else{u=this.a.K();for(var E=0;E<u.length;E++)v=S(v,u[E])}return v},St.set=function(u,v){return It(this),this.c=null,Qt(this,u=me(this,u))&&(this.b-=this.a.get(u).length),this.a.set(u,[v]),this.b+=1,this},St.get=function(u,v){return u&&0<(u=this.K(u)).length?String(u[0]):v},St.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var u=[],v=this.a.L(),E=0;E<v.length;E++){var L=v[E],Z=encodeURIComponent(String(L));L=this.K(L);for(var lt=0;lt<L.length;lt++){var Jt=Z;""!==L[lt]&&(Jt+="="+encodeURIComponent(String(L[lt]))),u.push(Jt)}}return this.c=u.join("&")};var rn=10;function Kn(u){return!!u.b||!!u.a&&u.a.size>=u.f}function pn(u){return u.b?1:u.a?u.a.size:0}function dn(u,v){return u.b?u.b==v:!!u.a&&u.a.has(v)}function Qn(u,v){u.a?u.a.add(v):u.b=v}function Gn(u,v){u.b&&u.b==v?u.b=null:u.a&&u.a.has(v)&&u.a.delete(v)}function Dr(u){var v,E;if(null!=u.b)return u.c.concat(u.b.s);if(null!=u.a&&0!==u.a.size){var L=u.c;try{for(var Z=D(u.a.values()),lt=Z.next();!lt.done;lt=Z.next())L=L.concat(lt.value.s)}catch(We){v={error:We}}finally{try{lt&&!lt.done&&(E=Z.return)&&E.call(Z)}finally{if(v)throw v.error}}return L}return b(u.c)}function Er(){}function Yn(){this.a=new Er}function Jr(u,v,E){var L=E||"";try{_r(u,function(Z,lt){var Jt=Z;Lt(Z)&&(Jt=at(Z)),v.push(L+lt+"="+encodeURIComponent(Jt))})}catch(Z){throw v.push(L+"type="+encodeURIComponent("_badmap")),Z}}function Gr(u,v,E,L,Z){try{v.onload=null,v.onerror=null,v.onabort=null,v.ontimeout=null,Z(L)}catch(lt){}}gn.prototype.cancel=function(){var u,v;if(this.c=Dr(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var E=D(this.a.values()),L=E.next();!L.done;L=E.next())L.value.cancel()}catch(lt){u={error:lt}}finally{try{L&&!L.done&&(v=E.return)&&v.call(E)}finally{if(u)throw u.error}}this.a.clear()}},Er.prototype.stringify=function(u){return Yt.JSON.stringify(u,void 0)},Er.prototype.parse=function(u){return Yt.JSON.parse(u,void 0)};var co=Yt.JSON.parse;function Nn(u){q.call(this),this.headers=new wr,this.H=u||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Ze,this.D=this.F=!1}Kt(Nn,q);var Ze="",Ln=/^https?$/i,Oi=["POST","PUT"];function lo(u){return"content-type"==u.toLowerCase()}function Wr(u,v){u.b=!1,u.a&&(u.g=!0,u.a.abort(),u.g=!1),u.f=v,u.h=5,Ei(u),fi(u)}function Ei(u){u.u||(u.u=!0,u.dispatchEvent("complete"),u.dispatchEvent("error"))}function Zr(u){if(u.b&&void 0!==Ne&&(!u.s[1]||4!=Cr(u)||2!=u.X()))if(u.l&&4==Cr(u))j(u.za,0,u);else if(u.dispatchEvent("readystatechange"),4==Cr(u)){u.b=!1;try{var L,v=u.X();t:switch(v){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var E=!0;break t;default:E=!1}if(!(L=E)){var Z;if(Z=0===v){var lt=String(u.B).match(Le)[1]||null;if(!lt&&Yt.self&&Yt.self.location){var Jt=Yt.self.location.protocol;lt=Jt.substr(0,Jt.length-1)}Z=!Ln.test(lt?lt.toLowerCase():"")}L=Z}if(L)u.dispatchEvent("complete"),u.dispatchEvent("success");else{u.h=6;try{var We=2<Cr(u)?u.a.statusText:""}catch(Ue){We=""}u.f=We+" ["+u.X()+"]",Ei(u)}}finally{fi(u)}}}function fi(u,v){if(u.a){Pi(u);var E=u.a,L=u.s[0]?de:null;u.a=null,u.s=null,v||u.dispatchEvent("ready");try{E.onreadystatechange=L}catch(Z){}}}function Pi(u){u.a&&u.D&&(u.a.ontimeout=null),u.m&&(Yt.clearTimeout(u.m),u.m=null)}function Cr(u){return u.a?u.a.readyState:0}function Un(u,v,E){t:{for(L in E){var L=!1;break t}L=!0}L||(E=function(u){var v="";return yt(u,function(E,L){v+=L,v+=":",v+=E,v+="\r\n"}),v}(E),"string"==typeof u?null!=E&&encodeURIComponent(String(E)):an(u,v,E))}function hi(u,v,E){return E&&E.internalChannelParams&&E.internalChannelParams[u]||v}function Ki(u){this.pa=0,this.g=[],this.c=new W,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=hi("failFast",!1,u),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=hi("baseRetryDelayMs",5e3,u),this.Ma=hi("retryDelaySeedMs",1e4,u),this.Ja=hi("forwardChannelMaxRetries",2,u),this.ma=hi("forwardChannelRequestTimeoutMs",2e4,u),this.Ka=u&&u.g||void 0,this.D=void 0,this.C=u&&u.supportsCrossDomainXhr||!1,this.J="",this.b=new gn(u&&u.concurrentRequestLimit),this.ka=new Yn,this.da=u&&u.fastHandshake||!1,this.Ga=u&&u.b||!1,u&&u.f&&(this.c.a=!1),u&&u.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&u&&u.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Di(u){if(Qi(u),3==u.v){var v=u.R++,E=zn(u.B);an(E,"SID",u.J),an(E,"RID",v),an(E,"TYPE","terminate"),Ii(u,E),(v=new Yr(u,u.c,v,void 0)).H=2,v.i=ci(zn(E)),E=!1,Yt.navigator&&Yt.navigator.sendBeacon&&(E=Yt.navigator.sendBeacon(v.i.toString(),"")),!E&&Yt.Image&&((new Image).src=v.i,E=!0),E||(v.a=ei(v.g,null),v.a.ba(v.i)),v.u=mt(),In(v)}Li(u)}function Lr(u){u.a&&(xi(u),u.a.cancel(),u.a=null)}function Qi(u){Lr(u),u.j&&(Yt.clearTimeout(u.j),u.j=null),Si(u),u.b.cancel(),u.h&&("number"==typeof u.h&&Yt.clearTimeout(u.h),u.h=null)}function ti(u,v){u.g.push(new Ve(u.La++,v)),3==u.v&&kr(u)}function kr(u){Kn(u.b)||u.h||(u.h=!0,ae(u.Ba,u),u.u=0)}function Jn(u,v){var E;E=v?v.f:u.R++;var L=zn(u.B);an(L,"SID",u.J),an(L,"RID",E),an(L,"AID",u.P),Ii(u,L),u.i&&u.l&&Un(L,u.i,u.l),E=new Yr(u,u.c,E,u.u+1),null===u.i&&(E.B=u.l),v&&(u.g=v.s.concat(u.g)),v=Yi(u,E,1e3),E.setTimeout(Math.round(.5*u.ma)+Math.round(.5*u.ma*Math.random())),Qn(u.b,E),qn(E,L,v)}function Ii(u,v){u.f&&_r({},function(E,L){an(v,L,E)})}function Yi(u,v,E){E=Math.min(u.g.length,E);var L=u.f?ct(u.f.Ha,u.f,u):null;t:for(var Z=u.g,lt=-1;;){var Jt=["count="+E];-1==lt?0<E?Jt.push("ofs="+(lt=Z[0].b)):lt=0:Jt.push("ofs="+lt);for(var We=!0,Ue=0;Ue<E;Ue++){var jn=Z[Ue].b,Ir=Z[Ue].a;if(0>(jn-=lt))lt=Math.max(0,Z[Ue].b-100),We=!1;else try{Jr(Ir,Jt,"req"+jn+"_")}catch(vr){L&&L(Ir)}}if(We){L=Jt.join("&");break t}}return u=u.g.splice(0,E),v.s=u,L}function Xi(u){u.a||u.j||(u.U=1,ae(u.Aa,u),u.o=0)}function Ti(u){return!(u.a||u.j||3<=u.o||(u.U++,u.j=mr(ct(u.Aa,u),Rr(u,u.o)),u.o++,0))}function xi(u){null!=u.s&&(Yt.clearTimeout(u.s),u.s=null)}function ho(u){u.a=new Yr(u,u.c,"rpc",u.U),null===u.i&&(u.a.B=u.l),u.a.O=0;var v=zn(u.la);an(v,"RID","rpc"),an(v,"SID",u.J),an(v,"CI",u.H?"0":"1"),an(v,"AID",u.P),Ii(u,v),an(v,"TYPE","xmlhttp"),u.i&&u.l&&Un(v,u.i,u.l),u.D&&u.a.setTimeout(u.D);var E=u.a;u=u.ga,E.H=1,E.i=ci(zn(v)),E.j=null,E.I=!0,$n(E,u)}function Si(u){null!=u.m&&(Yt.clearTimeout(u.m),u.m=null)}function $i(u,v){var E=null;if(u.a==v){Si(u),xi(u),u.a=null;var L=2}else{if(!dn(u.b,v))return;E=v.s,Gn(u.b,v),L=1}if(u.I=v.N,0!=u.v)if(v.b)if(1==L){E=v.j?v.j.length:0,v=mt()-v.u;var Z=u.u;(L=zt()).dispatchEvent(new Ur(L,E,v,Z)),kr(u)}else Xi(u);else if(3==(Z=v.h)||0==Z&&0<u.I||!(1==L&&function(u,v){return!(pn(u.b)>=u.b.f-(u.h?1:0)||(u.h?(u.g=v.s.concat(u.g),0):1==u.v||2==u.v||u.u>=(u.Ia?0:u.Ja)||(u.h=mr(ct(u.Ba,u,v),Rr(u,u.u)),u.u++,0)))}(u,v)||2==L&&Ti(u)))switch(E&&0<E.length&&(v=u.b,v.c=v.c.concat(E)),Z){case 1:Nr(u,5);break;case 4:Nr(u,10);break;case 3:Nr(u,6);break;default:Nr(u,2)}}function Rr(u,v){var E=u.Fa+Math.floor(Math.random()*u.Ma);return u.f||(E*=2),E*v}function Nr(u,v){if(u.c.info("Error code "+v),2==v){var E=null;u.f&&(E=null);var L=ct(u.Xa,u);E||(E=new nr("//www.google.com/images/cleardot.gif"),Yt.location&&"http"==Yt.location.protocol||Xr(E,"https"),ci(E)),function(u,v){var E=new W;if(Yt.Image){var L=new Image;L.onload=Ct(Gr,E,L,"TestLoadImage: loaded",!0,v),L.onerror=Ct(Gr,E,L,"TestLoadImage: error",!1,v),L.onabort=Ct(Gr,E,L,"TestLoadImage: abort",!1,v),L.ontimeout=Ct(Gr,E,L,"TestLoadImage: timeout",!1,v),Yt.setTimeout(function(){L.ontimeout&&L.ontimeout()},1e4),L.src=u}else v(!1)}(E.toString(),L)}else Re(2);u.v=0,u.f&&u.f.ra(v),Li(u),Qi(u)}function Li(u){u.v=0,u.I=-1,u.f&&((0!=Dr(u.b).length||0!=u.g.length)&&(u.b.c.length=0,b(u.g),u.g.length=0),u.f.qa())}function Ji(u,v,E){var L=function(u){return u instanceof nr?zn(u):new nr(u,void 0)}(E);if(""!=L.c)v&&Br(L,v+"."+L.c),$r(L,L.h);else{var Z=Yt.location;L=function(u,v,E,L){var Z=new nr(null,void 0);return u&&Xr(Z,u),v&&Br(Z,v),E&&$r(Z,E),L&&(Z.g=L),Z}(Z.protocol,v?v+"."+Z.hostname:Z.hostname,+Z.port,E)}return u.W&&yt(u.W,function(lt,Jt){an(L,Jt,lt)}),E=u.na,(v=u.A)&&E&&an(L,v,E),an(L,"VER",u.ha),Ii(u,L),L}function ei(u,v){if(v&&!u.C)throw Error("Can't create secondary domain capable XhrIo object.");return(v=new Nn(u.Ka)).F=u.C,v}function po(){}function ki(){if(jt&&!(10<=Number(hn)))throw Error("Environmental error: no available transport.")}function on(u,v){q.call(this),this.a=new Ki(v),this.l=u,this.b=v&&v.messageUrlParams||null,u=v&&v.messageHeaders||null,v&&v.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.a.l=u,u=v&&v.initMessageHeaders||null,v&&v.messageContentType&&(u?u["X-WebChannel-Content-Type"]=v.messageContentType:u={"X-WebChannel-Content-Type":v.messageContentType}),v&&v.a&&(u?u["X-WebChannel-Client-Profile"]=v.a:u={"X-WebChannel-Client-Profile":v.a}),this.a.O=u,(u=v&&v.httpHeadersOverwriteParam)&&!A(u)&&(this.a.i=u),this.h=v&&v.supportsCrossDomainXhr||!1,this.g=v&&v.sendRawJson||!1,(v=v&&v.httpSessionIdParam)&&!A(v)&&(this.a.A=v,null!==(u=this.b)&&v in u&&v in(u=this.b)&&delete u[v]),this.f=new un(this)}function Mi(u){Sr.call(this);var v=u.__sm__;if(v){t:{for(var E in v){u=E;break t}u=void 0}(this.c=u)?(u=this.c,this.data=null!==v&&u in v?v[u]:void 0):this.data=v}else this.data=u}function Wt(){Pr.call(this),this.status=1}function un(u){this.a=u}(St=Nn.prototype).ba=function(u,v,E,L){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+u);v=v?v.toUpperCase():"GET",this.B=u,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=function(u){var v;return(v=u.a)||(v=u.a={}),v}(this.H?this.H:Qr),this.a.onreadystatechange=ct(this.za,this);try{this.A=!0,this.a.open(v,String(u),!0),this.A=!1}catch(lt){return void Wr(this,lt)}u=E||"";var Z=new wr(this.headers);L&&_r(L,function(lt,Jt){Z.set(Jt,lt)}),L=function(u){t:{for(var v=lo,E=u.length,L="string"==typeof u?u.split(""):u,Z=0;Z<E;Z++)if(Z in L&&v.call(void 0,L[Z],Z,u)){v=Z;break t}v=-1}return 0>v?null:"string"==typeof u?u.charAt(v):u[v]}(Z.L()),E=Yt.FormData&&u instanceof Yt.FormData,!(0<=xt(Oi,v))||L||E||Z.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),Z.forEach(function(lt,Jt){this.a.setRequestHeader(Jt,lt)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Pi(this),0<this.o&&((this.D=function(u){return jt&&en(9)&&"number"==typeof u.timeout&&void 0!==u.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=ct(this.xa,this)):this.m=j(this.xa,this.o,this)),this.l=!0,this.a.send(u),this.l=!1}catch(lt){Wr(this,lt)}},St.xa=function(){void 0!==Ne&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},St.abort=function(u){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=u||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),fi(this))},St.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),fi(this,!0)),Nn.S.G.call(this)},St.za=function(){this.j||(this.A||this.l||this.g?Zr(this):this.Ta())},St.Ta=function(){Zr(this)},St.X=function(){try{return 2<Cr(this)?this.a.status:-1}catch(u){return-1}},St.$=function(){try{return this.a?this.a.responseText:""}catch(u){return""}},St.Na=function(u){if(this.a){var v=this.a.responseText;return u&&0==v.indexOf(u)&&(v=v.substring(u.length)),co(v)}},St.ua=function(){return this.h},St.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(St=Ki.prototype).ha=8,St.v=1,St.Ba=function(u){if(this.h)if(this.h=null,1==this.v){if(!u){this.R=Math.floor(1e5*Math.random()),u=this.R++;var L,v=new Yr(this,this.c,u,void 0),E=this.l;if(this.O&&(E?ft(E=pe(E),this.O):E=this.O),null===this.i&&(v.B=E),this.da)t:{for(var Z=L=0;Z<this.g.length;Z++){var lt=this.g[Z];if(void 0===(lt="__data__"in lt.a&&"string"==typeof(lt=lt.a.__data__)?lt.length:void 0))break;if(4096<(L+=lt)){L=Z;break t}if(4096===L||Z===this.g.length-1){L=Z+1;break t}}L=1e3}else L=1e3;L=Yi(this,v,L),an(Z=zn(this.B),"RID",u),an(Z,"CVER",22),this.A&&an(Z,"X-HTTP-Session-Id",this.A),Ii(this,Z),this.i&&E&&Un(Z,this.i,E),Qn(this.b,v),this.Ga&&an(Z,"TYPE","init"),this.da?(an(Z,"$req",L),an(Z,"SID","null"),v.V=!0,qn(v,Z,null)):qn(v,Z,L),this.v=2}}else 3==this.v&&(u?Jn(this,u):0==this.g.length||Kn(this.b)||Jn(this))},St.Aa=function(){if(this.j=null,ho(this),this.V&&!(this.F||null==this.a||0>=this.N)){var u=2*this.N;this.c.info("BP detection timer enabled: "+u),this.s=mr(ct(this.Sa,this),u)}},St.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Lr(this),ho(this))},St.Ra=function(){null!=this.m&&(this.m=null,Lr(this),Ti(this),Re(19))},St.Xa=function(u){u?(this.c.info("Successfully pinged google.com"),Re(2)):(this.c.info("Failed to ping google.com"),Re(1))},(St=po.prototype).ta=function(){},St.sa=function(){},St.ra=function(){},St.qa=function(){},St.Ha=function(){},ki.prototype.a=function(u,v){return new on(u,v)},Kt(on,q),(St=on.prototype).addEventListener=function(u,v,E,L){on.S.addEventListener.call(this,u,v,E,L)},St.removeEventListener=function(u,v,E,L){on.S.removeEventListener.call(this,u,v,E,L)},St.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var u=this.a,v=this.l,E=this.b||void 0;Re(0),u.fa=v,u.W=E||{},u.H=u.T,u.B=Ji(u,null,u.fa),kr(u)},St.close=function(){Di(this.a)},St.Pa=function(u){if("string"==typeof u){var v={};v.__data__=u,ti(this.a,v)}else this.g?((v={}).__data__=at(u),ti(this.a,v)):ti(this.a,u)},St.G=function(){this.a.f=null,delete this.f,Di(this.a),delete this.a,on.S.G.call(this)},Kt(Mi,Sr),Kt(Wt,Pr),Kt(un,po),un.prototype.ta=function(){this.a.dispatchEvent("a")},un.prototype.sa=function(u){this.a.dispatchEvent(new Mi(u))},un.prototype.ra=function(u){this.a.dispatchEvent(new Wt(u))},un.prototype.qa=function(){this.a.dispatchEvent("b")},ki.prototype.createWebChannel=ki.prototype.a,on.prototype.send=on.prototype.Pa,on.prototype.open=on.prototype.Oa,on.prototype.close=on.prototype.close,Tr.NO_ERROR=0,Tr.TIMEOUT=8,Tr.HTTP_ERROR=6,hr.COMPLETE="complete",_i.EventType=pr,pr.OPEN="a",pr.CLOSE="b",pr.ERROR="c",pr.MESSAGE="d",q.prototype.listen=q.prototype.va,Nn.prototype.listenOnce=Nn.prototype.wa,Nn.prototype.getLastError=Nn.prototype.Qa,Nn.prototype.getLastErrorCode=Nn.prototype.ua,Nn.prototype.getStatus=Nn.prototype.X,Nn.prototype.getResponseJson=Nn.prototype.Na,Nn.prototype.getResponseText=Nn.prototype.$,Nn.prototype.send=Nn.prototype.ba;var Zi=function(){return new ki},pi=Tr,Hr=hr,dr=_i,to=Nn;const Rn={createWebChannelTransport:Zi,ErrorCode:Tr,EventType:hr,WebChannel:_i,XhrIo:Nn}},7117:(Xn,be,Bt)=>{"use strict";var B=Bt(6279);function Dt(de){return de&&"object"==typeof de&&"default"in de?de:{default:de}}Bt(6003),Bt(4614),Bt(5910),Bt(9800),Bt(7450),Bt(6035),Bt(5062),Bt(8051),Bt(2136);var D=Dt(B);D.default.registerVersion("firebase","7.24.0","app"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the module builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nCommonJS Modules:\nconst firebase = require('firebase/app');\nrequire('firebase/<PACKAGE>');\n\nES Modules:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n\nTypescript:\nimport * as firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n"),D.default.registerVersion("firebase","7.24.0"),Xn.exports=D.default},6676:function(Xn,be){!function(Bt){"use strict";function B(ct){return Array.prototype.slice.call(ct)}function Dt(ct){return new Promise(function(Ct,mt){ct.onsuccess=function(){Ct(ct.result)},ct.onerror=function(){mt(ct.error)}})}function D(ct,Ct,mt){var Kt,ne=new Promise(function(qt,xt){Dt(Kt=ct[Ct].apply(ct,mt)).then(qt,xt)});return ne.request=Kt,ne}function Te(ct,Ct,mt){var Kt=D(ct,Ct,mt);return Kt.then(function(ne){if(ne)return new ut(ne,Kt.request)})}function St(ct,Ct,mt){mt.forEach(function(Kt){Object.defineProperty(ct.prototype,Kt,{get:function(){return this[Ct][Kt]},set:function(ne){this[Ct][Kt]=ne}})})}function Ne(ct,Ct,mt,Kt){Kt.forEach(function(ne){ne in mt.prototype&&(ct.prototype[ne]=function(){return D(this[Ct],ne,arguments)})})}function Yt(ct,Ct,mt,Kt){Kt.forEach(function(ne){ne in mt.prototype&&(ct.prototype[ne]=function(){return this[Ct][ne].apply(this[Ct],arguments)})})}function de(ct,Ct,mt,Kt){Kt.forEach(function(ne){ne in mt.prototype&&(ct.prototype[ne]=function(){return Te(this[Ct],ne,arguments)})})}function J(ct){this._index=ct}function ut(ct,Ct){this._cursor=ct,this._request=Ct}function Lt(ct){this._store=ct}function ee(ct){this._tx=ct,this.complete=new Promise(function(Ct,mt){ct.oncomplete=function(){Ct()},ct.onerror=function(){mt(ct.error)},ct.onabort=function(){mt(ct.error)}})}function Tt(ct,Ct,mt){this._db=ct,this.oldVersion=Ct,this.transaction=new ee(mt)}function ge(ct){this._db=ct}St(J,"_index",["name","keyPath","multiEntry","unique"]),Ne(J,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),de(J,"_index",IDBIndex,["openCursor","openKeyCursor"]),St(ut,"_cursor",["direction","key","primaryKey","value"]),Ne(ut,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(ct){ct in IDBCursor.prototype&&(ut.prototype[ct]=function(){var Ct=this,mt=arguments;return Promise.resolve().then(function(){return Ct._cursor[ct].apply(Ct._cursor,mt),Dt(Ct._request).then(function(Kt){if(Kt)return new ut(Kt,Ct._request)})})})}),Lt.prototype.createIndex=function(){return new J(this._store.createIndex.apply(this._store,arguments))},Lt.prototype.index=function(){return new J(this._store.index.apply(this._store,arguments))},St(Lt,"_store",["name","keyPath","indexNames","autoIncrement"]),Ne(Lt,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),de(Lt,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),Yt(Lt,"_store",IDBObjectStore,["deleteIndex"]),ee.prototype.objectStore=function(){return new Lt(this._tx.objectStore.apply(this._tx,arguments))},St(ee,"_tx",["objectStoreNames","mode"]),Yt(ee,"_tx",IDBTransaction,["abort"]),Tt.prototype.createObjectStore=function(){return new Lt(this._db.createObjectStore.apply(this._db,arguments))},St(Tt,"_db",["name","version","objectStoreNames"]),Yt(Tt,"_db",IDBDatabase,["deleteObjectStore","close"]),ge.prototype.transaction=function(){return new ee(this._db.transaction.apply(this._db,arguments))},St(ge,"_db",["name","version","objectStoreNames"]),Yt(ge,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(ct){[Lt,J].forEach(function(Ct){ct in Ct.prototype&&(Ct.prototype[ct.replace("open","iterate")]=function(){var mt=B(arguments),Kt=mt[mt.length-1],ne=this._store||this._index,qt=ne[ct].apply(ne,mt.slice(0,-1));qt.onsuccess=function(){Kt(qt.result)}})})}),[J,Lt].forEach(function(ct){ct.prototype.getAll||(ct.prototype.getAll=function(Ct,mt){var Kt=this,ne=[];return new Promise(function(qt){Kt.iterateCursor(Ct,function(xt){xt?(ne.push(xt.value),void 0===mt||ne.length!=mt?xt.continue():qt(ne)):qt(ne)})})})}),Bt.openDb=function(ct,Ct,mt){var Kt=D(indexedDB,"open",[ct,Ct]),ne=Kt.request;return ne&&(ne.onupgradeneeded=function(qt){mt&&mt(new Tt(ne.result,qt.oldVersion,ne.transaction))}),Kt.then(function(qt){return new ge(qt)})},Bt.deleteDb=function(ct){return D(indexedDB,"deleteDatabase",[ct])},Object.defineProperty(Bt,"__esModule",{value:!0})}(be)},1228:(Xn,be,Bt)=>{"use strict";Bt.d(be,{e:()=>St});var B=Bt(7117),D=Bt(7716),Te=Bt(4126);let St=(()=>{class Ne{constructor(de){this.auth=de,de.authState.subscribe(J=>{this.userinfo=J,console.log(J)})}login(de,J){return this.auth.auth.signInWithEmailAndPassword(de,J)}registrar(de,J){return this.auth.auth.createUserWithEmailAndPassword(de,J)}logOut(){return this.auth.auth.signOut()}verificarEmail(){this.auth.auth.currentUser&&this.auth.auth.currentUser.sendEmailVerification()}googleAuth(){this.auth.auth.signInWithPopup(new B.auth.GoogleAuthProvider)}enviarcodigoTel(de,J){return this.auth.auth.signInWithPhoneNumber(de,J).then(ut=>{})}}return Ne.\u0275fac=function(de){return new(de||Ne)(D.LFG(Te.z))},Ne.\u0275prov=D.Yz7({token:Ne,factory:Ne.\u0275fac,providedIn:"root"}),Ne})()},209:(Xn,be,Bt)=>{"use strict";Bt.r(be),Bt.d(be,{__extends:()=>Dt,__assign:()=>D,__rest:()=>Te,__decorate:()=>St,__param:()=>Ne,__metadata:()=>Yt,__awaiter:()=>de,__generator:()=>J,__createBinding:()=>ut,__exportStar:()=>Lt,__values:()=>ee,__read:()=>Tt,__spread:()=>ge,__spreadArrays:()=>Xe,__await:()=>ve,__asyncGenerator:()=>ct,__asyncDelegator:()=>Ct,__asyncValues:()=>mt,__makeTemplateObject:()=>Kt,__importStar:()=>ne,__importDefault:()=>qt,__classPrivateFieldGet:()=>xt,__classPrivateFieldSet:()=>At});var B=function(m,S){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,A){b.__proto__=A}||function(b,A){for(var x in A)A.hasOwnProperty(x)&&(b[x]=A[x])})(m,S)};function Dt(m,S){function b(){this.constructor=m}B(m,S),m.prototype=null===S?Object.create(S):(b.prototype=S.prototype,new b)}var D=function(){return(D=Object.assign||function(S){for(var b,A=1,x=arguments.length;A<x;A++)for(var T in b=arguments[A])Object.prototype.hasOwnProperty.call(b,T)&&(S[T]=b[T]);return S}).apply(this,arguments)};function Te(m,S){var b={};for(var A in m)Object.prototype.hasOwnProperty.call(m,A)&&S.indexOf(A)<0&&(b[A]=m[A]);if(null!=m&&"function"==typeof Object.getOwnPropertySymbols){var x=0;for(A=Object.getOwnPropertySymbols(m);x<A.length;x++)S.indexOf(A[x])<0&&Object.prototype.propertyIsEnumerable.call(m,A[x])&&(b[A[x]]=m[A[x]])}return b}function St(m,S,b,A){var z,x=arguments.length,T=x<3?S:null===A?A=Object.getOwnPropertyDescriptor(S,b):A;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)T=Reflect.decorate(m,S,b,A);else for(var Y=m.length-1;Y>=0;Y--)(z=m[Y])&&(T=(x<3?z(T):x>3?z(S,b,T):z(S,b))||T);return x>3&&T&&Object.defineProperty(S,b,T),T}function Ne(m,S){return function(b,A){S(b,A,m)}}function Yt(m,S){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(m,S)}function de(m,S,b,A){return new(b||(b=Promise))(function(T,z){function Y(yt){try{tt(A.next(yt))}catch(pe){z(pe)}}function Xt(yt){try{tt(A.throw(yt))}catch(pe){z(pe)}}function tt(yt){yt.done?T(yt.value):function(T){return T instanceof b?T:new b(function(z){z(T)})}(yt.value).then(Y,Xt)}tt((A=A.apply(m,S||[])).next())})}function J(m,S){var A,x,T,z,b={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]};return z={next:Y(0),throw:Y(1),return:Y(2)},"function"==typeof Symbol&&(z[Symbol.iterator]=function(){return this}),z;function Y(tt){return function(yt){return function(tt){if(A)throw new TypeError("Generator is already executing.");for(;b;)try{if(A=1,x&&(T=2&tt[0]?x.return:tt[0]?x.throw||((T=x.return)&&T.call(x),0):x.next)&&!(T=T.call(x,tt[1])).done)return T;switch(x=0,T&&(tt=[2&tt[0],T.value]),tt[0]){case 0:case 1:T=tt;break;case 4:return b.label++,{value:tt[1],done:!1};case 5:b.label++,x=tt[1],tt=[0];continue;case 7:tt=b.ops.pop(),b.trys.pop();continue;default:if(!(T=(T=b.trys).length>0&&T[T.length-1])&&(6===tt[0]||2===tt[0])){b=0;continue}if(3===tt[0]&&(!T||tt[1]>T[0]&&tt[1]<T[3])){b.label=tt[1];break}if(6===tt[0]&&b.label<T[1]){b.label=T[1],T=tt;break}if(T&&b.label<T[2]){b.label=T[2],b.ops.push(tt);break}T[2]&&b.ops.pop(),b.trys.pop();continue}tt=S.call(m,b)}catch(yt){tt=[6,yt],x=0}finally{A=T=0}if(5&tt[0])throw tt[1];return{value:tt[0]?tt[1]:void 0,done:!0}}([tt,yt])}}}function ut(m,S,b,A){void 0===A&&(A=b),m[A]=S[b]}function Lt(m,S){for(var b in m)"default"!==b&&!S.hasOwnProperty(b)&&(S[b]=m[b])}function ee(m){var S="function"==typeof Symbol&&Symbol.iterator,b=S&&m[S],A=0;if(b)return b.call(m);if(m&&"number"==typeof m.length)return{next:function(){return m&&A>=m.length&&(m=void 0),{value:m&&m[A++],done:!m}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}function Tt(m,S){var b="function"==typeof Symbol&&m[Symbol.iterator];if(!b)return m;var x,z,A=b.call(m),T=[];try{for(;(void 0===S||S-- >0)&&!(x=A.next()).done;)T.push(x.value)}catch(Y){z={error:Y}}finally{try{x&&!x.done&&(b=A.return)&&b.call(A)}finally{if(z)throw z.error}}return T}function ge(){for(var m=[],S=0;S<arguments.length;S++)m=m.concat(Tt(arguments[S]));return m}function Xe(){for(var m=0,S=0,b=arguments.length;S<b;S++)m+=arguments[S].length;var A=Array(m),x=0;for(S=0;S<b;S++)for(var T=arguments[S],z=0,Y=T.length;z<Y;z++,x++)A[x]=T[z];return A}function ve(m){return this instanceof ve?(this.v=m,this):new ve(m)}function ct(m,S,b){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var x,A=b.apply(m,S||[]),T=[];return x={},z("next"),z("throw"),z("return"),x[Symbol.asyncIterator]=function(){return this},x;function z(Ot){A[Ot]&&(x[Ot]=function(ft){return new Promise(function(ht,Nt){T.push([Ot,ft,ht,Nt])>1||Y(Ot,ft)})})}function Y(Ot,ft){try{!function(Ot){Ot.value instanceof ve?Promise.resolve(Ot.value.v).then(tt,yt):pe(T[0][2],Ot)}(A[Ot](ft))}catch(ht){pe(T[0][3],ht)}}function tt(Ot){Y("next",Ot)}function yt(Ot){Y("throw",Ot)}function pe(Ot,ft){Ot(ft),T.shift(),T.length&&Y(T[0][0],T[0][1])}}function Ct(m){var S,b;return S={},A("next"),A("throw",function(x){throw x}),A("return"),S[Symbol.iterator]=function(){return this},S;function A(x,T){S[x]=m[x]?function(z){return(b=!b)?{value:ve(m[x](z)),done:"return"===x}:T?T(z):z}:T}}function mt(m){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b,S=m[Symbol.asyncIterator];return S?S.call(m):(m=ee(m),b={},A("next"),A("throw"),A("return"),b[Symbol.asyncIterator]=function(){return this},b);function A(T){b[T]=m[T]&&function(z){return new Promise(function(Y,Xt){!function(T,z,Y,Xt){Promise.resolve(Xt).then(function(tt){T({value:tt,done:Y})},z)}(Y,Xt,(z=m[T](z)).done,z.value)})}}}function Kt(m,S){return Object.defineProperty?Object.defineProperty(m,"raw",{value:S}):m.raw=S,m}function ne(m){if(m&&m.__esModule)return m;var S={};if(null!=m)for(var b in m)Object.hasOwnProperty.call(m,b)&&(S[b]=m[b]);return S.default=m,S}function qt(m){return m&&m.__esModule?m:{default:m}}function xt(m,S){if(!S.has(m))throw new TypeError("attempted to get private field on non-instance");return S.get(m)}function At(m,S,b){if(!S.has(m))throw new TypeError("attempted to set private field on non-instance");return S.set(m,b),b}},5704:(Xn,be,Bt)=>{"use strict";Bt.r(be),Bt.d(be,{__extends:()=>Dt,__assign:()=>D,__rest:()=>Te,__decorate:()=>St,__param:()=>Ne,__metadata:()=>Yt,__awaiter:()=>de,__generator:()=>J,__createBinding:()=>ut,__exportStar:()=>Lt,__values:()=>ee,__read:()=>Tt,__spread:()=>ge,__spreadArrays:()=>Xe,__await:()=>ve,__asyncGenerator:()=>ct,__asyncDelegator:()=>Ct,__asyncValues:()=>mt,__makeTemplateObject:()=>Kt,__importStar:()=>ne,__importDefault:()=>qt,__classPrivateFieldGet:()=>xt,__classPrivateFieldSet:()=>At});var B=function(m,S){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,A){b.__proto__=A}||function(b,A){for(var x in A)A.hasOwnProperty(x)&&(b[x]=A[x])})(m,S)};function Dt(m,S){function b(){this.constructor=m}B(m,S),m.prototype=null===S?Object.create(S):(b.prototype=S.prototype,new b)}var D=function(){return(D=Object.assign||function(S){for(var b,A=1,x=arguments.length;A<x;A++)for(var T in b=arguments[A])Object.prototype.hasOwnProperty.call(b,T)&&(S[T]=b[T]);return S}).apply(this,arguments)};function Te(m,S){var b={};for(var A in m)Object.prototype.hasOwnProperty.call(m,A)&&S.indexOf(A)<0&&(b[A]=m[A]);if(null!=m&&"function"==typeof Object.getOwnPropertySymbols){var x=0;for(A=Object.getOwnPropertySymbols(m);x<A.length;x++)S.indexOf(A[x])<0&&Object.prototype.propertyIsEnumerable.call(m,A[x])&&(b[A[x]]=m[A[x]])}return b}function St(m,S,b,A){var z,x=arguments.length,T=x<3?S:null===A?A=Object.getOwnPropertyDescriptor(S,b):A;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)T=Reflect.decorate(m,S,b,A);else for(var Y=m.length-1;Y>=0;Y--)(z=m[Y])&&(T=(x<3?z(T):x>3?z(S,b,T):z(S,b))||T);return x>3&&T&&Object.defineProperty(S,b,T),T}function Ne(m,S){return function(b,A){S(b,A,m)}}function Yt(m,S){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(m,S)}function de(m,S,b,A){return new(b||(b=Promise))(function(T,z){function Y(yt){try{tt(A.next(yt))}catch(pe){z(pe)}}function Xt(yt){try{tt(A.throw(yt))}catch(pe){z(pe)}}function tt(yt){yt.done?T(yt.value):function(T){return T instanceof b?T:new b(function(z){z(T)})}(yt.value).then(Y,Xt)}tt((A=A.apply(m,S||[])).next())})}function J(m,S){var A,x,T,z,b={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]};return z={next:Y(0),throw:Y(1),return:Y(2)},"function"==typeof Symbol&&(z[Symbol.iterator]=function(){return this}),z;function Y(tt){return function(yt){return function(tt){if(A)throw new TypeError("Generator is already executing.");for(;b;)try{if(A=1,x&&(T=2&tt[0]?x.return:tt[0]?x.throw||((T=x.return)&&T.call(x),0):x.next)&&!(T=T.call(x,tt[1])).done)return T;switch(x=0,T&&(tt=[2&tt[0],T.value]),tt[0]){case 0:case 1:T=tt;break;case 4:return b.label++,{value:tt[1],done:!1};case 5:b.label++,x=tt[1],tt=[0];continue;case 7:tt=b.ops.pop(),b.trys.pop();continue;default:if(!(T=(T=b.trys).length>0&&T[T.length-1])&&(6===tt[0]||2===tt[0])){b=0;continue}if(3===tt[0]&&(!T||tt[1]>T[0]&&tt[1]<T[3])){b.label=tt[1];break}if(6===tt[0]&&b.label<T[1]){b.label=T[1],T=tt;break}if(T&&b.label<T[2]){b.label=T[2],b.ops.push(tt);break}T[2]&&b.ops.pop(),b.trys.pop();continue}tt=S.call(m,b)}catch(yt){tt=[6,yt],x=0}finally{A=T=0}if(5&tt[0])throw tt[1];return{value:tt[0]?tt[1]:void 0,done:!0}}([tt,yt])}}}function ut(m,S,b,A){void 0===A&&(A=b),m[A]=S[b]}function Lt(m,S){for(var b in m)"default"!==b&&!S.hasOwnProperty(b)&&(S[b]=m[b])}function ee(m){var S="function"==typeof Symbol&&Symbol.iterator,b=S&&m[S],A=0;if(b)return b.call(m);if(m&&"number"==typeof m.length)return{next:function(){return m&&A>=m.length&&(m=void 0),{value:m&&m[A++],done:!m}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}function Tt(m,S){var b="function"==typeof Symbol&&m[Symbol.iterator];if(!b)return m;var x,z,A=b.call(m),T=[];try{for(;(void 0===S||S-- >0)&&!(x=A.next()).done;)T.push(x.value)}catch(Y){z={error:Y}}finally{try{x&&!x.done&&(b=A.return)&&b.call(A)}finally{if(z)throw z.error}}return T}function ge(){for(var m=[],S=0;S<arguments.length;S++)m=m.concat(Tt(arguments[S]));return m}function Xe(){for(var m=0,S=0,b=arguments.length;S<b;S++)m+=arguments[S].length;var A=Array(m),x=0;for(S=0;S<b;S++)for(var T=arguments[S],z=0,Y=T.length;z<Y;z++,x++)A[x]=T[z];return A}function ve(m){return this instanceof ve?(this.v=m,this):new ve(m)}function ct(m,S,b){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var x,A=b.apply(m,S||[]),T=[];return x={},z("next"),z("throw"),z("return"),x[Symbol.asyncIterator]=function(){return this},x;function z(Ot){A[Ot]&&(x[Ot]=function(ft){return new Promise(function(ht,Nt){T.push([Ot,ft,ht,Nt])>1||Y(Ot,ft)})})}function Y(Ot,ft){try{!function(Ot){Ot.value instanceof ve?Promise.resolve(Ot.value.v).then(tt,yt):pe(T[0][2],Ot)}(A[Ot](ft))}catch(ht){pe(T[0][3],ht)}}function tt(Ot){Y("next",Ot)}function yt(Ot){Y("throw",Ot)}function pe(Ot,ft){Ot(ft),T.shift(),T.length&&Y(T[0][0],T[0][1])}}function Ct(m){var S,b;return S={},A("next"),A("throw",function(x){throw x}),A("return"),S[Symbol.iterator]=function(){return this},S;function A(x,T){S[x]=m[x]?function(z){return(b=!b)?{value:ve(m[x](z)),done:"return"===x}:T?T(z):z}:T}}function mt(m){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b,S=m[Symbol.asyncIterator];return S?S.call(m):(m=ee(m),b={},A("next"),A("throw"),A("return"),b[Symbol.asyncIterator]=function(){return this},b);function A(T){b[T]=m[T]&&function(z){return new Promise(function(Y,Xt){!function(T,z,Y,Xt){Promise.resolve(Xt).then(function(tt){T({value:tt,done:Y})},z)}(Y,Xt,(z=m[T](z)).done,z.value)})}}}function Kt(m,S){return Object.defineProperty?Object.defineProperty(m,"raw",{value:S}):m.raw=S,m}function ne(m){if(m&&m.__esModule)return m;var S={};if(null!=m)for(var b in m)Object.hasOwnProperty.call(m,b)&&(S[b]=m[b]);return S.default=m,S}function qt(m){return m&&m.__esModule?m:{default:m}}function xt(m,S){if(!S.has(m))throw new TypeError("attempted to get private field on non-instance");return S.get(m)}function At(m,S,b){if(!S.has(m))throw new TypeError("attempted to set private field on non-instance");return S.set(m,b),b}},2483:(Xn,be,Bt)=>{"use strict";Bt.r(be),Bt.d(be,{__extends:()=>Dt,__assign:()=>D,__rest:()=>Te,__decorate:()=>St,__param:()=>Ne,__metadata:()=>Yt,__awaiter:()=>de,__generator:()=>J,__createBinding:()=>ut,__exportStar:()=>Lt,__values:()=>ee,__read:()=>Tt,__spread:()=>ge,__spreadArrays:()=>Xe,__await:()=>ve,__asyncGenerator:()=>ct,__asyncDelegator:()=>Ct,__asyncValues:()=>mt,__makeTemplateObject:()=>Kt,__importStar:()=>ne,__importDefault:()=>qt,__classPrivateFieldGet:()=>xt,__classPrivateFieldSet:()=>At});var B=function(m,S){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,A){b.__proto__=A}||function(b,A){for(var x in A)A.hasOwnProperty(x)&&(b[x]=A[x])})(m,S)};function Dt(m,S){function b(){this.constructor=m}B(m,S),m.prototype=null===S?Object.create(S):(b.prototype=S.prototype,new b)}var D=function(){return(D=Object.assign||function(S){for(var b,A=1,x=arguments.length;A<x;A++)for(var T in b=arguments[A])Object.prototype.hasOwnProperty.call(b,T)&&(S[T]=b[T]);return S}).apply(this,arguments)};function Te(m,S){var b={};for(var A in m)Object.prototype.hasOwnProperty.call(m,A)&&S.indexOf(A)<0&&(b[A]=m[A]);if(null!=m&&"function"==typeof Object.getOwnPropertySymbols){var x=0;for(A=Object.getOwnPropertySymbols(m);x<A.length;x++)S.indexOf(A[x])<0&&Object.prototype.propertyIsEnumerable.call(m,A[x])&&(b[A[x]]=m[A[x]])}return b}function St(m,S,b,A){var z,x=arguments.length,T=x<3?S:null===A?A=Object.getOwnPropertyDescriptor(S,b):A;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)T=Reflect.decorate(m,S,b,A);else for(var Y=m.length-1;Y>=0;Y--)(z=m[Y])&&(T=(x<3?z(T):x>3?z(S,b,T):z(S,b))||T);return x>3&&T&&Object.defineProperty(S,b,T),T}function Ne(m,S){return function(b,A){S(b,A,m)}}function Yt(m,S){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(m,S)}function de(m,S,b,A){return new(b||(b=Promise))(function(T,z){function Y(yt){try{tt(A.next(yt))}catch(pe){z(pe)}}function Xt(yt){try{tt(A.throw(yt))}catch(pe){z(pe)}}function tt(yt){yt.done?T(yt.value):function(T){return T instanceof b?T:new b(function(z){z(T)})}(yt.value).then(Y,Xt)}tt((A=A.apply(m,S||[])).next())})}function J(m,S){var A,x,T,z,b={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]};return z={next:Y(0),throw:Y(1),return:Y(2)},"function"==typeof Symbol&&(z[Symbol.iterator]=function(){return this}),z;function Y(tt){return function(yt){return function(tt){if(A)throw new TypeError("Generator is already executing.");for(;b;)try{if(A=1,x&&(T=2&tt[0]?x.return:tt[0]?x.throw||((T=x.return)&&T.call(x),0):x.next)&&!(T=T.call(x,tt[1])).done)return T;switch(x=0,T&&(tt=[2&tt[0],T.value]),tt[0]){case 0:case 1:T=tt;break;case 4:return b.label++,{value:tt[1],done:!1};case 5:b.label++,x=tt[1],tt=[0];continue;case 7:tt=b.ops.pop(),b.trys.pop();continue;default:if(!(T=(T=b.trys).length>0&&T[T.length-1])&&(6===tt[0]||2===tt[0])){b=0;continue}if(3===tt[0]&&(!T||tt[1]>T[0]&&tt[1]<T[3])){b.label=tt[1];break}if(6===tt[0]&&b.label<T[1]){b.label=T[1],T=tt;break}if(T&&b.label<T[2]){b.label=T[2],b.ops.push(tt);break}T[2]&&b.ops.pop(),b.trys.pop();continue}tt=S.call(m,b)}catch(yt){tt=[6,yt],x=0}finally{A=T=0}if(5&tt[0])throw tt[1];return{value:tt[0]?tt[1]:void 0,done:!0}}([tt,yt])}}}function ut(m,S,b,A){void 0===A&&(A=b),m[A]=S[b]}function Lt(m,S){for(var b in m)"default"!==b&&!S.hasOwnProperty(b)&&(S[b]=m[b])}function ee(m){var S="function"==typeof Symbol&&Symbol.iterator,b=S&&m[S],A=0;if(b)return b.call(m);if(m&&"number"==typeof m.length)return{next:function(){return m&&A>=m.length&&(m=void 0),{value:m&&m[A++],done:!m}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}function Tt(m,S){var b="function"==typeof Symbol&&m[Symbol.iterator];if(!b)return m;var x,z,A=b.call(m),T=[];try{for(;(void 0===S||S-- >0)&&!(x=A.next()).done;)T.push(x.value)}catch(Y){z={error:Y}}finally{try{x&&!x.done&&(b=A.return)&&b.call(A)}finally{if(z)throw z.error}}return T}function ge(){for(var m=[],S=0;S<arguments.length;S++)m=m.concat(Tt(arguments[S]));return m}function Xe(){for(var m=0,S=0,b=arguments.length;S<b;S++)m+=arguments[S].length;var A=Array(m),x=0;for(S=0;S<b;S++)for(var T=arguments[S],z=0,Y=T.length;z<Y;z++,x++)A[x]=T[z];return A}function ve(m){return this instanceof ve?(this.v=m,this):new ve(m)}function ct(m,S,b){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var x,A=b.apply(m,S||[]),T=[];return x={},z("next"),z("throw"),z("return"),x[Symbol.asyncIterator]=function(){return this},x;function z(Ot){A[Ot]&&(x[Ot]=function(ft){return new Promise(function(ht,Nt){T.push([Ot,ft,ht,Nt])>1||Y(Ot,ft)})})}function Y(Ot,ft){try{!function(Ot){Ot.value instanceof ve?Promise.resolve(Ot.value.v).then(tt,yt):pe(T[0][2],Ot)}(A[Ot](ft))}catch(ht){pe(T[0][3],ht)}}function tt(Ot){Y("next",Ot)}function yt(Ot){Y("throw",Ot)}function pe(Ot,ft){Ot(ft),T.shift(),T.length&&Y(T[0][0],T[0][1])}}function Ct(m){var S,b;return S={},A("next"),A("throw",function(x){throw x}),A("return"),S[Symbol.iterator]=function(){return this},S;function A(x,T){S[x]=m[x]?function(z){return(b=!b)?{value:ve(m[x](z)),done:"return"===x}:T?T(z):z}:T}}function mt(m){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b,S=m[Symbol.asyncIterator];return S?S.call(m):(m=ee(m),b={},A("next"),A("throw"),A("return"),b[Symbol.asyncIterator]=function(){return this},b);function A(T){b[T]=m[T]&&function(z){return new Promise(function(Y,Xt){!function(T,z,Y,Xt){Promise.resolve(Xt).then(function(tt){T({value:tt,done:Y})},z)}(Y,Xt,(z=m[T](z)).done,z.value)})}}}function Kt(m,S){return Object.defineProperty?Object.defineProperty(m,"raw",{value:S}):m.raw=S,m}function ne(m){if(m&&m.__esModule)return m;var S={};if(null!=m)for(var b in m)Object.hasOwnProperty.call(m,b)&&(S[b]=m[b]);return S.default=m,S}function qt(m){return m&&m.__esModule?m:{default:m}}function xt(m,S){if(!S.has(m))throw new TypeError("attempted to get private field on non-instance");return S.get(m)}function At(m,S,b){if(!S.has(m))throw new TypeError("attempted to set private field on non-instance");return S.set(m,b),b}},9009:(Xn,be,Bt)=>{"use strict";Bt.r(be),Bt.d(be,{__extends:()=>Dt,__assign:()=>D,__rest:()=>Te,__decorate:()=>St,__param:()=>Ne,__metadata:()=>Yt,__awaiter:()=>de,__generator:()=>J,__createBinding:()=>ut,__exportStar:()=>Lt,__values:()=>ee,__read:()=>Tt,__spread:()=>ge,__spreadArrays:()=>Xe,__await:()=>ve,__asyncGenerator:()=>ct,__asyncDelegator:()=>Ct,__asyncValues:()=>mt,__makeTemplateObject:()=>Kt,__importStar:()=>ne,__importDefault:()=>qt,__classPrivateFieldGet:()=>xt,__classPrivateFieldSet:()=>At});var B=function(m,S){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,A){b.__proto__=A}||function(b,A){for(var x in A)A.hasOwnProperty(x)&&(b[x]=A[x])})(m,S)};function Dt(m,S){function b(){this.constructor=m}B(m,S),m.prototype=null===S?Object.create(S):(b.prototype=S.prototype,new b)}var D=function(){return(D=Object.assign||function(S){for(var b,A=1,x=arguments.length;A<x;A++)for(var T in b=arguments[A])Object.prototype.hasOwnProperty.call(b,T)&&(S[T]=b[T]);return S}).apply(this,arguments)};function Te(m,S){var b={};for(var A in m)Object.prototype.hasOwnProperty.call(m,A)&&S.indexOf(A)<0&&(b[A]=m[A]);if(null!=m&&"function"==typeof Object.getOwnPropertySymbols){var x=0;for(A=Object.getOwnPropertySymbols(m);x<A.length;x++)S.indexOf(A[x])<0&&Object.prototype.propertyIsEnumerable.call(m,A[x])&&(b[A[x]]=m[A[x]])}return b}function St(m,S,b,A){var z,x=arguments.length,T=x<3?S:null===A?A=Object.getOwnPropertyDescriptor(S,b):A;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)T=Reflect.decorate(m,S,b,A);else for(var Y=m.length-1;Y>=0;Y--)(z=m[Y])&&(T=(x<3?z(T):x>3?z(S,b,T):z(S,b))||T);return x>3&&T&&Object.defineProperty(S,b,T),T}function Ne(m,S){return function(b,A){S(b,A,m)}}function Yt(m,S){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(m,S)}function de(m,S,b,A){return new(b||(b=Promise))(function(T,z){function Y(yt){try{tt(A.next(yt))}catch(pe){z(pe)}}function Xt(yt){try{tt(A.throw(yt))}catch(pe){z(pe)}}function tt(yt){yt.done?T(yt.value):function(T){return T instanceof b?T:new b(function(z){z(T)})}(yt.value).then(Y,Xt)}tt((A=A.apply(m,S||[])).next())})}function J(m,S){var A,x,T,z,b={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]};return z={next:Y(0),throw:Y(1),return:Y(2)},"function"==typeof Symbol&&(z[Symbol.iterator]=function(){return this}),z;function Y(tt){return function(yt){return function(tt){if(A)throw new TypeError("Generator is already executing.");for(;b;)try{if(A=1,x&&(T=2&tt[0]?x.return:tt[0]?x.throw||((T=x.return)&&T.call(x),0):x.next)&&!(T=T.call(x,tt[1])).done)return T;switch(x=0,T&&(tt=[2&tt[0],T.value]),tt[0]){case 0:case 1:T=tt;break;case 4:return b.label++,{value:tt[1],done:!1};case 5:b.label++,x=tt[1],tt=[0];continue;case 7:tt=b.ops.pop(),b.trys.pop();continue;default:if(!(T=(T=b.trys).length>0&&T[T.length-1])&&(6===tt[0]||2===tt[0])){b=0;continue}if(3===tt[0]&&(!T||tt[1]>T[0]&&tt[1]<T[3])){b.label=tt[1];break}if(6===tt[0]&&b.label<T[1]){b.label=T[1],T=tt;break}if(T&&b.label<T[2]){b.label=T[2],b.ops.push(tt);break}T[2]&&b.ops.pop(),b.trys.pop();continue}tt=S.call(m,b)}catch(yt){tt=[6,yt],x=0}finally{A=T=0}if(5&tt[0])throw tt[1];return{value:tt[0]?tt[1]:void 0,done:!0}}([tt,yt])}}}function ut(m,S,b,A){void 0===A&&(A=b),m[A]=S[b]}function Lt(m,S){for(var b in m)"default"!==b&&!S.hasOwnProperty(b)&&(S[b]=m[b])}function ee(m){var S="function"==typeof Symbol&&Symbol.iterator,b=S&&m[S],A=0;if(b)return b.call(m);if(m&&"number"==typeof m.length)return{next:function(){return m&&A>=m.length&&(m=void 0),{value:m&&m[A++],done:!m}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}function Tt(m,S){var b="function"==typeof Symbol&&m[Symbol.iterator];if(!b)return m;var x,z,A=b.call(m),T=[];try{for(;(void 0===S||S-- >0)&&!(x=A.next()).done;)T.push(x.value)}catch(Y){z={error:Y}}finally{try{x&&!x.done&&(b=A.return)&&b.call(A)}finally{if(z)throw z.error}}return T}function ge(){for(var m=[],S=0;S<arguments.length;S++)m=m.concat(Tt(arguments[S]));return m}function Xe(){for(var m=0,S=0,b=arguments.length;S<b;S++)m+=arguments[S].length;var A=Array(m),x=0;for(S=0;S<b;S++)for(var T=arguments[S],z=0,Y=T.length;z<Y;z++,x++)A[x]=T[z];return A}function ve(m){return this instanceof ve?(this.v=m,this):new ve(m)}function ct(m,S,b){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var x,A=b.apply(m,S||[]),T=[];return x={},z("next"),z("throw"),z("return"),x[Symbol.asyncIterator]=function(){return this},x;function z(Ot){A[Ot]&&(x[Ot]=function(ft){return new Promise(function(ht,Nt){T.push([Ot,ft,ht,Nt])>1||Y(Ot,ft)})})}function Y(Ot,ft){try{!function(Ot){Ot.value instanceof ve?Promise.resolve(Ot.value.v).then(tt,yt):pe(T[0][2],Ot)}(A[Ot](ft))}catch(ht){pe(T[0][3],ht)}}function tt(Ot){Y("next",Ot)}function yt(Ot){Y("throw",Ot)}function pe(Ot,ft){Ot(ft),T.shift(),T.length&&Y(T[0][0],T[0][1])}}function Ct(m){var S,b;return S={},A("next"),A("throw",function(x){throw x}),A("return"),S[Symbol.iterator]=function(){return this},S;function A(x,T){S[x]=m[x]?function(z){return(b=!b)?{value:ve(m[x](z)),done:"return"===x}:T?T(z):z}:T}}function mt(m){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b,S=m[Symbol.asyncIterator];return S?S.call(m):(m=ee(m),b={},A("next"),A("throw"),A("return"),b[Symbol.asyncIterator]=function(){return this},b);function A(T){b[T]=m[T]&&function(z){return new Promise(function(Y,Xt){!function(T,z,Y,Xt){Promise.resolve(Xt).then(function(tt){T({value:tt,done:Y})},z)}(Y,Xt,(z=m[T](z)).done,z.value)})}}}function Kt(m,S){return Object.defineProperty?Object.defineProperty(m,"raw",{value:S}):m.raw=S,m}function ne(m){if(m&&m.__esModule)return m;var S={};if(null!=m)for(var b in m)Object.hasOwnProperty.call(m,b)&&(S[b]=m[b]);return S.default=m,S}function qt(m){return m&&m.__esModule?m:{default:m}}function xt(m,S){if(!S.has(m))throw new TypeError("attempted to get private field on non-instance");return S.get(m)}function At(m,S,b){if(!S.has(m))throw new TypeError("attempted to set private field on non-instance");return S.set(m,b),b}},7698:(Xn,be,Bt)=>{"use strict";Bt.r(be),Bt.d(be,{__extends:()=>Dt,__assign:()=>D,__rest:()=>Te,__decorate:()=>St,__param:()=>Ne,__metadata:()=>Yt,__awaiter:()=>de,__generator:()=>J,__createBinding:()=>ut,__exportStar:()=>Lt,__values:()=>ee,__read:()=>Tt,__spread:()=>ge,__spreadArrays:()=>Xe,__await:()=>ve,__asyncGenerator:()=>ct,__asyncDelegator:()=>Ct,__asyncValues:()=>mt,__makeTemplateObject:()=>Kt,__importStar:()=>ne,__importDefault:()=>qt,__classPrivateFieldGet:()=>xt,__classPrivateFieldSet:()=>At});var B=function(m,S){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,A){b.__proto__=A}||function(b,A){for(var x in A)A.hasOwnProperty(x)&&(b[x]=A[x])})(m,S)};function Dt(m,S){function b(){this.constructor=m}B(m,S),m.prototype=null===S?Object.create(S):(b.prototype=S.prototype,new b)}var D=function(){return(D=Object.assign||function(S){for(var b,A=1,x=arguments.length;A<x;A++)for(var T in b=arguments[A])Object.prototype.hasOwnProperty.call(b,T)&&(S[T]=b[T]);return S}).apply(this,arguments)};function Te(m,S){var b={};for(var A in m)Object.prototype.hasOwnProperty.call(m,A)&&S.indexOf(A)<0&&(b[A]=m[A]);if(null!=m&&"function"==typeof Object.getOwnPropertySymbols){var x=0;for(A=Object.getOwnPropertySymbols(m);x<A.length;x++)S.indexOf(A[x])<0&&Object.prototype.propertyIsEnumerable.call(m,A[x])&&(b[A[x]]=m[A[x]])}return b}function St(m,S,b,A){var z,x=arguments.length,T=x<3?S:null===A?A=Object.getOwnPropertyDescriptor(S,b):A;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)T=Reflect.decorate(m,S,b,A);else for(var Y=m.length-1;Y>=0;Y--)(z=m[Y])&&(T=(x<3?z(T):x>3?z(S,b,T):z(S,b))||T);return x>3&&T&&Object.defineProperty(S,b,T),T}function Ne(m,S){return function(b,A){S(b,A,m)}}function Yt(m,S){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(m,S)}function de(m,S,b,A){return new(b||(b=Promise))(function(T,z){function Y(yt){try{tt(A.next(yt))}catch(pe){z(pe)}}function Xt(yt){try{tt(A.throw(yt))}catch(pe){z(pe)}}function tt(yt){yt.done?T(yt.value):function(T){return T instanceof b?T:new b(function(z){z(T)})}(yt.value).then(Y,Xt)}tt((A=A.apply(m,S||[])).next())})}function J(m,S){var A,x,T,z,b={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]};return z={next:Y(0),throw:Y(1),return:Y(2)},"function"==typeof Symbol&&(z[Symbol.iterator]=function(){return this}),z;function Y(tt){return function(yt){return function(tt){if(A)throw new TypeError("Generator is already executing.");for(;b;)try{if(A=1,x&&(T=2&tt[0]?x.return:tt[0]?x.throw||((T=x.return)&&T.call(x),0):x.next)&&!(T=T.call(x,tt[1])).done)return T;switch(x=0,T&&(tt=[2&tt[0],T.value]),tt[0]){case 0:case 1:T=tt;break;case 4:return b.label++,{value:tt[1],done:!1};case 5:b.label++,x=tt[1],tt=[0];continue;case 7:tt=b.ops.pop(),b.trys.pop();continue;default:if(!(T=(T=b.trys).length>0&&T[T.length-1])&&(6===tt[0]||2===tt[0])){b=0;continue}if(3===tt[0]&&(!T||tt[1]>T[0]&&tt[1]<T[3])){b.label=tt[1];break}if(6===tt[0]&&b.label<T[1]){b.label=T[1],T=tt;break}if(T&&b.label<T[2]){b.label=T[2],b.ops.push(tt);break}T[2]&&b.ops.pop(),b.trys.pop();continue}tt=S.call(m,b)}catch(yt){tt=[6,yt],x=0}finally{A=T=0}if(5&tt[0])throw tt[1];return{value:tt[0]?tt[1]:void 0,done:!0}}([tt,yt])}}}function ut(m,S,b,A){void 0===A&&(A=b),m[A]=S[b]}function Lt(m,S){for(var b in m)"default"!==b&&!S.hasOwnProperty(b)&&(S[b]=m[b])}function ee(m){var S="function"==typeof Symbol&&Symbol.iterator,b=S&&m[S],A=0;if(b)return b.call(m);if(m&&"number"==typeof m.length)return{next:function(){return m&&A>=m.length&&(m=void 0),{value:m&&m[A++],done:!m}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}function Tt(m,S){var b="function"==typeof Symbol&&m[Symbol.iterator];if(!b)return m;var x,z,A=b.call(m),T=[];try{for(;(void 0===S||S-- >0)&&!(x=A.next()).done;)T.push(x.value)}catch(Y){z={error:Y}}finally{try{x&&!x.done&&(b=A.return)&&b.call(A)}finally{if(z)throw z.error}}return T}function ge(){for(var m=[],S=0;S<arguments.length;S++)m=m.concat(Tt(arguments[S]));return m}function Xe(){for(var m=0,S=0,b=arguments.length;S<b;S++)m+=arguments[S].length;var A=Array(m),x=0;for(S=0;S<b;S++)for(var T=arguments[S],z=0,Y=T.length;z<Y;z++,x++)A[x]=T[z];return A}function ve(m){return this instanceof ve?(this.v=m,this):new ve(m)}function ct(m,S,b){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var x,A=b.apply(m,S||[]),T=[];return x={},z("next"),z("throw"),z("return"),x[Symbol.asyncIterator]=function(){return this},x;function z(Ot){A[Ot]&&(x[Ot]=function(ft){return new Promise(function(ht,Nt){T.push([Ot,ft,ht,Nt])>1||Y(Ot,ft)})})}function Y(Ot,ft){try{!function(Ot){Ot.value instanceof ve?Promise.resolve(Ot.value.v).then(tt,yt):pe(T[0][2],Ot)}(A[Ot](ft))}catch(ht){pe(T[0][3],ht)}}function tt(Ot){Y("next",Ot)}function yt(Ot){Y("throw",Ot)}function pe(Ot,ft){Ot(ft),T.shift(),T.length&&Y(T[0][0],T[0][1])}}function Ct(m){var S,b;return S={},A("next"),A("throw",function(x){throw x}),A("return"),S[Symbol.iterator]=function(){return this},S;function A(x,T){S[x]=m[x]?function(z){return(b=!b)?{value:ve(m[x](z)),done:"return"===x}:T?T(z):z}:T}}function mt(m){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b,S=m[Symbol.asyncIterator];return S?S.call(m):(m=ee(m),b={},A("next"),A("throw"),A("return"),b[Symbol.asyncIterator]=function(){return this},b);function A(T){b[T]=m[T]&&function(z){return new Promise(function(Y,Xt){!function(T,z,Y,Xt){Promise.resolve(Xt).then(function(tt){T({value:tt,done:Y})},z)}(Y,Xt,(z=m[T](z)).done,z.value)})}}}function Kt(m,S){return Object.defineProperty?Object.defineProperty(m,"raw",{value:S}):m.raw=S,m}function ne(m){if(m&&m.__esModule)return m;var S={};if(null!=m)for(var b in m)Object.hasOwnProperty.call(m,b)&&(S[b]=m[b]);return S.default=m,S}function qt(m){return m&&m.__esModule?m:{default:m}}function xt(m,S){if(!S.has(m))throw new TypeError("attempted to get private field on non-instance");return S.get(m)}function At(m,S,b){if(!S.has(m))throw new TypeError("attempted to set private field on non-instance");return S.set(m,b),b}}}]);